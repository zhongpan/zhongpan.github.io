<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[å¹´ç»ˆæ€»ç»“-å‰ç«¯æ˜“ç”¨æ€§è§„èŒƒ]]></title>
    <url>%2F2020%2F12%2F30%2F042-front-end-usability-specfication%2F</url>
    <content type="text"><![CDATA[ä»Žä»Šå¹´7æœˆä»½å¼€å§‹ï¼Œå› ä¸ºå…¬å¸éœ€è¦ï¼ŒäºŸéœ€è§£å†³äº§å“æ˜“ç”¨æ€§ç—›ç‚¹é—®é¢˜ï¼Œæˆ‘å¼€å§‹å‰ç«¯æ˜“ç”¨æ€§æ”¹è¿›å·¥ä½œï¼Œæˆ‘æ€»ç»“äº†æ˜“ç”¨æ€§çš„6ä¸ªæ–¹é¢ï¼Œæ¢³ç†å‡º24ä¸ªæ”¹è¿›ç‚¹ï¼Œåœ¨éšåŽçš„ç‰ˆæœ¬ä¸­é€æ­¥è½åœ°ï¼Œç›®å‰å¤§éƒ¨åˆ†æ”¹è¿›ç‚¹éƒ½å¾—åˆ°è½å®žï¼Œäº§å“çš„æ˜“ç”¨æ€§å¾—åˆ°æžå¤§çš„æ”¹è§‚ï¼Œå‡ ä¸ªæœˆçš„è¾›å‹¤ä»˜å‡ºç»ˆæœ‰æˆæžœï¼Œå¿ƒä¸­ç”šæ˜¯æ¬£æ…°ã€‚ä¸Žæ­¤åŒæ—¶ï¼Œæˆ‘ä¹Ÿè´Ÿè´£å‰ç«¯çš„è®¾è®¡å¼€å‘ä»¥åŠå‰ç«¯è´Ÿè´£äººå·¥ä½œï¼Œè¿˜å¥½è‡ªå·±çš„åŸºæœ¬åŠŸæ‰Žå®žðŸ˜Šï¼Œè™½ç„¶ä¸€ç›´ä»Žäº‹åŽç«¯ç ”å‘ï¼ŒæžçŸ­çš„æ—¶é—´å†…ï¼Œæˆ‘å·²ç»å¯ä»¥å¨´ç†Ÿçš„è¿›è¡Œå‰ç«¯å¼€å‘å’Œè§£å†³å„ç§ç–‘éš¾é—®é¢˜ï¼Œè€Œå›¢é˜Ÿç®¡ç†æ›´æ˜¯æˆ‘æ“…é•¿çš„ï¼Œå›¢é˜Ÿæœ‰æˆå‘˜å¯¹æˆ‘è¯´ï¼Œä½ è¦æ˜¯æ—©ç‚¹æ¥å°±å¥½äº†ï¼Œæˆ‘å°±å¯ä»¥å­¦åˆ°æ›´å¤šä¸œè¥¿ï¼Œè¿™çœŸæ˜¯å¯¹æˆ‘æœ€å¤§çš„è¤’å¥–ã€‚çŸ­çŸ­å‡ ä¸ªæœˆçš„æ—¶é—´ï¼Œæˆ‘å·²ç»æŠŠå‰ç«¯çš„ä»£ç ç¿»äº†ä¸€éï¼Œè¯´å®žåœ¨ï¼Œä»¥å‰ä»£ç çš„è§„èŒƒæ€§éžå¸¸å·®ï¼Œç»„ä»¶å¤ç”¨æ€§æ›´å·®ï¼Œå®Œå…¨æ²¡æœ‰å¤ç”¨çš„æ€æƒ³ï¼Œæ•´ä¸ªå›¢é˜Ÿè¦æå‡çš„åœ°æ–¹å®žåœ¨å¤ªå¤šäº†ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘çŽ°å¾ˆå¤šé—®é¢˜ç»å¸¸é‡å¤å‡ºçŽ°ï¼Œä¾‹å¦‚æ®‹ç•™æ•°æ®çš„é—®é¢˜ï¼Œä¸€æ–¹é¢æ˜¯çŠ¶æ€ç®¡ç†ä½¿ç”¨ä¸å½“ï¼Œå…¨éƒ¨éƒ½æ˜¯ç”¨çš„å…¨å±€çŠ¶æ€ï¼Œå¦ä¸€æ–¹é¢æ˜¯æ²¡æœ‰é‡ç½®çŠ¶æ€çš„æ„è¯†ã€‚å› æ­¤æˆ‘å°†è¿‘å‡ ä¸ªæœˆçš„ç»éªŒæ€»ç»“æˆä¸€ä»½è§„èŒƒï¼Œä¸ä»…èƒ½å¤Ÿæå‡æ˜“ç”¨æ€§è€Œä¸”å¯ä»¥é¿å…å¾ˆå¤šå‰ç«¯Bugï¼Œä¹Ÿç®—æ˜¯ä¸€ä»½å¹´ç»ˆæ€»ç»“ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¯å‘å’Œå¸®åŠ©ã€‚ ä¸€.å‰è¨€ ä¸€ä¸ªæ˜“ç”¨çš„ç•Œé¢ä¼šç»™äººå¸¦æ¥èˆ’é€‚çš„ä½“éªŒï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿå¸å¼•ç”¨æˆ·ï¼Œæ‹‰è¿‘ç”¨æˆ·ä¸Žäº§å“ä¹‹é—´çš„è·ç¦»ï¼Œä»Žè€Œåˆ›é€ å¸‚åœºä»·å€¼ã€‚æ˜“ç”¨æ€§åŒ…å«å¦‚ä¸‹6ä¸ªæ–¹é¢ï¼š å¯æ“ä½œæ€§ï¼šç”¨æˆ·åœ¨è¿™ä¸ªç•Œé¢ä¸­æœ‰å¾ˆå¼ºæŽ§åˆ¶åŠ›ï¼› é”™è¯¯å¤„ç†ï¼šç”¨æˆ·å¾ˆå°‘ä¼šé€ æˆé”™è¯¯ï¼Œä»–ä»¬ä»Žé”™è¯¯ä¸­èµ°å‡ºå¾ˆå¿«ï¼› æ•ˆçŽ‡ï¼šç”¨æˆ·å®Œæˆä¸€ä¸ªä»»åŠ¡å¾ˆå¿«ï¼› å¸å¼•åŠ›ï¼šè¿™ä¸ªç•Œé¢å¾ˆå¸å¼•äººï¼Œè®©ç”¨æˆ·äº«å—ä½¿ç”¨çš„è¿‡ç¨‹ï¼› å¯ç†è§£æ€§ï¼šç”¨æˆ·å¾ˆå®¹æ˜“ç†è§£ä»–æ‰€çœ‹åˆ°çš„ï¼Œå¯¹äºŽä¸€ä¸ªæ–°ç”¨æˆ·æ¥è¯´ï¼Œå­¦ä¹ å¦‚ä½•åœ¨ç•Œé¢ä¸­æ“ä½œå¾ˆç®€å•ï¼› è§„èŒƒæ€§ï¼šç•Œé¢ä¾ä»Žè§„èŒƒã€æ ‡å‡†ã€‚ æœ¬è§„èŒƒå›´ç»•ä¸Šè¿°ç›®æ ‡ï¼Œä»Žä¸¤ä¸ªæ–¹é¢è§„èŒƒå’ŒæŒ‡å¯¼è®¾è®¡å¼€å‘è¿‡ç¨‹ï¼Œä»Žè€Œä¿è¯äº§å“çš„æ˜“ç”¨æ€§ï¼Œç¬¬ä¸€æ–¹é¢æ˜¯ç»„ä»¶è§„èŒƒï¼Œä¸»è¦è§£å†³å¸å¼•åŠ›å’Œè§„èŒƒæ€§é—®é¢˜ï¼Œä½¿å¾—äº§å“å…·æœ‰ç¾Žè§‚å’Œä¸€è‡´çš„ç•Œé¢é£Žæ ¼ï¼›ç¬¬äºŒæ–¹é¢æ˜¯è®¾è®¡è§„èŒƒï¼Œä¸»è¦è§£å†³å¯æ“ä½œæ€§ã€é”™è¯¯å¤„ç†ã€æ•ˆçŽ‡ã€å¯ç†è§£æ€§å’Œè§„èŒƒæ€§æ–¹é¢çš„é—®é¢˜ï¼Œæ€»ç»“äº†æœ€ä½³çš„äº¤äº’è®¾è®¡å®žè·µï¼Œæå‡æ˜“ç”¨æ€§çš„åŒæ—¶ä¹Ÿèƒ½å¤Ÿé¿å…å¾ˆå¤šå‰ç«¯Bugã€‚ æœ¬è§„èŒƒä¸»è¦é¢å‘UCDè®¾è®¡å¸ˆå’Œå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œåœ¨è¿›è¡ŒåŽŸåž‹è®¾è®¡å’Œå‰ç«¯è®¾è®¡å¼€å‘æ—¶éœ€è¦ä¸¥æ ¼éµå¾ªæœ¬è§„èŒƒã€‚ äºŒ.ç»„ä»¶è§„èŒƒ æ¯ä¸€ä¸ªäº§å“æœ‰è‡ªå·±çš„ç•Œé¢é£Žæ ¼ï¼Œè¿™ç§é£Žæ ¼ä¸»è¦ä½“çŽ°åœ¨ç»„ä»¶çš„è§†è§‰è¡¨çŽ°ä¸Šï¼Œæ˜¯ä¸€ç§äº§å“æ˜¾è‘—åŒºåˆ«äºŽå¦ä¸€ä¸ªäº§å“çš„ä¸»è¦å› ç´ ã€‚å½“ä¸€ç§é£Žæ ¼ç¡®å®šä¸‹æ¥ä¹‹åŽï¼Œéœ€è¦é€šè¿‡ç»„ä»¶è§„èŒƒå½¢æˆç»Ÿä¸€çš„çº¦æŸï¼Œä½¿å¾—äº§å“é£Žæ ¼èƒ½å¤Ÿä¿æŒä¸€è‡´ã€‚ ç»„ä»¶è§„èŒƒä»¥å¹³é¢è®¾è®¡ç¨¿çš„æ–¹å¼å‘ˆçŽ°ï¼Œè¯¦è§[SVN](https://cloudsvn.fiberhome.com/develop_team/04 Portalç»„/08\ è´¨é‡æå‡/å‰ç«¯è®¾è®¡è§„èŒƒ/ç»„ä»¶è§„èŒƒ/FitOS_æ–°è§„èŒƒ.zip)ï¼Œä¸»è¦æ¶µç›–å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š 1.å¸ƒå±€å’Œå¯¼èˆª é¡µé¢ç»“æž„ èœå• ä¸»èœå•æœ€å¤šäºŒçº§ï¼Œä½ç½®ä¾§è¾¹æ æˆ–é¡¶éƒ¨ï¼Œä¸€çº§èœå•æœ‰å›¾æ ‡ é¢åŒ…å±‘ï¼Œèœå•å¸®åŠ© é¡µé¢ ä¸‰çº§é¡µç­¾å¯¼èˆªï¼ˆå¯é€‰ï¼‰ åˆ—è¡¨é¡µæˆ–æ¦‚è§ˆé¡µ è¯¦æƒ…é¡µï¼ˆå¯é€‰ï¼‰ å…¨å±€header 2.å›¾æ ‡ æ ¼å¼ï¼šsvgï¼Œçº¿æ¡†é£Žæ ¼ï¼Œå•è‰²ï¼ˆéšä¸»é¢˜è‰²å˜åŒ–ï¼‰ å¤§å°ï¼š äº¤äº’æ•ˆæžœï¼šhoverï¼Œé€‰ä¸­ 3.é¢œè‰² ä¸»é¢˜è‰² è¾…åŠ©è‰² ä¸­æ€§è‰² åŠŸèƒ½è‰² ç‰¹æ®Šè‰² 4.å­—ä½“å­—å· å­—ä½“ å­—å· åŠ ç²— è¡Œé«˜ 5.ç»„ä»¶ è¡¨æ ¼ æŒ‰é’® é¡µç­¾ å¯¹è¯æ¡† å‘å¯¼ è¡¨å• ä¸‰.è®¾è®¡è§„èŒƒ è®¾è®¡è§„èŒƒä¸»è¦ä»Žäº¤äº’è®¾è®¡å’Œå¼€å‘å®žçŽ°çš„è§’åº¦ï¼Œæ€»ç»“æœ€ä½³è®¾è®¡å®žè·µï¼Œæå‡ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒã€‚è®¾è®¡è§„èŒƒåˆ†å¼ºåˆ¶å’Œå»ºè®®çº§åˆ«ï¼Œå¼ºåˆ¶çº§åˆ«å¿…é¡»éµå®ˆï¼ŒåŒ…æ‹¬å·²æœ‰åŠŸèƒ½å’Œæ–°åŠŸèƒ½ï¼Œå»ºè®®çº§åˆ«å¯è‡ªè¡Œå†³å®šæ˜¯å¦é‡‡ç”¨ï¼Œä½†æ˜¯ä¸€æ—¦é‡‡ç”¨åˆ™å¿…é¡»æ‰€æœ‰åŠŸèƒ½ä¿æŒä¸€è‡´ã€‚ 1.è·¯ç”± ã€å¼ºåˆ¶ã€‘äºŒçº§èœå•ï¼Œä¸‰çº§é¡µç­¾ï¼Œè¯¦æƒ…é¡µå‡æœ‰ç‹¬ç«‹çš„URLï¼ŒURLä¸èƒ½æºå¸¦queryå‚æ•°ã€‚ ã€å¼ºåˆ¶ã€‘è¯¦æƒ…é¡µé€šè¿‡URLç›´æŽ¥è®¿é—®ï¼Œä¸èƒ½ä»Žåˆ—è¡¨èŽ·å–ä»»ä½•æ•°æ®ã€‚ ã€å¼ºåˆ¶ã€‘è¯¦æƒ…é¡µçš„URLä¸€èˆ¬æ ¼å¼æ˜¯ï¼š{åˆ—è¡¨é¡µURL}/{id}ï¼Œå­˜åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœ‰ä¸€äº›æ²¡æœ‰å­˜åº“çš„èµ„æºï¼Œåº•å±‚openstackè¯¦æƒ…æŽ¥å£éœ€è¦åŒæ—¶ä¼ idå’Œnameï¼Œè¿™æ—¶è¯¦æƒ…é¡µçš„URLæ ¼å¼ä¸ºï¼š{åˆ—è¡¨é¡µURL}/{id}/{name}ï¼Œå¦‚é‡å…¶ä»–ç‰¹æ®Šæƒ…å†µéœ€è¦æ›´æ–°è§„èŒƒï¼Œåˆ—ä¸¾åœ¨æ­¤ã€‚ ã€å¼ºåˆ¶ã€‘å‡¡æ˜¯æœ‰è¯¦æƒ…é¡µçš„ï¼Œæ“ä½œæ—¥å¿—ä¸­éœ€è¦èƒ½å¤Ÿæ”¯æŒè·³è½¬ï¼Œåˆ é™¤æ“ä½œé™¤å¤–ï¼Œå…¶ä»–é¡µé¢æ˜¯å¦åšè·³è½¬çš„åŽŸåˆ™ï¼š è·³è½¬ç¡®å®žå¯¹ç”¨æˆ·æœ‰å¸®åŠ©ï¼Œèƒ½å¤Ÿé€šè¿‡è·³è½¬åŽçš„è¯¦æƒ…é¡µæŸ¥çœ‹æœ‰ç”¨çš„ä¿¡æ¯ã€‚ å¦‚æžœæŸç§èµ„æºåšè¿‡è·³è½¬ï¼Œé‚£ä¹ˆæ‰€æœ‰é¡µé¢ä¿æŒä¸€è‡´ï¼Œä¾‹å¦‚ç§ç½‘çš„VPCåšäº†è·³è½¬ï¼Œé‚£ä¹ˆå…¶ä»–é¡µé¢çš„VPCä¹Ÿéƒ½åšè·³è½¬ã€‚ è·³è½¬é€šè¿‡åå­—è·³è½¬ï¼Œæ²¡æœ‰åå­—åˆ™ä½¿ç”¨idã€‚ ã€å¼ºåˆ¶ã€‘ç‚¹å‡»ä¸€çº§èœå•ï¼Œå±•å¼€äºŒçº§èœå•ï¼›ç‚¹å‡»äºŒçº§èœå•ï¼Œæ˜¾ç¤ºå¯¹åº”åˆ—è¡¨é¡µæˆ–è€…è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‰çº§é¡µç­¾çš„ç¬¬ä¸€ä¸ªé¡µç­¾ï¼›ä¸‰çº§é¡µç­¾åˆ‡æ¢é¡µç­¾ï¼Œå±•ç¤ºç›¸åº”åˆ—è¡¨é¡µï¼ŒURLä¹Ÿéšä¹‹åˆ‡æ¢ã€‚ ã€å¼ºåˆ¶ã€‘è¿›å…¥äºŒçº§èœå•åŽï¼ŒäºŒçº§èœå•ä¿æŒé«˜äº®ã€‚ ã€å¼ºåˆ¶ã€‘åˆ—è¡¨é¡µé€šè¿‡åå­—åˆ—é“¾æŽ¥è·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œæ²¡æœ‰åå­—åˆ™é€šè¿‡idåˆ—ï¼Œå¦‚æžœåˆ—è¡¨å·²ç»åŒ…å«äº†è¯¦æƒ…çš„æ‰€æœ‰ä¿¡æ¯ï¼Œåˆ™å¯ä»¥ä¸å®žçŽ°è¯¦æƒ…é¡µã€‚ ã€å»ºè®®ã€‘è¯¦æƒ…é¡µå¯ä»¥é€šè¿‡é¢åŒ…å±‘è¿›è¡Œåˆ‡æ¢ï¼Œä¸éœ€è¦è¿”å›žåˆ—è¡¨é¡µå†åˆ‡æ¢ã€‚ 2.æ“æŽ§ ã€å»ºè®®ã€‘åˆ—è¡¨é¡µå’Œè¯¦æƒ…é¡µéƒ½å¯ä»¥å‘èµ·æ“ä½œã€‚ ã€å»ºè®®ã€‘è¡¨æ ¼æä¾›æ‰¹é‡æ“ä½œå…¥å£ã€‚ ã€å¼ºåˆ¶ã€‘ç‚¹å‡»ç­‰äº‹ä»¶ä¸è¦è¿›è¡Œä¼ æ’­ï¼Œä¾‹å¦‚ç‚¹å‡»tooltipï¼Œä¸è¦ä¼ æ’­åˆ°tooltipåŽé¢çš„ç»„ä»¶ã€‚ ã€å¼ºåˆ¶ã€‘æ“ä½œæµç¨‹ä¸­ä¸èƒ½å‡ºçŽ°è·³è½¬åˆ°å…¶ä»–é¡µé¢è€Œä¸­æ–­å½“å‰æµç¨‹ï¼Œåº”è¯¥é‡‡ç”¨å¼¹å‡ºå¯¹è¯æ¡†æ–¹å¼ï¼Œä¿è¯å½“å‰æ“ä½œæµç¨‹èƒ½å¤Ÿç»§ç»­ã€‚ ã€å¼ºåˆ¶ã€‘å…¨å±€headerå›ºå®šåœ¨é¡¶éƒ¨ï¼Œæ»šåŠ¨æ—¶æ€»æ˜¯å›ºå®šåœ¨é¡¶éƒ¨ã€‚ ã€å¼ºåˆ¶ã€‘éœ€è¦æŽ§åˆ¶tooltipæ˜¾ç¤ºçš„ä½ç½®ï¼Œä¸è¦é®ç›–æŒ‰é’®ç­‰ç”¨æˆ·äº¤äº’å…ƒç´ ã€‚ ã€å»ºè®®ã€‘å½“æ›´å¤šæ“ä½œè¶…è¿‡10ä¸ªæ—¶ï¼Œéœ€å¯¹æ“ä½œè¿›è¡Œåˆ†ç»„å¹¶æ¨ªå‘æŽ’åˆ—ï¼Œæ¯åˆ—æœ€å¤šæ˜¾ç¤º10ä¸ªæ“ä½œã€‚ ã€å»ºè®®ã€‘åˆ—è¡¨è¡Œæ“ä½œï¼Œå½“æ“ä½œå°äºŽç­‰äºŽ4ä¸ªæ—¶ï¼Œå…¨éƒ¨å›ºå®šæ˜¾ç¤ºï¼Œè¶…è¿‡4ä¸ªæ—¶ï¼Œå›ºå®šç¼–è¾‘ï¼Œåˆ é™¤ï¼Œå…¶ä»–æ”¾å…¥æ›´å¤šã€‚ ã€å¼ºåˆ¶ã€‘ä¸æ”¯æŒçš„æ“ä½œä¸æ˜¾ç¤ºï¼Œå¯¹äºŽå›ºå®šæ˜¾ç¤ºçš„æ“ä½œåˆ™ç½®ç°ã€‚ ã€å»ºè®®ã€‘èƒ½å¤Ÿä¸€é¡µå®Œæˆçš„å°±ä¸è¦ä½¿ç”¨å‘å¯¼åˆ†å¤šæ­¥å®Œæˆã€‚ ã€å»ºè®®ã€‘æ–°å»ºçˆ¶å¯¹è±¡åŽç›´æŽ¥è·³è½¬åˆ°è¯¦æƒ…é¡µæ–°å»ºå­å¯¹è±¡ã€‚ ã€å¼ºåˆ¶ã€‘ä¸‹æ‹‰æ¡†å½“é¡µé¢æ»šåŠ¨æ—¶ä¸èƒ½å’Œé€‰æ‹©å™¨åˆ†ç¦»ï¼Œè€Œæ˜¯è™½åˆ™é€‰æ‹©å™¨æ»šåŠ¨è€Œæ»šåŠ¨ã€‚ ã€å»ºè®®ã€‘umiçš„loadingæ˜¯æŽ¥å£ç²’åº¦ï¼Œåˆ—è¡¨æŸè¡Œçš„æ“ä½œæœªè¿”å›žä¼šé˜»å¡žå…¶ä»–è¡Œæ“ä½œï¼Œæ­¤æ—¶éœ€è¦è‡ªå·±å®žçŽ°è¡Œç²’åº¦çš„loadingã€‚ ã€å¼ºåˆ¶ã€‘å¯¹è¯æ¡†å®Œæˆæ—¶ï¼Œæ“ä½œå¤±è´¥åˆ™å¯¹è¯æ¡†ä¸å…³é—­ï¼ŒæˆåŠŸåˆ™å…³é—­ã€‚ ã€å¼ºåˆ¶ã€‘åˆ—è¡¨æ”¯æŒç‚¹å‡»è¡Œä»»æ„ä½ç½®é€‰ä¸­ï¼Œæ­¤æ—¶å•å…ƒæ ¼äº‹ä»¶ä¼˜å…ˆçº§æ›´é«˜ï¼Œå¦‚æžœå“åº”å•å…ƒæ ¼äº‹ä»¶ï¼Œåˆ™ä¸å†é€‰ä¸­è¡Œï¼Œç¬¦åˆè§„åˆ™3ã€‚ ã€å¼ºåˆ¶ã€‘åˆ—è¡¨ä¸å¯é€‰æ‹©çš„è¡Œç½®ç°ã€‚ 3.è¾“å…¥ ã€å»ºè®®ã€‘å¯¹äºŽä¸å¤ªé‡è¦çš„å­—æ®µæä¾›é»˜è®¤å€¼ï¼Œå¦‚å­ç½‘åç§°ï¼Œä½œç”¨ä¸å¤ªå¤§ï¼Œå¯ä½¿ç”¨é»˜è®¤å€¼ã€‚ ã€å¼ºåˆ¶ã€‘å¯¹äºŽå¯æžšä¸¾æ•°æ®ï¼Œä¸è¦ä½¿ç”¨è¾“å…¥æ¡†ï¼Œé€‰é¡¹å°äºŽç­‰äºŽ3é¡¹æ—¶ï¼Œä½¿ç”¨å¹³é“ºçš„å•é€‰æŽ§ä»¶ï¼Œå¤§äºŽ3é¡¹æ—¶ä½¿ç”¨ä¸‹æ‹‰é€‰æ‹©æŽ§ä»¶ã€‚ ã€å»ºè®®ã€‘IPæ®µçš„è¾“å…¥æ ¹æ®æŽ©ç ç®€åŒ–åœ°å€çš„è¾“å…¥ã€‚ ã€å»ºè®®ã€‘IPåœ°å€æ± çš„è¾“å…¥è¦å°†å¤æ‚çš„è¯­æ³•è½¬æ¢ä¸ºç”¨æˆ·çš„äº¤äº’è¾“å…¥ï¼Œè¯­æ³•ä¸ç›´æŽ¥æš´éœ²ç»™ç”¨æˆ·ã€‚ ã€å¼ºåˆ¶ã€‘ä¸‹æ‹‰é€‰æ‹©å†…å®¹å¤šäºŽ10é¡¹æ—¶æä¾›æœç´¢ã€‚ ã€å¼ºåˆ¶ã€‘æœç´¢è¾“å…¥æ¡†æä¾›æ¸…é™¤æŒ‰é’®ã€‚ ã€å»ºè®®ã€‘åœ¨é€‚å½“çš„åœ°æ–¹æä¾›æ‹–æ‹½åŠŸèƒ½ï¼šä¾‹å¦‚ä¸Šä¼ æ–‡ä»¶é€‰æ‹©ã€‚ ã€å»ºè®®ã€‘æœ‰æ˜Žç¡®èŒƒå›´çš„æ•°å€¼è¾“å…¥ä½¿ç”¨æ•°å­—è¾“å…¥ç»„ä»¶ï¼Œè¾“å…¥è¶…è¿‡æœ€å¤§å€¼æ—¶è‡ªåŠ¨å˜ä¸ºæœ€å¤§å€¼ï¼Œè¾“å…¥å°äºŽæœ€å°å€¼æ—¶è‡ªåŠ¨å˜ä¸ºæœ€å°å€¼ã€‚ ã€å¼ºåˆ¶ã€‘ä¸‹æ‹‰é€‰æ‹©å†…å®¹æ˜¾ç¤ºä¸å®Œæ•´æ—¶éœ€è¦tooltipã€‚ 4.æç¤ºä¸Žåé¦ˆ ã€å¼ºåˆ¶ã€‘æ‰€æœ‰ç”¨æˆ·è¾“å…¥ï¼Œå‰ç«¯éœ€è¦å¯¹é•¿åº¦ã€èŒƒå›´ã€æ ¼å¼è¿›è¡Œæœ¬åœ°æ ¡éªŒï¼Œæ ¡éªŒé€šè¿‡æ‰èƒ½ä¸‹å‘åŽå°ã€‚ ã€å¼ºåˆ¶ã€‘æ“ä½œç½®ç°æç¤ºæ–¹å¼æ˜¯å³ä¾§æ”¾ç½®é—®å·å›¾æ ‡ï¼Œé—®å·å›¾æ ‡ä¸Štooltipç»™å‡ºæç¤ºã€‚ ã€å¼ºåˆ¶ã€‘æŒ‰é’®ç½®ç°æç¤ºæ–¹å¼æ˜¯ç›´æŽ¥tooltipç»™å‡ºæç¤ºã€‚ ã€å¼ºåˆ¶ã€‘è¾“å…¥æŽ§ä»¶çš„æç¤ºæ”¾åœ¨æŽ§ä»¶ä¸‹æ–¹ï¼Œä¸è¦é€šè¿‡åœ¨labelæ—çš„é—®å·å›¾æ ‡ç»™å‡ºæç¤ºã€‚ ã€å¼ºåˆ¶ã€‘è¾“å…¥é”™è¯¯æç¤ºé€šè¿‡å†’æ³¡æ–¹å¼å®žæ—¶æç¤ºã€‚ ã€å¼ºåˆ¶ã€‘ç”¨æˆ·è§¦å‘é¡µé¢åŠ è½½æ—¶ï¼Œé¡µé¢å’ŒæŒ‰é’®éœ€è¦loadingæ•ˆæžœï¼Œå®šæ—¶åˆ·æ–°æ—¶ä¸è¦loadingã€‚ ã€å¼ºåˆ¶ã€‘æŒ‰é’®ä¸èƒ½æ“ä½œæ—¶ç½®ç°ä¸å¯ç”¨ã€‚ ã€å»ºè®®ã€‘ç¼–è¾‘æ“ä½œï¼Œç”¨æˆ·æ²¡æœ‰æ”¹å˜æ•°æ®æ—¶ï¼Œä¸å¯ä¸‹å‘åŽå°ã€‚ ã€å¼ºåˆ¶ã€‘åŽç«¯è¯·æ±‚è¿”å›žæç¤ºä½¿ç”¨é€šçŸ¥ç»„ä»¶ï¼Œæµè§ˆå™¨å³ä¾§å¼¹å‡ºï¼ŒæˆåŠŸåˆ™åœç•™5ç§’è‡ªåŠ¨å…³é—­ï¼Œå¤±è´¥ä¸è‡ªåŠ¨å…³é—­ï¼Œç”¨æˆ·å¯æ‰‹åŠ¨å…³é—­ã€‚è¯¦æƒ…é»˜è®¤æ”¶èµ·ï¼Œå¦‚æžœå¤±è´¥ï¼Œåˆ™è‡ªåŠ¨å±•å¼€è¯¦æƒ…ã€‚ ã€å»ºè®®ã€‘å¼‚æ­¥æ“ä½œè¯·æ±‚æç¤ºä¸è‡ªåŠ¨å…³é—­ï¼Œå½“æ“ä½œçœŸæ­£å®Œæˆæ—¶åŽç«¯æŽ¨é€æ¶ˆæ¯ç»™å‰ç«¯ï¼Œæ­¤æ—¶åœ¨åŽŸæ¥çš„æ¶ˆæ¯æç¤ºä¸­ç»™å‡ºæœ€ç»ˆç»“æžœï¼ŒåŽç»­åŒä¸Šã€‚ ã€å¼ºåˆ¶ã€‘å…¨å±€æ¶ˆæ¯æç¤ºä½¿ç”¨æ¶ˆæ¯ç»„ä»¶ï¼Œè¦ä¹ˆåµŒå…¥é¡µé¢ä¸­ï¼Œç”¨æˆ·å¯å…³é—­ã€‚è¦ä¹ˆæµè§ˆå™¨ä¸Šæ–¹å¼¹å‡ºï¼Œåœç•™4ç§’è‡ªåŠ¨å…³é—­ï¼Œç”¨æˆ·ä¸å¯æ‰‹åŠ¨å…³é—­ã€‚æœ€å¤šæ˜¾ç¤º1ä¸ªå…¨å±€å¼¹å‡ºæ¶ˆæ¯ã€‚ ã€å¼ºåˆ¶ã€‘å±é™©æ“ä½œç»™å‡ºç¡®è®¤æç¤ºï¼Œç”¨æˆ·ç¡®è®¤ä¹‹åŽæ‰ä¸‹å‘åŽå°ã€‚ ã€å¼ºåˆ¶ã€‘å¿…å¡«å­—æ®µåœ¨labelçš„å·¦ä¾§å¿…é¡»æœ‰çº¢è‰²çš„*ã€‚ ã€å»ºè®®ã€‘æ–‡æœ¬è¾“å…¥æ¡†è¦æœ‰ç°è‰²å ä½ç¬¦ï¼Œæç¤ºç”¨æˆ·éœ€è¦è¾“å…¥ä»€ä¹ˆå†…å®¹ã€‚ ã€å¼ºåˆ¶ã€‘æ²¡æœ‰æ•°æ®æ—¶ï¼Œéœ€è¦æœ‰ç©ºçŠ¶æ€æ–‡å­—å’Œå›¾æ ‡æç¤ºã€‚ 5.æ•°æ®ç®¡ç† ã€å¼ºåˆ¶ã€‘æ‰€æœ‰é¡µé¢éœ€è¦æä¾›æ‰‹å·¥åˆ·æ–°ï¼Œæœ‰çŠ¶æ€å˜åŒ–çš„é¡µé¢éœ€è¦æ”¯æŒè‡ªåŠ¨åˆ·æ–°ã€‚ ã€å¼ºåˆ¶ã€‘ä½¿ç”¨å®šæ—¶å™¨æ—¶éœ€è¦éžå¸¸å°å¿ƒï¼Œé¿å…å‡ºçŽ°åƒµå°¸å®šæ—¶å™¨ï¼Œè¿™é€šå¸¸æ˜¯ç”±äºŽæ‰“å¼€å®šæ—¶å™¨å’Œæ¸…é™¤å®šæ—¶å™¨æ²¡æœ‰é…å¯¹ï¼Œé‡å¤æ‰“å¼€äº†å®šæ—¶å™¨ï¼Œè¿™æ ·å‰ä¸€ä¸ªå®šæ—¶å™¨å°±æ°¸è¿œå…³é—­ä¸äº†ï¼Œå¥½çš„ä¹ æƒ¯æ˜¯åœ¨æ‰“å¼€å®šæ—¶å™¨ä¹‹å‰æ€»æ˜¯å…ˆæ¸…é™¤ä¸€ä¸‹ã€‚ ã€å¼ºåˆ¶ã€‘å¯¹è¯æ¡†å…³é—­æˆ–å®ŒæˆåŽï¼Œéœ€è¦æ¸…é™¤ä¸Šä¸€æ¬¡æ•°æ®ï¼Œé¿å…å†æ¬¡æ‰“å¼€å¯¹è¯æ¡†å‡ºçŽ°æ•°æ®æ®‹ç•™ï¼Œç‰¹åˆ«çš„antd formçš„æ•°æ®éœ€è¦resetFieldsæˆ–setFieldsValueæ¸…é™¤ã€‚æ¸…é™¤æ•°æ®å‰å…ˆéšè—å¯¹è¯æ¡†ï¼Œé¿å…å¯¹è¯æ¡†å‡ºçŽ°é—ªå˜ã€‚ ã€å¼ºåˆ¶ã€‘ç¦»å¼€é¡µé¢ï¼ˆåŒ…æ‹¬é€šè¿‡æµè§ˆå™¨å›žé€€ï¼‰ï¼Œéœ€è¦æ¸…é™¤é¡µé¢çŠ¶æ€ï¼Œé¿å…å†æ¬¡å›žåˆ°é¡µé¢å‡ºçŽ°æ®‹ç•™ï¼Œå¦‚å¯¹è¯æ¡†è‡ªåŠ¨å‡ºçŽ°ã€‚ ã€å¼ºåˆ¶ã€‘åªæœ‰çŠ¶æ€éœ€è¦åœ¨å¤šä¸ªç»„ä»¶å…±äº«æ—¶æ‰æ”¾åˆ°reduxä¸­ï¼Œå¦åˆ™çŠ¶æ€ä¿å­˜åœ¨ç»„ä»¶ä¸­ã€‚è¿™æ ·å¯ä»¥é¿å…åˆ‡æ¢é¡µé¢åŽä¼šå…ˆæ˜¾ç¤ºä¸Šæ¬¡çš„æ•°æ®é—®é¢˜ï¼Œä¹Ÿå¯ä»¥é¿å…ä¸€äº›æ•°æ®æ®‹ç•™é—®é¢˜ã€‚ ã€å¼ºåˆ¶ã€‘å‘å¯¼é¡µé¢ä¸­å·²å¡«æ•°æ®ï¼Œåœ¨ä¸Šä¸‹æ­¥åˆ‡æ¢æ—¶éœ€è¦ä¿ç•™ã€‚ ã€å»ºè®®ã€‘å¿…é¡»è¿›è¡Œæ•°æ®é€‰æ‹©çš„é€‰æ‹©åˆ—è¡¨ï¼Œåªæœ‰ä¸€é¡¹æ•°æ®æ—¶ï¼Œé»˜è®¤é€‰ä¸­ã€‚ ã€å¼ºåˆ¶ã€‘å­—æ®µä¸ºnullæ—¶æ˜¾ç¤ºâ€“ï¼Œç©ºå­—ç¬¦ä¸²è¿˜æ˜¯æ˜¾ç¤ºå®žé™…å€¼ã€‚ ã€å¼ºåˆ¶ã€‘é¿å…å­—æ®µå‡ºçŽ°é‡å æˆ–è¶…å‡ºè¾¹æ¡†ï¼Œè¦è®©å­—æ®µè‡ªåŠ¨æ¢è¡Œæˆ–çœç•¥æ˜¾ç¤ºã€‚ ã€å¼ºåˆ¶ã€‘å­—æ®µè¿‡é•¿æ—¶çœç•¥æ˜¾ç¤ºï¼Œå¤‡æ³¨æœ€é•¿32ï¼Œå…¶ä»–æœ€é•¿16ï¼Œè¶…è¿‡é•¿åº¦åˆ™æˆªå–æœ€å¤§é•¿åº¦åŽè¿½åŠ â€¦æ˜¾ç¤ºï¼Œä¸­æ–‡ä¸€ä¸ªå­—é•¿åº¦æŒ‰1ç®—ã€‚ ã€å¼ºåˆ¶ã€‘åˆ—è¡¨æ•°æ®è¿‡å¤šæ—¶éœ€è¦ä½¿ç”¨åˆ†é¡µï¼Œæ”¯æŒåˆ†é¡µã€è·³é¡µã€è®¾å®šæ¯é¡µæ¡æ•°ã€‚ ã€å¼ºåˆ¶ã€‘è¡¨æ ¼æ”¯æŒå®½åº¦éšå±å¹•è‡ªé€‚åº”ï¼Œä¸å‡ºçŽ°æ¨ªå‘æ»šåŠ¨æ¡ã€‚ä½†æ˜¯ç¼©æ”¾å®½åº¦è¿‡å°ï¼Œæ— æ³•æ˜¾ç¤ºæ‰€æœ‰åˆ—æ—¶ï¼Œéœ€è¦æ¨ªå‘æ»šåŠ¨æ¡ã€‚ ã€å»ºè®®ã€‘å¯¹è¯æ¡†æ”¯æŒæ‹–åŠ¨å’Œæœ€å¤§åŒ–ã€‚ ã€å»ºè®®ã€‘ä¸å¸¸ç”¨é€‰å¡«å†…å®¹æ”¾å…¥[é«˜çº§é€‰é¡¹]ï¼Œé»˜è®¤æ”¶èµ·ã€‚ ã€å¼ºåˆ¶ã€‘åˆ—è¡¨ä¸­æžšä¸¾å­—æ®µéœ€è¦æ”¯æŒè¿‡æ»¤ï¼ˆä¾èµ–openstackåº•å±‚è¿‡æ»¤éœ€è¦è§†åº•å±‚æ˜¯å¦æ”¯æŒè€Œå®šï¼Œå¦‚åº•å±‚ä¸æ”¯æŒåˆ™æ— æ³•å®žçŽ°è¿‡æ»¤ï¼‰ã€‚ ã€å¼ºåˆ¶ã€‘åˆ—è¡¨ä¸­åç§°ï¼Œæ—¶é—´å­—æ®µéœ€è¦æ”¯æŒæŽ’åºï¼Œå…¶ä»–å­—æ®µè§†éœ€æ±‚è€Œå®šï¼ˆåŒæ ·ä¾èµ–åº•å±‚çš„è§†åº•å±‚èƒ½åŠ›è€Œå®šï¼‰ã€‚ ã€å¼ºåˆ¶ã€‘æ‰€æœ‰èµ„æºéƒ½éœ€è¦åˆ›å»ºå’Œæ›´æ–°æ—¶é—´å­—æ®µã€‚ ã€å¼ºåˆ¶ã€‘åˆ—è¡¨å­—æ®µæ”¯æŒè‡ªå®šä¹‰æ˜¾ç¤ºçš„åˆ—ï¼ŒæŸäº›åˆ—å¯å›ºå®šæ˜¾ç¤ºï¼Œä¸å…è®¸éšè—ã€‚ ã€å¼ºåˆ¶ã€‘åˆ—è¡¨æ”¯æŒå­—æ®µæ¨¡ç³Šæ£€ç´¢ï¼ˆåŒæ ·ä¾èµ–åº•å±‚çš„è§†åº•å±‚èƒ½åŠ›è€Œå®šï¼‰ã€‚ ã€å»ºè®®ã€‘å¤æ‚çš„åˆ—è¡¨éœ€è¦æ”¯æŒç»„åˆæ¡ä»¶æ£€ç´¢ï¼Œå¹¶èƒ½å¤Ÿä¿å­˜æŸ¥è¯¢æ¡ä»¶ï¼Œä»¥ä¾¿é‡å¤ä½¿ç”¨ã€‚ ã€å»ºè®®ã€‘åˆ—è¡¨æ”¯æŒå­—æ®µä¸ºç©ºçš„æ£€ç´¢ã€‚ 6.ä¸€è‡´æ€§ ã€å¼ºåˆ¶ã€‘ä¸­æ–‡çŽ¯å¢ƒï¼Œæ ‡ç‚¹ç»Ÿä¸€ç”¨ä¸­æ–‡æ ‡ç‚¹ã€‚ ã€å¼ºåˆ¶ã€‘ä¸­æ–‡çŽ¯å¢ƒï¼Œé™¤äº†å¸¸ç”¨çš„è‹±æ–‡ç¼©å†™ï¼Œå¦‚CPUï¼Œè‹±æ–‡éƒ½åº”è¯¥ç¿»è¯‘ä¸ºä¸­æ–‡ã€‚ ã€å¼ºåˆ¶ã€‘é”™è¯¯æç¤ºç»Ÿä¸€ä¸åŠ æ„Ÿå¹å·ã€‚ ã€å¼ºåˆ¶ã€‘ä¸“ä¸šæœ¯è¯­åœ¨ä¸åŒåœ°æ–¹ä¿æŒä¸€è‡´æ€§ã€‚ ã€å¼ºåˆ¶ã€‘æ‰€æœ‰é¡µé¢ç¬¦åˆç»„ä»¶è§„èŒƒã€‚ ã€å¼ºåˆ¶ã€‘æ‰€æœ‰é¡µé¢éœ€è¦é€‚é…å„ç§ä¸»é¢˜ï¼Œåœ¨å„ä¸»é¢˜ä¸‹æ˜¾ç¤ºæ­£å¸¸ï¼ŒåŒ…æ‹¬äº®è‰²ï¼Œæš—è‰²å’Œæš—é»‘ä¸»é¢˜ã€‚ 7.å…¼å®¹æ€§ ã€å¼ºåˆ¶ã€‘æµè§ˆå™¨è‡³å°‘æ”¯æŒchrome 85åŠä»¥ä¸Šå’Œfirefox 79åŠä»¥ä¸Šã€‚ ã€å¼ºåˆ¶ã€‘æœ€å°åˆ†è¾¨çŽ‡1366*768ï¼Œä¿è¯æ­¤åˆ†è¾¨çŽ‡åŠä»¥ä¸Šçš„æ˜¾ç¤ºæ­£å¸¸ã€‚]]></content>
      <categories>
        <category>design</category>
        <category>frontend</category>
      </categories>
      <tags>
        <tag>react</tag>
        <tag>frontend</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[jså®šæ—¶å™¨çš„é™·é˜±]]></title>
    <url>%2F2020%2F11%2F12%2F041-the-trap-of-js-timer%2F</url>
    <content type="text"><![CDATA[é¡¹ç›®é‡åˆ°ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œåˆ†é¡µæŸ¥è¯¢çš„é¡µé¢ä¼šè‡ªåŠ¨åœ¨ä¸¤é¡µä¹‹é—´è·³å˜ï¼ŒF5åˆ·æ–°ä¹‹åŽé—®é¢˜æ¶ˆå¤±ï¼Œç¬¬ä¸€æ¬¡æµ‹è¯•æŠ¥è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œè®©æµ‹è¯•æŒ‰ç…§æœ€è¿‘çš„æ“ä½œé‡è¯•ä¸€ä¸‹ï¼Œåˆé‡çŽ°äº†ä¸€æ¬¡ï¼Œæƒ³ç€åº”è¯¥æ˜¯å¿…çŽ°é—®é¢˜ï¼ŒåŽé¢å†çœ‹ï¼Œç»“æžœåŽé¢å†çœ‹çš„æ—¶å€™ï¼Œæ€Žä¹ˆéƒ½æ— æ³•é‡çŽ°äº†ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œé—®é¢˜åˆå†æ¬¡å‡ºçŽ°ï¼Œè¿™æ¬¡ä¸€å®šä¸èƒ½å†æ”¾è¿‡äº†ï¼ŒF12æŸ¥çœ‹ç½‘ç»œè°ƒç”¨ï¼Œå‘çŽ°ç¡®å®žä¼šå‘é€ä¸¤æ¬¡è°ƒç”¨ï¼Œä¸¤æ¬¡éƒ½æ˜¯å®šæ—¶åˆ·æ–°è§¦å‘çš„ï¼Œè‡ªæ­¤å¿ƒé‡ŒåŸºæœ¬æœ‰æ•°åº”è¯¥æ˜¯å®šæ—¶å™¨å¯¼è‡´çš„ã€‚æŽ¥ä¸‹æ¥é€šè¿‡åˆ†æžä»£ç ï¼Œç»ˆäºŽæ‰¾åˆ°é—®é¢˜çš„æ ¹æºï¼Œæ˜¯å› ä¸ºå‡ºçŽ°åƒµå°¸å®šæ—¶å™¨ï¼Œåœ¨èƒŒåŽè¿˜åœ¨ä¸€ç›´è¿è¡Œï¼Œå®ƒé‡Œé¢çš„çŠ¶æ€æ˜¯ä¸ä¼šå˜çš„ï¼Œå§‹ç»ˆæ˜¯æŸä¸€é¡µï¼Œè¿™æ ·åˆ‡æ¢åˆ°æ–°çš„é¡µä¹‹åŽï¼Œå°±ä¼šåœ¨ä¸¤é¡µä¹‹é—´è‡ªåŠ¨åˆ‡æ¢ã€‚è¿™ä¸ªé—®é¢˜è¿˜æŒºéšæ™¦çš„ï¼Œç‰¹æ­¤è®°å½•ä¸‹ã€‚ é—®é¢˜åˆ†æž é¡µé¢å¦‚ä¸‹ï¼š åˆ—è¡¨ä»£ç å¦‚ä¸‹ï¼Œé¡µé¢ç¬¬ä¸€æ¬¡åˆ›å»ºçš„æ—¶å€™è®¾ç½®å®šæ—¶å™¨timerListï¼Œå½“ç‚¹å‡»æ–°å»ºçš„æ—¶å€™ä¼šclearæŽ‰timerListï¼Œç„¶åŽæ–°å»ºçš„å®Œæˆæˆ–å–æ¶ˆçš„æ—¶å€™å†è°ƒç”¨openTimeræ¢å¤å®šæ—¶å™¨ã€‚ 12345678910111213141516171819202122232425262728componentDidMount() &#123; const &#123; dispatch &#125; = this.props; dispatch(&#123; type: 'image/getImageListByTid', &#125;); this.timerList = setInterval(this.timer, 5000);&#125;componentWillUnmount() &#123; clearInterval(this.timerList); clearInterval(this.timerModal);&#125;timer = () =&gt; &#123; const &#123; page &#125; = this.state; const &#123; dispatch &#125; = this.props; dispatch(&#123; type: 'image/getImageListByTid', payload: &#123; checkschedual: true, ...page, &#125;, &#125;);&#125;;openTimer = () =&gt; &#123; this.timerModal = setInterval(this.timer, 5000);&#125;; æ–°å»ºé•œåƒå®Œæˆçš„é€»è¾‘ï¼Œå›žè°ƒå‡½æ•°callbackä¸­è°ƒç”¨openTimerã€‚ 123456789101112131415161718192021222324okHandle = () =&gt; &#123; const &#123; dispatch, form, refresh, openTimer &#125; = this.props; const &#123; switcheValue &#125; = this.state; const callback = () =&gt; &#123; refresh(); openTimer(); &#125;; form.validateFields((err, fieldsValue) =&gt; &#123; if (err) return err; // console.log('file: ', fieldsValue); const data = &#123; ...fieldsValue, enable_integrity_check: switcheValue, // min_ram:fieldsValue.min_ram*1024, // åŽå°å•ä½MB &#125;; dispatch(&#123; type: 'image/createImage', payload: data, callback, &#125;); &#125;);&#125;; æ–°å»ºé•œåƒå–æ¶ˆçš„é€»è¾‘ï¼Œå›žè°ƒä¼šè°ƒç”¨openTimerã€‚ 123456789101112cancelHandle = () =&gt; &#123; const &#123; dispatch, openTimer &#125; = this.props; this.setState(&#123; step: 0, type: 'imagefile', &#125;); dispatch(&#123; type: 'image/addModal', payload: false, callback: openTimer, &#125;);&#125;; modelä»£ç ï¼ŒæˆåŠŸçš„æ—¶å€™å…³é—­å¯¹è¯æ¡†ï¼Œå¤±è´¥çš„æ—¶å€™ä¸å…³é—­å¯¹è¯æ¡†ã€‚ä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šè°ƒç”¨å›žè°ƒå‡½æ•°ã€‚ 123456789101112131415161718192021222324252627282930// é€šè¿‡é•œåƒåœ°å€åˆ›å»ºé•œåƒä¼šè°ƒç”¨è¯¥æ–¹æ³• *createImage(&#123; payload, callback &#125;, &#123; call, put &#125;) &#123; const formData = new FormData(); formData.append('name', payload.name); formData.append('disk_format', payload.disk_format); formData.append('fileurl', payload.fileurl); formData.append('hypervisor_type', payload.hypervisor_type); formData.append('min_disk', payload.min_disk); formData.append('min_ram', payload.min_ram); formData.append('system', payload.system); formData.append('version', payload.version); formData.append('description', payload.description); formData.append('visibility', payload.visibility); formData.append('type', payload.type); formData.append('back', payload.back); formData.append('enable_integrity_check', payload.enable_integrity_check); const response = yield call(createImage, formData); if (isResponseSuccess(response)) &#123; notification.success(&#123; message: 'æ“ä½œæˆåŠŸï¼', &#125;); yield put(&#123; type: 'addModal', payload: false, &#125;); &#125; else &#123; errorMessage(response); &#125; if (callback) callback(); &#125;, æ‰€ä»¥å¦‚æžœæ–°å»ºé•œåƒå¤±è´¥ï¼Œä¼šè°ƒç”¨ä¸€æ¬¡å›žè°ƒå‡½æ•°ï¼Œè®¾ç½®äº†å®šæ—¶å™¨ã€‚æ­¤æ—¶å¯¹è¯æ¡†è¿˜æ²¡å…³é—­ï¼Œä¸ç®¡æ˜¯å–æ¶ˆï¼Œè¿˜æ˜¯å†æ¬¡å®Œæˆï¼Œéƒ½ä¼šå†æ¬¡è°ƒç”¨openTimerï¼Œè€ŒopenTimerä¸­æ²¡æœ‰è¯·é™¤ä¸Šæ¬¡çš„å®šæ—¶å™¨ï¼Œé€ æˆäº†åƒµå°¸å®šæ—¶å™¨ã€‚ é—®é¢˜ä¿®æ”¹ è¦ä¹ˆmodelä¸­æ–°å»ºåªæœ‰æˆåŠŸæ‰è°ƒç”¨å›žè°ƒå‡½æ•°ï¼Œè¦ä¹ˆopenTimerä¸­æ€»æ˜¯å…ˆè¯·é™¤ä¸Šæ¬¡çš„å®šæ—¶å™¨ã€‚ é—®é¢˜å¯ç¤º setIntervalå’ŒclearIntervalå¿…é¡»æˆå¯¹å‡ºçŽ°ï¼ŒclearIntervalçš„å‚æ•°æ˜¯setIntervalçš„è¿”å›žå€¼ã€‚ç”¨æˆå‘˜å˜é‡è®°å½•setIntervalçš„è¿”å›žå€¼æ—¶ï¼Œå¦‚æžœé‡å¤è®¾ç½®setIntervalï¼Œä¸€å®šè¦æ³¨æ„è¯·é™¤ä¸Šæ¬¡çš„å®šæ—¶å™¨ï¼Œå¦åˆ™å°±ä¼šå‡ºçŽ°åƒµå°¸å®šæ—¶å™¨ã€‚ 123456openTimer = () =&gt; &#123; if (this.timerModal) &#123; clearInterval(this.timerModal); &#125; this.timerModal = setInterval(this.timer, 5000);&#125;; componentDidMountä¸­è®¾ç½®çš„å®šæ—¶å™¨ï¼Œæ³¨æ„åœ¨componentWillUnmountä¸­è¦è¯·é™¤ï¼Œå¦‚æžœç”¨useEffectä¼šæ›´å¥½ï¼Œè®¾ç½®å®šæ—¶å™¨å’Œæ¸…é™¤å®šæ—¶å™¨å¯ä»¥å†™åœ¨ä¸€èµ·ï¼Œä¸ç”¨åˆ†å¼€ï¼Œå¯ç»´æŠ¤æ€§æ›´å¥½ã€‚]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>react</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[antd dialogçš„ä¸€ä¸ªé—®é¢˜åˆ†æž]]></title>
    <url>%2F2020%2F10%2F27%2F037-analysis-of-a-problem-in-antd-dialog%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘é¡¹ç›®ä¸­ç¢°åˆ°ä¸€ä¸ªå¥‡æ€ªé—®é¢˜ï¼Œé¡¹ç›®æ˜¯react+antd+umiå®žçŽ°ï¼Œå½“é¡µé¢ä¸­ç‚¹å‡»å¯¹è¯æ¡†ï¼Œé¡µé¢ä¼šè‡ªåŠ¨æ»šåŠ¨åˆ°æœ€ä¸Šé¢ã€‚æœ€ç»ˆå®šä½è·Ÿantd dialogçš„å®žçŽ°æœ‰å…³ï¼Œåœ¨æŸç§æ¡ä»¶ä¸‹ä¼šè§¦å‘æ­¤é—®é¢˜ï¼Œä¸‹é¢åˆ†äº«ä¸€ä¸‹é—®é¢˜å®šä½è¿‡ç¨‹ï¼Œå¸Œæœ›å¯¹é‡åˆ°ç±»ä¼¼é—®é¢˜çš„åŒå­¦æœ‰æ‰€å¸®åŠ©ã€‚ é—®é¢˜çŽ°è±¡ åˆ—è¡¨é¡µæ»šåŠ¨åˆ°ä¸‹æ–¹ï¼Œç‚¹å‡»æ“ä½œå¼¹å‡ºå¯¹è¯æ¡†ï¼Œåˆ—è¡¨è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€ä¸Šé¢ã€‚æ­¤é—®é¢˜åœ¨ä¸Šä¸ªç‰ˆæœ¬è¿˜ä¸å­˜åœ¨ã€‚ é—®é¢˜å®šä½ ä¸€å®šæ˜¯è§¦å‘äº†æ»šåŠ¨äº‹ä»¶æ‰ä¼šæ»šåŠ¨åˆ°åˆ—è¡¨æœ€ä¸Šæ–¹ï¼Œæ€Žä¹ˆå®šä½å“ªé‡Œè§¦å‘çš„æ»šåŠ¨äº‹ä»¶å‘¢ï¼Œä»Žä»£ç å…¥æ‰‹æ¯«æ— å¤´ç»ªã€‚å¥½åœ¨å¯ä»¥é€šè¿‡æµè§ˆå™¨devtoolæ‰“æ–­ç‚¹ï¼Œè·Ÿè¸ªä¸€ä¸‹å“ªé‡Œè§¦å‘ã€‚é¦–å…ˆå°è¯•äº†scrolläº‹ä»¶ï¼Œç¡®å®žèƒ½å¤Ÿè¿›åˆ°æ–­ç‚¹ï¼Œä½†æ˜¯å †æ ˆåªæœ‰ä¸€è´žï¼Œæ²¡æ³•æ‰¾åˆ°æºå¤´ã€‚æŽ¥ç€å°è¯•äº†focusäº‹ä»¶ã€‚ è¿›åˆ°focusäº‹ä»¶æ—¶å·²ç»æ»šåŠ¨åˆ°ä¸Šæ–¹äº†ï¼Œæ­¤æ—¶æœ‰å †æ ˆä¿¡æ¯ï¼Œä»Žå †æ ˆå®šä½åˆ°rc-dialogï¼Œå…¶ä¸­æœ‰ä¸€å¥this.switchScrollingEffect()ï¼Œé«˜åº¦æ€€ç–‘è¿™é‡Œè§¦å‘äº†é—®é¢˜ï¼Œåœ¨è¿™é‡Œæ‰“ä¸Šæ–­ç‚¹ï¼Œè¯å®žäº†ç¡®å®žå¦‚æ­¤ã€‚ è¿›ä¸€æ­¥è°ƒè¯•åˆ°this.switchScrollingEffecté‡Œé¢ï¼Œé—®é¢˜è§¦å‘ç‚¹åœ¨setStyleè¿™é‡Œï¼Œè®¾ç½®äº†å¦‚ä¸‹æ ·å¼åŽï¼Œå°±ä¼šè§¦å‘æ»šåŠ¨åˆ°æœ€ä¸Šé¢ã€‚ switchScrollingEffectå¦‚ä¸‹ï¼š setStyleå¦‚ä¸‹ï¼š ç»“åˆæœ€è¿‘ä¿®æ”¹ä»£ç åå¤å°è¯•ï¼Œå‘çŽ°å¯¼è‡´ä¸Šé¢é—®é¢˜åœ¨äºŽå¦‚ä¸‹æ ·å¼ï¼š 1234html &#123; overflow-x: hidden; overflow-y: auto;&#125; ä¹Ÿå°±æ˜¯å½“htmlæœ‰å¦‚ä¸Šæ ·å¼(bodyæ²¡æœ‰ï¼Œå¦‚æžœbodyä¹Ÿæœ‰ä¹Ÿä¸ä¼šè§¦å‘é—®é¢˜ï¼‰ï¼Œå†è®¾ç½®bodyæ ·å¼{overflow: hidden, overflow-x: hidden, overflow-y: hidden}ï¼Œå°±ä¼šå‡ºçŽ°è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€ä¸Šé¢ã€‚ æ‰¾åˆ°é—®é¢˜åŽŸå› åŽæˆ‘å†™äº†ä¸€å°æ®µä»£ç æœ€å°åŒ–é‡çŽ°äº†è¿™ä¸ªé—®é¢˜ã€‚ 123456789101112131415&lt;html&gt; &lt;body id="content"&gt; &lt;button onclick="restore()"&gt; restore &lt;/button&gt;&lt;br&gt; sssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt;s&lt;br&gt; &lt;button onclick="setStyle()"&gt; setstyle &lt;/button&gt; &lt;button onclick="showsize()"&gt; showsize &lt;/button&gt; &lt;/body&gt;&lt;/html&gt; 12345678910html &#123; border: 1px solid red; height: 100%; overflow-y: auto;&#125;body &#123; border: 1px solid blue; height: 100%;&#125; 1234567891011121314151617function setStyle() &#123; var s = document.getElementById("content"); s.style['overflow'] = 'hidden'; s.style['overflow-x'] = 'hidden'; s.style['overflow-y'] = 'hidden';&#125;function showsize() &#123; var s = document.getElementById("content"); alert("document.body.offsetWidth="+document.body.offsetWidth+"\nwindow.innerWidth="+window.innerWidth+"\ndocument.body.scrollHeight="+document.body.scrollHeight+"\nwindow.innerHeight="+window.innerHeight);&#125;function restore() &#123; var s = document.getElementById("content"); s.style['overflow'] = ''; s.style['overflow-x'] = ''; s.style['overflow-y'] = '';&#125; é—®é¢˜åˆ†æž å› ä¸ºbodyæ²¡æœ‰è®¾ç½®overflow-yï¼Œé»˜è®¤æ˜¯visibleï¼Œæ‰€ä»¥å†…å®¹æ˜¾ç¤ºåˆ°æ¡†å¤–ã€‚ htmlè®¾ç½®äº†overflow-y: autoï¼Œæ‰€ä»¥å‡ºçŽ°çºµå‘æ»šåŠ¨æ¡ã€‚ å½“ç‚¹å‡»setstyleåŽï¼Œbodyé«˜åº¦å˜å°ï¼Œhtmlå°±æ»šåŠ¨åˆ°æœ€ä¸Šé¢ã€‚ å¦‚æžœhtmlæ²¡æœ‰è®¾ç½®overflow-y: autoï¼Œåˆ™é»˜è®¤æ˜¯visibleï¼Œä¸ä¼šæ»šåŠ¨ï¼Œä»ç„¶ä¿æŒåœ¨åº•éƒ¨ã€‚ å¦‚æžœbodyä¹Ÿè®¾ç½®äº†overflow-y:autoï¼Œåˆ™bodyä¼šå‡ºçŽ°çºµå‘æ»šåŠ¨æ¡ï¼Œè€Œhtmlçš„æ»šåŠ¨æ¡åªä¼šè¦†ç›–bodyçš„clientheightåŒºåŸŸã€‚ç‚¹å‡»setstyleï¼Œåªæ˜¯å°†bodyçš„æ»šåŠ¨æ¡åŽ»æŽ‰ï¼Œä¸ä¼šè§¦å‘htmlæ»šåŠ¨ã€‚ æ‰€ä»¥rc-dialog.switchScrollingEffect()çš„å®žçŽ°æ˜¯å­˜åœ¨ä¸€äº›ç¼ºé™·çš„ã€‚ å…¶ä»–é—®é¢˜ ä¸Šé¢è°ƒè¯•è¿‡ç¨‹ä¸­ï¼ŒisBodyOverflowingçš„å®žçŽ°å¼•èµ·äº†æˆ‘çš„å…´è¶£ã€‚ 1234567function isBodyOverflowing() &#123; return ( document.body.scrollHeight &gt; (window.innerHeight || document.documentElement.clientHeight) &amp;&amp; window.innerWidth &gt; document.body.offsetWidth );&#125; window.innerWidth &gt; document.body.offsetWidthè¿™ä¸ªæ¡ä»¶ï¼Œè¡¨ç¤ºbodyçš„width+paddingæ²¡æœ‰è¶…è¿‡æµè§ˆå™¨çª—å£å†…å®½ã€‚document.body.scrollHeight &gt; â€‹ (window.innerHeight || document.documentElement.clientHeight)è¡¨ç¤ºæœ‰çºµå‘æ»šåŠ¨ã€‚æ‰€ä»¥è¿™ä¸ªæ¡ä»¶çš„æ„å›¾æœ‰ç‚¹è®©äººä¸å¤ªç†è§£ï¼Œå‰ä¸€ä¸ªæ¡ä»¶å¾ˆå®¹æ˜“ä¸æ»¡è¶³ï¼Œä¾‹å¦‚è®¾ç½®bodyçš„widthä¸º100vwã€‚ ï¼ˆå›¾ç‰‡æ¥è‡ªhttps://www.pianshen.com/article/6486132360/ï¼‰]]></content>
      <categories>
        <category>antd</category>
      </categories>
      <tags>
        <tag>debug</tag>
        <tag>antd</tag>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[antd inputèƒ½åœ¨DOMä¸­çœ‹åˆ°å¯†ç é—®é¢˜]]></title>
    <url>%2F2020%2F10%2F20%2F038-the-password-show-in-dom-with-antd-input%2F</url>
    <content type="text"><![CDATA[åˆæ˜¯ä¸€ä¸ªantdç»„ä»¶é—®é¢˜ï¼Œå¯†ç ç»„ä»¶åœ¨domä¸­å¯ä»¥çœ‹åˆ°å¯†ç ï¼Œè¿™ç®—æ˜¯ä¸€ä¸ªä½Žçº§çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šå­˜åœ¨è¿™ç§é—®é¢˜ï¼Œç¿»çœ‹antdæºä»£ç ï¼Œå‘çŽ°å…¶å®žä¸“é—¨è§£å†³è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è§£å†³å½»åº•ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ä»ç„¶å­˜åœ¨ã€‚ é—®é¢˜çŽ°è±¡ F12åœ¨é¡µé¢DOMä¸­å¯ä»¥çœ‹åˆ°å¯†ç ä¿å­˜åœ¨valueå±žæ€§ä¸­ï¼ŒèŽ·å¾—ç„¦ç‚¹æ—¶valueä¼šæ¶ˆå¤±ï¼Œä½†æ˜¯åˆä¼šè‡ªåŠ¨å‡ºçŽ°ã€‚ é—®é¢˜å®šä½ é€šè¿‡åœ¨inputå…ƒç´ ä¸Šæ‰“æ–­ç‚¹è°ƒè¯•ï¼Œå‘çŽ°antd inputç»„ä»¶æ›¾ç»è§£å†³è¿‡æ­¤é—®é¢˜ï¼Œè§https://github.com/ant-design/ant-design/issues/20541ï¼Œä½†æ˜¯å…¶è§£å†³æ–¹æ³•æ˜¯åœ¨componentDidMountï¼ŒonFocusï¼ŒonBlurï¼ŒonChangeå››ä¸ªæ—¶æœºåˆ é™¤valueå±žæ€§ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆèŽ·å¾—ç„¦ç‚¹æ—¶valueä¼šæ¶ˆå¤±ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆåˆä¼šè‡ªåŠ¨å‡ºçŽ°å‘¢ï¼Œå› ä¸ºæœ‰ä¸€äº›åœºæ™¯è¿™ç§è§£æ³•æ˜¯æ— æ•ˆçš„ã€‚ åœºæ™¯ä¸€ï¼š å¦‚ä¸Šé¡µé¢ï¼Œå¯¹è¯æ¡†ä½¿ç”¨äº†dvaä¸Šçš„çŠ¶æ€ï¼ŒèƒŒåŽçš„åˆ—è¡¨é¡µé¢5så®šæ—¶åˆ·æ–°å¯¼è‡´dvaä¸ŠçŠ¶æ€å˜åŒ–ï¼Œå¯¼è‡´å¯¹è¯æ¡†updateï¼Œè¿™æ—¶valueåˆä¼šå‡ºçŽ°ã€‚ åœºæ™¯äºŒï¼š åŒ…è£¹åœ¨Form.Item(V4)æˆ–getFieldDecorator(V4ä¹‹å‰ï¼‰é‡Œé¢çš„Inputä¸æ˜¯ç¬¬ä¸€å±‚èŠ‚ç‚¹ï¼Œæ­¤æ—¶Inputå¤±åŽ»ç„¦ç‚¹æ—¶ï¼Œvalueä¹Ÿä¼šåˆå‡ºçŽ°ã€‚ ä¾‹1ï¼š 1234567891011121314151617181920212223&lt;FormItem labelCol=&#123;&#123; span: 6 &#125;&#125; wrapperCol=&#123;&#123; span: 14 &#125;&#125; label="æ–°å¯†ç "&gt; &lt;PasswordTooltip name=&#123;form.getFieldValue('name')&#125; password=&#123;form.getFieldValue('password')&#125; &gt; &#123;form.getFieldDecorator('password', &#123; // initialValue:text.password, rules: [ &#123; required: true, message: 'è¯·è¾“å…¥å¯†ç ï¼' &#125;, &#123; pattern: /\S+/, message: 'ä¸å…è®¸å‡ºçŽ°ç©ºå£ä»¤!', &#125;, &#123; validator: passwordValidator(form.getFieldValue('name') || '') &#125;, ], &#125;)( &lt;Input type=&#123;passwordType ? 'password' : 'text'&#125; // suffix=&#123;&lt;Icon component=&#123;passwordType ? Close : Eye&#125; onClick=&#123;this.changeType&#125; /&gt;&#125; /&gt;, )&#125; &lt;/PasswordTooltip&gt; &lt;/FormItem&gt; ä¾‹2ï¼š 12345678910111213141516171819202122232425262728293031323334&lt;FormItem shouldUpdate&gt; &#123;() =&gt; ( &lt;FormItem labelCol=&#123;&#123; span: 6 &#125;&#125; wrapperCol=&#123;&#123; span: 14 &#125;&#125; label="æ–°å¯†ç " name='newPassword' rules=&#123;[ &#123; required: switchState, message: 'è¯·è¾“å…¥æ–°å¯†ç ' &#125;, &#123; pattern: /\S+/, message: 'ä¸å…è®¸å‡ºçŽ°ç©ºå£ä»¤', &#125;, this.validatePassword, this.validateToOldPassword, this.validateToConfirm, this.validateCloudname, ]&#125; &gt; &lt;PasswordTooltip name=&#123;this.formRef.current &amp;&amp; this.formRef.current.getFieldValue('username')&#125; password=&#123;this.formRef.current &amp;&amp; this.formRef.current.getFieldValue('newPassword')&#125; &gt; &lt;Input disabled=&#123;!switchState&#125; type=&#123;passwordType ? 'password' : 'text'&#125; // suffix=&#123;&lt;Icon component=&#123;passwordType ? Close : Eye&#125; onClick=&#123;this.changeType&#125; /&gt;&#125; onChange=&#123;(e) =&gt; &#123; this.formRef.current.setFieldsValue(&#123; 'newPassword': e.target.value &#125;); this.formRef.current.validateFields(['newPassword']); &#125;&#125; /&gt; &lt;/PasswordTooltip&gt; &lt;/FormItem&gt; )&#125; &lt;/FormItem&gt; åœºæ™¯ä¸‰ï¼š åŒ…è£¹åœ¨Form.Item(V4)æˆ–getFieldDecorator(V4ä¹‹å‰ï¼‰é‡Œé¢çš„Inputï¼Œonchangeçš„è§¦å‘ä¼šå¤±æ•ˆï¼Œè¿™æ ·è¾“å…¥ä¸€ä¸ªå­—ç¬¦åŽï¼Œvalueåˆä¼šå‡ºçŽ°ã€‚ è§£å†³æ–¹æ¡ˆ å°†InputåŒ…è£…äº†ä¸€å±‚ï¼Œåœ¨å…¶componentDidUpdateä¸­åˆ é™¤valueå±žæ€§ã€‚ä¸è§£ä¸ºä»€ä¹ˆantd inputä¸åœ¨componentDidUpdateä¸­åˆ é™¤valueå±žæ€§ã€‚ 123456789101112131415161718192021import React, &#123; PureComponent &#125; from 'react';import &#123; Input &#125; from 'antd';export default class ClearValueInput extends PureComponent &#123; componentDidUpdate() &#123; if (this.input &amp;&amp; this.input.input) &#123; if (this.input.input.hasAttribute('value')) &#123; setTimeout(() =&gt; this.input.input.removeAttribute('value')); &#125; &#125; &#125; saveInput = (input) =&gt; &#123; this.input = input; &#125; render() &#123; return &lt;Input &#123;...this.props&#125; ref=&#123;this.saveInput&#125;/&gt;; &#125;&#125;]]></content>
      <categories>
        <category>antd</category>
      </categories>
      <tags>
        <tag>debug</tag>
        <tag>antd</tag>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[cssä¼ªç±»ä½¿ç”¨æŠ€å·§ä¸€ä¾‹]]></title>
    <url>%2F2020%2F09%2F29%2F039-an-example-of-using-css-pseudo-class%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘æµ‹è¯•åŒå­¦æäº†ä¸€ä¸ªé—®é¢˜ï¼Œè§‰å¾—antdçš„æ—¶é—´é€‰æ‹©ç»„ä»¶ï¼Œæ²¡æœ‰æç¤ºæ—¶åˆ†ç§’ï¼Œä¸å¤ªå‹å¥½ã€‚è¿™ç§é—®é¢˜éƒ½èƒ½å¤Ÿæå‡ºæ¥ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å’±ä»¬çš„å‰ç«¯æ°´å¹³å·²ç»è¢«æ¿€å‘åˆ°æžè‡´äº†ï¼Œä¼°è®¡antdæ˜¯ä¸å¤ªä¼šæŽ¥å—è¿™ç§é—®é¢˜çš„ã€‚è¿™ç§é—®é¢˜æ€Žä¹ˆè§£å‘¢ï¼Œä½ è¿˜åˆ«è¯´ï¼ŒçœŸè®©æˆ‘æƒ³åˆ°ä¸€ä¸ªå¥½åŠžæ³•ï¼Œé‚£å°±æ˜¯ç”¨cssä¼ªç±»ã€‚ é—®é¢˜å¦‚ä¸‹ï¼š å¢žåŠ å¦‚ä¸‹æ ·å¼ï¼š 123.ant-picker-time-panel::before &#123; content: 'æ—¶\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0åˆ†\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0\00A0ç§’';&#125; æœ€ç»ˆæ•ˆæžœï¼Œæµ‹è¯•åŒå­¦åº”è¯¥æ»¡æ„äº†ï¼š]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>antd</tag>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[antdä¸‹æ‹‰èœå•æ¨ªå‘å¸ƒå±€]]></title>
    <url>%2F2020%2F09%2F27%2F040-antd-dropdown-horizontal-layout%2F</url>
    <content type="text"><![CDATA[é¡¹ç›®ä¸­çš„ä¸‹æ‹‰èœå•é¡¹è¶Šæ¥è¶Šå¤šï¼Œæœ€è¿‘åˆåŠ äº†åˆ†ç»„ï¼Œé•¿é•¿çš„ä¸€æ¡éžå¸¸éš¾çœ‹ï¼Œèƒ½ä¸èƒ½æŠŠå®ƒæ”¹æˆæ¨ªå‘å¸ƒå±€å‘¢ã€‚é¡¹ç›®æ˜¯ç”¨çš„antdï¼Œç ”ç©¶äº†ä¸‹antdçš„ä¸‹æ‹‰èœå•æ˜¯ç”¨ul,liå®žçŽ°çš„ï¼Œé€šè¿‡cssçš„flexå¸ƒå±€å’Œgridå¸ƒå±€å¾ˆå®¹æ˜“å®žçŽ°æ¨ªå‘å¸ƒå±€ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åªç”¨gridå¸ƒå±€å®žçŽ°ï¼Œgridå¯¹äºŽä¸€ç»´äºŒç»´éƒ½å¯ä»¥èƒœä»»ï¼Œæ›´åŠ å¼ºå¤§ã€‚ é¡¹ç›®åŽŸæ¥çš„æ ·å­ï¼š æ”¹æˆæ¨ªå‘å¸ƒå±€çš„æ ·å­ï¼š ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­æ¼”ç¤ºä¸€ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;div style="display:block;min-width:98px;position: absolute;"&gt; &lt;ul class="menu"&gt; &lt;li class="group"&gt; &lt;div&gt;èœå•1&lt;/div&gt; &lt;ul class="group-list"&gt; &lt;li class="item"&gt;item1&lt;/li&gt; &lt;li class="item"&gt;item2&lt;/li&gt; &lt;li class="item"&gt;item3&lt;/li&gt; &lt;li class="item"&gt;item4&lt;/li&gt; &lt;li class="item"&gt;item5&lt;/li&gt; &lt;li class="item"&gt;item6&lt;/li&gt; &lt;li class="item"&gt;item6&lt;/li&gt; &lt;li class="item"&gt;item8&lt;/li&gt; &lt;li class="item"&gt;item9&lt;/li&gt; &lt;li class="item"&gt;item10&lt;/li&gt; &lt;li class="item"&gt;item11&lt;/li&gt; &lt;li class="item"&gt;item12&lt;/li&gt; &lt;/ul&gt; &lt;/li&gt; &lt;li class="group"&gt; &lt;div&gt;èœå•2&lt;/div&gt; &lt;ul class="group-list"&gt; &lt;li class="item"&gt;item1&lt;/li&gt; &lt;li class="item"&gt;item2&lt;/li&gt; &lt;/ul&gt; &lt;/li&gt; &lt;li class="group"&gt; &lt;div&gt;èœå•3&lt;/div&gt; &lt;ul class="group-list"&gt; &lt;li class="item"&gt;item1&lt;/li&gt; &lt;li class="item"&gt;item2&lt;/li&gt; &lt;/ul&gt; &lt;/li&gt; &lt;li class="group"&gt; &lt;div&gt;èœå•4&lt;/div&gt; &lt;ul class="group-list"&gt; &lt;li class="item"&gt;item1&lt;/li&gt; &lt;li class="item"&gt;item2&lt;/li&gt; &lt;/ul&gt; &lt;/li&gt; &lt;/ul&gt;&lt;/div&gt; é»˜è®¤æ•ˆæžœæ˜¯è¿™æ ·çš„ï¼Œä¸¤çº§èœå•ï¼Œç¬¬ä¸€çº§åˆ†ç»„ï¼Œç¬¬äºŒçº§èœå•é¡¹ã€‚ å¢žåŠ å¦‚ä¸‹æ ·å¼ï¼Œé¦–å…ˆè®©ç¬¬ä¸€çº§æ¨ªå‘æŽ’åˆ—ï¼Œç”¨åˆ°äº†flexå¸ƒå±€ï¼Œæ–¹å‘æ˜¯rowï¼Œä¸æ¢è¡Œã€‚ç„¶åŽç¬¬äºŒçº§ä¸ºäº†å®žçŽ°æœ€å¤š8è¡Œï¼Œç”¨åˆ°äº†gridå¸ƒå±€ï¼Œè¡Œæ•°å›ºå®šä¸º8ï¼Œå…ˆæŒ‰åˆ—æŽ’ï¼Œå¤šäºŽ8è¡Œæ—¶åˆ—è‡ªåŠ¨æ‰©å±•ã€‚ 1234567891011121314151617181920212223ul,li &#123; list-style: none; padding: 0; margin: 0;&#125;.menu &#123; display: flex; flex-direction: row; flex-wrap: nowrap;&#125;.group &#123; flex: auto; &#125;.group-list &#123; display: grid; grid-template-columns: repeat(auto-fill, auto); grid-template-rows: repeat(8,auto); grid-auto-flow: column;&#125;.item &#123; margin: 0 8px;&#125; æœ€ç»ˆæ•ˆæžœå¦‚ä¸‹ï¼š]]></content>
      <categories>
        <category>antd</category>
      </categories>
      <tags>
        <tag>antd</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[antd proåŠ¨æ€åˆ‡æ¢ä¸»é¢˜]]></title>
    <url>%2F2020%2F09%2F24%2F036-dynamically-switches-theme-in-antd-pro%2F</url>
    <content type="text"><![CDATA[antd proå®˜æ–¹æ–‡æ¡£(https://pro.ant.design/docs/dynamic-theme-cn)ä»‹ç»äº†åŠ¨æ€åˆ‡æ¢ä¸»é¢˜çš„æ–¹æ³•ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰è®²çš„ç‰¹åˆ«æ¸…æ¥šï¼Œè€Œä¸”ç¼–è¯‘ä¸»é¢˜çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œéžå¸¸å½±å“å¼€å‘æ•ˆçŽ‡ã€‚ä¸‹é¢ä»‹ç»ä¸‹æˆ‘çš„è§£å†³åŠžæ³•ã€‚ åŠ¨æ€ä¸»é¢˜åˆ‡æ¢åŽŸç† ä¸»é¢˜åˆ‡æ¢ä¸»è¦æ˜¯é€šè¿‡unm-plugin-antd-themeæ’ä»¶å®žçŽ°çš„ï¼Œunm-plugin-antd-themeæ’ä»¶é€šè¿‡antd-pro-merge-lesså°†lessæ–‡ä»¶ç¼–è¯‘ä¸ºä¸€ä¸ªä¸»é¢˜cssæ–‡ä»¶ã€‚ æ‰€ä»¥unm-plugin-antd-themeçš„é…ç½®æ–‡ä»¶å°±æ˜¯å®šä¹‰çš„antd-pro-merge-less(https://github.com/chenshuai2144/antd-pro-merge-less)çš„å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œè¦æ±‚æ˜¯jsonæ–‡ä»¶ï¼Œæ–‡ä»¶åtheme.config.jsonï¼š 12345678910111213141516171819202122232425262728293031323334353637383940&#123; "theme": [ &#123; "key": "dark", "theme": "dark", "fileName": "dark.css", "modifyVars": &#123; "@font-size-base": "12px", "@table-padding-vertical": "10px", "@link-color": "#0070cc" &#125; &#125;, &#123; "key": "volcano", "fileName": "volcano.css", "modifyVars": &#123; "@primary-color": "#FA541C", "@font-size-base": "12px", "@table-padding-vertical": "10px", "@link-color": "#0070cc" &#125; &#125;, &#123; "key": "volcano", "theme": "dark", "fileName": "dark-volcano.css", "modifyVars": &#123; "@primary-color": "#FA541C", "@font-size-base": "12px", "@table-padding-vertical": "10px", "@link-color": "#0070cc" &#125; &#125; ], "min": true, "isModule": true, "ignoreAntd": false, "ignoreProLayout": false, "cache": true &#125; æ¯ç§ä¸»é¢˜ä¸€ä¸ªä¸åŒçš„æ–‡ä»¶ï¼ŒfileNameå®šä¹‰äº†æ–‡ä»¶åï¼Œthemeä¸ºdarkè¡¨ç¤ºæš—é»‘ä¸»é¢˜ï¼ˆå¯¹åº”antdproä¸»é¢˜è®¾ç½®é‡Œé¢çš„realDarkï¼‰ï¼Œä¸å†™å°±æ˜¯äº®è‰²ä¸»é¢˜ï¼ˆå¯¹åº”antdproä¸»é¢˜è®¾ç½®é‡Œé¢çš„lightæˆ–darkï¼‰ã€‚modifyVarså°±æ˜¯å¯¹antdé»˜è®¤å˜é‡çš„å®šåˆ¶ã€‚ å¤§å®¶ä¼šå‘çŽ°ä¸Šé¢æ²¡æœ‰é»˜è®¤çš„äº®è‰²ä¸»é¢˜ï¼Œå› ä¸ºè¿™æ—¶ä¸ç”¨å•ç‹¬çš„ä¸»é¢˜cssæ–‡ä»¶ï¼Œç›´æŽ¥ç”¨é»˜è®¤çš„å°±å¥½ã€‚ æ¯æ¬¡ç¼–è¯‘çš„æ—¶å€™unm-plugin-antd-themeæ’ä»¶ä¼šéåŽ†ä¸Šé¢å®šä¹‰çš„æ¯ä¸ªä¸»é¢˜ï¼Œç¼–è¯‘ä¸ºä¸€ä¸ªcssæ–‡ä»¶ï¼Œå¼€å‘æ—¶ä½äºŽnode_modules/.plugin-theme/themeç›®å½•ä¸‹ï¼Œå‘å¸ƒæ—¶ä½äºŽthemeç›®å½•ä¸‹ï¼Œæ¯ä¸ªä¸»é¢˜æ–‡ä»¶ç¼–è¯‘éƒ½éœ€è¦å‡ ç§’é’Ÿï¼Œæ‰€ä»¥ä¸»é¢˜å¤šäº†ç¼–è¯‘æ—¶é—´ä¼šæ¯”è¾ƒæ…¢ï¼ŒåŽé¢ä¼šè®²æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å…³äºŽæ’ä»¶çš„ä½¿ç”¨ï¼Œumi3å¯¹äºŽumi-pluginå¼€å¤´çš„æ’ä»¶æ˜¯è‡ªåŠ¨åŠ è½½çš„ï¼Œä¸éœ€å®šä¹‰åœ¨configæ–‡ä»¶çš„pluginsä¸­ï¼Œå¦‚æžœçœ‹åˆ°ä¸€äº›è€çš„æ•™ç¨‹ä¸è¦æ„Ÿåˆ°å›°æƒ‘ã€‚ å¥½äº†ï¼Œæœ‰äº†ä¸»é¢˜æ–‡ä»¶ï¼ŒæŽ¥ä¸‹æ¥è¦è§£å†³æ€Žä¹ˆåº”ç”¨ä¸»é¢˜ï¼Œå…¶å®žå¾ˆç®€å•ï¼Œå°±æ˜¯é‡æ–°åŠ è½½æ–°çš„cssæ–‡ä»¶ã€‚antd proå®˜æ–¹ç»™äº†å‚è€ƒä¾‹å­ï¼Œä¹Ÿå¯ä»¥å‚è€ƒSettingDraweræºä»£ç (https://github.com/ant-design/ant-design-pro-layout/blob/master/src/SettingDrawer/index.tsx)ã€‚ è§£å†³ä¸»é¢˜ç¼–è¯‘æ…¢é—®é¢˜ å¼€å‘æœŸæ¯æ¬¡éƒ½ç¼–è¯‘ä¸»é¢˜æ˜¯éš¾ä»¥å¿å—çš„ï¼Œæ‰€ä»¥æˆ‘çš„åŠžæ³•æ˜¯å¼€å‘å™¨èƒ½å¤Ÿé…ç½®æ˜¯å¦ç¼–è¯‘ä¸»é¢˜ï¼Œè€Œå‘å¸ƒæ—¶æ€»æ˜¯ç¼–è¯‘ä¸»é¢˜ã€‚å¯æƒœunm-plugin-antd-themeæ’ä»¶æœ¬èº«å¹¶æ²¡æœ‰æä¾›è¿™ç§é…ç½®èƒ½åŠ›ã€‚å¥½åœ¨umiçš„æ‰©å±•èƒ½åŠ›éžå¸¸å¼ºï¼Œæˆ‘å†™äº†ä¸€ä¸ªæ’ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®žéžå¸¸ç®€å•ï¼Œä»£ç åªæœ‰å‡ è¡Œï¼Œæ’ä»¶åumi-plugin-configï¼ˆhttps://github.com/zhongpan/umi-plugin-configï¼‰ã€‚ å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨umiç¦ç”¨æ’ä»¶çš„æ–¹æ³•ï¼Œunm-plugin-antd-themeæ’ä»¶çš„keyä¸ºantdThemeï¼Œä¿®æ”¹configæ–‡ä»¶å¦‚ä¸‹ï¼š 123456import &#123; defineConfig &#125; from 'umi';const &#123; REACT_APP_ENV &#125; = process.env;export default defineConfig(&#123; antdTheme: REACT_APP_ENV !== 'dev', &#125;); ä¸»é¢˜é…ç½®æ–‡ä»¶ä¼˜åŒ– unm-plugin-antd-themeæ’ä»¶çš„é…ç½®æ–‡ä»¶ä¸ºjsonæ ¼å¼ï¼Œå¾ˆä¸æ–¹ä¾¿ï¼Œä¸€æ¥ä¸å¥½åŠ å…¥æ³¨é‡Šï¼ŒäºŒæ¥ä¸å¥½å…±äº«ä¸€äº›å˜é‡ï¼Œæ¯•ç«Ÿå¤šä¸ªä¸»é¢˜æœ‰ä¸€äº›ä¸€æ ·çš„æˆåˆ†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿˜æ˜¯ç”¨åˆ°umiæ’ä»¶çš„æ‰©å±•èƒ½åŠ›ï¼Œåœ¨æ’ä»¶ä¸­å°†jså®šä¹‰è½¬æ¢ä¸ºjsonå®šä¹‰ï¼Œè¯¦è§ä¸Šè¿°umi-plugin-configæ’ä»¶ã€‚ é€šè¿‡ä¾‹å­è¯´æ˜Žè¿™æ ·åšçš„å¥½å¤„ã€‚ä½ æ˜¯å¦è¿˜è®°å¾—é»˜è®¤çš„äº®è‰²ä¸»é¢˜æ²¡æœ‰ç¼–è¯‘ä¸ºå•ç‹¬çš„ä¸»é¢˜cssï¼Œé‚£ä¹ˆæ‰€æœ‰ä¸»é¢˜ç»Ÿä¸€ä¿®æ”¹çš„å˜é‡å¦‚æžœåšå‘¢ã€‚ é»˜è®¤çš„ä¸»é¢˜è¿˜æ˜¯å¯ä»¥é€šè¿‡umiçš„é…ç½®æ–‡ä»¶çš„themeé…ç½®ï¼š theme.js 12345export default &#123; "@font-size-base": "12px", "@table-padding-vertical": "10px", "@link-color": "#0070cc",&#125;; config.js 123456import &#123; defineConfig &#125; from 'umi';import theme from './theme';const &#123; REACT_APP_ENV &#125; = process.env;export default defineConfig(&#123; theme,&#125;); ç„¶åŽå…¶ä»–ä¸»é¢˜å°±éœ€è¦åœ¨unm-plugin-antd-themeæ’ä»¶çš„jsoné…ç½®æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªä¸»é¢˜çš„modifyVarsä¸­éƒ½è¦åŠ å…¥ï¼Œæœ¬æ–‡ä¸€å¼€å§‹å·²ç»ç»™å‡ºäº†ä¾‹å­ã€‚ æ˜¾è€Œæ˜“è§ä¸Šé¢çš„ç»Ÿä¸€å˜é‡ä¿®æ”¹éœ€è¦çƒ¦äººçš„é‡å¤ï¼Œå°†jsonæ”¹æˆjsåŽå°±èƒ½å®Œç¾Žè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œtheme.config.jsonä¼šå˜æˆå¦‚ä¸‹ï¼Œéœ€è¦ä½¿ç”¨CommonJSè§„èŒƒå®šä¹‰æ¨¡å—ï¼š 123456789101112131415161718192021222324252627282930313233343536const theme = require('./theme').default;module.exports = &#123; "theme": [ &#123; "key": "dark", "theme": "dark", "fileName": "dark.css", "modifyVars": &#123; ...theme &#125; &#125;, &#123; "key": "volcano", "fileName": "volcano.css", "modifyVars": &#123; "@primary-color": "#FA541C", ...theme &#125; &#125;, &#123; "key": "volcano", "theme": "dark", "fileName": "dark-volcano.css", "modifyVars": &#123; "@primary-color": "#FA541C", ...theme &#125; &#125; ], "min": true, "isModule": true, "ignoreAntd": false, "ignoreProLayout": false, "cache": true &#125;; è¿™æ ·å°±å¯ä»¥å°†ç»Ÿä¸€çš„å˜é‡ä¿®æ”¹å¤ç”¨èµ·æ¥ã€‚umi-plugin-configæ’ä»¶æ£€æµ‹åˆ°theme.config.jsæ–‡ä»¶å°±ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºtheme.config.jsonæ–‡ä»¶ã€‚ è‡ªå®šä¹‰ä¸»é¢˜æ³¨æ„äº‹é¡¹ è¦æ”¯æŒåŠ¨æ€åˆ‡æ¢ä¸»é¢˜ï¼Œéœ€è¦ä¸¥æ ¼è§„èŒƒæ ·å¼çš„å®šä¹‰æ–¹å¼ï¼Œä¸‹é¢æ˜¯æˆ‘æ€»ç»“çš„ä¸€äº›å»ºè®®ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚ ä¸è¦ä½¿ç”¨å›ºå®šçš„é¢œè‰²ï¼Œå°½é‡ä½¿ç”¨antdå·²æœ‰å˜é‡ï¼Œä¾‹å¦‚@text-colorï¼Œè¡¨ç¤ºæ–‡å­—é¢œè‰²ï¼Œåœ¨äº®è‰²å’Œæš—é»‘æ¨¡å¼ä¸‹å€¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œantd-pro-merge-lesså·²ç»ä¸ºæˆ‘ä»¬è‡ªåŠ¨å¤„ç†äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨@text-color æ‰€æœ‰ä¸»é¢˜ç»Ÿä¸€ä¿®æ”¹çš„å˜é‡å®šä¹‰åœ¨ä¸Šè¿°theme.jsä¸­ï¼Œæ‰€æœ‰ä¸»é¢˜å¤ç”¨ ä¸»é¢˜ä¸ä¸€æ ·çš„å˜é‡ä¿®æ”¹åœ¨å„è‡ªçš„é…ç½®ä¸­å®šä¹‰ æ‰€æœ‰ä¸»é¢˜ç»Ÿä¸€ä¿®æ”¹çš„æ ·å¼å®šä¹‰åœ¨global.lessæ–‡ä»¶ä¸­ï¼Œéœ€è¦è®¾ç½®æœ€é«˜ä¼˜å…ˆçº§ æ‰€æœ‰ä¸»é¢˜ç”¨çš„åŒä¸€ä¸ªå˜é‡ä½†æ˜¯å€¼ä¸ä¸€æ ·ï¼ˆäº®è‰²å’Œæš—é»‘ä¸ä¸€æ ·ï¼‰ï¼Œå®šä¹‰åœ¨ç»„ä»¶lessä¸­ï¼Œéœ€è¦ä½¿ç”¨:global å¦‚æžœæ— æ³•é€šè¿‡lesså®šä¹‰æ ·å¼ï¼Œå¯ä»¥é€šè¿‡settingsèŽ·å–ä¸»é¢˜åŽåŠ¨æ€è®¾ç½®è¡Œå†…æ ·å¼]]></content>
      <categories>
        <category>antd</category>
      </categories>
      <tags>
        <tag>antd</tag>
        <tag>theme</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CriteriaQueryä½¿ç”¨çš„ä¸€ä¸ªé™·é˜±]]></title>
    <url>%2F2020%2F07%2F20%2F035-a-trap-for-using-criteriaquery%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨Spring Data Jpaçš„CriteriaQueryè¿›è¡ŒåŠ¨æ€æ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€ä¸ªé™·é˜±ï¼Œå½“æ¡ä»¶ä¸ºç©ºæ—¶ï¼ŒæŸ¥è¯¢ä¸åˆ°ä»»ä½•ç»“æžœï¼Œå¹¶ä¸æ˜¯æœŸæœ›çš„è¿”å›žæ‰€æœ‰ç»“æžœã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ä¾‹å¦‚ä¸‹è¿°ä»£ç ï¼Œå½“predicatesä¸ºç©ºæ—¶ï¼Œè¿”å›žç»“æžœæ€»æ˜¯ä¸ºç©ºã€‚ 123456789101112public Page&lt;VmhostWithRelationPO&gt; listVmhostSpecWithRelationByPage(String name) &#123; Specification&lt;VmhostWithRelationPO&gt; spec = (root, cq, cb) -&gt; &#123; root.join("user", JoinType.LEFT); root.join("tenant", JoinType.LEFT); List&lt;javax.persistence.criteria.Predicate&gt; predicates = new ArrayList&lt;&gt;(); ...... return cb.or(predicates.toArray(new javax.persistence.criteria.Predicate[0])); &#125;; PageRequest pagable = PageRequest.of(0, 5); Page&lt;VmhostWithRelationPO&gt; page = vmhostSpecWithRelationDao.findAll(spec, pagable); return page;&#125; çœ‹ä¸‹orçš„æ³¨é‡Šå°±æ˜Žç™½äº†ï¼Œå› ä¸ºç©ºæ¡ä»¶æ€»æ˜¯ä¸ºfalseï¼Œè€Œandçš„ç©ºæ¡ä»¶æ€»æ˜¯ä¸ºtrueã€‚æ‰€ä»¥ï¼Œå¦‚æžœæœ€åŽæ˜¯andå°±æ²¡æœ‰é—®é¢˜ï¼Œåªæœ‰orçš„æ—¶å€™æœ‰é—®é¢˜ã€‚ 12345678910111213141516171819public interface CriteriaBuilder &#123; /** * Create a conjunction of the given restriction predicates. * A conjunction of zero predicates is true. * @param restrictions zero or more restriction predicates * @return and predicate */ Predicate and(Predicate... restrictions); /** * Create a disjunction of the given restriction predicates. * A disjunction of zero predicates is false. * @param restrictions zero or more restriction predicates * @return or predicate */ Predicate or(Predicate... restrictions);&#125; æ‰€ä»¥æ­£ç¡®çš„å†™æ³•åº”è¯¥è¿™æ ·ï¼š 123456789101112public Page&lt;VmhostWithRelationPO&gt; listVmhostSpecWithRelationByPage(String name) &#123; Specification&lt;VmhostWithRelationPO&gt; spec = (root, cq, cb) -&gt; &#123; root.join("user", JoinType.LEFT); root.join("tenant", JoinType.LEFT); List&lt;javax.persistence.criteria.Predicate&gt; predicates = new ArrayList&lt;&gt;(); ...... return predicates.isEmpty() ? cb.conjunction() : cb.or(predicates.toArray(new javax.persistence.criteria.Predicate[0])); &#125;; PageRequest pagable = PageRequest.of(0, 5); Page&lt;VmhostWithRelationPO&gt; page = vmhostSpecWithRelationDao.findAll(spec, pagable); return page; &#125; å¦‚æžœæ¡ä»¶ä¸ºç©ºåˆ™è¿”å›žä¸€ä¸ªç©ºconjunctionï¼Œä¹Ÿå°±æ˜¯ç©ºçš„andï¼Œæ€»æ˜¯ä¸ºtrueã€‚ å…¬å¸é¡¹ç›®çš„ä»£ç ä¸­å¸¸è§è¿™ç§å†™æ³•ï¼š 1234567891011121314151617public Page&lt;VmhostWithRelationPO&gt; listVmhostSpecWithRelationByPage(String name) &#123; Specification&lt;VmhostWithRelationPO&gt; spec = (root, cq, cb) -&gt; &#123; root.join("user", JoinType.LEFT); root.join("tenant", JoinType.LEFT); List&lt;javax.persistence.criteria.Predicate&gt; predicates = new ArrayList&lt;&gt;(); ...... if (predicates.isEmpty()) &#123; cq.where(); &#125; else &#123; cq.where(cb.or(predicates.toArray(new javax.persistence.criteria.Predicate[0]))); &#125; return cq.getRestriction(); &#125;; PageRequest pagable = PageRequest.of(0, 5); Page&lt;VmhostWithRelationPO&gt; page = vmhostSpecWithRelationDao.findAll(spec, pagable); return page;&#125; ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯å…¶å®žæ²¡æœ‰å¿…è¦åœ¨toPredicateæ–¹æ³•ä¸­è°ƒç”¨whereï¼ŒtoPredicateåªéœ€è¦è¿”å›žæ¡ä»¶ï¼Œå¤–å±‚ä¼šè°ƒç”¨whereã€‚ 123456789101112131415public interface Specification&lt;T&gt; extends Serializable &#123; /** * Creates a WHERE clause for a query of the referenced entity in form of a &#123;@link Predicate&#125; for the given * &#123;@link Root&#125; and &#123;@link CriteriaQuery&#125;. * * @param root must not be &#123;@literal null&#125;. * @param query must not be &#123;@literal null&#125;. * @param criteriaBuilder must not be &#123;@literal null&#125;. * @return a &#123;@link Predicate&#125;, may be &#123;@literal null&#125;. */ @Nullable Predicate toPredicate(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder criteriaBuilder);&#125;]]></content>
      <categories>
        <category>spring boot</category>
      </categories>
      <tags>
        <tag>spring boot</tag>
        <tag>jpa</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Data JPAä¸­å¤šè¡¨è”åˆæŸ¥è¯¢æœ€ä½³å®žè·µ]]></title>
    <url>%2F2020%2F07%2F20%2F034-best-practice-of-multi-table-joint-query-in-spring-data-jpa%2F</url>
    <content type="text"><![CDATA[Spring Data JPAå¯¹äºŽå•è¡¨æ“ä½œéžå¸¸æ–¹ä¾¿ï¼Œé‡‡ç”¨å®šä¹‰æŽ¥å£çš„æ–¹å¼ï¼Œä¸ç”¨å†™ä»»ä½•å®žçŽ°ä»£ç å°±å¯ä»¥èŽ·å¾—å¸¸ç”¨çš„æ•°æ®åº“æ“ä½œã€‚ä½†æ˜¯å¯¹äºŽå¤šè¡¨è”åˆæŸ¥è¯¢ï¼Œåˆ™ä¸é‚£ä¹ˆæ–¹ä¾¿äº†ï¼Œç›®å‰å…¬å¸é¡¹ç›®æ˜¯é‡‡ç”¨æ•°æ®åº“è§†å›¾çš„æ–¹æ³•ï¼Œå°†å¤šè¡¨è”åˆæŸ¥è¯¢å…¨éƒ¨å˜æˆäº†å•è¡¨æŸ¥è¯¢ã€‚æ•°æ®åº“è§†å›¾æœ‰ä¼—å¤šå¥½å¤„ï¼Œä¸å¤±ä¸ºä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›å¼Šç«¯ï¼š å½“æ•°æ®åº“è¡¨ç»“æž„å˜åŒ–éœ€è¦åŒæ­¥ä¿®æ”¹è§†å›¾ï¼Œç»´æŠ¤ç¹çï¼› ä¸šåŠ¡éœ€æ±‚å˜åŒ–å¯èƒ½å¯¼è‡´é¢‘ç¹ä¿®æ”¹è§†å›¾æš´éœ²çš„å­—æ®µï¼› æœ‰äº›åœºæ™¯å¯èƒ½åªéœ€è¦2è¡¨è”åˆï¼Œæœ‰äº›åœºæ™¯éœ€è¦æ›´å¤šè¡¨è”åˆï¼Œè¦ä¹ˆå»ºç«‹ä¸€ä¸ªå¤§è§†å›¾ï¼Œè¦ä¹ˆéœ€è¦å»ºç«‹å¤šä¸ªç±»ä¼¼è§†å›¾ï¼Œéƒ½ä¸å¤ªå¥½ï¼› è§†å›¾çš„SQLä¼šå˜å¾—è¶Šæ¥è¶Šåºžå¤§ï¼Œéš¾ä»¥ç»´æŠ¤ï¼› å®šä¹‰äº†å®žä½“ç±»ï¼ŒJPAè‡ªåŠ¨å»ºè¡¨ä¼šæŠŠè§†å›¾å»ºæˆè¡¨ï¼› SQL SERVERä¼šå°†è§†å›¾çš„æŸ¥è¯¢è½¬æ¢ä¸ºå¯¹åŸºæœ¬è¡¨çš„æŸ¥è¯¢ï¼Œæ€§èƒ½ä¸é«˜ã€‚ æ€»ä¹‹å°†ä¸€éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘æ”¾åˆ°æ•°æ®åº“å±‚ç»´æŠ¤ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç‰¹åˆ«å¥½çš„æ–¹å¼ã€‚é‚£ä¹ˆSpring Data JPAå¯¹å¤šè¡¨æŸ¥è¯¢è¿˜æœ‰å“ªäº›æ–¹æ³•å‘¢ï¼Ÿæœ‰æ²¡æœ‰æ›´å¥½çš„é€‰æ‹©å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œç›´æŽ¥ä¸Šç»“è®ºã€‚ æ–¹æ¡ˆ è¯´æ˜Ž è‡ªå®šä¹‰æŽ¥æ”¶å¯¹è±¡ SQL åˆ†é¡µ å¤šè¡¨è”åˆ é—®é¢˜ æ–¹æ¡ˆä¸€ @Query JPQLï¼šDTOæˆ–æŠ•å½±åŽŸç”ŸSQLï¼šObject[]ï¼Œmap(2ä¸ªå­—æ®µæ—¶) JPQLæˆ–åŽŸç”ŸSQL JpaRepository å®žä½“ä¸Šé…ä¸é…å…³ç³»éƒ½å¯ä»¥ 1.æŸ¥è¯¢æ¡ä»¶è¦åµŒå…¥SQLè¯­å¥å†…ï¼Œä¸€äº›å¤æ‚çš„æƒ…å½¢ä¸å¥½å¤„ç†ï¼Œä¾‹å¦‚æŸä¸ªå­—æ®µæ¨¡ç³Šæ£€ç´¢ï¼Œå­—æ®µæ˜¯åŠ¨æ€çš„ï¼›2.åˆ†é¡µæŸ¥è¯¢countQueryæŠŠæŸ¥è¯¢è¯­å¥é‡å¤äº†ä¸€é æ–¹æ¡ˆäºŒ Specification ä¸æ”¯æŒï¼Œåªèƒ½è¿”å›žå¯¹åº”PO æ— SQL ç»“åˆJpaRepository éœ€è¦åœ¨å®žä½“ä¸Šé…ç½®å…³ç³»ï¼Œå¦‚@OneToOneï¼Œå¦åˆ™æ— æ³•å®žçŽ°å·¦è¿žæŽ¥ï¼Œåªèƒ½è”åˆæŸ¥è¯¢ 1.å®žä½“éœ€è¦é…ç½®è¿žæŽ¥å…³ç³»2.æ¯ä¸€ä¸ªå…³è”å¯¹è±¡éƒ½æ˜¯å•ç‹¬çš„æ•°æ®åº“æŸ¥è¯¢ æ–¹æ¡ˆä¸‰ EntityManager ä¸æ”¯æŒæŠ•å½±ï¼Œå…¶ä»–åŒ@Query JPQLæˆ–åŽŸç”ŸSQL è‡ªå·±å°è£… å®žä½“ä¸Šé…ä¸é…å…³ç³»éƒ½å¯ä»¥ ç›¸æ¯”äºŽ@Queryå¥½å¤„æ˜¯ï¼ŒJPQLå­—ç¬¦ä¸²å¯ä»¥åŠ¨æ€æ‹¼æŽ¥ï¼Œå¯ä»¥å¤„ç†ä¸€äº›å¤æ‚çš„æŸ¥è¯¢æƒ…å½¢ã€‚ä½†æ˜¯åˆ†é¡µéœ€è¦è‡ªå·±å°è£…ã€‚ æ–¹æ¡ˆå›› CriteriaQuery DTO æ— SQL è‡ªå·±å°è£… éœ€è¦åœ¨å®žä½“ä¸Šé…ç½®å…³ç³»ï¼Œå¦‚@OneToOneå¦åˆ™æ— æ³•å®žçŽ°å·¦è¿žæŽ¥ï¼Œåªèƒ½è”åˆæŸ¥è¯¢ åŒSpecificationï¼Œä¸”åˆ†é¡µéœ€è¦è‡ªå·±å°è£… ç»ˆæžæ–¹æ¡ˆ QueryDSL DTOTuple æ— SQL æ”¯æŒ å®žä½“ä¸Šé…ä¸é…å…³ç³»éƒ½å¯ä»¥ è§£å†³ä»¥ä¸Šæ‰€æœ‰é—®é¢˜ é€‰æ‹©ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œéœ€è¦è€ƒè™‘å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š èƒ½å¤Ÿè‡ªå®šä¹‰å¯¹è±¡æŽ¥æ”¶æŸ¥è¯¢ç»“æžœé›†ï¼› èƒ½å¤Ÿæ”¯æŒå¤æ‚çš„ã€åŠ¨æ€çš„æŸ¥è¯¢æ¡ä»¶ï¼› æ—¢ç„¶ä½¿ç”¨JPAï¼Œå½“ç„¶æœ€å¥½èƒ½å¤Ÿç”¨ç±»åž‹å®‰å…¨çš„æŸ¥è¯¢æ–¹å¼ï¼Œå¹¶ä¸”ä½¿ç”¨èµ·æ¥æ¯”è¾ƒè‡ªç„¶ï¼› èƒ½å¤ŸåŽŸç”Ÿæ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼› èƒ½å¤Ÿæ”¯æŒleft joinï¼Œå¹¶ä¸”å¯¹å®žä½“å®šä¹‰æ²¡æœ‰çº¦æŸã€‚ ä¸Šè¡¨å°±æ˜¯ä»Žè¿™å‡ ä¸ªæ–¹é¢è¿›è¡Œåˆ†æžï¼Œæœ€åŽQueryDSLå ªç§°å®Œç¾Žï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»å‡ ç§æ–¹æ¡ˆã€‚ ç¤ºä¾‹ä»£ç ï¼šhttps://github.com/zhongpan/jpa-demo.git Spring Data JPA å…ˆäº†è§£ä¸‹JPAã€Hibernateã€Spring Data JPAä¸‰è€…çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ JPAæ˜¯ä¸€ä¸ªæŽ¥å£è§„èŒƒï¼Œéšç€Java EE 5å‘å¸ƒï¼Œä¹Ÿæ˜¯EJB3.0çš„ä¸€éƒ¨åˆ†ã€‚Hibernateæ˜¯å…ˆäºŽJPAå‡ºçŽ°çš„ä¸€ç§åŽ†å²æ‚ ä¹…çš„ORMæ¡†æž¶ï¼Œå®ƒå®žçŽ°äº†JPAï¼Œä¹Ÿæ˜¯ç›®å‰ç”¨çš„æœ€å¤šçš„å®žçŽ°ã€‚è€ŒSprint Data JPAæ˜¯Springä¸­æä¾›çš„å¼€ç®±å³ç”¨çš„åŸºäºŽJPAçš„æ•°æ®åº“è®¿é—®æ¡†æž¶ï¼Œå…¶é‡‡ç”¨çš„å®žçŽ°æ­£æ˜¯Hibernateã€‚Spring Data JPAæä¾›çš„æ•°æ®åº“è®¿é—®èƒ½åŠ›å¦‚ä¸‹ï¼š ä»Žä¸Šè¿°æŽ¥å£çš„åå­—å°±å¯ä»¥çœ‹å‡ºï¼š CrudRepositoryï¼šæœ€åŸºæœ¬çš„å¢žåˆ æ”¹æŸ¥æ“ä½œ PagingAndSortingRepositoryï¼šåˆ†é¡µæŸ¥è¯¢ QueryByExampleExecutorï¼šåŸºäºŽæ ·æœ¬æŸ¥è¯¢ï¼Œé¿å…äº†ä¼ ä¸€å †å‚æ•°ï¼Œè¿˜è¦åˆ¤æ–­æ˜¯å¦null JpaSpecificationExecutorï¼šåŸºäºŽSpecificationæŸ¥è¯¢ï¼Œå°±æ˜¯å¯¹CriteriaQueryçš„å°è£…ï¼Œç±»åž‹å®‰å…¨çš„æŸ¥è¯¢æ–¹å¼ QuerydslPredicateExecutorï¼šåŸºäºŽQueryDSLçš„æŸ¥è¯¢ï¼Œä¹Ÿæ˜¯ç±»åž‹å®‰å…¨çš„ ä¸Šè¿°æŽ¥å£çš„å®žçŽ°åœ¨SimpleJpaRepositoryå’ŒQuerydslJpaPredicateExecutorä¸­ï¼Œå…¶ä¸­å°±æ˜¯åŸºäºŽJPAçš„EntiryManageræŽ¥å£è¿›è¡Œå°è£…ã€‚å¦‚æžœæˆ‘ä»¬è¦é‡å†™å®žçŽ°ï¼Œä¹Ÿæ˜¯é€šè¿‡EntiryManageræ¥å®Œæˆã€‚ æ–¹æ¡ˆä¸€ é¦–å…ˆæƒ³åˆ°çš„æ–¹æ³•è‡ªç„¶æ˜¯ä½¿ç”¨@Queryæ³¨è§£ï¼Œç›´æŽ¥ä½¿ç”¨JPQLè¿›è¡Œè”åˆæŸ¥è¯¢ï¼Œè‡ªå®šä¹‰æŽ¥æ”¶å¯¹è±¡ï¼Œleft joinéƒ½ä¸åœ¨è¯ä¸‹ã€‚ä¸»è¦çš„é—®é¢˜æ˜¯å¯¹äºŽä¸€äº›å¤æ‚çš„ã€åŠ¨æ€çš„æŸ¥è¯¢æ¡ä»¶ä¸å¥½å¤„ç†ï¼Œå¦å¤–åˆ†é¡µçš„countQueryä¸å¾—ä¸æŠŠä¸»æŸ¥è¯¢é‡å†™ä¸€éï¼Œæœ‰ç‚¹çƒ¦äººã€‚ 1234567891011121314151617181920@Repositorypublic interface VmhostDao extends JpaRepository&lt;VmhostPO, String&gt; &#123; // æ–¹æ³•ä¸€ï¼šä½¿ç”¨@Queryæ³¨è§£ï¼Œå¯ä»¥è‡ªå®šä¹‰æŽ¥æ”¶å¯¹è±¡ // é—®é¢˜ï¼šæŸ¥è¯¢æ¡ä»¶è¦åµŒå…¥SQLè¯­å¥å†…ï¼Œä¸€äº›å¤æ‚çš„æƒ…å½¢ä¸å¥½å¤„ç†ï¼Œä¾‹å¦‚æŸä¸ªå­—æ®µæ¨¡ç³Šæ£€ç´¢ï¼Œå­—æ®µæ˜¯åŠ¨æ€çš„ï¼›åˆ†é¡µæŸ¥è¯¢countQueryæŠŠæŸ¥è¯¢è¯­å¥é‡å¤äº†ä¸€é @Query("select new com.example.demo.entity.VmhostDTO(v, u, t) from VmhostPO v left join AuthUserPO u on v.userid = u.id left join AuthTenantPO t on v.tenantid = t.id where v.name like %?1%") List&lt;VmhostDTO&gt; findVmhost(String name); @Query("select new com.example.demo.entity.VmhostInfoDTO(v.id, v.name, u.username, t.name) from VmhostPO v left join AuthUserPO u on v.userid = u.id left join AuthTenantPO t on v.tenantid = t.id where v.name like %:name%") List&lt;VmhostInfoDTO&gt; findVmhostInfo(String name); @Query("select v.id as id, v.name as name, u.username as userName, t.name as tname from VmhostPO v left join AuthUserPO u on v.userid = u.id left join AuthTenantPO t on v.tenantid = t.id") List&lt;VmhostInfoByProjection&gt; findVmhostInfoByProjection(); @Query(value = "select new com.example.demo.entity.VmhostInfoDTO(v.id, v.name, u.username, t.name) from VmhostPO v left join AuthUserPO u on v.userid = u.id left join AuthTenantPO t on v.tenantid = t.id where v.name like %:name%", countQuery = "select count(*) from VmhostPO v left join AuthUserPO u on v.userid = u.id left join AuthTenantPO t on v.tenantid = t.id where v.name like %:name%") Page&lt;VmhostInfoDTO&gt; findVmhostInfoByPage(String name, Pageable pageable);&#125; æ–¹æ¡ˆäºŒ é‚£ä¹ˆSQLçš„ç»„ç»‡èƒ½å¦åŠ¨æ€ç¼–ç¨‹æŽ§åˆ¶å‘¢ï¼Œè‡ªç„¶ä¼šæƒ³åˆ°SpecificationæŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ¡ä»¶å¯ä»¥é€šè¿‡CriteriaQueryåŠ¨æ€æ‹¼è£…ã€‚è¿™ä¹Ÿæ˜¯Spring Data JPAä¸­ç”¨çš„æœ€å¹¿æ³›çš„æŸ¥è¯¢æ–¹å¼ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼å­˜åœ¨ä¸€äº›é™åˆ¶ï¼Œé¦–å…ˆä¸èƒ½çµæ´»è‡ªå®šä¹‰æŽ¥æ”¶å¯¹è±¡ï¼Œåªèƒ½è¿”å›žPOï¼Œå…¶æ¬¡è¦æƒ³å®žçŽ°left joinï¼Œå¿…é¡»åœ¨å®žä½“ä¸Šå®šä¹‰å…³ç³»ï¼Œæœ€åŽå…³è”å¯¹è±¡ä¸æ˜¯ä¸€æ¬¡æŸ¥è¯¢å›žæ¥çš„ï¼Œè€Œæ˜¯å•ç‹¬çš„æŸ¥è¯¢ã€‚ 1234567891011121314151617181920212223public interface VmhostSpecWithRelationDao extends JpaRepository&lt;VmhostWithRelationPO, String&gt;, JpaSpecificationExecutor&lt;VmhostWithRelationPO&gt; &#123; // æ–¹æ¡ˆäºŒï¼šä½¿ç”¨SpecificationæŸ¥è¯¢ // é—®é¢˜ï¼šå®žä½“å¿…é¡»é…ç½®å…³ç³»ï¼Œå¦åˆ™æ— æ³•å·¦è¿žæŽ¥ï¼›æ¯ä¸ªå…³è”å¯¹è±¡æ˜¯å•ç‹¬æ•°æ®åº“æŸ¥è¯¢&#125;package com.example.demo.service;@Servicepublic class VmhostService &#123; public List&lt;VmhostWithRelationPO&gt; listVmhostSpecWithRelation(String name) &#123; Specification&lt;VmhostWithRelationPO&gt; spec = (root, cq, cb) -&gt; &#123; root.join("user", JoinType.LEFT); root.join("tenant", JoinType.LEFT); return cb.like(root.get("name"), "%" + name + "%"); &#125;; List&lt;VmhostWithRelationPO&gt; list = vmhostSpecWithRelationDao.findAll(spec); return list; &#125;&#125; å¯èƒ½å¤§å®¶æœ‰ä¸¤ç‚¹ç–‘é—®ï¼š @Queryå’ŒSpecificationèƒ½å¦æ··ç”¨ï¼Œ@Queryå®šä¹‰selectçš„ç»“æžœï¼ŒSpecificationå®šä¹‰æŸ¥è¯¢æ¡ä»¶ ç­”æ¡ˆï¼šä¸è¡Œï¼Œæ€»æ˜¯@Queryæœ‰æ•ˆï¼Œä½ å®šä¹‰çš„Specificationå‚æ•°åŽ‹æ ¹å°±ä¸ä¼šç†ä¼š 1234567891011121314// JpaSpecificationExecutorçš„å‚æ•°å’ŒJpaRepositoryä¸ä¸€æ ·ï¼Œæ²¡å•¥ç”¨ï¼ŒSimpleJpaRepositoryæ€»æ˜¯ç”¨çš„JpaRepositoryçš„å‚æ•°public interface VmhostSpecDao extends JpaRepository&lt;VmhostPO, String&gt;, JpaSpecificationExecutor&lt;VmhostInfoDTO&gt; &#123; // æ–¹æ¡ˆäºŒï¼š@Queryå’ŒSpecificationæ˜¯ä¸èƒ½æ··ç”¨çš„ï¼Œä¹Ÿæ— æ³•æ”¹å˜æŽ¥æ”¶ç»“æžœé›†å¯¹è±¡ // æ— æ³•æ··ç”¨ï¼Œæ€»æ˜¯queryæœ‰æ•ˆï¼Œspecå‚æ•°åŽ‹æ ¹å°±ä¸ä¼šç†ä¼š @Query("from VmhostPO") List&lt;VmhostPO&gt; findVmhost(Specification&lt;VmhostPO&gt; spec); // è¦†ç›–JpaSpecificationExecutorçš„æ–¹æ³•å¯ä»¥å—ï¼Ÿä¸€æ ·çš„ï¼Œæ ¹æœ¬ä¸ä¼šèµ°åˆ°findAllçš„é»˜è®¤å®žçŽ° @Override @Query("select new com.example.demo.entity.VmhostInfoDTO(v.id, v.name, u.username, t.name) from VmhostPO v left join AuthUserPO u on v.userid = u.id left join AuthTenantPO t on v.tenantid = t.id") List&lt;VmhostInfoDTO&gt; findAll(Specification&lt;VmhostInfoDTO&gt; spec);&#125; SpecificationæŽ§åˆ¶æŽ¥æ”¶ç»“æžœé›†å¯¹è±¡ ç­”æ¡ˆï¼šå¯¹ä¸èµ·ï¼ŒSpecificationçš„toPredicateä¸­æ‰§è¡Œselectæ˜¯æ— æ•ˆçš„ï¼Œé‡Œé¢åªèƒ½è¿”å›žæŸ¥è¯¢æ¡ä»¶ã€‚ 123456789101112131415 // è¿™æ ·å†™æ²¡æœ‰ç”¨ï¼Œç”Ÿæˆå¦‚ä¸‹sql // select vmhostpo0_.id as id1_2_, vmhostpo0_.addresses as addresse2_2_, vmhostpo0_.availablezone as availabl3_2_, vmhostpo0_.baremetal as baremeta4_2_, vmhostpo0_.cpucore as cpucore5_2_, vmhostpo0_.createtime as createti6_2_, vmhostpo0_.disksize as disksize7_2_, vmhostpo0_.floatip as floatip8_2_, vmhostpo0_.hostname as hostname9_2_, vmhostpo0_.locked as locked10_2_, vmhostpo0_.metadata as metadat11_2_, vmhostpo0_.name as name12_2_, vmhostpo0_.privatenetworkid as private13_2_, vmhostpo0_.ramsize as ramsize14_2_, vmhostpo0_.tenantid as tenanti15_2_, vmhostpo0_.tenantname as tenantn16_2_, vmhostpo0_.type as type17_2_, vmhostpo0_.userid as userid18_2_, vmhostpo0_.username as usernam19_2_, vmhostpo0_.vmstatus as vmstatu20_2_ from vmhost vmhostpo0_ cross join auth_user authuserpo1_ cross join auth_tenant authtenant2_ where vmhostpo0_.userid=authuserpo1_.id and vmhostpo0_.tenantid=authtenant2_.id and (vmhostpo0_.name like ?)public Optional&lt;VmhostInfoDTO&gt; listVmhostSpec(String name) &#123; Specification&lt;VmhostInfoDTO&gt; spec = (root, cq, cb) -&gt; &#123; // åªèƒ½cross joinï¼Œè¦left joinéœ€è¦åœ¨å®žä½“ä¸Šå»ºç«‹å…³ç³» Root&lt;AuthUserPO&gt; user = cq.from(AuthUserPO.class); Root&lt;AuthTenantPO&gt; tenant = cq.from(AuthTenantPO.class); // è¿™é‡Œæ‰§è¡Œselectæ²¡æœ‰ç”¨ï¼Œè¿™ä¸ªå‡½æ•°åªèƒ½è¿”å›žæŸ¥è¯¢æ¡ä»¶ï¼Œå¤–å±‚ä¼šè¦†ç›–select cq.multiselect(root.get("id"), root.get("name"), user.get("username"), tenant.get("name")); return cb.and(cb.equal(root.get("userid"), user.get("id")), cb.equal(root.get("tenantid"), tenant.get("id")), cb.like(root.get("name"), "%" + name + "%")); &#125;; return vmhostSpecDao.findOne(spec);&#125; å› ä¸ºSimpleJpaRepositoryçš„å®žçŽ°å·²ç»å›ºå®šäº†selectï¼Œè·ŸJpaRepositoryçš„ç±»åž‹å‚æ•°ç›¸å…³ï¼Œè·ŸJpaSpecificationExecutorçš„ç±»åž‹å‚æ•°æ— å…³ 1234567891011121314protected &lt;S extends T&gt; TypedQuery&lt;S&gt; getQuery(@Nullable Specification&lt;S&gt; spec, Class&lt;S&gt; domainClass, Sort sort) &#123; CriteriaBuilder builder = em.getCriteriaBuilder(); CriteriaQuery&lt;S&gt; query = builder.createQuery(domainClass); Root&lt;S&gt; root = applySpecificationToCriteria(spec, domainClass, query); query.select(root); if (sort.isSorted()) &#123; query.orderBy(toOrders(sort, root, builder)); &#125; return applyRepositoryMethodMetadata(em.createQuery(query));&#125; æ–¹æ¡ˆä¸‰ ä¸Šé¢ä¸¤ç§ä½¿ç”¨æ–¹æ³•æ˜¯Spring Data JPAç”¨çš„æœ€å¤šçš„ï¼ŒæŽ¥ä¸‹æ¥åªèƒ½ä»Žåº•å±‚å…¥æ‰‹ï¼Œç›´æŽ¥ä½¿ç”¨EntiryManagerã€‚è¿™ç§æ–¹æ³•å®Œå…¨é è‡ªå·±ï¼Œæ‰€æœ‰æŽ¥å£éƒ½éœ€è¦è‡ªå·±å®žçŽ°ï¼Œä¸§å¤±äº†Spring Data JPAçš„ä¾¿åˆ©æ€§ã€‚ 123456789101112131415161718192021222324252627282930@Repositorypublic class VmhostEMDao &#123; @Autowired @PersistenceContext private EntityManager entityManager; // æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨åŽŸç”Ÿçš„entityManagerï¼Œè§£å†³@Queryçš„SQLæ— æ³•åŠ¨æ€æ‹¼æŽ¥é—®é¢˜ // æ­¤æ—¶åˆ†é¡µå°±éœ€è¦è‡ªå·±å°è£…äº†ï¼Œä¹Ÿæ²¡æœ‰äº†JPAè‡ªåŠ¨å®žçŽ°çš„æŽ¥å£ // æ³¨æ„è¿™é‡ŒlikeåŽé¢è¦å¼•å· @SuppressWarnings("unchecked") public List&lt;VmhostDTO&gt; findVmhost(String name) &#123; List&lt;VmhostDTO&gt; list = entityManager.createQuery( "select new com.example.demo.entity.VmhostDTO(v, u, t) from VmhostPO v left join AuthUserPO u on v.userid = u.id left join AuthTenantPO t on v.tenantid = t.id where v.name like '%" + name + "%'") .getResultList(); return list; &#125; @SuppressWarnings("unchecked") public List&lt;VmhostInfoByProjection&gt; findVmhostInfoByProjection() &#123; // æ­¤æ—¶æ€»æ˜¯Object[]ï¼Œä¸æ”¯æŒæŠ•å½± List&lt;VmhostInfoByProjection&gt; list = entityManager.createQuery( "select v.id as id, v.name as name, u.username as userName, t.name as tname from VmhostPO v left join AuthUserPO u on v.userid = u.id left join AuthTenantPO t on v.tenantid = t.id") .getResultList(); return list; &#125;&#125; æ–¹æ¡ˆå›› ç±»ä¼¼äºŽæ–¹æ¡ˆäºŒä¹‹äºŽæ–¹æ¡ˆä¸€ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»åž‹å®‰å…¨çš„æŸ¥è¯¢æ–¹å¼CriteraQueryã€‚ 123456789101112131415161718192021222324@Repositorypublic class VmhostCQDao &#123; @Autowired @PersistenceContext private EntityManager entityManager; // æ–¹æ¡ˆå››ï¼šç›¸å¯¹äºŽæ–¹æ¡ˆä¸‰ï¼Œä½¿ç”¨äº†ç±»åž‹å®‰å…¨çš„CriteriaQueryï¼Œå…¶å®žSpecificationä¹Ÿæ˜¯ç”¨çš„CriteriaQueryï¼Œæ‰€ä»¥å­˜åœ¨å’ŒSpecificationä¸€æ ·çš„é™åˆ¶ï¼Œä½†æ˜¯å¯ä»¥æŽ§åˆ¶selectäº†ï¼Œæ¯”Specificationçµæ´»ä¸€ç‚¹ public List&lt;VmhostDTO&gt; findVmhost(String name) &#123; CriteriaBuilder builder = entityManager.getCriteriaBuilder(); CriteriaQuery&lt;VmhostDTO&gt; query = builder.createQuery(VmhostDTO.class); // å®žä½“ä¸Šæ²¡æœ‰é…ç½®å…³ç³»ï¼Œæ— æ³•ä½¿ç”¨left joinï¼Œåªèƒ½è”åˆæŸ¥è¯¢(inner join) Root&lt;VmhostPO&gt; root = query.from(VmhostPO.class); Root&lt;AuthUserPO&gt; rootUser = query.from(AuthUserPO.class); Root&lt;AuthTenantPO&gt; rootTenant = query.from(AuthTenantPO.class); query.multiselect(root, rootUser, rootTenant).where(builder.equal(root.get("userid"), rootUser.get("id")), builder.equal(root.get("tenantid"), rootTenant.get("id")), builder.like(root.get("name"), "%" + name + "%")); List&lt;VmhostDTO&gt; list = entityManager.createQuery(query).getResultList(); return list; &#125;&#125; ç»ˆæžæ–¹æ¡ˆ åˆ°äº†ç»ˆæžæ–¹æ¡ˆäº†ï¼ŒSpring Data JPAé›†æˆäº†å¯¹QueryDSLçš„æ”¯æŒï¼Œå®˜æ–¹å‚è€ƒè§ï¼šhttp://www.querydsl.com/static/querydsl/latest/reference/html_singleã€‚ æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒæ–¹æ¡ˆäºŒ+æ–¹æ¡ˆå››ï¼Œå•è¡¨çš„æ—¶å€™ç›´æŽ¥ä½¿ç”¨JpaRepositoryå’ŒQuerydslPredicateExecutoræä¾›çš„é»˜è®¤å®žçŽ°ã€‚ 1234567891011121314package com.example.demo.dao;import com.example.demo.entity.VmhostPO;import org.springframework.data.jpa.repository.JpaRepository;import org.springframework.data.querydsl.QuerydslPredicateExecutor;public interface VmhostQDSLDao extends JpaRepository&lt;VmhostPO, String&gt;, QuerydslPredicateExecutor&lt;VmhostPO&gt;, VmhostRepository &#123; // æ–¹æ¡ˆäº”ï¼šVmhostRepositoryä½¿ç”¨åŽŸç”Ÿçš„entityManageré…åˆQueryDSLï¼Œå®Œç¾Žè§£å†³æ‰€æœ‰é—®é¢˜ // å¯¹äºŽå•è¡¨ä¹Ÿå¯ä»¥ä½¿ç”¨QuerydslPredicateExecutorï¼Œè‡ªåŠ¨æ‹¥æœ‰é»˜è®¤å®žçŽ°&#125; å¤šè¡¨çš„æ—¶å€™å°±åŸºäºŽEntityManageræ‰©å±•ï¼Œä½†æ˜¯querydslå·²ç»å¸®æˆ‘ä»¬åšäº†å¾ˆå¤šå·¥ä½œï¼Œä¸æ˜¯ä»Žå¤´å¼€å§‹ã€‚querydslçš„ä¹¦å†™æ–¹å¼ç›¸å¯¹äºŽCriteriaQueryä¹Ÿæ›´åŠ è‡ªç„¶ï¼Œæ˜“äºŽç†è§£ã€‚ 1234567@NoRepositoryBeanpublic class BaseRepository &#123; @PersistenceContext protected EntityManager em;&#125; 1234567public interface VmhostRepository &#123; public List&lt;VmhostDTO&gt; findVmhost(Predicate predicate); public QueryResults&lt;VmhostDTO&gt; findVmhostByPage(Predicate predicate, Pageable pageable);&#125; 1234567891011121314151617181920212223242526272829303132333435@Repositorypublic class VmhostRepositoryImpl extends BaseRepository implements VmhostRepository &#123; // å¤šè¡¨å·¦è¿žæŽ¥ @Override public List&lt;VmhostDTO&gt; findVmhost(Predicate predicate) &#123; JPAQueryFactory queryFactory = new JPAQueryFactory(em); JPAQuery&lt;VmhostDTO&gt; jpaQuery = queryFactory .select(Projections.constructor(VmhostDTO.class, QVmhostPO.vmhostPO, QAuthUserPO.authUserPO, QAuthTenantPO.authTenantPO)) .from(QVmhostPO.vmhostPO).leftJoin(QAuthUserPO.authUserPO) .on(QVmhostPO.vmhostPO.userid.stringValue().eq(QAuthUserPO.authUserPO.id.stringValue())) .leftJoin(QAuthTenantPO.authTenantPO) .on(QVmhostPO.vmhostPO.tenantid.stringValue().eq(QAuthTenantPO.authTenantPO.id.stringValue())); jpaQuery.where(predicate); return jpaQuery.fetch(); &#125; @Override public QueryResults&lt;VmhostDTO&gt; findVmhostByPage(Predicate predicate, Pageable pageable) &#123; JPAQueryFactory queryFactory = new JPAQueryFactory(em); JPAQuery&lt;VmhostDTO&gt; jpaQuery = queryFactory .select(Projections.constructor(VmhostDTO.class, QVmhostPO.vmhostPO, QAuthUserPO.authUserPO, QAuthTenantPO.authTenantPO)) .from(QVmhostPO.vmhostPO).leftJoin(QAuthUserPO.authUserPO) .on(QVmhostPO.vmhostPO.userid.stringValue().eq(QAuthUserPO.authUserPO.id.stringValue())) .leftJoin(QAuthTenantPO.authTenantPO) .on(QVmhostPO.vmhostPO.tenantid.stringValue().eq(QAuthTenantPO.authTenantPO.id.stringValue())) .offset(pageable.getOffset()).limit(pageable.getPageSize()); jpaQuery.where(predicate); return jpaQuery.fetchResults(); &#125;&#125; æ€»ç»“ ä»¥ä¸Šæ–¹æ³•éƒ½è¿˜æ˜¯åœ¨Spring Data JPAæ¡†æž¶ä¹‹å†…ï¼Œå¦‚æžœä½ æ„¿æ„ï¼Œä½ ä¹Ÿå¯ä»¥åŽ»é‡å†™SimpleJpaRepositoryï¼Œé‡å†™äº†æ³¨æ„é€šè¿‡å¦‚ä¸‹æ³¨è§£å¯ç”¨ã€‚ 1@EnableJpaRepositories(repositoryBaseClass = XXXXXX.class) å…¶å®žQueryDSLå·²ç»åšäº†å¾ˆå¥½çš„å°è£…ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦é‡å¤é€ è½®å­ï¼ŒSpring Data JPAä¹Ÿæä¾›äº†å¾ˆå¤šæ‰©å±•ç‚¹ï¼Œåœ¨ä¿ç•™å…¶ä¾¿åˆ©æ€§çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®éœ€è¦åŽ»æ‰©å±•ï¼Œä¸éœ€è¦å…¨éƒ¨æŽ¨å€’é‡æ¥ã€‚]]></content>
      <categories>
        <category>spring boot</category>
      </categories>
      <tags>
        <tag>spring boot</tag>
        <tag>jpa</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¯¦è§£Spring Bootä¸­æ—¥æœŸæ—¶é—´æ ¼å¼å¤„ç†]]></title>
    <url>%2F2020%2F06%2F04%2F033-time-format-processing-in-springboot%2F</url>
    <content type="text"><![CDATA[åœ¨springbootä¸­å¼€å‘RESTfulæŽ¥å£ï¼Œç»å¸¸ä¼šé‡åˆ°æ—¥æœŸæ—¶é—´è½¬æ¢ç›¸å…³çš„é—®é¢˜ï¼Œä¾‹å¦‚æˆ‘ä»¬æ˜Žæ˜Žè¾“å…¥çœ‹èµ·æ¥å¾ˆæ­£å¸¸çš„æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç³»ç»Ÿå´æŠ¥é”™æ— æ³•è§£æžï¼š JSON parse error: Cannot deserialize value of type java.time.OffsetDateTime from String â€œ2020-06-06 14:26:31â€ æˆ–è€…æŽ¥å£è¿”å›žçš„æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„å­—ç¬¦ä¸²ï¼š 2020-06-04 14:41:54.767135400+08:00 å¦‚ä½•æ­£ç¡®çš„å¤„ç†æ—¥æœŸæ—¶é—´ï¼Œæœ¬æ–‡å°†ä¸€æŽ¢ç©¶ç«Ÿã€‚ æ—¥æœŸæ—¶é—´æ ¼å¼æ ‡å‡† æœ‰ä¸¤ä¸ªæ ‡å‡†ç»„ç»‡å¯¹æ—¥æœŸæ—¶é—´æ ¼å¼è¿›è¡Œè§„èŒƒï¼Œä¸€ä¸ªæ˜¯IETFï¼Œä¸€ä¸ªæ˜¯ISOã€‚è™½ç„¶IETFçš„å®šä¹‰æ›´æ—©ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€äº›é—®é¢˜ï¼ŒISOçš„å®šä¹‰ä½¿ç”¨æ›´æ™®éã€‚ä½†æ˜¯ä¸ç®¡å“ªç§å®šä¹‰ï¼Œæˆ‘ä»¬å¸¸å¸¸ä½¿ç”¨çš„yyyy-MM-dd HH:mm:ssè¿™ç§æ ¼å¼éƒ½ä¸æ˜¯æ ‡å‡†çš„ï¼Œä½ æ˜¯å¦éžå¸¸æƒŠè®¶å‘¢ã€‚ IETF RFC822-&gt;RFC2822-&gt;RFC5322 æ—¥æœŸæ—¶é—´çš„æœ¬æ–‡è¡¨ç¤ºæœ€æ—©æ˜¯åœ¨ç”µå­é‚®ä»¶æ¶ˆæ¯ä¸­è¢«è®¨è®ºå’Œå®šä¹‰ï¼Œå¯ä»¥è¿½æº¯åˆ°Internetåˆšè¯žç”Ÿä¹‹æ—¶ï¼ŒARPANETä½¿ç”¨çš„æ–‡æœ¬ä¿¡æ¯æ ¼å¼ä¸­æ‰€å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯RFC822ï¼Œå‘å¸ƒäºŽ1982å¹´ã€‚æ­¤åŽç»è¿‡è‹¥å¹²æ¬¡ä¿®è®¢ï¼Œå®šåž‹æ˜¯RFC2822ï¼Œæœ€æ–°ç‰ˆæ˜¯RFC5322ã€‚ é€šè¿‡å‡ ä¸ªä¾‹å­æ¥äº†è§£ä¸‹è¿™ç§æ ¼å¼é•¿ä»€ä¹ˆæ ·å­ã€‚ æœ€å¸¸è§çš„æ ·å­å¦‚ä¸‹ï¼Œé€šè¿‡linuxå‘½ä»¤dateå¯ä»¥æ‰“å°ï¼š date --rfc-email Thu, 04 Jun 2020 13:54:52 +0800 æœ‰äº›æ ¼å¼å·²ç»ä¸å»ºè®®ä½¿ç”¨ï¼ŒRFC2822å®šä¹‰ä¸ºè¿‡æ—¶çš„æ ¼å¼ï¼Œå¦‚ï¼š å¹´ä»½ä½¿ç”¨4ä½ä»¥ä¸‹æ•°å­— æ—¶åŒºä½¿ç”¨æ—¶åŒºåï¼Œå¦‚UTï¼ŒGMT RFC1123 RFC1123å¹¶ä¸å®šä¹‰æ—¥æœŸæ—¶é—´æ ¼å¼ï¼Œè€Œæ˜¯æè¿°åº”ç”¨ç¨‹åºä¹‹é—´é€šä¿¡åè®®çš„éœ€æ±‚ï¼ŒåŒ…æ‹¬å„ç§åº”ç”¨å±‚åè®®ï¼Œå¦‚TELNETï¼ŒFTPï¼ŒSMTPç­‰ï¼Œæ¶‰åŠåˆ°æ—¥æœŸæ—¶é—´æ ¼å¼çš„æ­£æ˜¯SMTPï¼Œå®ƒå¼•ç”¨äº†RFC822ï¼Œå¹¶è¯´æ˜Žäº†å¹´ä»½ä¿®æ”¹ä¸º2åˆ°4ä¸ªæ•°å­—ï¼Œå»ºè®®æ—¶åŒºæ€»æ˜¯ä½¿ç”¨æ•°å­—ã€‚ RFC1036 åŒæ ·RFC1306ä¹Ÿä¸å®šä¹‰æ—¥æœŸæ—¶é—´æ ¼å¼ï¼Œè€Œæ˜¯æè¿°USENETä¸­å¯¹æ—¥æœŸæ—¶é—´çš„è¦æ±‚ï¼ŒåŒæ ·å¼•ç”¨äº†RFC822ã€‚ ç»¼ä¸ŠIETFçš„æ—¶é—´æ ¼å¼ä¸»è¦ä¸ºç”µå­é‚®ä»¶å®šä¹‰ï¼Œä½†æ˜¯åªè¦ä»¥å¯è¯»æ–‡æœ¬æ–¹å¼è¡¨ç¤ºæ—¶é—´éƒ½å¯ä»¥ä½¿ç”¨ã€‚IETFçš„å®šä¹‰å¸¦æœ‰æ˜Žæ˜¾çš„æ—¶ä»£å’Œåœ°åŒºç‰¹å¾ï¼Œå¹¶ä¸å…·æœ‰å›½é™…é€šç”¨æ€§ï¼Œä¹Ÿä¸ä¾¿äºŽé˜…è¯»å’Œè§£æžï¼Œå› æ­¤åˆå‡ºçŽ°äº†ISOçš„æ—¥æœŸæ—¶é—´æ ¼å¼ã€‚ ISO8601,RFC3339 ISOçš„æ—¥æœŸæ—¶é—´æ ¼å¼æœ‰åŠ©äºŽé¿å…ç”±è®¸å¤šä¸åŒçš„å›½å®¶ç¬¦å·å¼•èµ·çš„å›½é™…é€šä¿¡æ··ä¹±ï¼Œå¹¶æé«˜äº†è®¡ç®—æœºç”¨æˆ·ç•Œé¢çš„å¯ç§»æ¤æ€§ã€‚ç¬¬ä¸€ç‰ˆå‘å¸ƒäºŽ1988å¹´ã€‚ RFC3339æ˜¯ISO8601çš„æ¦‚è¦ç‰ˆæœ¬ã€‚ å…ˆé€šè¿‡ä¾‹å­äº†è§£ä¸€ä¸‹ä»–ä»¬é•¿ä»€ä¹ˆæ ·å­ã€‚ date --iso-8601=ns 2020-06-04T14:41:54,767135400+08:00 date --rfc-3339=ns 2020-06-04 14:41:54.767135400+08:00 ä»¥ä¸Šæ˜¯æœ€å¸¸è§çš„æ ·å­ï¼ŒISO8601ç›¸å¯¹äºŽRFC5322æœ‰å‡ ä¸ªä¸»è¦å˜åŒ–ï¼š å¤šäº†ç§’çš„å°æ•°éƒ¨åˆ†ï¼Œç”¨.æˆ–,è¿žæŽ¥ ç²¾åº¦ä¸Šå¯ä»¥ä»Žå¹´åˆ°ç§’çš„å°æ•°éƒ¨åˆ†éƒ½å¯ä»¥ï¼Œä¾‹å¦‚2020ã€2020-06ã€2020-06-04éƒ½æ˜¯åˆæ³•çš„ æ—¥æœŸå’Œæ—¶é—´ä¹‹é—´å¢žåŠ äº†è¿žæŽ¥å­—ç¬¦T å¯ä»¥è¡¨ç¤ºä¸€å¹´çš„ç¬¬å‡ å‘¨çš„æ˜ŸæœŸå‡ ï¼Œä¾‹å¦‚2020-W01-1è¡¨ç¤º2020å¹´ç¬¬ä¸€å‘¨çš„æ˜ŸæœŸä¸€ UTCæ—¶åŒºå¯ä»¥ç®€å†™ä¸ºZ å¹´æœˆæ—¥æˆ–æ—¶åˆ†ç§’ä¹‹é—´çš„è¿žæŽ¥ç¬¦å¯çœç•¥ RFC3339å’ŒISO8601çš„åŒºåˆ«ï¼š RFC3339å…è®¸å°†æ—¥æœŸå’Œæ—¶é—´ä¹‹é—´çš„è¿žæŽ¥ç¬¦Tæ¢ä¸ºç©ºæ ¼ ç§’çš„å°æ•°éƒ¨åˆ†é€šå¸¸ä½¿ç”¨.è¿žæŽ¥ æœªä½¿ç”¨ä¸€å¹´çš„ç¬¬å‡ å‘¨çš„æ˜ŸæœŸå‡ çš„è¡¨ç¤º Javaæ—¥æœŸæ—¶é—´ç¼–ç¨‹æŽ¥å£ Javaçš„å‘å±•è¿‡ç¨‹ä¸­å‡ºçŽ°è¿‡å‡ ä¸ªä¸åŒçš„æ—¥æœŸæ—¶é—´ç¼–ç¨‹æŽ¥å£ã€‚java8ä¹‹å‰çš„æ—¥æœŸæ—¶é—´æŽ¥å£å­˜åœ¨ä¼—æ‰€å‘¨çŸ¥çš„é—®é¢˜ï¼Œè¿™æ—¶åªèƒ½å¯»æ±‚ç¬¬ä¸‰æ–¹åº“åº“æ¥è§£å†³ï¼Œè¿™å°±æ˜¯jodaï¼Œjava8å¤§é‡å€Ÿé‰´äº†jodaï¼ŒæŽ¨å‡ºäº†æ–°çš„æ—¥æœŸæ—¶é—´åº“ã€‚è‡ªæ­¤ï¼Œjava8æ—¥æœŸæ—¶é—´æŽ¥å£æˆä¸ºé¦–é€‰ã€‚ java8ä¹‹å‰ java8 joda æœ¬åœ°æ—¶é—´ java.util.Date java.time.LocalDatejava.time.LocalTimejava.time.LocalDateTime org.joda.time.LocalDateorg.joda.time.LocalTimeorg.joda.time.LocalDateTime å¸¦æ—¶åŒºæ—¶é—´ java.time.OffsetTimejava.time.OffsetDateTimejava.time.ZonedDateTime org.joda.time.DateTime æ ¼å¼åŒ–å’Œè§£æž java.text.DateFormat java.time.format.DateTimeFormatter org.joda.time.format.DateTimeFormatter ä¸¾ä¾‹ Date date = new Date();SimpleDateFormat fmt = new SimpleDateFormat(â€œyyyy-MM-dd HH:mm:ssâ€);String str = fmt.format(date);date = fmt.parse(â€œ2020-06-06 15:13:25â€); LocalDateTime date = LocalDateTime.now();DateTimeFormatter fmt = DateTimeFormatter.ofPattern(â€œyyyy-MM-dd HH:mm:ssâ€);String str = fmt.format(date);TemporalAccessor acc = fmt.parse(â€œ2020-06-06 15:13:25â€);date = LocalDateTime.from(acc); LocalDateTime date = LocalDateTime.now();DateTimeFormatter fmt = DateTimeFormat.forPattern(â€œpatternâ€);String str = fmt.print(date);date = fmt.parseLocalDate(â€œ2020-06-06 15:13:25â€); ä»¥ä¸Šå„ç§æ—¥æœŸæ—¶é—´ç¼–ç¨‹æŽ¥å£éƒ½æä¾›äº†æ ¼å¼åŒ–å’Œè§£æžæŽ¥å£ï¼Œå®žçŽ°å­—ç¬¦ä¸²å’Œæ—¥æœŸæ—¶é—´å¯¹è±¡ä¹‹é—´çš„äº’ç›¸è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶æ—¥æœŸæ ¼å¼ï¼Œä¾‹å¦‚å¸¸ç”¨çš„æ ¼å¼yyyy-MM-dd HH:mm:ssï¼Œé‚£ä¹ˆæ ¼å¼åŒ–å’Œè§£æžéƒ½ä¼šæŒ‰ç…§è¿™ä¸ªæ ¼å¼ï¼Œè§£æžæ—¶å¦‚æžœä¸ç¬¦åˆæ ¼å¼å°±ä¼šå¼‚å¸¸ã€‚ sprintbootä¸­å¦‚ä½•å¤„ç†æ—¥æœŸæ—¶é—´ ç¡®åˆ‡çš„è¯´æ˜¯å¦‚ä½•å¤„ç†jsonå’Œjavaæ—¥æœŸæ—¶é—´å¯¹è±¡ä¹‹é—´çš„è½¬æ¢ã€‚ springbootæžå¤§çš„ç®€åŒ–äº†springmvcçš„å¼€å‘ï¼Œå¯¹äºŽå¼€å‘RESTfulæŽ¥å£ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå¼€ç®±å³ç”¨ã€‚è¿™æ˜¯é€šè¿‡autoconfigureå’Œstarterå®žçŽ°çš„ã€‚ é¦–å…ˆå¼•å…¥spring-boot-starter-webä¾èµ–ã€‚ 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; spring-boot-starter-webä¼šå¼•å…¥spring-boot-starter-jsonï¼Œspring-boot-starter-jsonåˆä¼šå¼•å…¥jackson-databindï¼Œjackson-datatype-jdk8å’Œjackson-datatype-jsr310ã€‚å¯è§jsonçš„å®žçŽ°é»˜è®¤æ˜¯ä½¿ç”¨çš„jacksonã€‚å…¶ä¸­jackson-datatype-jsr310å°±åŒ…å«äº†java8æ—¥æœŸæ—¶é—´çš„åºåˆ—åŒ–ã€ååºåˆ—åŒ–æ–¹æ³•ã€‚ å…¶æ¬¡springbootåº”ç”¨ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†@SpringBootApplicationæ³¨è§£ï¼Œé€šè¿‡autoconfigureå¯¹jacksonè¿›è¡Œäº†è‡ªåŠ¨é…ç½®ã€‚å®žçŽ°ä»£ç åœ¨sprint-boot-autoconfigureçš„JacksonAutoConfiguration.javaæ–‡ä»¶ä¸­ã€‚ å…¶ä¸­æœ‰ä¸‰ä¸ªç‚¹å¯¹jacksonè¿›è¡Œé…ç½®ï¼šJackson2ObjectMapperBuilderï¼ŒJackson2ObjectMapperBuilderCustomizerå’ŒObjectMapperï¼Œä»¥ä¸Šæ‰€æœ‰é…ç½®æœ€ç»ˆéƒ½æ˜¯å½±å“ObjectMapperã€‚ Jackson2ObjectMapperBuilderæ˜¯ObjectMapperçš„å·¥åŽ‚ï¼Œåªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†@ConditionalOnMissingBean 1234567891011121314@Configuration(proxyBeanMethods = false) @ConditionalOnClass(Jackson2ObjectMapperBuilder.class) static class JacksonObjectMapperBuilderConfiguration &#123; @Bean @Scope("prototype") @ConditionalOnMissingBean Jackson2ObjectMapperBuilder jacksonObjectMapperBuilder(ApplicationContext applicationContext, List&lt;Jackson2ObjectMapperBuilderCustomizer&gt; customizers) &#123; Jackson2ObjectMapperBuilder builder = new Jackson2ObjectMapperBuilder(); builder.applicationContext(applicationContext); customize(builder, customizers); return builder; &#125; Jackson2ObjectMapperBuilderä¼šè°ƒç”¨Jackson2ObjectMapperBuilderCustomizerå¯¹builderè¿›è¡Œå®šåˆ¶ï¼Œå³ä¸Šè¿°customizeæ–¹æ³•ï¼ŒJackson2ObjectMapperBuilderCustomizerå¯ä»¥æœ‰å¤šä¸ª 12345678910@Configuration(proxyBeanMethods = false) @ConditionalOnClass(Jackson2ObjectMapperBuilder.class) @EnableConfigurationProperties(JacksonProperties.class) static class Jackson2ObjectMapperBuilderCustomizerConfiguration &#123; @Bean StandardJackson2ObjectMapperBuilderCustomizer standardJacksonObjectMapperBuilderCustomizer( ApplicationContext applicationContext, JacksonProperties jacksonProperties) &#123; return new StandardJackson2ObjectMapperBuilderCustomizer(applicationContext, jacksonProperties); &#125; æœ€åŽä½ å¯ä»¥ç›´æŽ¥é…ç½®ObjectMapperï¼Œåªèƒ½æœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥ä½ éœ€è¦æŒ‡å®š@Primaryï¼Œé»˜è®¤æ˜¯é€šè¿‡builderåˆ›å»º 12345678910111213 @Configuration(proxyBeanMethods = false)@ConditionalOnClass(Jackson2ObjectMapperBuilder.class)static class JacksonObjectMapperConfiguration &#123; @Bean @Primary @ConditionalOnMissingBean ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) &#123; return builder.createXmlMapper(false).build(); &#125; &#125; é‚£ä¹ˆå¯¹äºŽæ—¥æœŸæ—¶é—´çš„å¤„ç†ï¼Œspringbootçš„é»˜è®¤è¡Œä¸ºæ˜¯æ€Žä¹ˆæ ·çš„å‘¢ï¼Œé»˜è®¤çš„ä»£ç é…ç½®åœ¨ä¸Šè¿°StandardJackson2ObjectMapperBuilderCustomizerä¸­ã€‚ 1234567891011121314151617181920212223242526static final class StandardJackson2ObjectMapperBuilderCustomizer implements Jackson2ObjectMapperBuilderCustomizer, Ordered &#123; ...... private void configureDateFormat(Jackson2ObjectMapperBuilder builder) &#123; // We support a fully qualified class name extending DateFormat or a date // pattern string value String dateFormat = this.jacksonProperties.getDateFormat(); if (dateFormat != null) &#123; try &#123; Class&lt;?&gt; dateFormatClass = ClassUtils.forName(dateFormat, null); builder.dateFormat((DateFormat) BeanUtils.instantiateClass(dateFormatClass)); &#125; catch (ClassNotFoundException ex) &#123; SimpleDateFormat simpleDateFormat = new SimpleDateFormat(dateFormat); // Since Jackson 2.6.3 we always need to set a TimeZone (see // gh-4170). If none in our properties fallback to the Jackson's // default TimeZone timeZone = this.jacksonProperties.getTimeZone(); if (timeZone == null) &#123; timeZone = new ObjectMapper().getSerializationConfig().getTimeZone(); &#125; simpleDateFormat.setTimeZone(timeZone); builder.dateFormat(simpleDateFormat); &#125; &#125; &#125; å…¶é€»è¾‘æ˜¯é¦–å…ˆè¯»å–spring.jackson.date-formatå±žæ€§ï¼Œå¦‚æžœä¸ä¸ºç©ºå°±ä¼šè®¾ç½®builder.dateFormatï¼Œå¦‚æžœæ˜¯ä¸€ä¸ªç±»ï¼ˆå½“ç„¶æ˜¯ä»Žjava.text.DateFormatæ´¾ç”Ÿï¼‰ï¼Œé‚£ä¹ˆåˆå§‹åŒ–ä¸ºè¿™ä¸ªç±»çš„å®žä¾‹ï¼Œå¦åˆ™è®¤ä¸ºé…ç½®çš„yyyy-MM-dd HH:mm:ssè¿™ç§æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç„¶åŽåˆ›å»ºSimpleDateFormatå®žä¾‹ã€‚ å¦å¤–springmvcæœ¬èº«è¿˜æœ‰ä¸€ä¸ªMappingJackson2HttpMessageConverterï¼Œå…¶å®žä¹Ÿæ˜¯é…ç½®Jackson2ObjectMapperBuilderã€‚]]></content>
      <categories>
        <category>spring boot</category>
      </categories>
      <tags>
        <tag>spring boot</tag>
        <tag>jackson</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è§£å†³vscodeè°ƒè¯•pythoné‡åˆ°connection refusedé—®é¢˜]]></title>
    <url>%2F2020%2F04%2F22%2F032-vscode-debug-connection-resused%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘ç”¨vscodeè¿œç¨‹å¼€å‘åŠŸèƒ½è°ƒè¯•ä¸€å°centosè™šæ‹Ÿæœºä¸Šçš„pythonçš„æ—¶å€™é‡åˆ°connection refusedé—®é¢˜ï¼Œè€Œä¹‹å‰åœ¨windowsæœ¬åœ°çŽ¯å¢ƒä¸€ç›´æ˜¯å¥½çš„ï¼Œéžå¸¸å¥‡æ€ªã€‚ç ”ç©¶äº†2å¤©çš„æ—¶é—´ï¼Œæ‰æŠŠé—®é¢˜æ‰¾åˆ°ï¼Œé€šè¿‡å®šä½é—®é¢˜ï¼ŒæŠŠvscodeçš„è°ƒè¯•å™¨çš„æž¶æž„ä¹Ÿæœ‰äº†æ›´æ·±å…¥çš„äº†è§£ï¼Œä¸‹é¢è®°å½•ä¸‹é—®é¢˜å®šä½è¿‡ç¨‹ã€‚ çŽ¯å¢ƒ VS Code version: 1.44.2 Python Extension version: 2020.4.74986 OS and version: centos7 Python version: 2.7.5 vscodeè°ƒè¯•å™¨æž¶æž„ å®˜æ–¹å‚è€ƒï¼š vscode Debugger Extensionï¼šhttps://code.visualstudio.com/api/extension-guides/debugger-extension Debug Adapter Protocolï¼šhttps://microsoft.github.io/debug-adapter-protocol/overview ä¸ºäº†è§£è€¦vscodeå’Œå…·ä½“è¯­è¨€çš„è°ƒè¯•å™¨ï¼Œä¸­é—´å¢žåŠ äº†ä¸€ä¸ªDebug Adapterï¼Œå®ƒæ˜¯åœ¨ç‹¬ç«‹è¿›ç¨‹è¿è¡Œçš„ï¼Œvscodeå’ŒDebug Adapterä¹‹é—´é€šè¿‡Debug Adapter Protocolé€šä¿¡ã€‚ Pythonçš„Debug Adapterå°±æ˜¯åœ¨Microsoft Python Extensionä¸­å®žçŽ°çš„ã€‚ æ·±å…¥è°ƒè¯•äº¤äº’è¿‡ç¨‹ é€šè¿‡ä¸€ä¸ªWindowsæ­£å¸¸çŽ¯å¢ƒæ¥æŽ¢ç´¢è°ƒå¼å™¨äº¤äº’è¿‡ç¨‹ã€‚ 12345678910111213&#123; "version": "0.2.0", "configurations": [ &#123; "name": "Python: å½“å‰æ–‡ä»¶", "type": "python", "request": "launch", "program": "$&#123;file&#125;", "console": "integratedTerminal", "port": 50624 &#125; ]&#125; ä¸Šé¢çš„launch.jsonæŒ‡å®šäº†å…·ä½“ç«¯å£ï¼Œä¾¿äºŽæˆ‘ä»¬åˆ†æžè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œæ‰“ä¸Šæ–­ç‚¹ï¼Œå¯åŠ¨ä¸€ä¸ªè°ƒè¯•ï¼Œç„¶åŽé€šè¿‡ç«¯å£åˆ†æžè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ã€‚ ä¸Šè¿°9088è¿›ç¨‹å°±æ˜¯Debug Adapterï¼Œè¿è¡Œä»£ç å¦‚ä¸‹ï¼š 14272è¿›ç¨‹å¦‚ä¸‹ï¼š æ­£æ˜¯vscodeç»ˆç«¯æ‰“å°çš„ï¼š ptvsd_launcher.pyæ˜¯è°ƒç”¨çš„ptvsdï¼Œä¸Šè¿°å‘½ä»¤å°±æ˜¯ptvsd --client --host localhost --port 50624 D:/test/pytest/main.pyã€‚ ç„¶åŽå†ç»“åˆé˜…è¯»python-extensionå’Œptvsdçš„æºä»£ç ï¼Œç»ˆäºŽç†æ¸…ä¸Šè¿°è¿›ç¨‹å…³ç³»ï¼Œä¸‹é¢æ˜¯launchçš„è¿‡ç¨‹ï¼Œattachçš„è¿‡ç¨‹æœ‰æ‰€åŒºåˆ«ã€‚ vscode Debugger UIå¯åŠ¨ä¸€ä¸ªè°ƒè¯•ï¼Œé¦–å…ˆä¼šåˆ›å»ºDebug Adapterè¿›ç¨‹ï¼Œå°±æ˜¯ä¸Šè¿°9088è¿›ç¨‹ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯é€šè¿‡stdinå’Œstdouté€šä¿¡çš„ã€‚Python Debug Adapterçš„å®žçŽ°æ˜¯é€šè¿‡æ´¾ç”Ÿnode debug adapterå®žçŽ°çš„ã€‚ Debug Adapterè¿›ç¨‹ä¼šæ ¹æ®launch.jsonçš„hostå’Œportè¿›è¡ŒTCPç›‘å¬ï¼Œå¦‚æžœä¸è®¾ç½®hostå°±æ˜¯localhostï¼Œå¦‚æžœä¸è®¾ç½®portï¼Œä¼šè‡ªåŠ¨éšæœºé€‰æ‹©ä¸€ä¸ªã€‚ Debug Adapterå¯åŠ¨è°ƒè¯•ç¨‹åºï¼Œå®žé™…æ˜¯é€šè¿‡ptvsdå®Œæˆçš„ï¼Œè¿è¡Œåœ¨å•ç‹¬çš„è¿›ç¨‹ï¼Œå°±æ˜¯ä¸Šè¿°14272è¿›ç¨‹ï¼Œlaunchçš„æƒ…å†µä¸‹ptvsdä»¥client modeè¿è¡Œï¼Œä¹Ÿå°±æ˜¯ptvsdä¸»åŠ¨è¿žæŽ¥Debug Adapterï¼Œå› ä¸ºè¿™æ—¶Debug Adapterå…ˆäºŽè°ƒè¯•ç¨‹åºè¿è¡Œï¼Œè°ƒè¯•ç¨‹åºå¯ä»¥ç¬¬ä¸€æ—¶é—´çŸ¥é“Debug Adapterçš„ç«¯å£ã€‚å¦‚æžœæ˜¯attachçš„æƒ…å†µï¼Œå°±éœ€è¦IDEè¿žæŽ¥è°ƒè¯•ç¨‹åºï¼Œå‘Šè¯‰è°ƒè¯•ç¨‹åºDebug Adapterçš„åœ°å€ï¼Œç„¶åŽè°ƒè¯•ç¨‹åºå†è¿žæŽ¥Debug Adapterã€‚ è°ƒå¼ç¨‹åºè¿žæŽ¥åˆ°Debug Adapterï¼Œç„¶åŽæŒ‰ç…§DAPè¿›è¡Œè°ƒè¯•äº¤äº’ã€‚ é—®é¢˜å®šä½ å¼„æ¸…æ¥šè°ƒå¼çš„äº¤äº’è¿‡ç¨‹åŽï¼Œå°±å®¹æ˜“å®šä½é—®é¢˜äº†ï¼Œconnection refusedé—®é¢˜å°±å‡ºåœ¨ptvsdè¿žæŽ¥Debug Adapterçš„æ—¶å€™ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ä¸æ˜¯Debug Adapteré€€å‡ºäº†ï¼Œä½†æ˜¯psæŸ¥çœ‹è¿›ç¨‹æ˜¯æ­£å¸¸çš„ã€‚é€šè¿‡é˜…è¯»æºä»£ç å‘çŽ°ptvsdè¿žæŽ¥Debug Adapterçš„è¶…æ—¶æ—¶é—´å¯ä»¥åœ¨launch.jsonä¸­è®¾ç½®ï¼Œé»˜è®¤æ˜¯20ç§’(20000)ï¼Œæˆ‘å°†timeoutæ”¹å¤§äº†ä¸€ç‚¹ï¼Œä¾¿äºŽåˆ†æžé—®é¢˜ã€‚ 1234567891011121314&#123; "version": "0.2.0", "configurations": [ &#123; "name": "Python: å½“å‰æ–‡ä»¶", "type": "python", "request": "launch", "program": "$&#123;file&#125;", "console": "integratedTerminal", "port": 50624, "timeout": 200000 &#125; ]&#125; ç„¶åŽé€šè¿‡netstatæŸ¥çœ‹ï¼Œå‘çŽ°Debug Adapterå¹¶ä¸æ˜¯ç»‘å®šåœ¨127.0.0.1ã€‚ è¿›ä¸€æ­¥æŸ¥çœ‹/etc/hostsæ–‡ä»¶ï¼Œå‘çŽ°localhostæ­£æ˜¯10.0.2.15ï¼Œæ˜¯eth0çš„ipã€‚ è€ŒDebug Adapterå¯åŠ¨è°ƒè¯•ç¨‹åºæ—¶çš„â€“hostå‚æ•°æ€»æ˜¯ä¸ºlocalhostï¼Œä¸ç®¡launch.jsonä¸­å¦‚ä½•è®¾ç½®ã€‚ è‡ªæ­¤é—®é¢˜åŸºæœ¬å®šä½æ¸…æ¥šï¼š Debug Adapterä¸­ç›‘å¬æ˜¯é€šè¿‡node netæ¨¡å—å®žçŽ°ï¼Œnetæ¨¡å—å¯¹äºŽlocalhostä¼šé€šè¿‡getaddrinfoèŽ·å–ipï¼Œè€Œgetaddrinfoä¼šé€šè¿‡/etc/hostsæŸ¥è¯¢ipï¼› ptvsdä¸­æ˜¯é€šè¿‡Python socketæ¨¡å—å®žçŽ°tcpé€šä¿¡ï¼Œsockeæ¨¡å—connectæ—¶ï¼Œå¦‚æžœåœ°å€æ˜¯localhostï¼Œå®ƒæ€»æ˜¯ä¼šä½¿ç”¨127.0.0.1ï¼Œbindä¹Ÿæ˜¯ä¸€æ ·ã€‚ä¸‹è¿°ä»£ç é™¤äº†è¿”å›ž/etc/hostsä¸­çš„ipï¼Œæ€»æ˜¯ä¼šåŠ ä¸Š127.0.0.1ã€‚ 1socket.getaddrinfo("localhost", None, socket.AF_INET, socket.SOCK_STREAM) é—®é¢˜è§£å†³ æ–¹æ¡ˆ1ï¼šlaunch.jsonä¸­æŒ‡å®šhostä¸º127.0.0.1ä¸”å¿…é¡»ä¸º127.0.0.1 æ–¹æ¡ˆ2ï¼šDebug Adapterå¯åŠ¨è°ƒè¯•ç¨‹åºæ—¶çš„â€“hostå‚æ•°ä»Žlaunch.jsonä¸­èŽ·å–ï¼ŒåŒæ—¶launch.jsonä¸­æŒ‡å®šhostä¸ºä»»æ„åˆæ³•ip Debug Adapteræ€»æ˜¯ç»‘å®šåˆ°0.0.0.0ï¼Œä¹Ÿå°±æ˜¯ä»»æ„åœ°å€ ptvsdè¿žæŽ¥Debug Adapteræ—¶ä¹Ÿæ ¹æ®getaddrinfoå°†localhostè½¬æ¢ä¸ºipï¼Œå¹¶é€‰æ‹©éž127.0.0.1çš„ip ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯æœ€ç®€å•çš„ï¼Œå…¶ä»–æ–¹æ¡ˆéœ€è¦ä¿®æ”¹python-extensionæˆ–ptvsdçš„æºä»£ç ã€‚ ä»¥ä¸Šéƒ½æ˜¯ä»ç„¶ä½¿ç”¨ptvsdçš„è§£å†³æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ‡æ¢åˆ°æœ€æ–°çš„debugpyä¹Ÿå¯ä»¥è§£å†³é—®é¢˜ï¼Œå‚ç…§microsoft/ptvsd#2104ã€‚]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>vscode</tag>
        <tag>python</tag>
        <tag>debug</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Elasticsearchå­¦ä¹ ç¬”è®°(ä¸€)-æ­å»ºçŽ¯å¢ƒ]]></title>
    <url>%2F2020%2F04%2F14%2F031-elasticsearch-learning-notes-01%2F</url>
    <content type="text"><![CDATA[Elasticsearchç›®å‰çš„å‘å±•å¯è°“å¦‚æ—¥ä¸­å¤©ï¼ŒDBEngineä¸Šåœ¨æœç´¢å¼•æ“Žé¢†åŸŸä½åˆ—ç¬¬ä¸€ï¼Œä½œä¸ºåŽæ¥è€…çƒ­åº¦è¿œé«˜äºŽæŽ’ç¬¬äºŒã€ä¸‰çš„Splunkå’ŒSolrã€‚Elasticsearchçš„åˆ›é€ è€…å«Shay Banonï¼Œæœ€åˆæ˜¯å› ä¸ºLucenceçš„æŽ¥å£ä½¿ç”¨å›°éš¾ï¼Œå¼€å‘äº†ä¸€ä¸ªåº“Compassï¼Œè®©Lucenceæ›´å¥½ç”¨ï¼Œ2010å¹´Shay Banonå¯¹Compassè¿›è¡Œé‡å†™ï¼ŒæŠŠå®ƒå˜æˆä¸€ä¸ªé«˜æ€§èƒ½çš„ã€åˆ†å¸ƒå¼çš„æœåŠ¡ç«¯è½¯ä»¶ï¼Œå–åå«Elasticsearchï¼Œå¹¶åœ¨githubå¼€æºã€‚è¿™èƒŒåŽè¿˜æœ‰ä¸€ä¸ªæ¸©æƒ…çš„æ•…äº‹ï¼Œæ®è¯´èµ·å› æ˜¯ä¸ºäº†ç»™æ–°å©šè€å©†å†™ä¸€ä¸ªèœè°±æœç´¢åº”ç”¨ï¼Œä½†æ˜¯æœ€åŽèœè°±åº”ç”¨æ²¡æœ‰å†™å‡ºæ¥ï¼Œå€’æ˜¯é€ å°±äº†ä¸€ä¸ªä¼Ÿå¤§çš„è½¯ä»¶ã€‚ Elasticsearchå‘å±•éžå¸¸å¿«ï¼Œ2010å¹´2æœˆå‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œ2012å¹´æˆç«‹Elasticå…¬å¸ï¼Œ2014å¹´å¼€å§‹å•†ä¸šåŒ–ï¼Œ2018å¹´çº½äº¤æ‰€ä¸Šå¸‚ï¼Œåœ¨å…¨çƒè‚¡å¸‚ä½Žè¿·çš„èƒŒæ™¯ä¸‹ä¸Šå¸‚å½“å¤©ä»å¤§æ¶¨94%ï¼Œåˆ›é€ äº†å¼€æºè½¯ä»¶çš„ä¼ å¥‡ã€‚è€ŒElasticå…¬å¸éžå¸¸çš„åŽšé“ï¼ŒåšæŒå¼€æºè·¯çº¿ï¼Œä»Ž6.3ç‰ˆæœ¬å¼€å§‹å°†å…¶æ”¶è´¹éƒ¨åˆ†x-packä¹Ÿ&quot;å¼€æº&quot;ï¼Œx-packçš„åŸºç¡€åŠŸèƒ½ç»ˆèº«å…è´¹ï¼Œä¸éœ€è¦æ³¨å†Œï¼Œå…¶ä¸­å°±åŒ…æ‹¬å®‰å…¨æ–¹é¢å¿…é¡»çš„HTTPSï¼Œæƒé™æŽ§åˆ¶ç­‰ã€‚ ä»Šå¤©å¼€å§‹æˆ‘æƒ³é€šè¿‡ä¸€ç³»åˆ—æ–‡ç« æ¥æŽ¢ç´¢å’Œå­¦ä¹ ä¸€ä¸‹ESï¼Œç¬¬ä¸€ç¯‡ä»‹ç»ä¸€ä¸‹ESçš„åŸºæœ¬æ¦‚å¿µï¼Œæ­å»ºå•èŠ‚ç‚¹çš„ESï¼Œé€šè¿‡å›¾å½¢å®¢æˆ·ç«¯åŽ»æŽ¢ç´¢ESçš„æ•°æ®ç»“æž„å’Œæ“ä½œï¼Œé€šè¿‡ç›‘æŽ§äº†è§£ESè¿è¡ŒçŠ¶æ€ï¼Œå»ºç«‹å¯¹ESæ€»ä½“ä¸Šçš„ä¸€ä¸ªè®¤è¯†ã€‚ ESç®€ä»‹ ESæ˜¯åŸºäºŽApache Lucenceçš„ä¸€ä¸ªå¼€æºçš„ï¼Œé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼æœç´¢å¼•æ“Žï¼ŒJavaè¯­è¨€å¼€å‘ï¼Œå¯¹å¤–æä¾›RESTfulæŽ¥å£ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚ ESä»Ž6.3ç‰ˆæœ¬å¼€å§‹å†…ç½®æ”¯æŒSQLï¼Œå½“ç„¶åªæ”¯æŒæŸ¥è¯¢æ“ä½œï¼Œä»Žè€Œé™ä½Žäº†å­¦ä¹ å…¶ç‰¹æœ‰query DSLçš„æˆæœ¬ï¼Œæ›´æ˜¯è®©ä¸Šå±‚åŸºäºŽSQLçš„åº”ç”¨å¯ä»¥æ— ç¼å’ŒESå¯¹æŽ¥ã€‚è™½ç„¶ESè¶Šæ¥è¶Šåƒä¸€ä¸ªæ•°æ®åº“ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œæœ€æ˜¾è‘—çš„ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼ŒESæ·»åŠ æ•°æ®ä¸æ˜¯ç«‹åˆ»åˆ·æ–°ç´¢å¼•çš„ï¼Œæœ‰ä¸€ä¸ªåˆ·æ–°é—´éš”ï¼Œé»˜è®¤1sï¼Œæ‰€ä»¥ä¸ä¼šç«‹åˆ»æŸ¥è¯¢åˆ°ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„è¿‘å®žæ—¶ï¼ŒESå¼ºåœ¨æ£€ç´¢å’Œåˆ†æžã€‚æ‰€ä»¥ESå’Œå…³ç³»æ•°æ®åº“çš„åŒºåˆ«åƒæ˜¯OLAPå’ŒOLTPçš„åŒºåˆ«ï¼Œé€‚ç”¨äºŽä¸åŒåœºæ™¯ã€‚ ESä¸»è¦çš„åº”ç”¨åœºæ™¯ï¼Œä¸€ä¸ªæ˜¯ä½œä¸ºåº”ç”¨çš„å‰ç«¯æ£€ç´¢ç¼“å­˜ï¼Œæé«˜æµ·é‡æ•°æ®çš„æ£€ç´¢æ•ˆçŽ‡å’Œåšä¸€äº›èšåˆæ£€ç´¢ï¼Œå…ˆä»ŽESæ£€ç´¢ï¼Œç„¶åŽå†ä»ŽåŽç«¯å­˜å‚¨æ£€ç´¢ã€‚ç¬¬äºŒä¸ªæ˜¯æ—¥å¿—å’Œç›‘æŽ§ï¼Œä»¥ESä¸ºä¸­å¿ƒï¼ŒElasticå…¬å¸å‘å±•èµ·ä¸€ä¸ªç”Ÿæ€åœˆï¼Œä¹‹å‰å«ELKï¼Œä¹Ÿå°±æ˜¯Elasticsearchã€Logstashå’ŒKibanaï¼ŒåŽæ¥åŠ å…¥Beatsï¼Œåå­—æ”¹æˆäº†Elastic Stackã€‚ä»¥Kibanaä¸ºå…¥å£ï¼Œå‘å±•åˆ°ä¸Šå±‚çš„å„ç§åˆ†æžå’Œå¯è§†åŒ–åº”ç”¨ï¼ŒåŒ…æ‹¬çƒ­é—¨çš„æœºå™¨å­¦ä¹ ã€‚ å…ˆç†è§£ESçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œå¯ä»¥å’Œå…³ç³»æ•°æ®åº“åšä¸€ä¸ªç±»æ¯”ï¼š indexï¼šç±»ä¼¼å…³ç³»æ•°æ®åº“çš„è¡¨ï¼Œä½†æ˜¯indexä¸éœ€è¦é¢„å…ˆå®šä¹‰schemaã€‚ documentï¼šç±»ä¼¼å…³ç³»æ•°æ®åº“çš„è®°å½•ï¼Œjsonæ ¼å¼ã€‚ mappingï¼šä¹Ÿå°±æ˜¯ç±»ä¼¼å…³ç³»æ•°æ®çš„schemaäº†ï¼Œå¯ä»¥æ˜¾å¼å®šä¹‰ï¼Œä¹Ÿå¯ä»¥æ·»åŠ documentæ—¶ESè‡ªåŠ¨è¯†åˆ«åˆ›å»ºã€‚å¯ä»¥æŒ‡å®šmappingä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œè¿™æ ·æ·»åŠ æ•°æ®åº“å°±å¿…é¡»ä¸¥æ ¼ç¬¦åˆmappingä¸­å®šä¹‰çš„å­—æ®µã€‚ typeï¼šä»Ž7.0å¼€å§‹åˆ é™¤äº†ï¼Œå…¶å®žå°±æ˜¯mappingçš„åå­—ï¼Œä¸€ä¸ªindexä¸‹åªæœ‰ä¸€ä¸ªtypeï¼Œæœ‰ç‚¹é¸¡è‚‹ã€‚è™½ç„¶åˆ é™¤äº†ï¼Œä½†æ˜¯å…¶å®žå†…éƒ¨é»˜è®¤è¿˜æ˜¯æœ‰ä¸€ä¸ªtypeï¼Œåå­—å›ºå®šæ˜¯_docã€‚ index templateï¼šåˆ›å»ºindexæ—¶è‡ªåŠ¨å¯¹indexåšä¸€äº›è®¾ç½®ï¼Œä¾‹å¦‚indexçš„ä¸»åˆ†ç‰‡ä¸ªæ•°ï¼Œå¤åˆ¶åˆ†ç‰‡ä¸ªæ•°ï¼Œmappingå­—æ®µçš„ç±»åž‹ç­‰ç­‰ã€‚ ilmï¼šä¹Ÿå°±æ˜¯index lifecycle managementï¼Œå¯ä»¥å¯¹æ•°æ®åˆ†ä¸ºHotï¼ŒWarmï¼ŒColdï¼ŒDeleteå››ä¸ªé˜¶æ®µï¼Œå¯ä»¥ç›¸åº”çš„å®šä¹‰ä¸åŒçš„ç­–ç•¥ã€‚ ESå®‰è£… æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç”¨dockeræ¥è¿è¡Œã€‚ å®˜æ–¹å‚è€ƒæ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html æˆ‘ä½¿ç”¨çš„æœ€æ–°çš„7.6.2ç‰ˆæœ¬ï¼Œå•èŠ‚ç‚¹è¿è¡Œæ—¶éœ€è¦æŒ‡å®šdiscovery.type=single-nodeï¼Œä»¥å‰è€çš„ç‰ˆæœ¬æ˜¯ä¸éœ€è¦çš„ã€‚ 1docker run -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; docker.elastic.co/elasticsearch/elasticsearch:7.6.2 ä¸ºäº†åŽç»­é…ç½®æ–¹é¢å¯ä»¥æŠŠé…ç½®æ–‡ä»¶æ”¾åˆ°hostæœºå™¨ä¸Šï¼Œç„¶åŽmountåˆ°å®¹å™¨ã€‚ 1docker run -d --name es -p 9200:9200 -p 9300:9300 -v $(pwd)/elasticsearch.docker.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /etc/localtime:/etc/localtime elasticsearch:7.6.2 è¿™é‡ŒåŠ å…¥-v /etc/localtime:/etc/localtimeæ˜¯ä¸ºäº†å°†å®¹å™¨çš„æ—¶é—´å’Œhostä¿æŒä¸€è‡´ï¼ŒåŽé¢å†è®²ä¸ºä»€ä¹ˆã€‚ é…ç½®æ–‡ä»¶elasticsearch.docker.ymlå¦‚ä¸‹ã€‚ 123cluster.name: "es_cluster"network.host: 0.0.0.0discovery.type: single-node ä»Žä¸Šé¢å‘½ä»¤çœ‹åˆ°ESæš´éœ²2ä¸ªç«¯å£ï¼Œ9200ç”¨äºŽæä¾›RESTfulæŽ¥å£ï¼Œ9300ç«¯å£æä¾›TCPçš„å†…éƒ¨åè®®é€šä¿¡ï¼Œ9300å¯¹å¤–çš„è®¿é—®åœ¨7.0æ ‡è¯†ä¸ºDeprecatedï¼Œåªæœ‰é›†ç¾¤å†…éƒ¨ä¹‹é—´ä»é€šè¿‡9300é€šä¿¡ã€‚ é€šè¿‡curlå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ“ä½œESã€‚ 1curl http://127.0.0.1:9200 è¿”å›žå¦‚ä¸‹å†…å®¹è¡¨ç¤ºESå¯åŠ¨æ­£å¸¸ã€‚ 1234567891011121314151617&#123; "name" : "903d9b3ecb97", "cluster_name" : "es_cluster", "cluster_uuid" : "zV0tEFQ4TgqtyzsabtzMMg", "version" : &#123; "number" : "7.6.2", "build_flavor" : "default", "build_type" : "docker", "build_hash" : "ef48eb35cf30adf4db14086e8aabd07ef6fb113f", "build_date" : "2020-03-26T06:34:37.794943Z", "build_snapshot" : false, "lucene_version" : "8.4.0", "minimum_wire_compatibility_version" : "6.8.0", "minimum_index_compatibility_version" : "6.0.0-beta1" &#125;, "tagline" : "You Know, for Search"&#125; å›¾å½¢å®¢æˆ·ç«¯ æŽ¨èä¸€ä¸ªå›¾å½¢å®¢æˆ·ç«¯dejavuï¼Œä½¿ç”¨reactjså¼€å‘ï¼Œç›¸æ¯”å¸¸ç”¨çš„elasticsearch-headæ’ä»¶æ›´åŠ çŽ°ä»£åŒ–ä¸€äº›ï¼ŒåŠŸèƒ½ä¹Ÿä¸°å¯Œä¸€äº›ï¼Œå¯¹äºŽæŽ¢ç´¢ESéžå¸¸æœ‰å¸®åŠ©ã€‚ ä¸ºäº†è§£å†³è·¨ç«™è®¿é—®é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹ESçš„é…ç½®å¦‚ä¸‹ï¼Œå…¶ä¸­http.cors.allow-originä¹Ÿå¯ä»¥æŒ‡å®šä¸ºå…·ä½“çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯dejavuçš„åœ°å€ï¼Œä¾‹å¦‚http://localhost:1358ã€‚ 1234567cluster.name: "es_cluster"network.host: 0.0.0.0discovery.type: single-nodehttp.cors.enabled: truehttp.cors.allow-origin: "*"http.cors.allow-headers: X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorizationhttp.cors.allow-credentials: true ç„¶åŽé‡å¯ä¸€ä¸‹ESã€‚ dejavuä¹Ÿæ”¯æŒdockerè¿è¡Œã€‚ 1docker run -d --name=es-ui -p 1358:1358 -d appbaseio/dejavu è®¿é—®http://localhost:1358å³å¯ä½¿ç”¨ã€‚ è¾“å…¥ESåœ°å€å’Œindexå(*è¡¨ç¤ºæ‰€æœ‰)å°±å¯ä»¥å¼€å§‹è¯»å–å’Œæ“ä½œdocumentå’Œmappingã€‚ç›®å‰ä¸æ”¯æŒindex tempalteï¼ŒILMç­–ç•¥ç­‰ã€‚ éœ€è¦æ³¨æ„å¦‚æžœESæ˜¯ç©ºçš„æ˜¯è¿žæŽ¥ä¸ä¸Šçš„ï¼Œå¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªindexã€‚ ç›‘æŽ§ ESæœ€å¸¸ç”¨çš„åœºæ™¯æ˜¯ç”¨äºŽç›‘æŽ§å’Œåˆ†æžï¼Œå¯¹ESè‡ªèº«çš„ç›‘æŽ§è‡ªç„¶ä¹Ÿä¸åœ¨è¯ä¸‹ã€‚ESæœ¬ç”Ÿæä¾›äº†ä¸°å¯Œçš„ç›‘æŽ§æŒ‡æ ‡ï¼Œç»“åˆKibanaå¯ä»¥å°†ä»–ä»¬å¯è§†åŒ–ã€‚é€šè¿‡ç›‘æŽ§å¯ä»¥è®©æˆ‘ä»¬æ›´äº†è§£ESå†…éƒ¨çš„ç»†èŠ‚ã€‚ Kibanaå®‰è£… å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/kibana/7.6/docker.html åŒæ ·ä½¿ç”¨dockerè¿è¡Œï¼š 1docker run -d --link es:elasticsearch -p 5601:5601 -v $(pwd)/kibana.docker.yml:/usr/share/kibana/config/kibana.yml -v /etc/localtime:/etc/localtime --name kibana kibana:7.6.2 â€“linkå¯ä»¥åœ¨kibanaå®¹å™¨ä¸­é€šè¿‡http://elasticsearch:9200è®¿é—®ESã€‚ é…ç½®æ–‡ä»¶kibana.docker.ymlå¦‚ä¸‹ã€‚ 1234server.name: kibanaserver.host: "0"elasticsearch.hosts: [ "http://elasticsearch:9200" ]xpack.monitoring.ui.container.elasticsearch.enabled: true kibanaä¸­å¯¹ESçš„ç›‘æŽ§æ˜¯åœ¨Stack MonitoringåŠŸèƒ½ä¸­ï¼Œå…¶ä¸­ä¹ŸåŒ…å«å¯¹Kibanaï¼ŒLogstashåŠBeatsçš„ç›‘æŽ§ã€‚ æ•°æ®é‡‡é›†æœ‰ä¸¤ç§æ–¹å¼ï¼Œé€šè¿‡Metricbeaté‡‡é›†æˆ–å†…éƒ¨é‡‡é›†ï¼Œå®˜æ–¹æŽ¨èå‰è€…ï¼š æ—¶åŒºé—®é¢˜ å…ˆè¯´é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œä»ŽKibanaæŸ¥è¯¢æœ€è¿‘ä¸€ä¸ªå°æ—¶çš„æ•°æ®ä¼šå‘çŽ°æŸ¥è¯¢ä¸åˆ°ï¼Œä½†æ˜¯é‡‡é›†æ˜¯æ­£å¸¸çš„ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°ç›‘æŽ§çš„indexå·²ç»æœ‰æ•°æ®äº†ã€‚ é—®é¢˜åŽŸå› æ˜¯è®¿é—®kibanaçš„æœºå™¨æ˜¯ç”¨çš„æœ¬åœ°æ—¶é—´ï¼Œè€ŒESã€Kibanaè¿è¡Œçš„æœºå™¨æ˜¯UTCæ—¶é—´ã€‚éœ€è¦æŠŠESè¿è¡Œçš„æœºå™¨æ”¹æˆæœ¬åœ°æ—¶é—´ã€‚ESæ˜¯è¿è¡Œåœ¨å®¹å™¨ä¸­çš„ï¼Œé—®é¢˜å°±å˜æˆäº†æ€Žä¹ˆä¿®æ”¹å®¹å™¨çš„æ—¶åŒºã€‚ç­”æ¡ˆå°±æ˜¯å…ˆæ”¹Hostçš„ï¼Œç„¶åŽè®©å®¹å™¨å’ŒHostä¿æŒä¸€è‡´ã€‚æˆ‘æ˜¯ç”¨çš„centosï¼Œä»¥ä¸‹æ˜¯centosçš„ä¿®æ”¹æ–¹æ³•ã€‚ 123sudo timedatectl set-timezone Asia/Shanghaisudo hwclock --localtime -wsudo timedatectl set-ntp yes ESçš„å®¹å™¨åŸºç¡€é•œåƒä¹Ÿæ˜¯centosï¼Œæ‰€ä»¥è¿è¡Œå®¹å™¨çš„æ—¶å€™åŠ ä¸Š-v /etc/localtime:/etc/localtimeå³å¯ã€‚ é€šè¿‡å†…éƒ¨é‡‡é›† å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/7.6/monitoring-production.html å…ˆæ¥çœ‹ç¬¬ä¸€ç§æ–¹å¼ï¼Œéžå¸¸ç®€å•ï¼Œé€šè¿‡kibanaå›¾å½¢ç•Œé¢å°±å¯ä»¥æ“ä½œã€‚ ç‚¹å‡»Turn on monitoringå°±å¯ä»¥äº†ï¼ŒKibanaä¼šå¸®æˆ‘ä»¬å°†ESçš„xpack.monitoring.collection.enabledè®¾ä¸ºtrueï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡Kibanaçš„Dev Toolsä¸­çš„Consoleè‡ªå·±ä¿®æ”¹ï¼Œæ˜¯ä¸€æ ·çš„æ•ˆæžœï¼š 123456PUT _cluster/settings&#123; &quot;persistent&quot;: &#123; &quot;xpack.monitoring.collection.enabled&quot;: true &#125;&#125; å¦å¤–æœ‰å‡ ä¸ªå‚æ•°ä¹Ÿå¾ˆé‡è¦ï¼Œå®ƒä»¬é»˜è®¤æ˜¯trueçš„ï¼Œå¦‚æžœå®ƒä»¬ä»»æ„ä¸€ä¸ªä¸ºfalseï¼Œé‚£ä¹ˆä¹Ÿæ— æ³•ç›‘æŽ§ã€‚ xpack.monitoring.enabledï¼šå†³å®šæ˜¯å¦å¯ç”¨ç›‘æŽ§ xpack.monitoring.elasticsearch.collection.enabledï¼šå†³å®šæ˜¯å¦é‡‡é›†elasticsearch å†…éƒ¨é‡‡é›†æ˜¯Kibanaé»˜è®¤é€šè¿‡local exporterä¿å­˜åœ¨è¢«ç›‘æŽ§ESé›†ç¾¤ä¸­ï¼Œindexåä¸º.monitoring-*ï¼Œä¾‹å¦‚å¯¹kibanaçš„é‡‡é›†æ•°æ®çš„indexå½¢å¦‚.monitorning-kibana-7-2020.04.13ï¼Œæ¯å¤©ä¸€ä¸ªã€‚ é€šè¿‡Metricbeaté‡‡é›† å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/7.6/configuring-metricbeat.html è¿™æ˜¯å®˜æ–¹æŽ¨èçš„æ–¹å¼ï¼Œä¸¤ç§æ–¹å¼äºŒé€‰ä¸€ã€‚ é¦–å…ˆåŒæ ·éœ€è¦ESçš„xpack.monitoring.collection.enabledè®¾ç½®ä¸ºtrueï¼Œä¸ºäº†ç¦ç”¨å†…éƒ¨é‡‡é›†å°†xpack.monitoring.elasticsearch.collection.enabledè®¾ç½®ä¸ºfalseã€‚ ç„¶åŽå®‰è£…Metricbeatï¼Œå®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/beats/metricbeat/7.6/running-on-docker.html åŒæ ·ç”¨Dockerè¿è¡Œï¼Œåˆ†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯setupè¿‡ç¨‹ï¼Œä¸»è¦æ˜¯åˆå§‹åŒ–ä¸€äº›æ•°æ®ã€‚ 1234docker run --rm --link kibana:kibana --link es:elasticsearch \docker.elastic.co/beats/metricbeat:7.6.2 \setup -E setup.kibana.host=kibana:5601 \-E output.elasticsearch.hosts=[&quot;elasticsearch:9200&quot;] ç¬¬äºŒæ­¥å¯åŠ¨Metricbeatã€‚ 123456789docker run -d --link es:elasticsearch \ --name=metricbeat \ --user=root \ --volume=&quot;$(pwd)/metricbeat.docker.yml:/usr/share/metricbeat/metricbeat.yml:ro&quot; \ --volume=&quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot; \ --volume=&quot;/sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro&quot; \ --volume=&quot;/proc:/hostfs/proc:ro&quot; \ --volume=&quot;/:/hostfs:ro&quot; \ docker.elastic.co/beats/metricbeat:7.6.2 metricbeat è¿™é‡Œå¯èƒ½ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚ 1Exiting: error loading config file: config file (&quot;metricbeat.yml&quot;) must be owned by the user identifier (uid=0) or root æˆ–è€…ï¼š 1Exiting: error loading config file: config file (&quot;metricbeat.yml&quot;) can only be writable by the owner but the permissions are &quot;-rw-rw-r--&quot; (to fix the permissions use: &apos;chmod go-w /usr/share/metricbeat/metricbeat.yml&apos;) åŽŸå› å‚è€ƒï¼šhttps://www.elastic.co/guide/en/beats/libbeat/5.3/config-file-permissions.html#config-file-permissions å› ä¸ºåœ¨hostä¸­æˆ‘æ˜¯ç”¨çš„non-rootç”¨æˆ·uid1000ï¼Œåˆ°å®¹å™¨é‡Œé¢çš„uid1000æ˜¯metricbeatç”¨æˆ·ï¼Œä½†æ˜¯beatsè¦æ±‚é…ç½®æ–‡ä»¶å¿…é¡»æ˜¯rootæ‹¥æœ‰å¹¶ä¸”æƒé™ä¸º0644ã€‚è§£å†³åŠžæ³•æ˜¯æŠŠmetricbeat.docker.ymlçš„owneræ”¹æˆrootã€‚ 12sudo chown root metricbeat.docker.ymlsudo chmod 0644 metricbeat.docker.yml é…ç½®æ–‡ä»¶metricbeat.docker.ymlå¦‚ä¸‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536metricbeat.config: modules: path: $&#123;path.config&#125;/modules.d/*.yml # Reload module configs as they change: reload.enabled: falsemetricbeat.autodiscover: providers: - type: docker hints.enabled: truemetricbeat.modules:- module: elasticsearch metricsets: - ccr - enrich - cluster_stats - index - index_recovery - index_summary - ml_job - node_stats - shard period: 10s hosts: ["http://elasticsearch:9200"] #username: "user" #password: "secret" xpack.enabled: trueprocessors: - add_cloud_metadata: ~output.elasticsearch: hosts: '$&#123;ELASTICSEARCH_HOSTS:elasticsearch:9200&#125;' username: '$&#123;ELASTICSEARCH_USERNAME:&#125;' password: '$&#123;ELASTICSEARCH_PASSWORD:&#125;' ç”¨dejavuå¯ä»¥æŸ¥çœ‹åˆ°metricbeatå†™å…¥çš„indexå½¢å¦‚.monitoring-es-7-mb-2020.04.13ï¼Œä¹Ÿæ˜¯æ¯å¤©ä¸€ä¸ªã€‚ å›žåˆ°Kibanaçš„Stack Monitoringå¯ä»¥æŸ¥çœ‹åˆ°ESå’ŒKibanaçš„ç›‘æŽ§äº†ï¼Œå…¶ä¸­ESæ˜¯é€šè¿‡Metricbeaté‡‡é›†çš„æ•°æ®ï¼Œè€ŒKibanaæ˜¯é€šè¿‡ç¬¬ä¸€ç§æ–¹å¼å†…éƒ¨é‡‡é›†çš„ã€‚]]></content>
      <categories>
        <category>elastic stack</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
        <tag>kibana</tag>
        <tag>metricbeat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vscodeè°ƒè¯•springmvcåº”ç”¨]]></title>
    <url>%2F2020%2F03%2F27%2F030-debug-springmvc-in-vscode%2F</url>
    <content type="text"><![CDATA[Spring Bootå·²ç»æˆä¸ºå¼€å‘webåº”ç”¨çš„æ ‡é…ï¼Œé€šè¿‡Spring Initializråˆ›å»ºSpringåº”ç”¨æ—¶ï¼ŒSpring Bootå·²ç»æ˜¯å¿…é€‰é¡¹ã€‚Springå®˜æ–¹æä¾›ä¸¤ä¸ªé‡è¦å¼€å‘å·¥å…·ï¼š Spring Tools 4ï¼šåŒ…æ‹¬eclipseã€vscodeå’ŒTheiaä¸‰ä¸ªç‰ˆæœ¬ï¼Œå…¶ä¸­é’ˆå¯¹eclipseçš„å°±æ˜¯ä¹‹å‰çš„STS(Spring Tools Suit)ï¼Œæ˜¯ä¸€ä¸ªåŸºäºŽeclipseçš„å®šåˆ¶ç‰ˆæœ¬ï¼Œè€Œé’ˆå¯¹vscodeçš„å…¶å®žå°±æ˜¯Spring Boot Extension Packï¼Œæ˜¯ä¸€ç³»åˆ—vscodeæ’ä»¶ã€‚å…¶ä¸­Spring Boot Dashboardæ’ä»¶æä¾›å¯¹spring bootåº”ç”¨çš„è°ƒè¯•æ”¯æŒã€‚ spring initializrï¼šç”¨äºŽåˆ›å»ºä¸€ä¸ªspringæ¨¡æ¿é¡¹ç›®ï¼Œç›®å‰Spring Bootæ˜¯å¿…é€‰é¡¹ã€‚ å¦‚æžœä½ ä½¿ç”¨çš„Spring Bootï¼Œé‚£ä¹ˆvscodeè°ƒè¯•ä¸æ˜¯é—®é¢˜ï¼Œå·²ç»æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚ä½†æ˜¯ä½ å¯èƒ½å‡ºäºŽå­¦ä¹ çš„ç›®çš„ï¼Œåˆ›å»ºçš„å•çº¯Spring mvcé¡¹ç›®ï¼Œé‚£ä¹ˆè°ƒè¯•å°±éœ€è¦ä¸€ç•ªæŠ˜è…¾äº†ã€‚ å‰æ å®‰è£…Java Extension Packï¼Œé…ç½®å¥½Javaå¼€å‘çŽ¯å¢ƒã€‚ä½¿ç”¨mavenç®¡ç†é¡¹ç›®ã€‚ è¿è¡Œ é¦–å…ˆè¦å°†Springåº”ç”¨è¿è¡Œèµ·æ¥ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡mavenæ’ä»¶å®žçŽ°ï¼Œä¾‹å¦‚jettyæ’ä»¶ï¼Œå½“ç„¶tomcatä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚åœ¨pom.xmlä¸­åŠ å…¥jetty-maven-pluginï¼Œè¯¦ç»†é…ç½®å¯å‚è€ƒï¼š 123456789101112131415161718192021222324252627&lt;project&gt; &lt;build&gt; &lt;finalName&gt;springmvc-study&lt;/finalName&gt; &lt;pluginManagement&gt;&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt; &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt; &lt;version&gt;9.4.27.v20200227&lt;/version&gt; &lt;configuration&gt; &lt;webApp&gt; &lt;contextPath&gt;/$&#123;project.build.finalName&#125;&lt;/contextPath&gt; &lt;/webApp&gt; &lt;stopKey&gt;CTRL+C&lt;/stopKey&gt; &lt;stopPort&gt;8999&lt;/stopPort&gt; &lt;scanIntervalSeconds&gt;10&lt;/scanIntervalSeconds&gt; &lt;scanTargets&gt; &lt;scanTarget&gt;src/main/webapp/WEB-INF/web.xml&lt;/scanTarget&gt; &lt;/scanTargets&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/pluginManagement&gt; &lt;/build&gt;&lt;/project&gt; ç„¶åŽé€šè¿‡mvn jetty:runå°±å¯ä»¥è¿è¡Œäº†ï¼Œè€Œä¸”è¿˜æ”¯æŒçƒ­éƒ¨ç½²ï¼Œå½“ä½ ä¿®æ”¹æºæ–‡ä»¶åŽï¼Œä¼šè‡ªåŠ¨é‡æ–°ç¼–è¯‘åŠ è½½ã€‚ è°ƒè¯• è°ƒè¯•æ˜¯é€šè¿‡javaè¿œç¨‹è°ƒè¯•å®žçŽ°çš„ï¼Œè®¾ç½®maven_optsçŽ¯å¢ƒå˜é‡åŽè¿è¡Œmvn jetty:runæˆ–è€…é€šè¿‡vscodeçš„taskåŠŸèƒ½è¿è¡Œï¼Œé…ç½®å¦‚ä¸‹ï¼š 1234567891011121314151617181920&#123; // See https://go.microsoft.com/fwlink/?LinkId=733558 // for the documentation about the tasks.json format "version": "2.0.0", "tasks": [ &#123; "label": "Jetty debug", "type": "shell", "command": "mvn jetty:run", "group": "build", "isBackground": false, "problemMatcher": [], "options": &#123; "env": &#123; "maven_opts": "-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000" &#125; &#125; &#125; ]&#125; ç„¶åŽåœ¨debugè§†å›¾ä¸­åˆ›å»ºlaunch.jsonï¼š 123456789101112131415&#123; // Use IntelliSense to learn about possible attributes. // Hover to view descriptions of existing attributes. // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387 "version": "0.2.0", "configurations": [ &#123; "type": "java", "name": "Debug (Attach) - Remote", "request": "attach", "hostName": "localhost", "port": 8000 &#125; ]&#125; æŽ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«çš„è°ƒè¯•äº†âœŒã€‚]]></content>
      <categories>
        <category>spring mvc</category>
      </categories>
      <tags>
        <tag>vscode</tag>
        <tag>debug</tag>
        <tag>spring mvc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£feignã€ribbonå’Œhystrixä¸‰è€…çš„å…³ç³»åŠè¶…æ—¶é…ç½®]]></title>
    <url>%2F2020%2F03%2F23%2F029-hystrix-ribbon-feign-relationship%2F</url>
    <content type="text"><![CDATA[spring cloudä¸­æœ‰å‡ ä¸ªé‡è¦çš„ç»„ä»¶ï¼Œæ·±å…¥ç†è§£å®ƒä»¬ä¹‹é—´çš„å…³ç³»æ‰èƒ½æ›´å¥½çš„ä½¿ç”¨å®ƒä»¬ï¼š ribbonï¼šå®žçŽ°æœåŠ¡å®šä½å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼› hystrixï¼šå®žçŽ°æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§ã€èµ„æºéš”ç¦»ç­‰ï¼› feignï¼šå£°æ˜Žå¼çš„httpå®¢æˆ·ç«¯ï¼Œç”¨äºŽæœåŠ¡ä¹‹é—´çš„httpè°ƒç”¨ã€‚ç›¸æ¯”äºŽresttemplateï¼Œfeignä¸Žribbonå’Œhystrixé›†æˆæ›´å‹å¥½ï¼Œæ˜¯spring cloudçš„é¡¶å±‚ç»„ä»¶ã€‚ ä¸Šè¿°ribbonå’Œhystrixéƒ½æ˜¯netflixè´¡çŒ®ç»„ä»¶ï¼Œç›®å‰å®ƒä»¬éƒ½å¤„äºŽç»´æŠ¤æ¨¡å¼ï¼Œä¸å†å¢žåŠ æ–°ç‰¹æ€§ï¼Œå°†é€æ¸è¢«spring cloudå®˜æ–¹ç»„ä»¶å–ä»£ï¼Œä¾‹å¦‚ä»ŽHoxton.M2å¼€å§‹æ•´åˆspring-cloud-loadbalancerç”¨äºŽæ›¿æ¢ribbonï¼Œä½†ç›®å‰è¿˜ä¸æˆç†Ÿï¼Œè¿˜æ˜¯è€è€å®žå®žç”¨ribbonï¼Œè€Œæ–­è·¯å™¨æ–¹é¢spring cloudæŠ½è±¡äº†Spring Cloud Circuit Breakerï¼Œhystrixåªæ˜¯å…¶ä¸­ä¸€ä¸ªå®žçŽ°ï¼Œè¿˜æœ‰å…¶ä»–å®žçŽ°å¯é€‰ï¼Œä¾‹å¦‚é˜¿é‡Œè´¡çŒ®çš„sentinelã€‚ ä¸‰è€…å…³ç³» hystrixå’Œribbonå¹¶æ²¡æœ‰ç›´æŽ¥å…³ç³»ã€‚ feignåº•å±‚é»˜è®¤æ˜¯é€šè¿‡ribbonè¿›è¡ŒæœåŠ¡å®šä½å’Œè´Ÿè½½å‡è¡¡ï¼Œä½¿ç”¨feignæ—¶ä½ æ„ŸçŸ¥ä¸åˆ°ribbonçš„å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ribbonã€‚å¦‚æžœä½ ä½¿ç”¨resttemplateï¼Œåˆ™éœ€è¦é€šè¿‡@LoadBalancedä½¿ç”¨ribbonã€‚ hystrixæœ‰ä¸¤ç§ä½¿ç”¨æƒ…å†µï¼Œä¸€ç§æ˜¯åœ¨controllerçš„handleræ–¹æ³•ä¸Šå¢žåŠ @HystrixCommandæ³¨è§£ï¼Œä½œç”¨çš„æ˜¯æ•´ä¸ªhandlerï¼›å¦ä¸€ç§æƒ…å†µæ˜¯è°ƒç”¨å…¶ä»–appæœåŠ¡æ—¶ï¼Œä¹Ÿå°±æ˜¯@feignclientæ³¨è§£çš„httpå®¢æˆ·ç«¯ï¼Œæ­¤æ—¶è°ƒç”¨è¿™ä¸ªhttpå®¢æˆ·ç«¯çš„handlerå¯ä¸éœ€è¦hystrixã€‚ æ€»ç»“ä¸€ä¸‹ï¼šæœåŠ¡ä¹‹é—´çš„httpè°ƒç”¨å¯é€šè¿‡feignå®žçŽ°ï¼Œfeignåº•å±‚æ˜¯é€šè¿‡ribbonå®žçŽ°æœåŠ¡å‘çŽ°å’Œè´Ÿè½½å‡è¡¡ï¼Œä¸ç®¡æ˜¯å¦ä½¿ç”¨feignï¼Œribbonéƒ½æ˜¯å¿…ä¸å¯å°‘çš„ï¼›feignå®¢æˆ·ç«¯å¯é€‰çš„å¯å¯ç”¨hystrixæ”¯æŒï¼Œhystrixä¹Ÿå¯ä»¥ç”¨åœ¨æœåŠ¡ç«¯æ•´ä¸ªhandlerä¸Šã€‚ å¦‚ä¸Šæ‰€ç¤ºï¼Œapp1.controll1.handler1è°ƒç”¨app2.controller2.handler2çš„è¿‡ç¨‹æ˜¯ï¼š å¦‚æžœfeign.hystrix.enabled=trueï¼ˆé»˜è®¤ä¸ºfalseï¼‰ï¼Œåˆ™feigné€šè¿‡jdkåŠ¨æ€ä»£ç†ï¼Œå°†è°ƒç”¨å°è£…ä¸ºHystrixCommandï¼Œåœ¨hystrix thread poolä¸­æ‰§è¡Œï¼Œå¦åˆ™è¿›å…¥3å’Œ4ï¼› hystrix thread poolä¸­æ‰§è¡Œhttpè°ƒç”¨ï¼Œè¿˜æ˜¯å›žè°ƒfeignæŽ¥å£ï¼› feignæ‰©å±•äº†ribbonå®¢æˆ·ç«¯ï¼Œä½¿ç”¨ribbonçš„æœåŠ¡å®šä½å’Œè´Ÿè½½å‡è¡¡èŽ·å¾—å¯ç”¨æœåŠ¡ï¼› feignæ‰©å±•çš„ribbonå®¢æˆ·ç«¯å‘èµ·å¯¹app2.controller2.handler2çš„httpè¯·æ±‚ï¼Œribbonå¯ä»¥å¼€å¯é‡è¯•ï¼Œå¦‚æžœè¯·æ±‚è¶…æ—¶åˆ™è‡ªåŠ¨é‡è¯•ã€‚ äº†è§£ä¸Šè¿°å…³ç³»å¯¹äºŽå¦‚ä½•è®¾ç½®è¶…æ—¶æ—¶é—´è‡³å…³é‡è¦ã€‚å¦‚æžœhystrixçš„è¶…æ—¶æ—¶é—´åˆ°è¾¾ï¼Œåˆ™1å°±è¿”å›žfallbackäº†ï¼Œä¸ä¼šç­‰åˆ°4æ‰§è¡Œå®Œã€‚ä¸€èˆ¬hystrixçš„è¶…æ—¶æ—¶é—´è¦å¤§äºŽfeignçš„è¶…æ—¶æ—¶é—´ã€‚ å¦å¤–ä¸Šè¿°æœåŠ¡ç«¯è®¾ç½®äº†æ–­è·¯å™¨ï¼Œå®žé™…ä¸Šå®¢æˆ·ç«¯å¯ä»¥ä¸ç”¨è®¾ç½®ã€‚ è¶…æ—¶ç›¸å…³é…ç½® feign å®˜æ–¹å‚è€ƒ æœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼š å±žæ€§é…ç½®ï¼ŒåŒ…æ‹¬å…¨å±€å’Œå®žä¾‹ï¼› ä»£ç é…ç½®ï¼Œä¹ŸåŒ…æ‹¬å…¨å±€å’Œå®žä¾‹ã€‚ ä¼˜å…ˆçº§ï¼šå®žä¾‹&gt;å…¨å±€ï¼Œå±žæ€§&gt;ä»£ç  å±žæ€§æ€»æ˜¯ä¼˜å…ˆçš„ï¼Œå¯ä»¥è®¾ç½®feign.client.default-to-propertiesä¸ºfalseï¼Œä½¿å¾—ä»£ç é…ç½®ä¼˜å…ˆã€‚ å…¨å±€å±žæ€§é…ç½®åé»˜è®¤æ˜¯defaultï¼Œå¯ä»¥è®¾ç½®feign.client.default-configä¸ºå…¶ä»–åå­—ã€‚ å±žæ€§é…ç½® 12345678910111213feign: hystrix: enabled: true client: config: # å…¨å±€é…ç½® default: connectTimeout: 5000 readTimeout: 5000 # å®žä¾‹é…ç½®ï¼ŒfeignNameå³@feignclientä¸­çš„valueï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å feignName: connectTimeout: 5000 readTimeout: 5000 ä»£ç é…ç½® å…¨å±€ä»£ç é…ç½® 12345678910111213141516171819202122package com.example.microservice2;import org.springframework.cloud.openfeign.support.SpringMvcContract;import org.springframework.context.annotation.Bean;import feign.Request;import feign.Retryer;public class FeignClientConfiguration &#123; @Bean public Request.Options feignRequestOptions() &#123; // é»˜è®¤è¿žæŽ¥è¶…æ—¶10ç§’ï¼Œè¯»å–è¶…æ—¶60ç§’ return new Request.Options(); &#125; // é»˜è®¤é‡è¯•æ˜¯å…³é—­çš„ @Bean public Retryer feignRetry() &#123; // é»˜è®¤é‡è¯•5æ¬¡ï¼Œé¦–æ¬¡é—´éš”100æ¯«ç§’ï¼Œæœ€å¤§é—´éš”1ç§’ return new Retryer.Default(); &#125;&#125; 1234567891011121314151617package com.example.microservice2;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;import org.springframework.cloud.openfeign.EnableFeignClients;@SpringBootApplication@EnableDiscoveryClient //å¼€å¯æ³¨å†ŒæœåŠ¡@EnableFeignClients(defaultConfiguration = FeignClientConfiguration.class) //å¼€å¯feignæ¶ˆè´¹æœåŠ¡public class DemoApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(DemoApplication.class, args); &#125;&#125; å®žä¾‹ä»£ç é…ç½® 123456789101112package com.example.microservice2;import org.springframework.cloud.openfeign.FeignClient;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation.RequestParam;@FeignClient(value = "microservice1", fallback = HelloServiceHystric.class, configuration = FeignClientConfiguration.class) // è®¿é—®å¾®æœåŠ¡1ï¼ŒæŒ‡å®šæ–­è·¯å™¨ç±»public interface HelloService &#123; @RequestMapping(value = "/hello", method = RequestMethod.GET) String hello(@RequestParam(value = "name") String name);&#125; hystrix å®˜æ–¹å‚è€ƒ hystrixæœ‰å››ç§é…ç½®æ–¹å¼ï¼š å…¨å±€ä»£ç é»˜è®¤å±žæ€§ï¼› å…¨å±€å±žæ€§é…ç½®ï¼› å®žä¾‹ä»£ç é…ç½®ï¼› å®žä¾‹å±žæ€§é…ç½®ã€‚ ä¼˜å…ˆçº§ï¼š1&lt;2&lt;3&lt;4 å’Œfeignä¸€æ ·ï¼Œä¹Ÿæ˜¯å±žæ€§ä¼˜å…ˆä»£ç ï¼Œå®žä¾‹ä¼˜å…ˆå…¨å±€ã€‚ å±žæ€§é…ç½® 123456789101112131415161718192021222324hystrix: command: #å…¨å±€é»˜è®¤é…ç½® default: #çº¿ç¨‹éš”ç¦»ç›¸å…³ execution: timeout: #æ˜¯å¦ç»™æ–¹æ³•æ‰§è¡Œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸ºtrueã€‚ä¸€èˆ¬æˆ‘ä»¬ä¸è¦æ”¹ã€‚ enabled: true isolation: #é…ç½®è¯·æ±‚éš”ç¦»çš„æ–¹å¼ï¼Œè¿™é‡Œæ˜¯é»˜è®¤çš„çº¿ç¨‹æ± æ–¹å¼ã€‚è¿˜æœ‰ä¸€ç§ä¿¡å·é‡çš„æ–¹å¼semaphoreã€‚ strategy: THREAD thread: #æ–¹å¼æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º1000æ¯«ç§’ï¼Œåœ¨å®žé™…åœºæ™¯ä¸­éœ€è¦æ ¹æ®æƒ…å†µè®¾ç½® timeoutInMilliseconds: 10000 # å®žä¾‹é…ç½® HystrixCommandKey: execution: timeout: enabled: true isolation: strategy: THREAD thread: timeoutInMilliseconds: 10000 ä»£ç é…ç½® 123456789101112131415161718192021222324@RefreshScope // å¼€å¯é…ç½®æ›´æ–°@RestController@Slf4jpublic class HelloController &#123; @Value("$&#123;serviceName&#125;") // è¯»é…ç½®æ–‡ä»¶çš„è¿™ä¸ªå±žæ€§ private String serviceName; @RequestMapping("/hello") @HystrixCommand(fallbackMethod = "helloError", commandProperties = &#123; @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "4000") &#125;) // æŒ‡å®šæ–­è·¯å™¨æ–¹æ³•ï¼Œæ–­è·¯å™¨ç›‘æŽ§ç”¨ public String hello(HttpServletRequest request, @RequestParam(value = "name", defaultValue = "Hugo") String name) throws InterruptedException &#123; log.info("ServerName:&#123;&#125; time:&#123;&#125;", request.getServerName(), DateFormatUtils.format(new Date(), "yyyyMMdd HH:mm:ss")); TimeUnit.SECONDS.sleep(4); return "hello " + name + ", my name is " + serviceName; &#125; public String helloError(HttpServletRequest request, String name) &#123; return "microservice1 hystrix," + name + "!"; &#125;&#125; feignä¸­çš„hystrixæ€Žä¹ˆé…ç½® åªèƒ½é€šè¿‡å±žæ€§è®¾ç½®ï¼Œé‚£ä¹ˆcommandkeyæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ 1234567package com.example.microservice2;@FeignClient(value = "microservice1", fallback = HelloServiceHystric.class, configuration = FeignClientConfiguration.class) // è®¿é—®å¾®æœåŠ¡1ï¼ŒæŒ‡å®šæ–­è·¯å™¨ç±»public interface HelloService &#123; @RequestMapping(value = "/hello", method = RequestMethod.GET) String hello(@RequestParam(value = "name") String name);&#125; ä¸Šä¾‹ä¸­é»˜è®¤è¡Œä¸ºå¦‚ä¸‹ï¼Œgroupkeyä¸º&quot;microservice1&quot;ï¼Œcommandkeyä¸º&quot;HelloService#hello(String)&quot;ï¼Œthreadpoolkeyä¸ºnullã€‚ 1234567891011121314151617181920212223public interface SetterFactory &#123; /** * Returns a hystrix setter appropriate for the given target and method */ HystrixCommand.Setter create(Target&lt;?&gt; target, Method method); /** * Default behavior is to derive the group key from &#123;@link Target#name()&#125; and the command key from * &#123;@link Feign#configKey(Class, Method)&#125;. */ final class Default implements SetterFactory &#123; @Override public HystrixCommand.Setter create(Target&lt;?&gt; target, Method method) &#123; String groupKey = target.name(); String commandKey = Feign.configKey(target.type(), method); return HystrixCommand.Setter .withGroupKey(HystrixCommandGroupKey.Factory.asKey(groupKey)) .andCommandKey(HystrixCommandKey.Factory.asKey(commandKey)); &#125; &#125;&#125; 1234567891011121314151617public abstract class Feign &#123; public static String configKey(Class targetType, Method method) &#123; StringBuilder builder = new StringBuilder(); builder.append(targetType.getSimpleName()); builder.append('#').append(method.getName()).append('('); for (Type param : method.getGenericParameterTypes()) &#123; param = Types.resolve(targetType, targetType, param); builder.append(Types.getRawType(param).getSimpleName()).append(','); &#125; if (method.getParameterTypes().length &gt; 0) &#123; builder.deleteCharAt(builder.length() - 1); &#125; return builder.append(')').toString(); &#125; &#125; æ‰€ä»¥è¿™æ ·è®¾ç½®ï¼š 12345678910hystrix: command: HelloService#hello(String): execution: timeout: enabled: true isolation: strategy: THREAD thread: timeoutInMilliseconds: 10000 ä¹Ÿå¯ä»¥æ”¹å˜ä¸Šè¿°commandkeyçš„é»˜è®¤è¡Œä¸ºï¼š 12345678910111213141516171819202122232425262728293031package com.example.microservice2;import java.lang.reflect.Method;import com.netflix.hystrix.HystrixCommand;import com.netflix.hystrix.HystrixCommandGroupKey;import com.netflix.hystrix.HystrixCommandKey;import org.springframework.context.annotation.Bean;import feign.Target;import feign.hystrix.SetterFactory;public class FeignClientConfiguration &#123; @Bean public SetterFactory feignHystrixSetter() &#123; return new MySetterFactory(); &#125;&#125;class MySetterFactory implements SetterFactory &#123; @Override public HystrixCommand.Setter create(Target&lt;?&gt; target, Method method) &#123; String groupKey = target.name(); String commandKey = target.type().getName(); return HystrixCommand.Setter .withGroupKey(HystrixCommandGroupKey.Factory.asKey(groupKey)) .andCommandKey(HystrixCommandKey.Factory.asKey(commandKey)); &#125; &#125; è¿™æ ·commandkeyå°±ä¼šå˜æˆ&quot;com.example.microservice2.HelloService&quot;ã€‚ ribbon å®˜æ–¹å‚è€ƒ ribbonåªæœ‰å±žæ€§é…ç½®ï¼ŒåŒæ ·å­˜åœ¨å…¨å±€å’Œå®žä¾‹é…ç½®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š 1&lt;clientName&gt;.&lt;nameSpace&gt;.&lt;propertyName&gt;=&lt;value&gt; nameSpaceæ˜¯å¯é…ç½®çš„ï¼Œé»˜è®¤ä¸ºribbonã€‚clientNameå¯ä¸ºè¿œç«¯æœåŠ¡åï¼Œå³@feignclientçš„valueï¼Œç©ºè¡¨ç¤ºå…¨å±€é…ç½®ã€‚ 1234567891011121314151617181920# å…¨å±€é…ç½®ribbon: # æœåŠ¡æœ€å¤§é‡è¯•æ¬¡æ•°,ä¸åŒ…å«ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œé»˜è®¤0 MaxAutoRetries: 5 # è´Ÿè½½å‡è¡¡åˆ‡æ¢æ¬¡æ•°,å¦‚æžœæœåŠ¡æ³¨å†Œåˆ—è¡¨å°äºŽ nextServer count é‚£ä¹ˆä¼šå¾ªçŽ¯è¯·æ±‚ A &gt; B &gt; Aï¼Œé»˜è®¤1 MaxAutoRetriesNextServer: 3 #æ˜¯å¦æ‰€æœ‰æ“ä½œéƒ½è¿›è¡Œé‡è¯• OkToRetryOnAllOperations: false #è¿žæŽ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤2ç§’ ConnectTimeout: 3000 #è¯»å–çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤5ç§’ ReadTimeout: 3000# å®žä¾‹é…ç½®clientName: ribbon: MaxAutoRetries: 5 MaxAutoRetriesNextServer: 3 OkToRetryOnAllOperations: false ConnectTimeout: 3000 ReadTimeout: 3000 è¶…æ—¶æ—¶é—´å…³ç³» feignè¶…æ—¶ feignå¯ä»¥è®¾ç½®è‡ªèº«è¶…æ—¶ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ribbonè¶…æ—¶ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å…³ç³»æ˜¯æ€Žä¹ˆæ ·çš„ï¼Ÿçœ‹feignä»£ç ï¼š 12345678910111213141516public class LoadBalancerFeignClient implements Client &#123; static final Request.Options DEFAULT_OPTIONS = new Request.Options(); IClientConfig getClientConfig(Request.Options options, String clientName) &#123; IClientConfig requestConfig; if (options == DEFAULT_OPTIONS) &#123; requestConfig = this.clientFactory.getClientConfig(clientName); &#125; else &#123; requestConfig = new FeignOptionsClientConfig(options); &#125; return requestConfig; &#125;&#125; å¦‚æžœæ²¡æœ‰è®¾ç½®è¿‡feignè¶…æ—¶ï¼Œä¹Ÿå°±æ˜¯ç­‰äºŽé»˜è®¤å€¼çš„æ—¶å€™ï¼Œå°±ä¼šè¯»å–ribbonçš„é…ç½®ï¼Œä½¿ç”¨ribbonçš„è¶…æ—¶æ—¶é—´å’Œé‡è¯•è®¾ç½®ã€‚å¦åˆ™ä½¿ç”¨feignè‡ªèº«çš„è®¾ç½®ã€‚ä¸¤è€…æ˜¯äºŒé€‰ä¸€çš„ï¼Œä¸”feignä¼˜å…ˆã€‚ å¦‚æžœè®¾ç½®çš„feignçš„è¶…æ—¶ï¼Œåˆ™è¶…æ—¶æ—¶é—´å¤§æ¦‚æ˜¯Retryer.Default.maxAttempts*(ConnectTimeout+ReadTimeout) å¦‚æžœä»…è®¾ç½®äº†ribbonï¼Œåˆ™è¶…æ—¶æ—¶é—´å¤§æ¦‚æ˜¯(ConnectTimeout+ReadTimeout)*(MaxAutoRetries+1)*(MaxAutoRetriesNextServer+1)ï¼› å»ºè®®ä½¿ç”¨ribbonè¶…æ—¶è®¾ç½®ã€‚ feigné‡è¯•å’Œribboné‡è¯• feignè‡ªèº«é‡è¯•ç›®å‰åªæœ‰ä¸€ä¸ªç®€å•çš„å®žçŽ°Retryer.Defaultï¼ŒåŒ…å«ä¸‰ä¸ªå±žæ€§ï¼š maxAttemptsï¼šé‡è¯•æ¬¡æ•°ï¼ŒåŒ…å«ç¬¬ä¸€æ¬¡ periodï¼šé‡è¯•åˆå§‹é—´éš”æ—¶é—´ï¼Œå•ä½æ¯«ç§’ maxPeriodï¼šé‡è¯•æœ€å¤§é—´éš”æ—¶é—´ï¼Œå•ä½æ¯«ç§’ é‡è¯•é—´éš”ç®—æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718public interface Retryer extends Cloneable &#123; class Default implements Retryer &#123; /** * Calculates the time interval to a retry attempt. &lt;br&gt; * The interval increases exponentially with each attempt, at a rate of nextInterval *= 1.5 * (where 1.5 is the backoff factor), to the maximum interval. * * @return time in nanoseconds from now until the next attempt. */ long nextMaxInterval() &#123; long interval = (long) (period * Math.pow(1.5, attempt - 1)); return interval &gt; maxPeriod ? maxPeriod : interval; &#125; &#125;&#125; ç¬¬ä¸€æ¬¡é‡è¯•é—´éš”periodï¼Œç¬¬äºŒæ¬¡period*1.5ï¼Œç¬¬ä¸‰æ¬¡period*1.5*1.5ï¼Œâ€¦ï¼Œæœ€å¤§å€¼ä¸è¶…è¿‡maxPeriodã€‚ å’Œribbonçš„é‡è¯•ç›¸æ¯”ï¼š é‡è¯•æ¬¡æ•°åŒ…å«äº†é¦–æ¬¡ï¼› ä¸èƒ½è®¾ç½®å¤šå®žä¾‹æœåŠ¡åˆ‡æ¢ï¼› é‡è¯•æœ‰ä¸€ä¸ªå»¶è¿Ÿæ—¶é—´ã€‚ feignè¶…æ—¶å’Œhystrixè¶…æ—¶ hystrixçš„è¶…æ—¶æ—¶é—´è¦å¤§äºŽfeignçš„ï¼Œå¦åˆ™æ²¡æœ‰ç­‰åˆ°feignè¶…æ—¶ï¼Œhystrixå°±fallbackäº†ï¼Œç‰¹åˆ«æ˜¯é‡è¯•æœºåˆ¶ä¼šæ— æ³•èµ·ä½œç”¨ã€‚]]></content>
      <categories>
        <category>java</category>
        <category>spring cloud</category>
      </categories>
      <tags>
        <tag>hystrix</tag>
        <tag>ribbon</tag>
        <tag>feign</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è§£å†³github pagesæ— æ³•è¢«baiduæŠ“å–é¡µé¢é—®é¢˜]]></title>
    <url>%2F2020%2F03%2F09%2F028-fix-baidu-seo-of-github-pages%2F</url>
    <content type="text"><![CDATA[å› ä¸ºgithubå±è”½äº†baiduçš„é¡µé¢æŠ“å–ï¼Œæ‰€ä»¥baiduä¸€ç›´æ— æ³•ç´¢å¼•è‡ªå»ºåšå®¢ã€‚è€Œåœ¨å›½å†…æ¯•ç«Ÿbaiduçš„ä½¿ç”¨é‡è¿˜æ˜¯æ›´å¤§ï¼Œä¸ºäº†è®©è‡ªå·±çš„åšå®¢æœ‰æ›´å¤šäººè®¿é—®ï¼Œè¿˜æ˜¯éœ€è¦æ‰“é€šè¿™æ¡é€šé“ã€‚æŸ¥æ‰¾äº†ä¸€äº›ç½‘ä¸Šèµ„æ–™ï¼Œè§£å†³åŠžæ³•å¯ä»¥é€šè¿‡ä½¿ç”¨å›½å†…çš„ç±»ä¼¼æœåŠ¡coding pagesä½œä¸ºé•œåƒã€‚ codingåœ¨å›½å†…äº‘ç«¯å¼€å‘è€…æœåŠ¡é‡Œæœ‰è‰¯å¥½çš„å£ç¢‘ï¼Œ2019å¹´è¢«é¹…åŽ‚æ”¶è´­ï¼Œå½“æ—¶å¹¿å¤§ç å†œæ‹…å¿ƒåˆä¸€ä¸ªå¥½æŠ€æœ¯è¢«è‘¬é€ï¼ŒçŽ°åœ¨æ¥çœ‹æœ‰é¹…åŽ‚çš„åŠ æŒï¼Œcodingå‘å±•è¿˜æ˜¯ä¸é”™çš„ï¼Œä¹Ÿä¸ºå¹¿å¤§å¼€å‘è€…æä¾›æ›´å¤šå®žæƒ ã€‚æ‰€ä»¥å¦‚æžœä½ æ­£åœ¨é€‰æ‹©ä¸€ä¸ªå»ºç«™æ–¹å¼ï¼Œç›´æŽ¥ä½¿ç”¨coding pagesä¹Ÿæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä¸‹é¢è¯´ä¸‹å·²ç»ä½¿ç”¨github pagesæ—¶å¦‚ä½•è§£å†³baiduæ— æ³•æŠ“å–é¡µé¢é—®é¢˜ã€‚ coding pages æœ€è¿‘codingè¿›è¡Œäº†ä¸€ç³»åˆ—äº§å“æ•´åˆå‡çº§æ“ä½œï¼Œæ‰€ä»¥ç½‘ä¸Šæœ‰äº›æ•™ç¨‹å·²ç»è¿‡æ—¶ï¼Œå¤§æ¦‚æ¢³ç†ä¸‹æ—¶é—´çº¿ï¼š codingæˆç«‹äºŽ2014å¹´ï¼Œæä¾›ä¸€ç«™å¼äº‘ç«¯å¼€å‘ä½“éªŒï¼Œæœ‰ä¸ªäººç‰ˆå’Œä¼ä¸šç‰ˆä¸¤ä¸ªäº§å“ï¼› 2018 å¹´4æœˆä¸Žè…¾è®¯äº‘è¾¾æˆæˆ˜ç•¥åˆä½œï¼ŒæŽ¨å‡ºäº†è½»é‡çº§ä»£ç æ‰˜ç®¡äº§å“ ã€Œè…¾è®¯äº‘å¼€å‘è€…å¹³å°ã€ï¼› 2019å¹´4æœˆæŽ¨å‡ºå…¨æ–°codingï¼Œåœ¨å°†åŽŸä¼ä¸šç‰ˆææƒä¸ºä¸»æ‰“äº§å“ï¼Œå¹¶åŠ å…¥æ•æ·é¡¹ç›®ååŒã€æŒç»­é›†æˆã€åˆ¶å“åº“ã€å•é¡¹ç›®å¤šä»“åº“ç­‰æ–°åŠŸèƒ½åŠæ•°ç™¾é¡¹ç‰¹æ€§æ”¹è¿›ï¼› 2019å¹´8æœˆè…¾è®¯å®Œæˆå¯¹codingçš„å…¨èµ„æ”¶è´­ï¼› 2019å¹´12æœˆ28æ—¥èµ·ï¼Œè…¾è®¯äº‘å¼€å‘è€…å¹³å°åœæ­¢æ³¨å†Œï¼› å°†codingä¸ªäººç‰ˆä¸Žè…¾è®¯äº‘å¼€å‘è€…å¹³å°å‡çº§è‡³å…¨æ–°codingï¼Œ2019.12.25~2020.1.20å°†åŽŸæœ‰è´¦æˆ·å…¨éƒ¨å‡çº§å®Œã€‚ è‡ªæ­¤codingåªæœ‰ä¸€ä¸ªå…¥å£coding.netï¼Œå…è´¹ç‰ˆæœ¬æ”¯æŒ5äººä»¥å†…å›¢é˜Ÿã€20ä¸ªé¡¹ç›®å’Œ50Gç©ºé—´ã€‚ coding pagesæ˜¯codingæä¾›çš„ç±»ä¼¼github pagesåŠŸèƒ½ï¼Œæœ‰äº›æ•™ç¨‹è¯´è¦å‡çº§è…¾è®¯äº‘å¼€å‘è€…è´¦æˆ·æ‰èƒ½ä½¿ç”¨ï¼ŒçŽ°åœ¨ä¸éœ€è¦äº†ï¼Œç›´æŽ¥coding.netæ³¨å†Œå³å¯ä½¿ç”¨ã€‚ç½‘ä¸Šå¯¹äºŽcoding pagesçš„è¯„ä»·å¯èƒ½è¿˜æ˜¯åœç•™åœ¨äº§å“æ•´åˆå‡çº§ä¹‹å‰ï¼Œå¯¹å…¶è¯„ä»·å¹¶ä¸æ˜¯å¤ªå¥½ã€‚ç›®å‰æœ€æ–°çš„coding pagesï¼Œåˆæ­¥ä½¿ç”¨è¿˜ç®—ä¸é”™ï¼Œè‡³å°‘æ¯”github pagesè¦å¿«å¾ˆå¤šã€‚ coding pagesæœ‰ä¸€ä¸ªä¸å¤ªå¥½çš„åœ°æ–¹æ˜¯ï¼Œä¸€å¼€å§‹æ²¡æœ‰æ‰¾åˆ°å…¥å£ðŸ˜‚ã€‚åŽŸæ¥é»˜è®¤æ²¡æœ‰å¯ç”¨å…¥å£ï¼Œæ–°ç‰ˆcodingä¸­æŠŠpageså½’åˆ°æž„å»ºä¸Žéƒ¨ç½²åŠŸèƒ½ä¸­ï¼Œè¦åˆ°é¡¹ç›®è®¾ç½®çš„åŠŸèƒ½å¼€å…³ä¸­å¼€å¯ã€‚ è¿™æ ·é¡¹ç›®å¯¼èˆªèœå•ä¸­æ‰ä¼šå‡ºçŽ°pageså…¥å£ã€‚ ä¹‹æ‰€ä»¥å½’ç±»åˆ°æž„å»ºä¸Žéƒ¨ç½²åŠŸèƒ½ï¼Œä¹Ÿæ˜¯æœ‰é“ç†çš„ï¼Œcodingçš„pagesåŠŸèƒ½ç±»ä¼¼ä¸€ä¸ªç‰¹æ®Šçš„éƒ¨ç½²ï¼Œå®ƒçš„ä¸»è¦ç‰¹æ€§æ˜¯é€‰æ‹©ä»Žå“ªä¸ªä»“åº“åœ¨ä»€ä¹ˆæ—¶å€™æ‰‹å·¥è¿˜æ˜¯è‡ªåŠ¨éƒ¨ç½²æˆç½‘ç«™ï¼Œç„¶åŽç»™ä½ ä¸€ä¸ªåŸŸåï¼Œè¿™ä¸ªåŸŸåä¸åƒgithubå¯ä»¥å®šåˆ¶ä¸ºå½¢å¦‚â€ç”¨æˆ·å.github.ioâ€œè¿™æ ·çš„ï¼Œè€Œæ˜¯è‡ªåŠ¨åˆ†é…çš„å½¢å¦‚&quot;00kj2k.coding-pages.com&quot;è¿™ç§çš„åŸŸåã€‚coding pagesä¹Ÿæ²¡æœ‰æä¾›å»ºç«™æ¨¡æ¿ç­‰åŠŸèƒ½ã€‚ ç†Ÿæ‚‰ä»¥ä¸Šè¿™äº›åŽï¼Œä½ åº”è¯¥å¯ä»¥å¾ˆå®¹æ˜“å»ºç«‹è‡ªå·±çš„coding pagesäº†ã€‚æ³¨æ„coding pageså¹¶ä¸è®¤ä»“åº“ä¸­çš„CNAMEæ–‡ä»¶ï¼Œéœ€è¦åœ¨ç•Œé¢ä¸­é…ç½®åŸŸåã€‚ é•œåƒæ–¹æ³• æŽ¥ä¸‹æ¥å°±æ˜¯è§£å†³å¦‚ä½•å°†coding pagesä½œä¸ºgithub pagesçš„é•œåƒäº†ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š æ–¹æ¡ˆä¸€ï¼šæœ¬åœ°hexo dæ—¶åŒæ—¶éƒ¨ç½²åˆ°coding pages æ–¹æ¡ˆäºŒï¼šé€šè¿‡githubæŒç»­é›†æˆè‡ªåŠ¨åŒæ­¥åˆ°coding pagesã€‚è€ŒæŒç»­é›†æˆä¹Ÿæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå¯ä»¥é€‰æ‹©githubè‡ªå®¶çš„github actionsï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ç¬¬ä¸‰æ–¹çš„ï¼Œå¦‚travis-ciã€‚ æŽ¨èæ–¹æ¡ˆäºŒï¼Œå¹¶ä¸”æŽ¨èä½¿ç”¨github actionsã€‚è¿™é‡Œé¡ºä¾¿æŠŠhexo dä¹Ÿåšæˆè‡ªåŠ¨çš„ï¼Œæˆ‘ä¹‹å‰éƒ½æ˜¯æ¯æ¬¡è‡ªå·±hexo gç„¶åŽhexo dï¼ŒçŽ°åœ¨ç”¨ä¸Šgithub actionsï¼Œå®žåœ¨æ˜¯çœå¿ƒäº†ä¸å°‘ã€‚ github actions github actionsæ˜¯githutè‡ªå®¶çš„æŒç»­é›†æˆï¼Œå®ƒçš„æœ€å¤§çš„ç‰¹è‰²æ˜¯å¯ä»¥å¤ç”¨åˆ«äººå†™å¥½çš„actionï¼Œè¿™äº›actionä¹Ÿåœ¨githubçš„ä»“åº“é‡Œï¼Œgithubè¿˜ä¸“é—¨å¼„äº†ä¸€ä¸ªå¸‚åœºï¼Œä¾›å¤§å®¶é€‰ç”¨ã€‚ æ¯«ä¸æ„å¤–çš„ï¼Œå®ƒé‡Œé¢å·²ç»æœ‰hexoçš„éƒ¨ç½²actionï¼Œä»¥åŠä»“åº“çš„åŒæ­¥actionï¼Œç›´æŽ¥æ‹¿æ¥å°±å¯ä»¥äº†ã€‚ ä»“åº“è®¿é—®å‡­è¯å‡†å¤‡ æˆ‘æ˜¯è¿™æ ·è§„åˆ’ä»“åº“çš„ï¼šhexoæºæ–‡ä»¶ä¸€ä¸ªgithubä»“åº“ï¼Œgithub pagesä¸€ä¸ªä»“åº“ï¼Œcoding pagesä¸€ä¸ªä»“åº“ github actionsæ˜¯å»ºåœ¨hexoæºæ–‡ä»¶ä»“åº“ä¸Šï¼Œæ‰§è¡Œæ—¶å…ˆè¿›è¡Œhexoéƒ¨ç½²ï¼ŒæŽ¨é€åˆ°github pagesä»“åº“ï¼ˆä¹Ÿå°±æ˜¯ç›¸å½“äºŽæ‰§è¡Œhexo dï¼‰ï¼Œç„¶åŽå°†github pagesä»“åº“åŒæ­¥åˆ°coding pagesä»“åº“ã€‚ github pages deploykey deploykeyå’Œå…¨å±€è®¾ç½®é‡Œçš„ssh keyç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯é’ˆå¯¹å•ä¸ªä»“åº“çš„ã€‚ ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆmysshå’Œmyssh.pubæ–‡ä»¶ï¼š 1ssh-keygen -t rsa -b 4096 -C &quot;zhongpan2000@gmail.com&quot; -f D:\myssh å°†myssh.pubçš„å†…å®¹è®¾ç½®åˆ°github pagesä»“åº“çš„deploykeyä¸­ã€‚ å°†mysshçš„å†…å®¹è®¾ç½®åˆ°hexoæºæ–‡ä»¶ä»“åº“çš„secretsä¸­ï¼Œåä¸ºgithub_pages_deploykeyï¼ŒåŽç»­åœ¨actionä½¿ç”¨ã€‚ coding pages token codingæ²¡æœ‰æä¾›ä»“åº“çº§åˆ«çš„ssh keyï¼Œåªèƒ½ä½¿ç”¨tokenã€‚åœ¨é¡¹ç›®è®¾ç½®çš„å¼€å‘è€…é€‰é¡¹ä¸­åˆ›å»ºå¹¶é…ç½®æƒé™ï¼Œåˆ›å»ºåŽå¾—åˆ°ç”¨æˆ·åå’Œå¯†ç ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡https://user:password@your.repo.urlå°±å¯ä»¥æ“ä½œä»“åº“ã€‚ å°†ä¸Šè¿°&quot;user:password&quot;ä¹Ÿå­˜å‚¨åˆ°hexoæºæ–‡ä»¶ä»“åº“çš„secretsä¸­ï¼Œåä¸ºcoding_blog_user_tokenï¼ŒåŽç»­åœ¨actionä½¿ç”¨ã€‚ å®Œæ•´workflow æœ€åŽç»™å‡ºå®Œæ•´çš„git actionsè„šæœ¬ã€‚ 12345678910111213141516171819202122232425262728name: Hexo Build and Deployon: [push]jobs: hexo-build-deploy: runs-on: ubuntu-latest steps: - uses: actions/checkout@v1 - name: Cache node modules uses: actions/cache@v1 with: path: node_modules key: $&#123;&#123;runner.OS&#125;&#125;-$&#123;&#123;hashFiles('**/package-lock.json')&#125;&#125; - uses: yrpang/github-actions-hexo@master with: deploykey: $&#123;&#123;secrets.github_pages_deploykey&#125;&#125; username: zhongpan email: zhongpan2000@gmail.com - name: repo-sync uses: wei/git-sync@v1 env: SOURCE_REPO: "https://github.com/zhongpan/zhongpan.github.io.git" SOURCE_BRANCH: "master" DESTINATION_REPO: "https://$&#123;&#123; secrets.coding_blog_user_token &#125;&#125;@e.coding.net/zhongpan/blog.git" DESTINATION_BRANCH: "master" with: args: $SOURCE_REPO $SOURCE_BRANCH $DESTINATION_REPO $DESTINATION_BRANCH DNSè§£æž æœ€åŽå°±æ˜¯DNSçš„é—®é¢˜çš„ï¼Œè‡ªå»ºç½‘ç«™æœ‰è‡ªå·±çš„åŸŸåï¼Œä¸ºäº†è§£å†³baiduæŠ“å–é¡µé¢é—®é¢˜ï¼Œå›½å†…éœ€è¦è§£æžåˆ°coding pagesä¸Šï¼Œå…·ä½“ä¹Ÿå¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼š æ–¹æ¡ˆä¸€ï¼šå¢ƒå†…è®¿é—®coding pagesï¼Œå¢ƒå¤–è®¿é—®github pages æ–¹æ¡ˆäºŒï¼šä»…baiduè®¿é—®coding pagesï¼Œå…¶ä»–è®¿é—®github pages æŽ¨èæ–¹æ¡ˆä¸€ï¼Œcoding pagesåœ¨å¢ƒå†…è®¿é—®é€Ÿåº¦éžå¸¸å¿«ï¼Œå¢ƒå¤–è¿˜æ˜¯è®¿é—®github pagesï¼Œè¿™æ ·ç›¸å½“äºŽè‡ªå»ºäº†ä¸€ä¸ªCDNã€‚æˆ‘ä½¿ç”¨çš„é˜¿é‡Œäº‘åŸŸåæœåŠ¡ï¼Œè®¾ç½®åŸŸåè§£æžè®°å½•å¦‚ä¸‹ï¼š å¦‚æžœä½ éœ€è¦å¯ç”¨httpsï¼Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨coding pagesä¸­ç”³è¯·è¯ä¹¦å¤±è´¥ï¼Œæ˜¯å› ä¸ºè¯ä¹¦æ˜¯é€šè¿‡Letâ€™s Encryptç”³è¯·çš„ï¼Œè¿™æ˜¯å›½å¤–çš„ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒéªŒè¯ç«™ç‚¹çš„æ—¶å€™ä¼šç»è¿‡ä¸Šè¿°DNSè§£æžåˆ°github pagesä¸ŠåŽ»ï¼Œè§£å†³åŠžæ³•æ˜¯å…ˆæš‚å®šå¢ƒå¤–çº¿è·¯è§£æžï¼Œç”³è¯·æˆåŠŸä¹‹åŽå†å¼€å¯ã€‚ç”³è¯·è¯ä¹¦æœ‰æ•ˆæœŸæ˜¯3ä¸ªæœˆï¼Œåˆ°æœŸåŽéœ€è¦é‡æ–°ç”³è¯·ã€‚github pagesä¹Ÿæ˜¯é€šè¿‡Letâ€™s Encryptç”³è¯·è¯ä¹¦ï¼Œä¹Ÿæ˜¯3ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œä½†æ˜¯åˆ°æœŸä¼šè‡ªåŠ¨å¸®ä½ ç”³è¯·ã€‚]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>github</tag>
        <tag>github actions</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gradleå¤šæ¨¡å—Spring Booté¡¹ç›®é—®é¢˜æ€»ç»“]]></title>
    <url>%2F2020%2F03%2F04%2F027-create-multi-module-spring-boot-gradle-project%2F</url>
    <content type="text"><![CDATA[æ¨¡å—åŒ–æ˜¯è®¾è®¡è½¯ä»¶çš„ä¸€ä¸ªåŸºæœ¬æ‰‹æ®µï¼Œå°†è½¯ä»¶æ¨¡å—åŒ–ä½¿å¾—æ¨¡å—å¯ä»¥è¢«å¤ç”¨ï¼Œå¯ä»¥ç‹¬ç«‹ç»´æŠ¤ã€‚Spring bootåº”ç”¨é€šå¸¸ä½¿ç”¨Spring initializråˆ›å»ºï¼Œå®ƒæ˜¯ä¸æ”¯æŒå¤šæ¨¡å—åˆ›å»ºçš„ã€‚å¤šæ¨¡å—æž„å»ºçš„èƒ½åŠ›æ˜¯æž„å»ºå·¥å…·æ‰€æä¾›ï¼Œä¹Ÿå°±æ˜¯Mavenæˆ–Gradleã€‚ä¸€äº›é«˜çº§çš„IDEï¼Œå¦‚JIDEï¼Œå¯ä»¥æ”¯æŒå¤šæ¨¡å—åˆ›å»ºï¼Œå°±æ˜¯å¸®ä½ ä¿®æ”¹å¥½Mavenæˆ–Gradleçš„è„šæœ¬ã€‚ä½ å¯èƒ½ä½¿ç”¨çš„vscodeè¿™ç±»ç¼–è¾‘å·¥å…·ï¼Œä½†æ˜¯ä¹Ÿæƒ³ä½“éªŒä¸€ä¸‹å¤šæ¨¡å—ï¼Œé‚£ä¹ˆå°±åªèƒ½æ‰‹å·¥ä¿®æ”¹æž„å»ºè„šæœ¬ã€‚ Gradleæ˜¯åŸºäºŽGroovyè¯­è¨€æž„å»ºå‡ºæ¥çš„ä¸€ä¸ªç‰¹å®šé¢†åŸŸè¯­è¨€(DSL)ï¼Œç”¨æ¥è¿›è¡Œé¡¹ç›®çš„æž„å»ºã€‚æˆ‘è§‰å¾—å®ƒå’ŒC++é¢†åŸŸçš„CMakeæ¯”è¾ƒåƒï¼Œä½†æ˜¯CMakeæ˜¯å®Œå…¨ç‰¹åŒ–çš„è„šæœ¬è¯­è¨€ï¼Œè€ŒGradleæ˜¯åŸºäºŽJVMä¸Šçš„è„šæœ¬è¯­è¨€Groovyæž„å»ºï¼Œå…¶ç¼–ç¨‹å’Œæ‰©å±•èƒ½åŠ›è¿œè¿œè¶…è¿‡CMakeï¼ŒGradleä¹Ÿæ”¯æŒC++è¯­è¨€çš„æž„å»ºã€‚ä¸€ä¸ªGradleè„šæœ¬æ˜¯åŽç¼€ä¸ºgradleçš„æ–‡ä»¶ï¼Œå…¶ä¸­é€šå¸¸ä¸ºDSLè¯­å¥ï¼Œå…·æœ‰ç‰¹å®šçš„æ ¼å¼ï¼Œè¿™èƒ½é™ä½Žè„šæœ¬çš„ç¼–å†™éš¾åº¦ï¼ŒåŒæ—¶ä½ ä¹Ÿå®Œå…¨å¯ä»¥å‚æ‚è¿›Groovyè¯­å¥ï¼Œå®žçŽ°æ›´å¤æ‚çš„åŠŸèƒ½ã€‚åŒæ—¶å€ŸåŠ©æ’ä»¶ï¼Œè¿˜å¯ä»¥å¾ˆå®¹æ˜“æ‰©å±•è¿™ä¸ªDSLï¼Œå®žé™…ä¸ŠGradleå¤§éƒ¨åˆ†åŠŸèƒ½éƒ½æ˜¯é€šè¿‡æ’ä»¶å®žçŽ°çš„ã€‚ ä»Žç½‘ç»œä¸Šå¯ä»¥æœç´¢åˆ°å¾ˆå¤šå…³äºŽå¦‚ä½•æž„å»ºGradleå¤šæ¨¡å—é¡¹ç›®çš„èµ„æ–™ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æœ‰å…±åŒçš„é—®é¢˜ï¼Œæ‰€ä½¿ç”¨çš„Gradleç‰ˆæœ¬è¾ƒä½Žï¼ŒæŒ‰ç…§å…¶æ–¹æ³•éƒ½æœ‰ä¸€äº›é—®é¢˜ã€‚æœ¬æ–‡åŸºäºŽç›®å‰æœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ€»ç»“ä¸€ä¸‹åˆ›å»ºå¤šæ¨¡å—Gradleé¡¹ç›®çš„é—®é¢˜ã€‚ ç‰ˆæœ¬ Spring boot 2.2.5 Spring boot 2.2.5ä½¿ç”¨çš„Gradleç‰ˆæœ¬æ˜¯6.0.1 å®˜æ–¹æ–‡æ¡£ æœ€æƒå¨çš„å…³äºŽå¦‚ä½•åˆ›å»ºå¤šæ¨¡å—é¡¹ç›®çš„æ–‡æ¡£èŽ«è¿‡äºŽå®˜æ–¹æ–‡æ¡£ï¼Œåœ°å€å¦‚ä¸‹ï¼š Springå®˜æ–¹ï¼šhttps://spring.io/guides/gs/multi-module/ Gradleå®˜æ–¹ï¼šhttps://guides.gradle.org/creating-multi-project-builds/ æ‰€ä»¥å½“ä½ é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œå¤šåŽ»æ‰¾åŽŸæ–‡ã€æ‰¾æºå¤´ã€‚ Gradleæ’ä»¶å¼•å…¥æ–¹å¼å˜åŒ– å‚ç…§ç½‘ç»œä¸Šçš„æ–‡ç« ï¼ˆä¾‹å¦‚æ­¤æ–‡VS Codeå¼€å‘Spring Boot + Cloudç¤ºä¾‹ï¼ˆå››ï¼‰Spring Boot + Gradleå¤šé¡¹ç›®æ¡†æž¶ï¼‰å‡ºçŽ°é—®é¢˜çš„åŽŸå› ï¼Œæ˜¯ä½ ä½¿ç”¨äº†æ–°ç‰ˆæœ¬çš„Gradleï¼Œå…¶DSLè¯­æ³•æœ‰å˜åŒ–ï¼Œä¸»è¦çš„å˜åŒ–æ˜¯æ’ä»¶å¼•å…¥çš„æ–¹å¼å˜äº†ã€‚ ä»¥å‰çš„æ–¹å¼ï¼š 1apply plugin: 'java' æ–°çš„æ–¹å¼ï¼š 123plubins &#123; id 'java'&#125; å…·ä½“ä»Žå“ªä¸ªç‰ˆæœ¬é»˜è®¤é‡‡ç”¨æ–°çš„æ–¹å¼ï¼Œæˆ‘æ²¡æœ‰åŽ»è€ƒè¯ï¼Œä¸¤è€…çš„åŒºåˆ«è§è¿™é‡Œã€‚pluginså­˜åœ¨ä¸€äº›é™åˆ¶ï¼Œä¸èƒ½æ”¾åœ¨subprojectsæˆ–allprojectsé‡Œé¢ï¼Œä¸”å¿…é¡»æ”¾åœ¨ä¸€å¼€å§‹ã€‚é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼Œå¦‚æžœä½ æŒ‰æ–‡ç« é‡Œé¢çš„å°†æ ¹é¡¹ç›®build.gradleçš„å†…å®¹å…¨éƒ¨ç§»åˆ°subprojectsé‡Œé¢ï¼Œå°±ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š Could not find method plugins() for arguments â€¦ å¦‚æžœæƒ³åœ¨æ ¹é¡¹ç›®å¼•å…¥æ’ä»¶ï¼Œåœ¨å­æ¨¡å—å¤ç”¨ï¼Œå¯ä»¥è¿™æ ·åšï¼Œæ³¨æ„æ ¸å¿ƒæ’ä»¶ä¸èƒ½ä½¿ç”¨versionå’Œapplyï¼š 12345678910111213plugins &#123; id 'org.springframework.boot' version '2.2.5.RELEASE' apply false id 'io.spring.dependency-management' version '1.0.9.RELEASE' apply false id 'java'&#125;subprojects &#123; apply plugin: 'org.springframework.boot' apply plugin: 'io.spring.dependency-management' apply plugin: 'java'&#125; å¸¸ç”¨æ’ä»¶ å¼€å‘Spring bootåº”ç”¨å¸¸ç”¨å¦‚ä¸‹æ’ä»¶ï¼š 123456plugins &#123; id 'org.springframework.boot' version '2.2.5.RELEASE' id 'io.spring.dependency-management' version '1.0.9.RELEASE' id 'java' id 'java-library'&#125; æ’ä»¶æ–‡æ¡£ï¼š dependency managementæ’ä»¶ï¼ˆç¤¾åŒºæ’ä»¶ï¼‰: org.springframework.boot Spring bootæ’ä»¶ï¼ˆç¤¾åŒºæ’ä»¶ï¼‰: io.spring.dependency-management javaè¯­è¨€æ’ä»¶ï¼ˆæ ¸å¿ƒæ’ä»¶ï¼‰ï¼šjava javaåº“å¼€å‘ï¼ˆæ ¸å¿ƒæ’ä»¶ï¼‰ï¼šjava-library ç¤¾åŒºæ’ä»¶å¯ä»¥åœ¨é—¨æˆ·https://plugins.gradle.orgä¸ŠæŸ¥è¯¢(ä¸è¿‡æ²¡æœ‰ç»Ÿä¸€çš„æ’ä»¶ä½¿ç”¨è¯´æ˜Žæ–‡æ¡£ï¼Œä¸å¤ªæ–¹ä¾¿)ï¼Œæ ¸å¿ƒæ’ä»¶éšGradleå‘è¡Œï¼Œä½¿ç”¨è¯´æ˜ŽåŒ…å«åœ¨Gradleæ–‡æ¡£ä¸­ã€‚ dependency managementæ’ä»¶ è¿™ä¸ªæ’ä»¶æä¾›äº†ç±»ä¼¼mavençš„ä¾èµ–ç®¡ç†åŠŸèƒ½ï¼Œé€šè¿‡å¦‚ä¸‹blockå®šä¹‰ï¼Œå…¶ä¸­å®šä¹‰çš„ä¾èµ–ï¼Œåœ¨Gradle dependenciesä¸­ä½¿ç”¨å¯ä»¥çœç•¥ç‰ˆæœ¬å·ã€‚ 123dependencyManagement &#123;&#125; å¸¸ç”¨çš„æ–¹å¼æ˜¯é€šè¿‡maven bomå¯¼å…¥ä¾èµ–ï¼š 123456789dependencyManagement &#123; imports &#123; mavenBom &apos;io.spring.platform:platform-bom:1.0.1.RELEASE&apos; &#125;&#125;dependencies &#123; implementation &apos;org.springframework.integration:spring-integration-core&apos;&#125; Spring bootæ’ä»¶ è¿™ä¸ªæ’ä»¶ä¸ºSpring bootåº”ç”¨å¼€å‘æä¾›äº†ä¸€äº›ä¾¿åˆ©ã€‚ä¾‹å¦‚å’Œdependency-managementæ’ä»¶ä¸€èµ·ä½¿ç”¨å¯ä»¥è‡ªåŠ¨å¯¼å…¥Spring bootçš„maven bomã€‚ 123456789plugins &#123; id 'org.springframework.boot' version '2.2.5.RELEASE' id 'io.spring.dependency-management' version '1.0.9.RELEASE' id 'java'&#125;dependencies &#123; implementation 'org.springframework.boot:spring-boot-starter-web'&#125; ç­‰ä»·äºŽï¼š 1234567891011121314plugins &#123; id 'io.spring.dependency-management' version '1.0.9.RELEASE' id 'java'&#125;dependencyManagement &#123; imports &#123; mavenBom("org.springframework.boot:spring-boot-dependencies:2.2.5.RELEASE") &#125;&#125;dependencies &#123; implementation 'org.springframework.boot:spring-boot-starter-web'&#125; è¿˜æä¾›äº†bootRunä»»åŠ¡å¯åŠ¨åº”ç”¨ï¼š 1gradle bootRun javaæ’ä»¶çš„ä¾èµ–é…ç½®å˜åŒ– æœ‰ä¸€ä¸ªä¸ä¸€æ ·çš„åœ°æ–¹å¯èƒ½ä¼šå›°æ‰°ä½ ï¼Œç½‘ä¸Šçš„å¾ˆå¤šæ–‡ç« é‡Œé¢ä¼šå‡ºçŽ°ï¼š 123dependencies &#123; compile('org.springframework.boot:spring-boot-starter-web')&#125; ä½†æ˜¯æœ€æ–°çš„æ˜¯è¿™æ ·çš„ï¼š 123dependencies &#123; implementation 'org.springframework.boot:spring-boot-starter-web'&#125; è¿™æ˜¯å› ä¸ºåœ¨æœ€æ–°çš„javaæ’ä»¶ä¸­ä¾èµ–é…ç½®æœ‰å˜åŒ–ï¼Œæœ‰ä¸€äº›deprecatedäº†ï¼Œå¦‚ä¸‹ç°è‰²å­—ä½“ï¼Œä¾‹å¦‚compileï¼Œè¯¦è§ã€‚ java-libraryæä¾›å¦‚ä¸‹ä¾èµ–é…ç½®ï¼š spring-boot-devtoolsä¸ç”Ÿæ•ˆ spring-boot-devtoolsä¸»è¦æä¾›Automatic restartå’ŒLiveReloadåŠŸèƒ½ï¼Œæžå¤§çš„æå‡äº†å¼€å‘è°ƒè¯•çš„æ•ˆçŽ‡ï¼Œåœ¨Spring Initializrä¸­åˆ›å»ºé¡¹ç›®æ—¶é€‰æ‹©DevToolsï¼Œä¼šç”Ÿæˆå¦‚ä¸‹æž„å»ºè„šæœ¬ï¼š 1234567891011121314configurations &#123; developmentOnly runtimeClasspath &#123; extendsFrom developmentOnly &#125; compileOnly &#123; extendsFrom annotationProcessor &#125;&#125;dependencies &#123; developmentOnly 'org.springframework.boot:spring-boot-devtools'&#125; åœ¨IDEä¸­é€šè¿‡è°ƒå¼è¿è¡Œåº”ç”¨æ—¶ï¼ŒdevtoolsåŠŸèƒ½ä¸€åˆ‡æ­£å¸¸ï¼Œä½†æ˜¯å¦‚æžœä½ é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯åŠ¨åº”ç”¨ï¼Œä¼šå‘çŽ°è‡ªåŠ¨é‡å¯å¹¶æ²¡æœ‰ç”Ÿæ•ˆã€‚ 1gradle bootRun è™½ç„¶bootRunä¼šè‡ªåŠ¨è¯†åˆ«devtoolsï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦å…ˆç¼–è¯‘ï¼Œå› ä¸ºdevtoolsé»˜è®¤ç›‘æŽ§çš„classpathä¸‹æ–‡ä»¶æ”¹å˜ï¼Œå¦å¤–é‡æ–°ç¼–è¯‘åŽæ‰èƒ½çœ‹åˆ°ä¿®æ”¹çš„æ•ˆæžœã€‚ä¸ºäº†è‡ªåŠ¨ç¼–è¯‘ï¼Œå¯ä»¥é€šè¿‡gradleçš„è¿žç»­æž„å»ºå®žçŽ°ï¼Œå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1gradle build --continuous ä¿æŒä¸Šè¿°ä¸¤ä¸ªå‘½ä»¤éƒ½å¼€ç€ï¼Œè¿™æ—¶ä¿®æ”¹æ–‡ä»¶å°±ä¼šå…ˆè§¦å‘buildï¼Œç„¶åŽå†è§¦å‘bootRuné‡å¯ã€‚ å‚è€ƒï¼š Continuous Auto-restart With Spring Boot DevTools and Gradle SpringBooté…ç½®devtoolså®žçŽ°çƒ­éƒ¨ç½² ç†è§£ä¾èµ–é…ç½® å¯ç”¨devtoolså·¥å…·åŽï¼Œä¾èµ–é…ç½®configurationsä¸­ä¼šå‡ºçŽ°è‡ªå®šä¹‰é…ç½®developmentOnlyï¼Œè¿™æ˜¯ä»€ä¹ˆç›®çš„å‘¢ï¼Ÿ configurationsé‡Œé¢çš„å†…å®¹ï¼Œæ¯ä¸€é¡¹ç§°ä¸ºä¸€ä¸ªdependency configurationï¼Œå…¶å®žæ˜¯å¯¹dependencyçš„ä¸€ä¸ªåˆ†ç»„ï¼Œåœ¨dependencieså¾€è¿™ä¸ªåˆ†ç»„é‡Œé¢åŠ å…¥dependencyï¼Œgradleå¯¹æ¯ä¸ªconfigurationè§£æžå‡ºä¸€ä¸ªä¾èµ–æ ‘ï¼Œä¾›taskä½¿ç”¨ã€‚ æ¯ä¸€ä¸ªdependency configurationä»£è¡¨ä¸€å®šè§’è‰²ï¼Œå†³å®šäº†ï¼š æž„å»ºç”Ÿå‘½å‘¨æœŸçš„å“ªäº›æ­¥éª¤ä¼šä½¿ç”¨åˆ†ç»„ä¸­çš„ä¾èµ– åˆ†ç»„ä¸­çš„ä¾èµ–ä¼šä¼ é€’å—ï¼Œæ˜¯ä¼ é€’åˆ°æ¶ˆè´¹æ¨¡å—çš„ç¼–è¯‘æœŸè¿˜æ˜¯è¿è¡ŒæœŸï¼Œè¿˜æ˜¯éƒ½æœ‰ åˆ†ç»„ä¸­çš„ä¾èµ–ä¼šæ‰“åŒ…è¿›æž„å»ºè¾“å‡ºå— å‰æ–‡çš„javaåŠjava libraryæ’ä»¶é¢„å®šä¹‰äº†ä¸€äº›dependency configurationï¼Œå¦‚implementationã€compileOnlyç­‰ï¼Œå®ƒä»¬çš„è§’è‰²ç”±æ’ä»¶é¢„å®šä¹‰å¥½ã€‚ implementation compileOnly runtimeOnly api æž„å»ºé˜¶æ®µ compile time runtime test compile time test runtime compile time runtime compile time runtime test compile time test runtime ä¼ é€’åˆ°æ¶ˆè´¹æ¨¡å—ç¼–è¯‘æœŸ no no no yes ä¼ é€’åˆ°æ¶ˆè´¹æ¨¡å—è¿è¡ŒæœŸ yes no yes yes æ‰“åŒ…åˆ°è¾“å‡º yes no yes yes å¯¹äºŽdevtoolsï¼Œå®ƒçš„å®žçŽ°åŽŸç†æ˜¯å¯ç”¨ç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼Œä»…ç”¨åœ¨å¼€å‘è°ƒå¼é˜¶æ®µï¼Œæ‰€ä»¥å®ƒä¸ä¼šåº”ç”¨åˆ°æž„å»ºé˜¶æ®µï¼Œä¹Ÿä¸éœ€è¦ä¼ é€’åˆ°æ¶ˆè´¹æ¨¡å—ï¼Œä¹Ÿä¸éœ€è¦æ‰“åŒ…åˆ°è¾“å‡ºï¼Œæ‰€ä»¥è¿™é‡Œå°±è‡ªå®šä¹‰äº†ä¸€ä¸ªä¾èµ–é…ç½®developmentOnlyï¼Œç›®çš„å°±æ˜¯ä¸å‚ä¸Žæž„å»ºé˜¶æ®µã€ä¸ä¼ é€’ã€ä¸æ‰“åŒ…ï¼Œè¿™ä¸ªä¾èµ–é…ç½®ä¹Ÿå¯ä»¥ç”¨åˆ«çš„åå­—ã€‚ é‚£ä¹ˆdevtoolsåˆæ˜¯æ€Žä¹ˆç”Ÿæ•ˆçš„å‘¢ï¼š åœ¨IDEä¸­è¿›è¡Œè°ƒè¯•è¿è¡Œæ—¶ï¼Œæ£€æµ‹åˆ°devtoolsæ—¶å°±ä¼šä½¿ç”¨å…¶ä¸­çš„&quot;restart&quot;ç±»åŠ è½½å™¨åŠ è½½æ‰“å¼€çš„å·¥ç¨‹ï¼Œå…¶ä»–jarä½¿ç”¨&quot;base&quot;ç±»åŠ è½½å™¨åŠ è½½ï¼› ä½¿ç”¨gradle bootRunè¿è¡Œæ—¶ï¼Œæ£€æµ‹åˆ°devtoolsæ—¶åŒä¸Š å‚è€ƒï¼š Faster Development with Spring Boot DevTools Spring boot devtools tutorial Maven Scopes and Gradle Configurations Explained]]></content>
      <categories>
        <category>java</category>
        <category>spring boot</category>
      </categories>
      <tags>
        <tag>gradle</tag>
        <tag>spring boot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨åœ¨çº¿è¡¨æ ¼airtableè¿›è¡Œè½¯ä»¶å¼€å‘ç®¡ç†]]></title>
    <url>%2F2020%2F02%2F22%2F026-development-management-with-airtable%2F</url>
    <content type="text"><![CDATA[2019å¹´çš„å†¬å¤©çˆ†å‘æ–°å† ç—…æ¯’ç–«æƒ…ï¼Œè€Œæˆ‘æ­£å¤„äºŽè¿™æ¬¡ç–«æƒ…çš„ä¸­å¿ƒæ­¦æ±‰ï¼Œé™¤å¤•æˆ‘å¸¦ç€å¤§å„¿å¥³å›žåˆ°æ­¦æ±‰éƒŠåŒºçš„å†œæ‘è€å®¶ï¼Œè€Œè€å©†å¸¦ç€åˆšæ»¡ä¸€å²çš„å°å„¿å¥³ç•™åœ¨æ­¦æ±‰åŸŽåŒºï¼Œé‚£ä¸ªæ—¶å€™å·²ç»å…¬å¸ƒäººä¼ äººï¼Œæ­¦æ±‰ä¹Ÿåˆšå°åŸŽï¼Œæˆ‘è™½ç„¶æ„è¯†åˆ°ä¸¥é‡ï¼Œä½†è¿˜æ²¡æœ‰æƒŠæ…Œï¼Œæ‰§æ„å›žäº†è€å®¶ã€‚ç›´åˆ°åŽæ¥ç¡®è¯Šäººæ•°æš´å¢žï¼Œå¤§é‡ç–‘ä¼¼ç—…äººæ— æ³•å…¥é™¢æ²»ç–—ï¼Œç½‘ç»œä¸Šå„ç§æ— åŠ©çš„æ±‚æ•‘ï¼Œæ‰å¼€å§‹æ‹…å¿ƒèµ·æ¥ã€‚çŽ°åœ¨å›žæƒ³èµ·æ¥å†³å®šå›žè€å®¶éžå¸¸å†’é™©ï¼Œä¸‡ä¸€æ„ŸæŸ“äº²äººå°†ä¸å ªè®¾æƒ³ã€‚ æ˜¥èŠ‚è¿‡åŽï¼Œå› ä¸ºç–«æƒ…ï¼Œå·¥ä½œä¸­å¤šäº†ä¸€äº›ç›¸å…³çš„ç»Ÿè®¡å·¥ä½œï¼Œä¾‹å¦‚ç»Ÿè®¡åœ¨å®¶è¿œç¨‹åŠžå…¬æ—¶é•¿ã€ç»Ÿè®¡å¤å·¥æƒ…å†µã€ç»Ÿè®¡å¤–åœ°è¿”æ±‰ä¿¡æ¯ç­‰ç­‰ï¼Œç»å¸¸éœ€è¦æŠŠå›¢é˜Ÿçš„åé¦ˆåˆå¹¶åˆ°ä¸€èµ·ï¼Œéžå¸¸çš„ç¹çã€‚äºŽæ˜¯æˆ‘å¼€å§‹å¯»æ‰¾ä¸€æ¬¾èƒ½å¤ŸååŒç¼–è¾‘çš„åœ¨çº¿è¡¨æ ¼ï¼Œè®©æˆ‘æ‰¾åˆ°äº†Airtableï¼Œçž¬é—´è§£å†³äº†å›°æ‰°æˆ‘çš„é—®é¢˜ï¼ŒçœŸæ˜¯å¦‚èŽ·è‡³å®ã€‚ éšç€å¤å·¥æ—¶é—´ä¸€å†æŽ¨è¿Ÿï¼Œåœ¨å®¶è¿œç¨‹åŠžå…¬å°†æˆä¸ºä¸€ç§å¸¸æ€ï¼Œæ€Žä¹ˆåšå¥½è¿œç¨‹åŠžå…¬æ˜¯éœ€è¦å¥½å¥½ç¢ç£¨çš„ä¸€ä¸ªäº‹æƒ…ã€‚æ€Žä¹ˆæ ·è®©å¤§å®¶åˆ†æ•£å„åœ°ï¼Œä½†æ˜¯èƒ½å¤Ÿè¡ŒåŠ¨ä¸€è‡´ã€é«˜æ•ˆçš„å·¥ä½œï¼Œæ˜¯éžå¸¸æœ‰æŒ‘æˆ˜çš„ã€‚è¿™å‘¨ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œåˆ©ç”¨AirtableæŠŠå›¢é˜Ÿçš„ä»»åŠ¡ç®¡ç†èµ·æ¥ï¼Œæˆ‘è§‰å¾—æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å°è¯•ï¼Œä¹Ÿè®©æˆ‘æ›´åŠ å–œæ¬¢ä¸ŠAirtableã€‚ Airtableè§£å†³äº†ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼Œå°±æ˜¯åº¦é‡å’Œå¯è§†åŒ–ã€‚æ‰€è°“æ²¡æœ‰åº¦é‡å°±æ²¡æœ‰æ”¹è¿›ï¼Œç®¡ç†ä¸­éœ€è¦é‡åŒ–å„ç§æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šæˆä¸ºä¸€æŠŠæˆ’å°ºï¼Œæœ‰æ„æ— æ„ä¸­è§„èŒƒå½±å“å¤§å®¶çš„è¡Œä¸ºã€‚é€‰æ‹©ä»€ä¹ˆçš„åº¦é‡æŒ‡æ ‡ï¼Œæ˜¯å› æ—¶å› äº‹è€Œå¼‚çš„ã€‚å†å¥½çš„é¡¹ç›®ç®¡ç†è½¯ä»¶ä¹Ÿä¸å¯èƒ½é¢é¢ä¿±åˆ°ï¼Œæ»¡è¶³å„ç§éœ€æ±‚ã€‚è€ŒAirtableçš„çº¯ç²¹ï¼Œå°±æ˜¯ä¸ºäº†å¤„ç†æ•°æ®ã€æ˜¾ç¤ºæ•°æ®ï¼Œå¯éšå¿ƒæ‰€æ¬²å®šåˆ¶ï¼Œæˆä¸ºäº†å®ƒçš„è¿‡äººä¹‹å¤„ã€‚ ä¸‹é¢æˆ‘å°±è¯¦ç»†è¯´è¯´ï¼Œæˆ‘æ˜¯æ€Žä¹ˆå‡ å°æ—¶å†…å°±ç”¨Airtableæ‰“é€ ä¸€ä¸ªè½¯ä»¶å¼€å‘ä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼Œæˆ‘å¯¹å®ƒéžå¸¸æ»¡æ„ï¼Œè€Œå¦‚æžœè¦å¼€å‘ä¸€ä¸ªç±»ä¼¼çš„é¡¹ç›®ç®¡ç†ç³»ç»Ÿç»ä¸æ˜¯ä¸€æ—¶åŠä¼šèƒ½åŠžåˆ°çš„ã€‚ Airtableç®€ä»‹ Airtableæ˜¯ä¸€ä¸ªå›½å¤–çš„åœ¨çº¿æœåŠ¡ï¼Œæ³¨å†ŒåŽå³å¯ä½¿ç”¨ï¼Œåˆ†å…è´¹å’Œä»˜è´¹ç‰ˆæœ¬ã€‚Airtableä¸­æŒ‰ç…§workspace-base-tableä¸‰çº§æ¥ç»„ç»‡æ•°æ®ï¼Œä¸€ä¸ªworkspaceä¸­å¯ä»¥æœ‰å¤šä¸ªbaseï¼Œä¸€ä¸ªbaseä¸‹æœ‰å¤šä¸ªtableã€‚baseä¸‹çš„tableä¹‹é—´å¯ä»¥å…³è”ï¼Œä½†æ˜¯è·¨baseçš„è¡¨æ˜¯ä¸èƒ½å…³è”çš„ã€‚ Airtableå…è´¹ç‰ˆæœ¬ä¸é™åˆ¶baseæ•°ç›®ï¼Œåªé™åˆ¶æ¯ä¸ªbaseæœ€å¤š1200æ¡è®°å½•ï¼Œ2Gé™„ä»¶ç©ºé—´ï¼Œå…·å¤‡å›¢é˜Ÿåä½œåŠŸèƒ½ï¼Œè¿™å°±å®Œå…¨å¯ä»¥æ»¡è¶³ä¸€ä¸ªå°å›¢é˜Ÿçš„ä½¿ç”¨ï¼Œå¤§ä¸äº†æ•°æ®æ»¡äº†å†å¼€ä¸€ä¸ªbaseï¼Œéžå¸¸åŽšé“ã€‚æ”¶è´¹ç‰ˆæœ¬æ˜¯æŒ‰ç…§æ¯workspaceä»¥åŠworkspaceä¸­çš„ç”¨æˆ·æ•°æ¥è®¡ç®—è´¹ç”¨ï¼Œè®°å½•æ•°å’Œç©ºé—´æ›´å¤§ï¼Œå…·å¤‡é«˜çº§åŠŸèƒ½ï¼Œé¦–æ¬¡æ³¨å†Œå¯è¯•ç”¨15å¤©proç‰ˆã€‚ ä¸ŽexcelåŒºåˆ« Airtableå’Œexcelè™½ç„¶æœ‰ç›¸ä¼¼åŠŸèƒ½ï¼Œä½†è®¾è®¡ç†å¿µå®Œå…¨ä¸åŒäºŽexcelã€‚Airtableçš„baseå’Œæ•°æ®åº“å¾ˆåƒï¼Œå…¶ä¸­æ¯ä¸ªtableï¼Œæ¯ä¸€åˆ—æœ‰å›ºå®šç±»åž‹å’Œå«ä¹‰ï¼Œè€Œexcelå°±æ˜¯äºŒç»´çš„å•å…ƒæ ¼ï¼Œå¯éšå¿ƒæ‰€æ¬²ç¼–è¾‘ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼ŒAirtableå’Œexcelåœ¨å…¬å¼çš„ä½¿ç”¨ä¸Šå­˜åœ¨å¾ˆå¤§ä¸åŒï¼Œä¾‹å¦‚ï¼š Airtableçš„å…¬å¼æ˜¯å®šä¹‰åœ¨åˆ—ä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨åœ¨åˆ—çš„æ‰€æœ‰å•å…ƒæ ¼ï¼Œè€Œexcelçš„æ¯ä¸ªå•å…ƒæ ¼å¯ä»¥å®šä¹‰ä¸åŒçš„å…¬å¼ï¼› Airtableçš„å…¬å¼ä¸èƒ½è·¨tableï¼Œéœ€è¦å€ŸåŠ©å…³è”è¡¨å®žçŽ°è·¨tableï¼Œå¹¶ä¸”å…¬å¼æ€»æ˜¯è®¿é—®æœ¬è¡Œæ•°æ®ï¼Œè€Œexcelçš„å…¬å¼å¯ä»¥è®¿é—®å…¶ä»–sheetæ•°æ®ï¼Œä¹Ÿå¯ä»¥è®¿é—®æœ¬sheetä»»æ„å•å…ƒæ ¼æ•°æ®ã€‚ å®žé™…ä¸ŠAirtableä¸æ˜¯ä¸€ä¸ªåœ¨çº¿excelï¼Œå®ƒæ›´åƒä¸€ä¸ªå¼€å‘å¹³å°ï¼Œå‡¡æ˜¯åŸºäºŽå…³ç³»æ•°æ®çš„ä¿¡æ¯å¤„ç†ç³»ç»Ÿï¼Œéƒ½å¯ä»¥ç”¨å®ƒå®žçŽ°ã€‚ ä¸»è¦åŠŸèƒ½ è§†å›¾ ç”¨äºŽå±•çŽ°å’Œæ“ä½œè¡¨çš„ç•Œé¢ï¼Œæœ‰Gridã€Formã€Calendarã€Gallervã€Kanbanå‡ ç§ï¼ŒGridæ˜¯æœ€å¸¸ç”¨çš„ï¼Œæ–°å»ºtableæ—¶é»˜è®¤å»ºç«‹ä¸€ä¸ªGridè§†å›¾ã€‚ä¸€ä¸ªtableå¯ä»¥å»ºå¤šä¸ªè§†å›¾ã€‚Gridè§†å›¾ä¸­æœ‰è¿‡æ»¤ã€åˆ†ç»„ã€æŽ’åºã€ç€è‰²ç­‰åŠŸèƒ½ã€‚è¿‡æ»¤ä¸åƒexcelé‚£æ ·åœ¨åˆ—ä¸Šæ“ä½œï¼Œæ„Ÿè§‰æ²¡æœ‰excelæ–¹ä¾¿ï¼Œæ¯ä¸ªè§†å›¾å¯ä»¥è®¾ç½®ä¸åŒçš„è¿‡æ»¤æ¡ä»¶ã€‚ è¡¨å»ºæ¨¡å’Œæ•°æ®æ“ä½œ å°±åƒè®¾è®¡å…³ç³»æ•°æ®åº“ä¸€æ ·ï¼Œä½¿ç”¨Airtableæä¾›çš„å­—æ®µç±»åž‹ï¼Œå°†è¡¨åŠå…³è”è®¾è®¡å‡ºæ¥ã€‚å­—æ®µç±»åž‹å¤§æ¦‚æœ‰è¿™ä¹ˆå‡ ç±»ï¼š è¾“å…¥å­—æ®µï¼Œä¾‹å¦‚æ–‡æœ¬ã€æ•°å­—ã€é€‰æ‹©ã€checkboxç­‰ï¼› å…¬å¼å­—æ®µï¼Œæ˜¯åŸºäºŽå…¶ä»–å­—æ®µè®¡ç®—å‡ºæ¥çš„ï¼› è¡¨å’Œè¡¨ä¹‹é—´çš„å…³è”æ˜¯é€šè¿‡ç‰¹æ®Šçš„å­—æ®µç±»åž‹Link to another recordå»ºç«‹ï¼ŒåŸºäºŽå…³è”å­—æ®µå¯ä»¥åšä¸€äº›æŸ¥æ‰¾å’Œèšåˆè®¡ç®—ï¼ŒåŒ…æ‹¬rollupã€lookupå’Œcountå‡ ä¸ªå­—æ®µç±»åž‹ï¼Œå¯ä»¥å®žçŽ°ä¸°å¯Œçš„æŠ¥è¡¨ç»Ÿè®¡ï¼› å¦å¤–è¿˜æœ‰è‡ªå¢žã€åˆ›å»ºæ—¶é—´ã€æœ€åŽæ›´æ–°æ—¶é—´ç­‰æœ‰ç”¨çš„å­—æ®µç±»åž‹ã€‚ blocks å¯ä»¥ç†è§£æˆåŸºäºŽä¸Šè¿°è¡¨çš„å°åº”ç”¨ã€‚ä¸»è¦æœ‰å¯è§†åŒ–ã€æ•°æ®æ“ä½œã€æŠ¥è¡¨ç­‰åº”ç”¨ã€‚æ„Ÿè§‰ä¸‹ä¸€æ­¥ä¼šåšæˆå¼€æ”¾å¹³å°ï¼Œç¬¬ä¸‰æ–¹ä¹Ÿå¯ä»¥å¼€å‘blocksï¼Œæ‹­ç›®ä»¥å¾…ã€‚ åä½œ Ownerå¯ä»¥é‚€è¯·å…¶ä»–äººä¸€èµ·ååŒå·¥ä½œï¼Œå¯åŸºäºŽworkspaceçº§åˆ«æˆ–baseçº§åˆ«ï¼Œä¸èƒ½åŸºäºŽè¡¨çº§åˆ«ã€‚ååŒè€…æœ‰Creatorã€Editorã€Commenterã€Read onlyå‡ ç§è§’è‰²ï¼Œæƒé™ç”±é«˜åˆ°ä½Žã€‚ååŒç¼–è¾‘æ—¶å¯ä»¥å®žæ—¶çœ‹åˆ°å…¶ä»–äººç¼–è¾‘è¿‡ç¨‹ï¼Œå¾ˆé…·çš„ä½“éªŒã€‚ æ¨¡æ¿ ä¹Ÿå°±æ˜¯é¢„å®šä¹‰å¥½çš„è¡¨æ¨¡åž‹ï¼Œåˆ›å»ºbaseæ—¶é€‰æ‹©ï¼Œå¼€ç®±å³ç”¨ã€‚ ç†è§£è¡¨çš„å…³è” è¡¨çš„å…³è”æ˜¯å®žçŽ°å¤æ‚çš„æŠ¥è¡¨ç»Ÿè®¡çš„å…³é”®ã€‚ ä¸»é”® æ¯ä¸ªè¡¨çš„ç¬¬ä¸€åˆ—æ€»æ˜¯ä¸»é”®ï¼Œä¸èƒ½ç§»åŠ¨æˆ–åˆ é™¤ã€‚ä¸»é”®å€’ä¸æ˜¯è¯´å†…å®¹å¿…é¡»å”¯ä¸€ï¼Œè€Œæ˜¯åœ¨å…³è”è¡¨å­—æ®µé€‰æ‹©æ—¶å‘ˆçŽ°çš„å°±æ˜¯ä¸»é”®çš„å†…å®¹ï¼Œæœ€å¥½èƒ½å¤ŸåŒºåˆ†ä¸åŒçš„è¡Œï¼Œä½†ä¸æ˜¯å¼ºåˆ¶çš„ã€‚å®žé™…ä¸ŠAirtableå†…éƒ¨æœ‰æ¯ä¸€è¡Œçš„å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥é€šè¿‡å…¬å¼RECORD_ID()èŽ·å–ã€‚ Link to another recordå­—æ®µç±»åž‹ å»ºç«‹Aè¡¨åˆ°Bè¡¨çš„å…³è”ï¼Œæ˜¯åœ¨Aè¡¨ä¸­å»ºç«‹ä¸€ä¸ªLink to another recordç±»åž‹å­—æ®µï¼Œå¹¶é€‰æ‹©Bè¡¨ã€‚é‚£ä¹ˆåœ¨ç¼–è¾‘æ­¤å­—æ®µä¼šå¼¹å‡ºé€‰æ‹©ç•Œé¢åˆ—å‡ºBè¡¨çš„æ‰€æœ‰è®°å½•ã€‚æ­¤å­—æ®µå¯ä»¥è®¾ç½®æ˜¯å¦å…è®¸å¤šé€‰ï¼Œå¦‚æžœå¦ï¼Œåˆ™åªèƒ½é€‰æ‹©ä¸€æ¡è®°å½•ï¼Œé‚£ä¹ˆAå’ŒBå°±æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ã€‚å¦‚æžœå…è®¸å¤šé€‰ï¼Œé‚£ä¹ˆAå’ŒBå°±æ˜¯å¤šå¯¹å¯¹çš„å…³ç³»ã€‚Aä¸­å»ºç«‹å…³è”å­—æ®µåŽï¼ŒBè¡¨ä¸­ä¹Ÿä¼šè‡ªåŠ¨å»ºç«‹ä¸€ä¸ªå…³è”å­—æ®µå’ŒAå…³è”ï¼Œè¿™ä¸ªå­—æ®µé»˜è®¤æ˜¯å…è®¸å¤šé€‰çš„ã€‚ä¸¤è¾¹æ˜¯è”åŠ¨çš„ï¼Œéƒ½å¯ä»¥è¿›è¡Œç¼–è¾‘ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°†ä¸€è¾¹éšè—æŽ‰ï¼Œæ€»æ˜¯ä»Žå¦ä¸€è¾¹è¿›è¡Œç¼–è¾‘ã€‚ rollupã€lookupã€countå­—æ®µç±»åž‹ è¿™å‡ ä¸ªå­—æ®µç±»åž‹å¿…é¡»å…ˆå»ºç«‹Link to another recordå­—æ®µï¼Œé€šè¿‡Link to another recordå­—æ®µçš„å†…å®¹è¿›è¡ŒæŸ¥è¯¢æˆ–è®¡ç®—ã€‚ lookupå’Œrollupæ˜¯é’ˆå¯¹å…³è”çš„è¡¨ä¸­ç›¸å…³è®°å½•çš„æŸä¸ªå­—æ®µï¼Œé€‰æ‹©Link to another recordå­—æ®µå­—æ®µåŽè¿˜éœ€è¦é€‰æ‹©å…³è”è¡¨çš„æŸä¸ªå­—æ®µï¼ŒåŒºåˆ«æ˜¯rollupè¿˜å¯ä»¥æ‹©åº”ç”¨ä¸€äº›èšåˆå‡½æ•°ï¼Œä¾‹å¦‚SUMã€MAXç­‰ï¼› lookupå’Œrollupåªèƒ½å¯¹å…³è”è¡¨çš„ä¸€ä¸ªå­—æ®µè¿›è¡Œç»Ÿè®¡ï¼Œå¦‚æžœå¸Œæœ›ä½œç”¨äºŽå¤šä¸ªå­—æ®µï¼Œå¯ä»¥åœ¨å…³è”è¡¨ä¸­å»ºç«‹ä¸€ä¸ªå…¬å¼å­—æ®µå…ˆæŠŠå¤šä¸ªå­—æ®µç»„åˆåœ¨ä¸€èµ·ï¼› countåªéœ€é€‰æ‹©å“ªä¸ªLink to another recordå­—æ®µï¼Œç»Ÿè®¡é€‰æ‹©çš„ä¸ªæ•°ï¼Œå…¶å®žç”¨rollupä¹Ÿå¯ä»¥å®žçŽ°ï¼Œç›¸å¯¹äºŽæ˜¯å¯¹rollupçš„ç‰¹åŒ–ã€‚ å€¼ç±»åž‹ ä¸Šè¿°å­—æ®µçš„å€¼ç±»åž‹ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ²¡æœ‰æ‰¾åˆ°æ˜Žç¡®è¯´æ˜Žï¼Œé€šè¿‡æµ‹è¯•éªŒè¯ç»“æžœå¦‚ä¸‹ï¼š Link to another record å…¬å¼å­—æ®µè®¿é—®æ—¶ä¸ºå­—ç¬¦ä¸²ï¼Œå¦‚æžœæ˜¯å¤šé€‰ï¼Œåˆ™æ˜¯&quot;, &quot;åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚å¦‚æžœè¦ç»Ÿè®¡å…¶ä¸ªæ•°ï¼Œä¸€ç§æ–¹æ³•æ˜¯å»ºç«‹countå­—æ®µï¼Œå¦ä¸€ä¸ªæ–¹æ³•æ˜¯é€šè¿‡å…¬å¼LEN({field})-LEN(SUBSTITUTE({fieldç»™},&quot;,&quot;,&quot;&quot;))+1 rollupå­—æ®µèšåˆå‡½æ•°è®¿é—®æ—¶ä¸ºæ•°ç»„ lookupï¼šåŒä¸Š rollupï¼šåŒèšåˆå‡½æ•°çš„è¿”å›žç±»åž‹ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªç‰¹åˆ«æ³¨æ„æ˜¯è¿”å›žçš„æ•°ç»„ç±»åž‹ï¼ŒåŒ…æ‹¬ARRAYCOMPACTã€ARRAYFLATTENã€ARRAYUNIQUEï¼Œå®ƒä»¬çš„è¿”å›žå€¼å¯ä»¥åº”ç”¨COUNTAå…¬å¼å¾—åˆ°æ•°ç»„é•¿åº¦ï¼Œå¦‚æžœéœ€è¦å½“æˆå­—ç¬¦ä¸²ä½¿ç”¨åˆ™è¦ä½¿ç”¨ARRAYJOINæˆ–CONCATENATEå…ˆè½¬æˆå­—ç¬¦ä¸²ã€‚é’ˆå¯¹æ•°ç»„ç±»åž‹ï¼Œæˆ‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œæƒ³æŠŠä¸¤ä¸ªæ•°ç»„è¿žæŽ¥èµ·æ¥ï¼Œå¹¶åŽ»æŽ‰é‡å¤å€¼ï¼ŒAirtableæä¾›äº†åŽ»é™¤æ•°ç»„é‡å¤å€¼çš„å…¬å¼ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›è¿žæŽ¥æ•°ç»„çš„å…¬å¼ï¼Œæ²¡æœ‰åŠžæ³•å®žçŽ°è¿™ä¸ªéœ€æ±‚ï¼Œæœ‰æ‰€é—æ†¾ã€‚ countï¼šæ•°å­— å®žçŽ°ç›®æ ‡ æˆ‘çš„å‡ºå‘ç‚¹å¾ˆç®€å•ï¼Œå¸Œæœ›å¤§å®¶æœ‰ä¸€ä¸ªç»Ÿä¸€çš„è§†å›¾ï¼Œéƒ½å¯ä»¥çœ‹åˆ°æœ‰å“ªäº›ä»»åŠ¡ï¼Œä»»åŠ¡çš„è¿›å±•çŠ¶æ€ã€‚åŒæ—¶èƒ½å¤Ÿé‡åŒ–æ˜¾ç¤ºå®ŒæˆçŽ‡ï¼Œå®Œæˆå¾—åˆ†ç­‰æ•°æ®å¹¶è¿›è¡ŒæŽ’åºï¼Œå½¢æˆå½¼æ­¤ä¹‹é—´çš„å¯¹æ¯”ï¼Œä»Žè€Œè®©å¤§å®¶æ¸…æ¥šåšä»€ä¹ˆå¹¶åŠªåŠ›è¾¾æˆç›®æ ‡ã€‚ ç»„ç»‡ç»“æž„ æˆ‘ç®¡ç†çš„å›¢é˜Ÿå…±26äººï¼Œæˆ‘å¸Œæœ›åˆ’åˆ†æˆè‹¥å¹²ä¸ªå°ç»„ï¼Œé€šè¿‡å°ç»„é•¿å¸®åŠ©æˆ‘ç®¡ç†å¥½ä»»åŠ¡ã€‚å°ç»„é•¿è¦è´Ÿè´£ä»»åŠ¡çš„è®¡åˆ’ã€è·Ÿè¸ªå’ŒçŠ¶æ€æ›´æ–°ã€‚ ç®¡äººæ–¹é¢ æˆ‘å¸Œæœ›çœ‹åˆ°æ¯ä¸ªäººçš„å·¥ä½œé‡åŠæŽ’åºï¼Œä»¥æ­¤ç¡®å®šä»»åŠ¡å®‰æŽ’æ˜¯å¦é¥±æ»¡å’Œå‡è¡¡ï¼› æˆ‘å¸Œæœ›çœ‹åˆ°æ¯ä¸ªäººçš„ä»»åŠ¡å®Œæˆæƒ…å†µå¾—åˆ†åŠæŽ’åºï¼Œè¿™ä¸ªå¾—åˆ†ä½“çŽ°äº†æ˜¯å¦æŒ‰æ—¶å®Œæˆï¼Œå®Œæˆè´¨é‡å¦‚ä½•ï¼Œä»¥æ­¤ç‰µå¼•å¤§å®¶æŒ‰æ—¶ä¿è´¨å®Œæˆä»»åŠ¡ï¼› æˆ‘å¸Œæœ›å›¢é˜Ÿç»„é•¿æ¯å‘¨æ±‡æŠ¥å›¢é˜Ÿç›¸å…³ä»»åŠ¡çš„è¿›å±•ï¼Œä»¥ä¾¿æˆ‘åŠæ—¶å‘çŽ°é—®é¢˜ï¼Œåšå‡ºè°ƒæ•´ï¼› ç®¡äº‹æ–¹é¢ ä»»åŠ¡æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯å¼€å‘ä»»åŠ¡ï¼Œä¸€ç§æ˜¯Bugå¤„ç†ä»»åŠ¡ï¼Œè¿™ä¸¤ç§æ˜¯å­˜åœ¨åŒºåˆ«çš„ï¼Œæˆ‘å¸Œæœ›éœ€è¦åŒºåˆ«å¯¹å¾…ï¼› æˆ‘å¸Œæœ›ä»»åŠ¡æ˜¯åˆ†çº§çš„ï¼Œç±»ä¼¼scrumçš„Epic-Theme-User Storyï¼Œæˆ‘åªå…³æ³¨é¡¶å±‚çš„ä»»åŠ¡ï¼Œå›¢é˜Ÿç»„é•¿å…³æ³¨ä¸‹çº§ä»»åŠ¡ï¼Œæˆ‘è§‰å¾—2çº§å°±å¤Ÿäº†ï¼Œè‡³äºŽä¸‹çº§ä»»åŠ¡æŒ‰ä»€ä¹ˆæ–¹å¼å®šï¼Œæ˜¯æŒ‰scrumçš„å›ºå®šå‘¨æœŸè¿­ä»£ï¼Œè¿˜æ˜¯é•¿ä»»åŠ¡ï¼Œä¸æ˜¯æˆ‘å…³å¿ƒçš„ï¼› æˆ‘å¸Œæœ›ä»Žé¡¶å±‚ä»»åŠ¡çš„è§†è§’èƒ½å¤Ÿçœ‹åˆ°å®ŒæˆçŽ‡åŠæŽ’åºï¼Œä»Žè€Œæ¸…æ¥šæ€»ä½“çš„ä»»åŠ¡å®Œæˆæƒ…å†µå¦‚ä½•ï¼› æˆ‘å¸Œæœ›ä»Žé¡¶å±‚ä»»åŠ¡çš„è§†è§’èƒ½å¤Ÿçœ‹åˆ°å·¥ä½œé‡åŠæŽ’åºï¼Œä»Žè€Œæ¸…æ¥šå·¥ä½œæŠ•å…¥çš„åˆ†å¸ƒï¼› æˆ‘å¸Œæœ›å…·ä½“ä»»åŠ¡è§†å›¾èƒ½å¤Ÿæœ‰ä¸€äº›æ˜Žæ˜¾æç¤ºä»»åŠ¡å¿«åˆ°æœŸæˆ–å·²ç»è¶…æ—¶ã€‚ åˆ›å»ºè¡¨ æˆ³è¿™é‡Œï¼Œè¿›å…¥æˆ‘åˆ†äº«çš„baseï¼Œè¯¦ç»†æŸ¥çœ‹å­—æ®µç±»åž‹å’Œå…¬å¼ï¼Œè¿˜å¯ä»¥å®žé™…ä½“éªŒä¸€ä¸‹ã€‚ æ ¹æ®ä»¥ä¸Šéœ€æ±‚ï¼Œé¦–å…ˆå»ºç«‹è¡¨ç»“æž„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ï¼ˆ1ï¼‰ä¸Šè¿°èšåˆå…³ç³»è¡¨ç¤ºå…³è”è¡¨ï¼Œn:1æ˜¯å•é€‰ï¼Œm:næ˜¯å¤šé€‰ï¼› ï¼ˆ2ï¼‰å›¢é˜Ÿå’Œæˆå‘˜è¡¨å®šä¹‰äº†å›¢é˜Ÿåˆ†ç»„ï¼› ï¼ˆ3ï¼‰Backlogæ˜¯ä¸€çº§ä»»åŠ¡ï¼Œä»»åŠ¡å’ŒBugæ˜¯äºŒçº§ä»»åŠ¡ï¼›å·¥ä½œé‡å’Œå®Œæˆä¿¡æ¯å®šä¹‰åœ¨äºŒçº§ä»»åŠ¡é‡Œé¢ï¼› ï¼ˆ4ï¼‰Backlogé€šè¿‡ä»»åŠ¡åˆ†ç±»è¡¨è¿›è¡Œä¸€ä¸ªåˆ†ç±»ï¼› ï¼ˆ5ï¼‰Bugçº§åˆ«è¡¨ä¸­å®šä¹‰äº†ä¸€äº›å‚æ•°ï¼Œç”¨äºŽè®¡ç®—Bugå·¥ä½œé‡ï¼› ï¼ˆ6ï¼‰ä»»åŠ¡å¯èƒ½ç”±å¤šä¸ªäººæ‰¿æ‹…ï¼Œä¾‹å¦‚å‰ç«¯å’ŒåŽç«¯éƒ½éœ€è¦å¼€å‘çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥åˆ†æ´¾ç»™å¤šä¸ªäººï¼›Bugåªèƒ½åˆ†æ´¾ç»™1ä¸ªäººï¼› ï¼ˆ7ï¼‰ä»»åŠ¡å’ŒBugä¸­çš„è´Ÿè´£äººï¼Œç”¨äºŽæç¤ºæ­¤äººè´Ÿè´£ä»»åŠ¡çš„åˆ›å»ºã€è·Ÿè¸ªæ›´æ–°åŠè¯„ä»·ï¼Œå®Œæˆè¡¨æ ¼çš„æ‰€æœ‰ç¼–è¾‘å·¥ä½œï¼Œç¼–è¾‘å·¥ä½œä¸èƒ½å¼€æ”¾ç»™æ‰€æœ‰æˆå‘˜ã€‚ä»»åŠ¡åˆ†æ´¾ç»™å¤šäººæ­£å¥½è·¨å›¢é˜Ÿæ—¶ï¼Œè´£ä»»äººç­‰äºŽåˆ›å»ºäººï¼Œå¦åˆ™ç­‰äºŽå›¢é˜Ÿè´Ÿè´£äººã€‚Bugçš„è´Ÿè´£äººå°±æ˜¯åˆ†æ´¾ç»™çš„å›¢é˜Ÿè´Ÿè´£äººï¼› ï¼ˆ8ï¼‰å‘¨æŠ¥çš„ç²’åº¦æ˜¯ä¸€çº§ä»»åŠ¡ï¼Œæ¯æ¡ä¸€çº§ä»»åŠ¡æ¯å‘¨æ±‡æŠ¥ä¸€æ¬¡ã€‚ æ€»ç»“å‡ ç‚¹ä½¿ç”¨æŠ€å·§ï¼š ï¼ˆ1ï¼‰ä¸‹æ‹‰é€‰æ‹©çš„å­—æ®µï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªtableï¼Œç„¶åŽä¸Žå…¶å…³è”ã€‚è¿™æ ·ä¸€æ¥å¯èƒ½å¢žåŠ å¯å®šåˆ¶æ€§ï¼Œæœ‰å˜åŒ–æ—¶ä¸ç”¨ä¿®æ”¹è¡¨å®šä¹‰ï¼Œåªéœ€ä¿®æ”¹è¡¨æ•°æ®ï¼ŒäºŒæ¥å¯ä»¥åŸºäºŽé€‰æ‹©å†…å®¹è¿›è¡Œç»Ÿè®¡ï¼› ï¼ˆ2ï¼‰éšè—å­—æ®µç”¨å¤„å¤§ï¼Œå°±åƒå˜é‡ä¸€æ ·ã€‚æœ‰æ—¶å¿…é¡»å€ŸåŠ©éšè—å­—æ®µæ‰èƒ½å®žçŽ°åŠŸèƒ½ï¼Œä¾‹å¦‚ç»Ÿè®¡å®ŒæˆçŽ‡ï¼Œä¸‹é¢ä¼šæœ‰ä»‹ç»ï¼›æœ‰æ—¶å¯ä»¥ç®€åŒ–å…¬å¼ï¼Œè¿˜èƒ½å¢žåŠ å¤ç”¨æ€§ï¼›è¿˜ä¾‹å¦‚è¿‡æ»¤åŠŸèƒ½ä¸èƒ½è¿›è¡Œå¤æ‚çš„é€»è¾‘ç»„åˆï¼Œåªèƒ½è¦ä¹ˆå…¨éƒ¨ä¸Žï¼Œè¦ä¹ˆå…¨éƒ¨æˆ–ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡å¢žåŠ éšè—çš„å…¬å¼å­—æ®µæ¥å®žçŽ°å¤æ‚é€»è¾‘ã€‚ æŒ‡æ ‡è®¾è®¡ å·¥ä½œé‡ç»Ÿè®¡ å¯¹äºŽä»»åŠ¡ï¼šç”±å›¢é˜Ÿè´Ÿè´£äººç»™å‡ºä»»åŠ¡ä¼°è®¡å·¥ä½œé‡ï¼Œå¦‚æžœä»»åŠ¡ç”±å¤šäººæ‰¿æ‹…ï¼Œåˆ™æ¯ä¸ªå–å¹³å‡å€¼ï¼Œç„¶åŽåœ¨æˆå‘˜è¡¨å’ŒBacklogè¡¨ä¸­å»ºç«‹rollupå­—æ®µï¼Œå¯¹ä»»åŠ¡è¡¨å·¥ä½œé‡è¿›è¡Œsumï¼Œå¾—åˆ°ä»»åŠ¡æ€»å·¥ä½œé‡ã€‚ å¯¹äºŽBugï¼šé‡‡ç”¨ç®€åŒ–å¤„ç†ï¼Œå·¥ä½œé‡ç›´æŽ¥å’ŒBugçº§åˆ«ç›¸å…³ï¼Œç­‰äºŽ{Bugçº§åˆ«æƒé‡}*{Bugå·¥ä½œé‡åŸºæ•°}ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å®šä¹‰åœ¨Bugçº§åˆ«è¡¨ä¸­ï¼ŒåŒæ ·åœ¨æˆå‘˜è¡¨å’ŒBacklogè¡¨ä¸­å»ºç«‹rollupå­—æ®µï¼Œå¯¹bugè¡¨å·¥ä½œé‡è¿›è¡Œsumï¼Œå¾—åˆ°Bugæ€»å·¥ä½œé‡ã€‚ å†åˆ†åˆ«å»ºç«‹å…¬å¼å­—æ®µï¼Œå°†ä¸Šè¿°ä¸¤ä¸ªå­—æ®µç›¸åŠ å¾—åˆ°æ€»å·¥ä½œé‡ã€‚ è¿™æ ·ä»Žæˆå‘˜è¡¨å’ŒBacklogè¡¨éƒ½å¯ä»¥çœ‹åˆ°æ±‡æ€»çš„å·¥ä½œé‡æƒ…å†µã€‚ è´Ÿè·çŽ‡ç»Ÿè®¡ ä¸»è¦é’ˆå¯¹ä»»åŠ¡ï¼Œè¡¡é‡æŸä¸ªäººçš„ä»»åŠ¡å®‰æŽ’æ˜¯å¦é¥±æ»¡åˆç†ï¼Œä½“çŽ°äº†å›¢é˜Ÿè´Ÿè´£äººä»»åŠ¡è®¡åˆ’çš„èƒ½åŠ›ã€‚åˆç†çš„è´Ÿè·çŽ‡åº”è¯¥æ˜¯æ¯”100%ç¨é«˜ï¼Œå¦‚æžœè´Ÿè·è¿‡é«˜é€šå¸¸æ˜¯ä¼°è®¡å·¥ä½œé‡è¿‡é«˜æˆ–è®¡åˆ’å®Œæˆæ—¶é—´ä¸åˆç†ï¼Œä¹Ÿæœ‰å¯èƒ½æ²¡æœ‰è€ƒè™‘ä¸€ä¸ªäººåˆ†æ´¾å¤šä¸ªä»»åŠ¡çš„å åŠ æƒ…å†µã€‚å¦‚æžœè´Ÿè·è¿‡ä½Žåªæœ‰ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯å®‰æŽ’ä»»åŠ¡è¿‡å°‘ã€‚ åœ¨ä»»åŠ¡è¡¨ä¸­å»ºç«‹å…¬å¼å­—æ®µè®¡ç®—ä»»åŠ¡å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡ä»Žå¼€å§‹åˆ°ç»“æŸæŒç»­çš„æ—¶é•¿ï¼Œè¿™é‡Œå°†åˆ›å»ºæ—¶é—´å½“æˆä»»åŠ¡å¼€å§‹æ—¶é—´ã€‚ 1IF(&#123;è®¡åˆ’å®Œæˆæ—¶é—´&#125;,(DATETIME_DIFF(&#123;è®¡åˆ’å®Œæˆæ—¶é—´&#125;,&#123;åˆ›å»ºæ—¶é—´&#125;,&quot;seconds&quot;)/(60*60*24)),0) ç„¶åŽå»ºç«‹å…¬å¼å­—æ®µï¼Œè®¡ç®—å¹³å‡æ—¥å·¥ä½œé‡ï¼Œå•ä½å°æ—¶ã€‚ 1IF(&#123;ä»»åŠ¡å‘¨æœŸ(å¤©)&#125;&lt;=0,0,IF(IS_AFTER(NOW(),&#123;è®¡åˆ’å®Œæˆæ—¶é—´&#125;),0,&#123;å¹³å‡å·¥ä½œé‡(å¤©)&#125;*8/&#123;ä»»åŠ¡å‘¨æœŸ(å¤©)&#125;)) ç„¶åŽåœ¨æˆå‘˜è¡¨ä¸­å»ºç«‹rollupå­—æ®µï¼Œå¯¹ä»»åŠ¡è¡¨çš„å¹³å‡æ—¥å·¥ä½œé‡sumï¼Œå¾—åˆ°è¿™ä¸ªäººçš„ä»»åŠ¡å¹³å‡æ—¥å·¥ä½œé‡ï¼Œæœ€åŽå»ºç«‹å…¬å¼å­—æ®µï¼Œå¾—åˆ°å¹³å‡ä»»åŠ¡è´Ÿè·çŽ‡ã€‚ 1&#123;ä»»åŠ¡å¹³å‡æ—¥å·¥ä½œé‡(å°æ—¶)&#125;/8 å®ŒæˆçŽ‡ç»Ÿè®¡ rollupçš„countèšåˆå‡½æ•°æ²¡æœ‰æ¡ä»¶è¿‡æ»¤ç‰¹æ€§ï¼Œæ‰€ä»¥æ²¡æ³•ä¸€æ­¥åˆ°ä½ï¼Œéœ€è¦å€ŸåŠ©ä¸­é—´å­—æ®µã€‚ é¦–å…ˆåœ¨ä»»åŠ¡è¡¨å’ŒBugè¡¨ä¸­å»ºç«‹å…¬å¼å­—æ®µï¼Œæ ¹æ®çŠ¶æ€è®¡ç®—æ˜¯å¦å®Œæˆï¼Œå®Œæˆåˆ™å¡«å…¥å€¼ï¼Œä¸ºå®Œæˆä¸ºç©ºã€‚ ç„¶åŽåœ¨æˆå‘˜è¡¨å’ŒBacklogè¡¨ä¸­å»ºç«‹rollupå­—æ®µï¼Œé€šè¿‡countaèšåˆå‡½æ•°è®¡ç®—å®Œæˆæ•°ï¼ŒåŒæ—¶å»ºç«‹countå­—æ®µè®¡ç®—æ€»æ•°ï¼Œæœ€åŽå»ºç«‹å…¬å¼å­—æ®µï¼Œå®Œæˆæ•°é™¤ä»¥æ€»æ•°ï¼Œå¾—åˆ°å®ŒæˆçŽ‡ã€‚ è¯„åˆ†ç³»ç»Ÿ è®¾è®¡è¯„åˆ†è§„åˆ™å¦‚ä¸‹ï¼š å¾—åˆ†={è¯„åˆ†}(åªæœ‰ä»»åŠ¡æœ‰ï¼ŒBugæ— ï¼ŒæŒ‰æ—¶å®Œæˆæ‰èƒ½å¾—åˆ°)+{å·¥ä½œé‡(å¤©)}(å®Œæˆæ‰èƒ½å¾—åˆ°)+{æå‰(å¤©)}(è´Ÿæ•°è¡¨ç¤ºè¶…æœŸï¼Œå®Œæˆæˆ–è¶…æœŸæ—¶å¼€å§‹è®¡å…¥) è¯„åˆ†ä½“çŽ°å®Œæˆè´¨é‡ï¼Œå‰ææ˜¯æŒ‰æ—¶å®Œæˆæ‰èƒ½å¾—åˆ°ï¼Œè¶…æœŸä¸èƒ½å¾—åˆ°ï¼Œå›¢é˜Ÿè´Ÿè´£äººè¦å¯¹ä»»åŠ¡è¿›è¡ŒéªŒæ”¶ï¼ŒéªŒæ”¶é€šè¿‡æ‰èƒ½è§†ä¸ºå®Œæˆï¼›å·¥ä½œé‡ä½“çŽ°å·¥ä½œä»˜å‡ºï¼Œå¿…é¡»å®Œæˆæ‰èƒ½å¾—åˆ°ï¼Œä¹Ÿå°±è¯´è¦è´Ÿè´£åˆ°åº•ï¼›æå‰ä½“çŽ°äº†é¼“åŠ±å¤§å®¶å¢žé‡ä»˜å‡ºã€‚è¯„åˆ†è§„åˆ™çš„ç‰µå¼•æ–¹å‘æ˜¯æŒ‰æ—¶å®Œæˆä»»åŠ¡ï¼Œé¼“åŠ±æå‰ï¼Œæå‰æœ‰åŠ åˆ†ï¼Œè¶…æœŸæœ‰æ‰£åˆ†ã€‚ å¯¹äºŽä»»åŠ¡ æå‰ï¼š 1IF(&#123;è®¡åˆ’å®Œæˆæ—¶é—´&#125;,IF(&#123;Completed&#125;,DATETIME_DIFF(&#123;è®¡åˆ’å®Œæˆæ—¶é—´&#125;,&#123;çŠ¶æ€æœ€åŽæ›´æ–°æ—¶é—´&#125;,&quot;s&quot;),DATETIME_DIFF(&#123;è®¡åˆ’å®Œæˆæ—¶é—´&#125;,NOW(),&quot;s&quot;)),0) å¾—åˆ†ï¼š 1IF(AND(&#123;æå‰(ç§’)&#125;&gt;=0,&#123;Completed&#125;),&#123;è¯„åˆ†&#125;,0)+IF(&#123;Completed&#125;,&#123;å·¥ä½œé‡(å¤©)&#125;,0)+IF(OR(&#123;Completed&#125;,&#123;æå‰(ç§’)&#125;&lt;0),&#123;æå‰(ç§’)&#125;/(60*60*24),0) å¯¹äºŽBug æå‰ï¼š 1IF(&#123;è®¡åˆ’è§£å†³æ—¶é—´&#125;,IF(&#123;Resolved&#125;,DATETIME_DIFF(&#123;è®¡åˆ’è§£å†³æ—¶é—´&#125;, &#123;çŠ¶æ€æœ€åŽæ›´æ–°æ—¶é—´&#125;,&quot;s&quot;),DATETIME_DIFF(&#123;è®¡åˆ’è§£å†³æ—¶é—´&#125;,NOW(),&quot;s&quot;)),0) å¾—åˆ†ï¼š 1IF(&#123;Resolved&#125;,&#123;å·¥ä½œé‡(å¤©)&#125;,0)+IF(OR(&#123;Resolved&#125;,&#123;æå‰(ç§’)&#125;&lt;0),&#123;æå‰(ç§’)&#125;/(60*60*24),0) ç„¶åŽåœ¨æˆå‘˜è¡¨å’ŒBacklogè¡¨ä¸­é€šè¿‡rollupå­—æ®µå¯¹å¾—åˆ†è¿›è¡Œæ±‚å’Œæ±‡æ€»å°±å¾—åˆ°æ€»å¾—åˆ†ã€‚ æ€»ç»“ ä½ æ˜¯å¦ä¹Ÿå–œæ¬¢ä¸ŠAirtableï¼ŒçŸ­çŸ­æ•°å°æ—¶ä¹‹å†…ï¼Œä½ å°±å®Œå…¨å¯ä»¥æ‰“é€ ä¸€æ¬¾ä¸ºä½ é‡èº«å®šåšçš„è¡¨æ ¼ç³»ç»Ÿã€‚Airtableä¸­å·²ç»åŒ…å«è®¸å¤šé€‚ç”¨äºŽç‰¹æ€§ç”¨é€”çš„æ¨¡æ¿ï¼Œå¯ä»¥ç›´æŽ¥æ‹¿æ¥ä½¿ç”¨ï¼Œéžå¸¸æ–¹ä¾¿ã€‚ Airtableçš„ç»Ÿè®¡åŠŸèƒ½ä¸»è¦æ˜¯åŸºäºŽå…³è”è¡¨å’Œrollupç±»åž‹å­—æ®µï¼Œå…¶è®¾è®¡éžå¸¸ç®€æ´ï¼Œç”šè‡³ç®€é™‹ï¼Œèšåˆå‡½æ•°åŠŸèƒ½å¹¶ä¸ç®—ä¸°å¯Œï¼Œåªèƒ½åŸºäºŽä¸€åˆ—èšåˆï¼Œä½†æ˜¯å…¶è®¾è®¡åˆæ°åˆ°å¥½å¤„ï¼Œé€šè¿‡å˜é€šæŠ€å·§è¿˜æ˜¯å¯ä»¥å®žçŽ°å¤æ‚åŠŸèƒ½ã€‚å¦å¤–Airtableæä¾›äº†curlå’ŒJavaScriptæŽ¥å£ï¼Œå¯ä»¥é›†æˆç¬¬ä¸‰æ–¹å·¥å…·å®žçŽ°æ›´åŠ å¤æ‚çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å’ŒIFTTTæˆ–Zapieré›†æˆã€‚ å½“ç„¶Airtableä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå®ƒå¹¶ä¸èƒ½å–ä»£é¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªè¡¨æ ¼ç³»ç»Ÿï¼Œç¼ºä¹å¾ˆå¤šé¡¹ç›®ç®¡ç†å¿…è¦çš„ç‰¹æ€§ï¼Œä¾‹å¦‚å·¥ä½œæµç®¡ç†ç­‰ç­‰ã€‚æˆ‘ä¸»è¦æ˜¯åœ¨ç®¡ç†å›¢é˜Ÿä¸­ä½¿ç”¨Airtableï¼Œå…¶ä»–äººåªè¯»æŸ¥çœ‹ï¼Œå› ä¸ºç¼–è¾‘æƒé™æ˜¯baseç²’åº¦çš„ï¼Œä¸èƒ½æ”¾å¼€ç»™æ‰€æœ‰äººã€‚ä½†æ˜¯æˆ‘çš„éœ€è¦ä¹Ÿä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼Œæˆ‘åªéœ€è¦èƒ½å¤Ÿçµæ´»å®šåˆ¶å¹¶å‘ˆçŽ°åº¦é‡æŒ‡æ ‡ï¼ŒAirtableå®Œå…¨å¯ä»¥èƒœä»»ã€‚æ­¤å‰æˆ‘ä½¿ç”¨è¿‡JIRAã€Redmineè¿™ç±»é¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å­—æ®µï¼Œä½†æ˜¯æ²¡æœ‰å…¬å¼å’Œèšåˆç»Ÿè®¡è¿™ç§ç‰¹æ€§ï¼Œé€šå¸¸éœ€è¦é€šè¿‡æ’ä»¶å®žçŽ°ï¼Œæ‰€ä»¥å®šåˆ¶æ€§å—åˆ°å¾ˆå¤§é™åˆ¶ï¼ŒæœŸå¾…æœ‰ä¸€å¤©å®ƒä»¬èƒ½å¤Ÿå¸æ”¶Airtableçš„ç‰¹é•¿ï¼Œè®©é±¼ä¸Žç†ŠæŽŒå¯ä»¥å…¼å¾—ã€‚]]></content>
      <categories>
        <category>management</category>
      </categories>
      <tags>
        <tag>airtable</tag>
        <tag>software devemopement management</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœ‰ç”¨çš„c++å†…å­˜ç›¸å…³åº“]]></title>
    <url>%2F2020%2F02%2F06%2F025-useful-cpp-memory-related-libraries%2F</url>
    <content type="text"><![CDATA[c++å¯¹å†…å­˜çš„åŽŸå§‹æŽ§åˆ¶æ˜¯å…¶ä¼˜åŠ¿ï¼ŒåŒæ—¶å¸¦æ¥ä¸€ç³»åˆ—ç¾éš¾æ€§é—®é¢˜ï¼Œä¾‹å¦‚é‡ŽæŒ‡é’ˆé—®é¢˜ã€å†…å­˜æ³„æ¼é—®é¢˜ã€å†…å­˜ç¢Žç‰‡é—®é¢˜ï¼Œåœ¨c++ä¸–ç•Œè¿™æ˜¯éžå¸¸å¸¸è§è€Œæ£˜æ‰‹çš„é—®é¢˜ï¼Œå…¶å®žè¿™äº›é—®é¢˜æ—©æœ‰æˆç†Ÿåº”å¯¹æ–¹æ¡ˆï¼Œå°±ä»¥boostä¸ºä¾‹ï¼Œæ—©å°±åŒ…å«ç›¸å…³åº“ï¼Œæœ‰äº›å·²ç»æˆä¸ºc++æ ‡å‡†åº“ã€‚c++è§£å†³å†…å­˜æ–¹é¢çš„æŠ€æœ¯æœ‰ï¼š ï¼ˆ1ï¼‰æ™ºèƒ½æŒ‡é’ˆï¼šè§£å†³é‡ŽæŒ‡é’ˆã€å†…å­˜æ³„æ¼é—®é¢˜ï¼› ï¼ˆ2ï¼‰å†…å­˜æ± ï¼šæå‡å†…å­˜åˆ†é…æ•ˆçŽ‡ï¼Œè§£å†³å†…å­˜ç¢Žç‰‡é—®é¢˜ï¼› ï¼ˆ3ï¼‰flyweightï¼šè§£å†³å¤§é‡é‡å¤å¯¹è±¡å¯¹å†…å­˜çš„æµªè´¹ã€‚ ä¸‹é¢é€šè¿‡ä¸€äº›å®žä¾‹ä»‹ç»boostå¯¹ä¸Šè¿°æŠ€æœ¯çš„å®žçŽ°ã€‚ boostæ™ºèƒ½æŒ‡é’ˆ boostæ™ºèƒ½æŒ‡é’ˆå·²ç»æˆä¸ºc++11æ ‡å‡†ï¼Œæ˜¯æ—¶å€™å‘Šåˆ«è£¸æŒ‡é’ˆäº†ã€‚boostæ™ºèƒ½æŒ‡é’ˆåŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š æ™ºèƒ½æŒ‡é’ˆæ¨¡æ¿ç±» scoped_ptrï¼Œscoped_array shared_ptrï¼Œshared_arrayï¼ˆdeprecatedï¼‰ weak_ptr intrusive_ptr local_shared_ptr å®žç”¨å‡½æ•°å’Œç±» make_shared make_unique allocate_unique enable_shared_from_this pointer_to_other static_pointer_cast intrusive_ref_counter atomic_shared_ptr ä½¿ç”¨ç¤ºä¾‹ scoped_ptr scoped_ptré€‚ç”¨äºŽä½œç”¨åŸŸå†…çš„æŒ‡é’ˆç®¡ç†ï¼Œæ‰€æœ‰æƒä¸èƒ½è½¬ç§»å‡ºåŽ»ï¼Œè€Œæ ‡å‡†åº“ä¸­çš„unique_ptrå¯ä»¥è½¬ç§»ï¼Œè¿™æ˜¯ä¸¤è€…çš„ä¸»è¦åŒºåˆ«ã€‚ å…ˆçœ‹ä¸ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆçš„ä¾‹å­ï¼Œåœ¨æ¯ä¸ªé€€å‡ºæˆ–å¼‚å¸¸çš„åœ°æ–¹éœ€è¦ä¸åŽŒå…¶çƒ¦çš„æ£€æŸ¥åŠ¨æ€åˆ†é…çš„å¯¹è±¡æ˜¯å¦é‡Šæ”¾ï¼Œä¸€æ—¦æ¼æŽ‰ä¸€ä¸ªåœ°æ–¹å°±ä¼šå¯¼è‡´å†…å­˜æˆ–èµ„æºæ³„éœ²ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738void fun()&#123; int *pInt = NULL; try &#123; pInt = new int(1); bool bOk = false; //do something if (!bOk) &#123; if (pInt != NULL) &#123; delete pInt; pInt = NULL; &#125; return; &#125; //do something //maybe throw exception delete pInt; pInt = NULL; &#125; catch(...) &#123; if (pInt != NULL) &#123; delete pInt; pInt = NULL; &#125; &#125; return;&#125; ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ”¹å†™åŽçš„ä¾‹å­ï¼Œä¸ä½†ä»£ç æ›´åŠ ç®€æ´ï¼Œä¹Ÿå®Œå…¨æœç»äº†å†…å­˜æ³„éœ²çš„åŽé¡¾ä¹‹å¿§ã€‚ 1234567891011121314151617181920212223242526void fun()&#123; int *pInt = NULL; try &#123; boost::scoped_ptr&lt;int&gt; pInt(new int(1)); bool bOk = false; //do something if (!bOk) &#123; return; &#125; //do something //maybe throw exception &#125; catch(...) &#123; &#125; return;&#125; ä¸Šè¿°ä¾‹å­å……åˆ†ä½“çŽ°äº†æ™ºèƒ½æŒ‡é’ˆä¸­å¯¹RAIIï¼ˆresource acquisition is initializationï¼‰æ€æƒ³çš„è¿ç”¨ï¼Œç”±ä¸€ä¸ªä¸´æ—¶å¯¹è±¡æŒæœ‰è£¸æŒ‡é’ˆï¼Œåœ¨ä¸´æ—¶å¯¹è±¡é”€æ¯æ—¶åŒæ—¶é‡Šæ”¾è£¸æŒ‡é’ˆæŒ‡å‘çš„èµ„æºï¼Œè€Œç¼–è¯‘å™¨å¯ä»¥å¾ˆå¥½çš„ä¿è¯ä¸´æ—¶å¯¹è±¡åœ¨å„ç§æƒ…å†µä¸‹æ­£ç¡®çš„é”€æ¯ã€‚ä»Žscoped_ptrçš„åå­—å¯ä»¥çœ‹å‡ºï¼Œå®ƒåº”ç”¨äºŽç¦»å¼€æŸä¸ªä½œç”¨åŸŸåŽéœ€è¦èµ„æºè‡ªåŠ¨é‡Šæ”¾çš„åœºæ™¯ï¼Œå› æ­¤scoped_pträ¸åƒstd::auto_ptré‚£æ ·å…·æœ‰éš¾ä»¥ä½¿ç”¨çš„æ‰€æœ‰æƒè½¬è®©è¯­ä¹‰ï¼Œä¹Ÿä¸åƒshared_ptré‚£æ ·å…·æœ‰å…±äº«æ‰€æœ‰æƒè¯­ä¹‰ï¼Œå®ƒå°†èµ„æºçš„ç”Ÿå‘½å‘¨æœŸä»…ä»…é™å®šåœ¨æŸä¸ªä½œç”¨åŸŸå†…ï¼Œè¿™æ ·çš„è®¾è®¡ä½¿å®ƒæ„å›¾éžå¸¸æ˜Žç¡®å’Œç®€å•ï¼Œå®žé™…ä¸Šscoped_ptræ˜¯ä¸å¯å¤åˆ¶çš„ï¼Œå½“ç„¶å°±ä¸èƒ½åº”ç”¨åœ¨å®¹å™¨ä¸­ï¼Œå› ä¸ºå®ƒä¸éœ€è¦è½¬è®©æ‰€æœ‰æƒæˆ–å…±äº«æ‰€æœ‰æƒï¼Œå› æ­¤åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥é¿å…ä¸æ­£ç¡®çš„ä½¿ç”¨ï¼ˆä¸èƒ½å°†ä¸€ä¸ªscoped_ptrèµ‹å€¼æˆ–æ‹·è´æž„é€ ç»™å¦ä¸€ä¸ªscoped_ptrï¼Œä¹Ÿä¸èƒ½å°†scoped_ptrå­˜å‚¨åœ¨å®¹å™¨ä¸­ï¼‰ã€‚ é€‰æ‹©ä½¿ç”¨scoped_ptrè¿˜æ˜¯std::auto_ptrï¼Ÿscoped_ptrå’Œauto_ptrå¾ˆåƒï¼Œåªæ˜¯auto_ptrå¤šäº†æ‰€æœ‰æƒè½¬è®©è¯­ä¹‰ï¼Œä¾‹å¦‚å¯ä»¥ä½œä¸ºå‡½æ•°è¿”å›žå€¼ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä»–ä»¬éƒ½æ˜¯ç”¨æ ˆä¸Šçš„å¯¹è±¡ç®¡ç†å †ä¸Šçš„å¯¹è±¡ï¼Œéƒ½ä¸èƒ½å…±äº«æ‰€æœ‰æƒï¼Œå› æ­¤éƒ½ä¸èƒ½ä¿å­˜åœ¨å®¹å™¨ä¸­ï¼Œä½†æ˜¯scoped_pträ½œäº†ä¸¥æ ¼çš„æŽ§åˆ¶ï¼ˆèµ‹å€¼å’Œæ‹·è´æž„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼‰ï¼Œç¡®ä¿äº†ä½¿ç”¨è€…ä¸ä¼šè¯¯å…¥æ­§é€”ï¼Œè€Œå¯¹äºŽauto_ptrï¼Œåªè¦ä½ æ„¿æ„ï¼Œä½ è¿˜æ˜¯å¯ä»¥å°†å…¶æ”¾å…¥å®¹å™¨ä¸­ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æœ€å¥½ä½¿ç”¨scoped_ptrï¼Œå¦‚æžœä½ ç¡®å®žéœ€è¦æ‰€æœ‰æƒè½¬è®©è¯­ä¹‰ï¼Œå¯ä»¥ä½¿ç”¨auto_ptrï¼Œä½†å¿…é¡»éžå¸¸å°å¿ƒã€‚ shared_ptr ä¸ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆçš„ä¾‹å­ï¼š 1234567891011121314151617181920212223242526272829303132333435363738std::vector&lt;int *&gt; vecIntPtr;vecIntPtr.push_back(new int(1));vecIntPtr.push_back(new int(2));boost::mutex mtx;//thread1&#123; &#123; boost::mutex::scoped_lock lock(mtx); for(std::vector&lt;int *&gt;::iterator it = vecIntPtr.begin(); it != vecIntPtr.end(); ++it) &#123; delete *it; &#125; vecIntPtr.clear(); &#125;&#125;//thread2&#123; int *pInt = NULL; &#123; boost::mutex::scoped_lock lock(mtx); if (!vecIntPtr.empty()) &#123; pInt = *vecIntPtr.begin(); &#125; //maybe need long time if (pInt) &#123; *pInt = 3; &#125; &#125;&#125; ä½¿ç”¨shared_ptræ”¹å†™åŽï¼š 123456789101112131415161718192021222324252627282930313233343536typedef boost::shared_ptr&lt;int&gt; IntPtr;std::vector&lt;IntPtr&gt; vecIntPtr;vecIntPtr.push_back(IntPtr(new int(1)));vecIntPtr.push_back(boost::make_shared&lt;int&gt;(2));boost::mutex mtx;//thread1&#123; &#123; boost::mutex::scoped_lock lock(mtx); vecIntPtr.clear(); &#125;&#125;//thread2&#123; IntPtr pInt; &#123; boost::mutex::scoped_lock lock(mtx); if (!vecIntPtr.empty()) &#123; pInt = *vecIntPtr.begin(); &#125; &#125; //maybe need long time if (pInt) &#123; *pInt = 3; &#125;&#125; ä¸Šä¾‹å±•ç¤ºäº†å¤šçº¿ç¨‹æƒ…å½¢ä¸‹è®¿é—®åŒä¸€ä»½æŒ‡é’ˆçš„æƒ…å†µã€‚çœ‹å‡ºä¸¤ä»½ä»£ç ä¹‹é—´çš„åŒºåˆ«äº†å—ï¼Ÿ å‰é¢çš„ä»£ç éœ€è¦æ˜¾å¼çš„è°ƒç”¨deleteï¼Œè€ŒåŽé¢çš„ä»£ç ä¸éœ€è¦ï¼Œå…¶å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œåœ¨ä¸Šè¿°ç®€å•çš„ä¾‹å­ä¸­ï¼Œä¹Ÿè®¸ä½ è§‰å¾—ä¸å¯èƒ½å¿˜äº†delete æŒ‡é’ˆï¼Œä½†æ˜¯åœ¨æ›´å¤æ‚çš„ç³»ç»Ÿä¸­ï¼Œå¿˜äº†deleteæ˜¯å±¡è§ä¸é²œçš„ï¼Œè€ŒæŸ¥æ‰¾æ­¤ç±»é—®é¢˜éœ€è¦èŠ±è´¹é«˜æ˜‚çš„ä»£ä»·ï¼› å‰é¢çš„ä»£ç éœ€è¦åœ¨ä½¿ç”¨æŒ‡é’ˆçš„æ•´ä¸ªè¿‡ç¨‹åŠ é”ï¼Œå³ä½¿ä»Žå®¹å™¨ä¸­èŽ·å–äº†æŸä¸ªæŒ‡é’ˆï¼Œä»¥é˜²å…¶ä»–çº¿ç¨‹å°†å…¶åˆ é™¤ï¼Œåœ¨ä½¿ç”¨æŒ‡é’ˆçš„æ•´ä¸ªè¿‡ç¨‹éƒ½éœ€è¦åŠ é”ï¼Œå¦‚æžœè¿™ä¸ªè¿‡ç¨‹éžå¸¸è€—æ—¶ï¼Œé‚£ä¹ˆå¯èƒ½å¸¦æ¥ç³»ç»Ÿæ•ˆçŽ‡çš„ä½Žä¸‹ï¼Œè€ŒåŽé¢çš„ä»£ç ä»…ä»…æ˜¯åœ¨ä»Žå®¹å™¨èŽ·å–æŒ‡é’ˆçš„è¿‡ç¨‹éœ€è¦åŠ é”ï¼Œè¿™æ˜¯ç”±å®¹å™¨çš„æ€§è´¨å†³å®šçš„ï¼ŒSTLportå®¹å™¨ä¿è¯å¤šçº¿ç¨‹è¯»åŒä¸€ä¸ªå®¹å™¨æ˜¯å®‰å…¨çš„ï¼Œä½†ä¸ä¿è¯å¤šçº¿ç¨‹å†™åŒä¸€ä¸ªå®¹å™¨æ˜¯å®‰å…¨çš„ï¼Œå› æ­¤ä»Žå®¹å™¨èŽ·å–æŒ‡é’ˆçš„è¿‡ç¨‹å¿…é¡»äººä¸ºä¿è¯å…¶å®‰å…¨æ€§ï¼Œä½†æ˜¯ä¸€æ—¦èŽ·å–åˆ°äº†æŒ‡é’ˆï¼ŒåŽé¢å¯¹æŒ‡é’ˆçš„ä½¿ç”¨è¿‡ç¨‹å°±ä¸éœ€è¦åŠ é”äº†ï¼Œè¿™æ˜¯å¦‚ä½•ä¿è¯çš„å‘¢ï¼Œ shared_pträ¸ºæ¯ä¸ªè£¸æŒ‡é’ˆç»´æŠ¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œæ‰€æœ‰shared_ptrå¯¹è±¡ï¼ˆä¸´æ—¶å¯¹è±¡æˆ–å®¹å™¨ä¸­çš„å¯¹è±¡ï¼‰å…±äº«è£¸æŒ‡é’ˆå’Œè¿™ä¸ªå¼•ç”¨è®¡æ•°ï¼Œåˆ›å»ºä¸€ä¸ªshared_ptrå¯¹è±¡æ—¶å¼•ç”¨è®¡æ•°åŠ 1ï¼Œå¯¹è±¡é”€æ¯æ—¶å¼•ç”¨è®¡æ•°å‡1ï¼Œå½“å¼•ç”¨è®¡æ•°ä¸º0æ—¶å°±è¯´æ˜Žå·²ç»æ²¡æœ‰äººéœ€è¦æ­¤è£¸æŒ‡é’ˆäº†ï¼Œæ­¤æ—¶æ­£æ˜¯è£¸æŒ‡é’ˆç”Ÿå‘½ç»“æŸçš„æ—¶å€™ã€‚å› æ­¤åªè¦ä½ èŽ·å–äº†shared_ptrå¯¹è±¡ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¼•ç”¨è®¡æ•°å°±è‚¯å®šä¸å¯èƒ½ä¸º0ï¼Œæ‰€ä»¥ä½ å¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨æ­¤æŒ‡é’ˆã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šshared_ptrç¡®ä¿äº†æŒ‡é’ˆæœ¬èº«ä½¿ç”¨çš„å®‰å…¨ï¼ŒæŒ‡é’ˆå†…éƒ¨æ•°æ®çš„å®‰å…¨æ€§ä»éœ€è¦ä½¿ç”¨è€…è‡ªå·±æ¥ä¿è¯ï¼Œè¿™ä¸æ˜¯æ™ºèƒ½æŒ‡é’ˆå…³æ³¨çš„äº‹æƒ…ã€‚ å¦å¤–æ³¨æ„åˆ°boost::make_sharedçš„ä½¿ç”¨äº†å—ï¼Ÿä½¿ç”¨make_sharedä¸€æ–¹é¢å¯ä»¥åŽ»é™¤newçš„æ˜¾å¼è°ƒç”¨ï¼Œæ›´é‡è¦çš„æ˜¯å¯ä»¥èŽ·å¾—æ€§èƒ½çš„æå‡ï¼ˆåŽŸå› è§åŽï¼‰ï¼Œå»ºè®®å°½é‡ä½¿ç”¨make_sharedï¼Œå¦‚æžœç¼–è¯‘å™¨æ”¯æŒå³å€¼å¼•ç”¨ï¼Œmake_sharedå¯ä»¥å®Œç¾Žçš„å°†å‚æ•°ä¼ ç»™æž„é€ å‡½æ•°è€Œæ²¡æœ‰ä»»ä½•æ€§èƒ½çš„æŸå¤±ã€‚ å…³äºŽshared_ptrçš„ä½¿ç”¨æœ‰å‡ ç‚¹æ˜¯éœ€è¦æ³¨æ„çš„ï¼š ç¦æ­¢some_operation (boost::shared_ptr(new T), return_int_operation())ç”¨æ³•ï¼Œå› ä¸ºå‚æ•°æ±‚å€¼é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½å…ˆæ‰§è¡Œnew Tï¼Œç„¶åŽreturn_int_operation()ï¼Œç„¶åŽæž„é€ shared_ptrï¼Œå¦‚æžœreturn_int_operation()æŠ›å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºçŽ°å†…å­˜æ³„æ¼ï¼› é¿å…å¯¹shared_ptræ‰€ç®¡ç†å†…å­˜ç›´æŽ¥æ“ä½œï¼Œä»¥å…é‡å¤é‡Šæ”¾ï¼› å…³äºŽç±»åž‹è½¬æ¢ï¼Œåªè¦ T* èƒ½è¢«éšå¼åœ°è½¬æ¢åˆ° U*ï¼Œåˆ™ shared_ptr&lt;T&gt;å°±èƒ½è¢«éšå¼åœ°è½¬æ¢åˆ°shared_ptr&lt;U&gt;ã€‚ç‰¹åˆ«æ˜¯ï¼Œshared_ptr&lt;T&gt;éšå¼è½¬æ¢åˆ°shared_ptr&lt;T const&gt;ï¼Œå½“Uæ˜¯Tçš„ä¸€ä¸ªå¯è®¿é—®åŸºç±»çš„æ—¶å€™ï¼Œè¿˜èƒ½è½¬æ¢åˆ°shared_ptr&lt;U&gt;ï¼Œä»¥åŠè½¬æ¢åˆ°shared_ptr&lt;void&gt;ï¼Œå¦å¤–å¯ç”¨å¦‚ä¸‹å‡½æ•°ç±»åž‹è½¬æ¢ï¼š 12345678template&lt;class T, class U&gt;shared_ptr&lt;T&gt; static_pointer_cast(shared_ptr&lt;U&gt; const &amp; r); // never throwstemplate&lt;class T, class U&gt;shared_ptr&lt;T&gt; const_pointer_cast(shared_ptr&lt;U&gt; const &amp; r); // never throwstemplate&lt;class T, class U&gt;shared_ptr&lt;T&gt; dynamic_pointer_cast(shared_ptr&lt;U&gt; const &amp; r); // never throws æ‰€æœ‰å…±äº«åŒä¸€è£¸æŒ‡é’ˆçš„shared_ptrå¿…é¡»åŒæºï¼Œä¾‹å¦‚ä¸èƒ½å‡ºçŽ°å¦‚ä¸‹ä»£ç ï¼š 123int *p = new int(10); boost::shared_ptr&lt;int&gt; sp1(p); boost::shared_ptr&lt;int&gt; sp2(p); åº”è¯¥æ˜¯ï¼š 123int *p = new int(10); boost::shared_ptr&lt;int&gt; sp1(p); boost::shared_ptr&lt;int&gt; sp2 = sp1; ä¸è¦ç›´æŽ¥ä½¿ç”¨å®¹å™¨ä¸­çš„æ™ºèƒ½æŒ‡é’ˆã€‚ weak_ptr çœ‹å‡ºä¸‹é¢çš„ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜äº†å—ï¼Ÿåˆå§‹åŽä¸´æ—¶å¯¹è±¡fatherå’Œsonçš„å¼•ç”¨è®¡æ•°éƒ½æ˜¯2ï¼Œå½“fatherå’Œsoné”€æ¯åŽï¼Œå¼•ç”¨è®¡æ•°å˜ä¸º1ï¼Œä¹‹åŽå†ä¹Ÿæ²¡æœ‰å¯èƒ½å˜æˆ0äº†ï¼ŒäºŽæ˜¯äº§ç”Ÿäº†å†…å­˜æ³„éœ²ã€‚ 1234567891011121314151617181920class CFather;class CSon;typedef boost::shared_ptr&lt;CFather&gt; FatherPtr;typedef boost::shared_ptr&lt;CSon&gt; SonPtr;class CFather&#123;public: SonPtr m_son;&#125;;class CSon&#123;public: FatherPtr m_father;&#125;;FatherPtr father(new CFather);SonPtr son(new CSon);father-&gt;m_son = son;son-&gt;m_father = father; ä¸ºäº†è§£å†³å¾ªçŽ¯å¼•ç”¨å¸¦æ¥çš„å†…å­˜æ— æ³•é‡Šæ”¾çš„é—®é¢˜ï¼Œweak_pträº§ç”Ÿäº†ï¼Œåªè¦å°†å¾ªçŽ¯å¼•ç”¨ä¸­çš„ä¸€çŽ¯æ”¹ä¸ºweak_ptrï¼Œé—®é¢˜å°±è¿Žåˆƒè€Œè§£äº†ã€‚ 123456789101112131415161718192021222324252627282930class CFather;class CSon;typedef boost::shared_ptr&lt;CFather&gt; FatherPtr;typedef boost::shared_ptr&lt;CSon&gt; SonPtr;typedef boost::weak_ptr&lt;CSon&gt; SonWeakPtr;class CFather&#123;public: SonWeakPtr m_son;&#125;;class CSon&#123;public: FatherPtr m_father;&#125;;FatherPtr father(new CFather);SonPtr son(new CSon);father-&gt;m_son = son;son-&gt;m_father = father;//how to access weak_ptr&#123; SonPtr son = father-&gt;m_son.lock(); if (son) &#123; //do something &#125;&#125; æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š weak_ptrå¿…é¡»ç”±shared_ptræˆ–å…¶ä»–weak_ptråˆå§‹åŒ–ï¼Œweak_ptråªæ˜¯ä½œä¸ºshared_ptrçš„è§‚å¯Ÿè€…ï¼Œä¸ä¼šå¯¼è‡´shared_ptrçš„å¼•ç”¨è®¡æ•°åŠ 1ï¼› åœ¨æ¯æ¬¡ä½¿ç”¨æŒ‡é’ˆæ—¶ï¼Œè¿˜æ˜¯è¦èŽ·å–shared_ptrï¼Œæ–¹æ³•æ˜¯è°ƒç”¨lockæˆå‘˜å‡½æ•°ï¼Œå®žé™…ä¸Šï¼Œweak_ptræ²¡æœ‰é‡è½½*å’Œ-&gt;ï¼Œä¹Ÿæ²¡æœ‰æä¾›getæ¥èŽ·å–è£¸æŒ‡é’ˆï¼Œæ‰€ä»¥å®ƒæ˜¯å®‰å…¨çš„ã€‚ é‚£ä¹ˆé‡å†™åŽçš„ä»£ç ï¼Œæ˜¯ä¸æ˜¯è§£å†³äº†å†…å­˜æ³„éœ²çš„é—®é¢˜å‘¢ï¼Ÿåˆå§‹åŽfatherçš„å¼•ç”¨è®¡æ•°ä¸º2ï¼Œsonä¸º1ï¼Œsoné”€æ¯åŽå¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œä»Žè€Œä¼šé‡Šæ”¾sonæŒæœ‰çš„CSonæŒ‡é’ˆï¼ŒåŒæ—¶CSonçš„æˆå‘˜m_fatherä¹Ÿä¼šæžæž„ï¼Œfatherçš„å¼•ç”¨è®¡æ•°å˜ä¸º1ï¼Œfatheré”€æ¯åŽå¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œæœ€ç»ˆfatheræŒæœ‰çš„CFatheræŒ‡é’ˆå¾—åˆ°é‡Šæ”¾ã€‚ intrusive_ptr 123456789101112131415161718192021222324252627282930313233343536373839404142class CSharedObject&#123;public: CSharedObject() : m_ulCnt(0) &#123; &#125; void AddRef() &#123; InterlockedIncrement((long *)&amp;m_ulCnt); &#125; unsigned long ReleaseRef() &#123; return InterlockedDecrement((long *)&amp;m_ulCnt); &#125;private: unsigned long m_ulCnt;&#125;;class CMyObject : public CSharedObject&#123;&#125;;typedef boost::intrusive_ptr&lt;CMyObject&gt; MyObjectPtr; void intrusive_ptr_release(CMyObject *p)&#123; if (p-&gt;ReleaseRef() == 0) &#123; delete p; &#125;&#125;void intrusive_ptr_add_ref(CMyObject *p)&#123; p-&gt;AddRef();&#125; intrusive_ptrç”¨äºŽå­˜å‚¨å¸¦æœ‰ä¾µå…¥å¼å¼•ç”¨è®¡æ•°å¯¹è±¡çš„æŒ‡é’ˆï¼Œä½¿ç”¨æ—¶å®šä¹‰boost::intrusive_ptr&lt;T&gt;çš„åŒæ—¶ï¼Œè¿˜è¦å®šä¹‰void intrusive_ptr_add_ref(T*) å’Œvoid intrusive_ptr_release(T *)ï¼Œintrusive_pträ¿è¯éœ€è¦å¢žåŠ å¼•ç”¨è®¡æ•°æ—¶è°ƒç”¨intrusive_ptr_add_refï¼Œéœ€è¦å‡å°å¼•ç”¨è®¡æ•°æ—¶è°ƒç”¨intrusive_ptr_releaseã€‚ ä½¿ç”¨intrusive_ptrçš„ä¸»è¦åŽŸå› æœ‰ï¼š ä¸€äº›å·²æœ‰çš„ frameworks å’Œæ“ä½œç³»ç»Ÿæä¾›å¸¦æœ‰ä¾µå…¥å¼å¼•ç”¨è®¡æ•°çš„å¯¹è±¡ï¼› intrusive_ptr çš„å†…å­˜å ç”¨é‡å’Œç›¸åº”çš„è£¸æŒ‡é’ˆä¸€æ ·ï¼› intrusive_ptr&lt;T&gt; èƒ½å¤Ÿä»Žä»»æ„ä¸€ä¸ªç±»åž‹ä¸º T * çš„è£¸æŒ‡é’ˆæž„é€ å‡ºæ¥ã€‚ scoped_array 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// scoped_arraytypedef boost::scoped_array&lt;int&gt; IntArrayPtr;IntArrayPtr intArrayPtr(new int[10]);for (int i = 0; i &lt; 10; i++)&#123; intArrayPtr[i] = i;&#125;intArrayPtr[10] = 10; //no check// scoped_ptr to vectortypedef boost::scoped_ptr&lt;std::vector&lt;int&gt; &gt; IntArrayPtr;IntArrayPtr intArrayPtr(new std::vector&lt;int&gt;(10));for (int i = 0; i &lt; 10; i++)&#123; (*intArrayPtr)[i] = i;&#125;(*intArrayPtr)[10] = 10; //no checkintArrayPtr-&gt;at(10) = 10; //have check// shared_arraytypedef boost::shared_array&lt;int&gt; IntArrayPtr;IntArrayPtr intArrayPtr(new int[10]);for (int i = 0; i &lt; 10; i++)&#123; intArrayPtr[i] = i;&#125;intArrayPtr[10] = 10; //no check// shared_ptr to vectortypedef boost::shared_ptr&lt;std::vector&lt;int&gt; &gt; IntArrayPtr;IntArrayPtr intArrayPtr(new std::vector&lt;int&gt;(10));for (int i = 0; i &lt; 10; i++)&#123; (*intArrayPtr)[i] = i;&#125;(*intArrayPtr)[10] = 10; //no checkintArrayPtr-&gt;at(10) = 10; //have check scoped_arrayå’Œshared_arrayæ˜¯ä¸“é—¨ç®¡ç†ç”¨new T[]åˆ†é…çš„æŒ‡é’ˆçš„ï¼Œå®ƒä»¬éƒ½é‡è½½äº†[]æ“ä½œç¬¦ï¼Œæ²¡æœ‰é‡è½½*å’Œ-&gt;æ“ä½œç¬¦ï¼Œä½¿ç”¨scoped_arrayå’Œshared_ptrç¡®ä¿äº†åœ¨åˆ é™¤æ—¶ç›¸åº”çš„ä½¿ç”¨delete []ã€‚å®žé™…ä¸Šscoped_arrayå’Œshared_arrayå®Œå…¨å¯ä»¥ç”¨vectoræ¥ä»£æ›¿Cæ•°ç»„ï¼Œè§ä¸Šè¿°ç¤ºä¾‹ä»£ç ã€‚ åŽŸç† ç”¨ä¸€ä¸ªè‡ªå·±å®žçŽ°çš„ç®€å•ç‰ˆæœ¬æ¥è¯´æ˜Žä¸€ä¸‹shared_ptrçš„åŽŸç†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768template&lt;typename T&gt;class MySmartPtr&#123;public: T * operator -&gt;() const &#123; return m_pData; &#125; T &amp; operator *() &#123; return *m_pData; &#125; MySmartPtr() &#123; m_pData = NULL; m_piCnt = NULL; &#125; explicit MySmartPtr(T * pData) &#123; m_pData = pData; m_piCnt = new int(0); InterlockedIncrement((long*)m_piCnt); &#125; MySmartPtr &amp; operator=(const MySmartPtr &amp; other) &#123; if (this != &amp;other &amp;&amp; m_pData != other.m_pData) &#123; destroy(); m_pData = other.m_pData; m_piCnt = other.m_piCnt; InterlockedIncrement((long*)m_piCnt); &#125; return *this; &#125; MySmartPtr(const MySmartPtr &amp; other) &#123; m_pData = NULL; m_piCnt = NULL; *this = other; &#125; ~MySmartPtr() &#123; destroy(); &#125;private: void destroy() &#123; if (m_piCnt &amp;&amp; *m_piCnt &gt; 0) &#123; if (InterlockedDecrement((long*)m_piCnt) == 0) &#123; delete m_pData; m_pData = NULL; delete m_piCnt; m_piCnt = NULL; &#125; &#125; &#125; T *m_pData; int *m_piCnt;&#125;; æ™ºèƒ½æŒ‡é’ˆæ‰€è¿ç”¨çš„åŸºæœ¬åŽŸç†åŒ…æ‹¬ï¼š ï¼ˆ1ï¼‰ é‡è½½*å’Œ-&gt;æ“ä½œç¬¦ï¼Œæ˜¯å…¶ç”¨æ³•å’Œè£¸æŒ‡é’ˆçš„ä½¿ç”¨æ–¹æ³•ä¸€è‡´ï¼› ï¼ˆ2ï¼‰ æ™ºèƒ½æŒ‡é’ˆå¯¹è±¡çš„æžæž„å‡½æ•°ä¸­åˆ¤æ–­è£¸æŒ‡é’ˆæ˜¯å¦åˆ é™¤ï¼ŒRAIIæ€æƒ³çš„è¿ç”¨ï¼› ï¼ˆ3ï¼‰ shared_pträ½¿ç”¨ä¸€ä¸ªå…±äº«çš„å¼•ç”¨è®¡æ•°å†³å®šä½•æ—¶åˆ é™¤è£¸æŒ‡é’ˆï¼ˆè§ç¤ºä¾‹ï¼‰ã€‚ æ€§èƒ½ shared_ptrçš„æ€§èƒ½æ˜¯ä½¿ç”¨è€…æ¯”è¾ƒå…³å¿ƒçš„é—®é¢˜ã€‚è€Œè¿™ä¸ªé—®é¢˜ä¹Ÿæ—©å·²ç»è¿‡å¹¿æ³›çš„è®¨è®ºå’Œè¯•éªŒï¼Œé—®é¢˜çš„æ ¸å¿ƒé›†ä¸­åœ¨å¼•ç”¨è®¡æ•°çš„å®žçŽ°æ–¹å¼ï¼Œboostæ–‡æ¡£ä¸­è®°è¿°çš„ä¸€äº›å¼€å‘äººå‘˜æ‰€åšçš„è¯•éªŒï¼Œè¯•éªŒä¸­æµ‹è¯•äº†5ç§å®žçŽ°æ–¹å¼ï¼š Counted pointer using a heap allocated reference count, this is referred to as simple counted. Counted pointer using a special purpose allocator for the reference count - special counted. Counted pointer using an intrusive reference count - intrusive. Linked pointer as described above - linked. Cyclic pointer, a counted implementation using a std::deque for allocation with provision for weak pointers and garbage collection of cycles of pointers - cyclic. ä»Žä¸¤ä¸ªæ–¹é¢è¿›è¡Œäº†è¯•éªŒï¼š Two tests were run: the first aimed to obtain timings for two basic individual operations: Initial construction from raw pointer. An amortized copy operation consisting of half an assignment and half a copy construction - designed to reflect average usage. The second attempted to gain more insight into normal usage by timing the fill and sort algorithms for vectors and lists filled with the various smart pointers. è¯•éªŒçŽ¯å¢ƒï¼š on two compilers: MSVC 6.0 service pack 3, using default release optimization mode (/O2 - optimized for speed, no inlining of functions defined outside a class body unless specified as inline). gcc 2.95.2 using full optimization (-O3 -DNDEBUG). Additionally, generated pointer sizes (taking into account struct alignment) were compared, as were generated code sizes for MSVC mainly by manual inspection of generated assembly code - a necessity due to function inlining. All tests were run on a PII-200 running Windows NT version 4.0 ç¬¬ä¸€ä¸ªè¯•éªŒç»“æžœï¼š å•ä½ï¼šçº³ç§’ MSVC initialization copy operation simple counted 3000 +/- 170 104 +/- 31 special counted 1330 +/- 50 85 +/- 9 intrusive 1000 +/- 20 71 +/- 3 linked 970 +/- 60 136 +/- 10 cyclic 1290 +/- 70 112 +/- 12 dumb 1020 +/- 20 10 +/- 4 raw 1038 +/- 30 10 +/- 5 GCC initialization copy operation simple counted 4620 +/- 150 301 +/- 28 special counted 1990 +/- 40 264 +/- 7 intrusive 1590 +/- 70 181 +/- 12 linked 1470 +/- 140 345 +/- 26 cyclic 2180 +/- 100 330 +/- 18 dumb 1590 +/- 70 74 +/- 12 raw 1430 +/- 60 27 +/- 11 ç¬¬äºŒä¸ªè¯•éªŒç»“æžœï¼š å•ä½ï¼šç§’ GCC vector list fill sort fill sort simple counted 46.54 2.44 47.09 3.22 special counted 14.02 2.83 7.28 3.21 intrusive 12.15 1.91 7.99 3.08 linked 12.46 2.32 8.14 3.27 cyclic 22.60 3.19 1.63 3.18 raw 11.81 0.24 27.51 0.77 MSVC vector list fill sort fill sort simple counted 1.83 2.37 1.86 4.85 special counted 1.04 2.35 1.38 4.58 intrusive 1.04 1.84 1.16 4.29 linked 1.08 2.00 1.21 4.33 cyclic 1.38 2.84 1.47 4.73 raw 0.67 0.28 1.24 1.81 ç»“è®ºï¼š The timing results mainly speak for themselves: clearly an intrusive pointer outperforms all others and a simple heap based counted pointer has poor performance relative to other implementations. The selection of an optimal non-intrusive smart pointer implementation is more application dependent, however. Where small numbers of copies are expected, it is likely that the linked implementation will be favoured. Conversely, for larger numbers of copies a counted pointer with some type of special purpose allocator looks like a win. Other factors to bear in mind are: - Deterministic individual, as opposed to amortized, operation time. This weighs against any implementation depending on an allocator. Multithreaded synchronization. This weighs against an implementation which spreads its information as in the case of linked pointer. æ ¹æ®ä»¥ä¸Šè¯•éªŒå¯ä»¥çœ‹å‡ºç›¸æ¯”äºŽè£¸æŒ‡é’ˆï¼Œshared_ptræ€§èƒ½åœ°æŸå¤±ä¸»è¦æ¥è‡ªä¸¤æ–¹é¢ï¼šä¸€æ–¹é¢æ˜¯ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ—¶éœ€è¦é¢å¤–åˆ†é…å¼•ç”¨è®¡æ•°ï¼Œå¦ä¸€æ–¹é¢æ˜¯èµ‹å€¼æˆ–æ‹·è´æ—¶å¼•ç”¨è®¡æ•°çš„æ›´æ–°ç­‰ï¼Œè€Œå‰è€…çš„æŸå¤±æ˜¯ä¸»è¦çš„ã€‚è¯•éªŒç»“æžœè¡¨æ˜Žå¸¦æœ‰ä¾µå…¥å¼å¼•ç”¨è®¡æ•°çš„å®žçŽ°èƒœè¿‡å…¶ä»–å®žçŽ°ï¼Œä½†æ˜¯å¤§å¤šæ•°åº”ç”¨æ›´ä¾èµ–äºŽéžä¾µå…¥å¼å¼•ç”¨è®¡æ•°çš„å®žçŽ°ã€‚boost::shared_ptrå°±æ˜¯éžä¾µå…¥å¼å®žçŽ°ï¼Œå…¶é»˜è®¤å®žçŽ°å±žäºŽsimple countedï¼Œé€šè¿‡ä¼ å…¥è‡ªå®šä¹‰çš„åˆ†é…å™¨ï¼Œä¹Ÿå¯ä»¥å®žçŽ°special countedæ–¹å¼å¼•ç”¨è®¡æ•°ï¼Œé™¤éžå¯¹æ—¶é—´ç‰¹åˆ«å…³é”®çš„åº”ç”¨ï¼Œé»˜è®¤çš„å®žçŽ°å®Œå…¨å¯ä»¥æ»¡è¶³è¦æ±‚ã€‚å¦å¤–åœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨å·¥åŽ‚æ–¹æ³•boost::make_shared(æˆ–boost::allocate_shared)å¯ä»¥èŽ·å¾—å’Œä¾µå…¥å¼æŽ¥è¿‘çš„æ€§èƒ½ï¼Œå› ä¸ºboost::make_sharedä½¿ç”¨äº†ä¸€ä¸ªplacement newæ¥åˆ†é…Tï¼Œè¿™æ ·ç›¸å½“äºŽèŠ‚çœäº†åˆ†é…å¼•ç”¨è®¡æ•°çš„æ—¶é—´ã€‚å…³äºŽæ˜¯å¦å¯ä»¥å°†æ™ºèƒ½æŒ‡é’ˆä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’ï¼Œä¸Šè¿°è¯•éªŒä¸­çš„simple countedå®žçŽ°æ­£æ˜¯ç”¨äº†ä¸€ä¸ªé»˜è®¤çš„boost::shared_ptrï¼Œå…¶æ‹·è´çš„æ—¶é—´ç¡®å®žæ¯”è£¸æŒ‡é’ˆå¤šå¾ˆå¤šï¼ˆåœ¨PII-200æœºå™¨ä¸Šæ˜¯104çº³ç§’ï¼Œè£¸æŒ‡é’ˆæ˜¯10çº³ç§’ï¼‰ï¼Œä½†æ˜¯æ¯•ç«Ÿä¹Ÿæ˜¯çº³ç§’çº§åˆ«ï¼Œå®žé™…ä½¿ç”¨æ—¶çš„æ€§èƒ½æŸå¤±åº”è¯¥åŸºæœ¬è§‰å¯Ÿä¸åˆ°ã€‚boost::shared_ptrçš„é»˜è®¤å®žçŽ°æ˜¯é‡‡ç”¨lock-freeçš„æ•´æ•°åŽŸå­æ“ä½œè¿›è¡Œçš„å¼•ç”¨è®¡æ•°å¢žå‡ï¼Œè¯•éªŒå¹¶æœªè¯„ä¼°åœ¨å¤æ‚çš„å¤šçº¿ç¨‹æˆ–å¼‚æ­¥çŽ¯å¢ƒä¸­å¯¹ç³»ç»Ÿé€ æˆçš„æ€§èƒ½æŸå¤±ã€‚ boostå†…å­˜æ±  å†…å­˜æ± ç”¨äºŽç®¡ç†å¤§é‡å°å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åœ¨å †ä¸Šåˆ†é…ã€‚boostå†…å­˜æ± åŒ…å«å¦‚ä¸‹å†…å®¹ï¼š pool object_pool singleton_pool pool_allocator ä½¿ç”¨ç¤ºä¾‹ pool 1234567891011121314151617boost::pool&lt;&gt; FixSizeMemPool(sizeof(int), 32);int *pInt = (int *)FixSizeMemPool.malloc();FixSizeMemPool.free(pInt);pInt = (int *)FixSizeMemPool.malloc();FixSizeMemPool.ordered_free(pInt);int *pIntArray = (int *)FixSizeMemPool.ordered_malloc(10);FixSizeMemPool.ordered_free(pIntArray, 10);pIntArray = (int *)FixSizeMemPool.ordered_malloc(10);FixSizeMemPool.free(pIntArray, 10); boost::poolæ˜¯ç”¨æ¥å¿«é€Ÿåˆ†é…å›ºå®šå¤§å°å†…å­˜å¿«çš„å†…å­˜æ± ï¼Œæž„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¸Œæœ›ä»Žå†…å­˜æ± ä¸­æ¯æ¬¡èŽ·å–çš„åŒºå—(chunk)çš„å¤§å°ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ¯æ¬¡ç©ºé—´ä¸å¤ŸåŽå†æ¬¡åˆ†é…çš„åŒºå—ä¸ªæ•°ï¼ˆnext_chunk_numï¼‰ï¼Œä¸ºé»˜è®¤å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º 32ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨mallocæˆ–ordered_mallocæ—¶è¿›è¡Œç¬¬ä¸€æ¬¡åˆ†é…ï¼Œåˆ†é…èƒ½å®¹çº³next_chunk_numä¸ªåŒºå—çš„å†…å­˜å¿«(block)ï¼Œç„¶åŽå°†next_chunk_numä¹˜ä»¥2ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸‹ä¸€æ¬¡åˆ†é…çš„å†…å­˜å¿«èƒ½å®¹çº³çš„åŒºå—ä¸ªæ•°ç¿»å€ï¼Œä¾æ¬¡ç±»æŽ¨ã€‚mallocæ˜¯ä»Žå†…å­˜æ± ä¸­åˆ†é…ä¸€ä¸ªåŒºå—ï¼Œå¦‚æžœå¤±è´¥è¿”å›ž0ï¼›ordered_mallocæ˜¯ä»Žå†…å­˜æ± ä¸­åˆ†é…è¿žç»­çš„åŒºå—ï¼Œå¦‚æžœå¤±è´¥ä¹Ÿæ˜¯è¿”å›ž0ï¼›åˆ†é…çš„åŒºå—ä¸å†ä½¿ç”¨åŽé€šè¿‡freeè¿”è¿˜ç»™å†…å­˜æ± ï¼›ç‰¹åˆ«çš„ordered_freeä¿è¯å¯¹è¿”è¿˜åŽçš„ç©ºé—²åŒºå—æŽ’åºï¼Œä»¥ä¿è¯ä¹‹åŽä½¿ç”¨ordered_mallocåˆ†é…è¿žç»­åŒºå—çš„æœºä¼šæ›´å¤§ï¼Œæ‰€ä»¥ordered_freeçš„æ—¶é—´å¤æ‚åº¦ä¸æ˜¯O(1)ï¼Œå¦‚æžœä½ ç»å¸¸ä¼šä½¿ç”¨ordered_mallocï¼Œæœ€å¥½åœ¨é‡Šæ”¾æ—¶ä½¿ç”¨ordered_freeã€‚FixSizeMemPoolé”€æ¯æ—¶ä¿è¯æ‰€æœ‰åˆ†é…çš„å†…å­˜å¾—åˆ°é‡Šæ”¾ï¼Œå³ä½¿æ²¡æœ‰è°ƒç”¨freeæˆ–ordered_freeï¼Œä¹Ÿå› æ­¤boost::poolä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒä¸æ˜¯è®¾è®¡ç”¨æ¥å¤šä¸ªæ¨¡å—å…±äº«çš„ã€‚ object_pool 12345678910111213struct X&#123;public: X(int i) &#123; &#125;&#125;;boost::object_pool&lt;X&gt; ObjectPool(32);X *pX = ObjectPool.construct(1);ObjectPool.destroy(pX); boost::object_poolæ˜¯ä»Žboost::poolç»§æ‰¿è€Œæ¥ï¼Œæž„é€ å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°å³next_chunk_numï¼Œå’Œboost::poolçš„ä¸»è¦åŒºåˆ«æ˜¯boost::object_poolåœ¨èŽ·å–åˆ°åŒºå—åŽï¼Œä½¿ç”¨äº†ä¸€æ¬¡placement newå¯¹åŒºå—è¿›è¡Œäº†æž„é€ ï¼Œä¹‹åŽè¿”å›žäº†T *è€Œä¸æ˜¯void *ï¼Œè¿™æ˜¯é€šè¿‡è°ƒç”¨constructè¿›è¡Œçš„ï¼Œconstructé»˜è®¤æ”¯æŒ3ä¸ªå‚æ•°ï¼Œå¦‚æžœæƒ³ä¼ å…¥æ›´å¤šå‚æ•°ï¼Œéœ€è¦ä¿®æ”¹boost/pool/detail/pool_construct_simple.incæ–‡ä»¶ã€‚ç›¸åº”çš„è°ƒç”¨destroyï¼Œä¼šå…ˆè¿›è¡Œæžè´­ï¼Œç„¶åŽå›žæ”¶å†…å­˜ã€‚å½“ç„¶ä¹Ÿå¯ä»¥è°ƒç”¨malloc/freeï¼ˆæ²¡æœ‰ordered_malloc/ordered_freeï¼‰ï¼Œä½†ä¸æŽ¨èï¼Œå› ä¸ºObjectPoolåœ¨é”€æ¯æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨æ²¡æœ‰freeçš„åŒºå—çš„æžè´­å‡½æ•°ï¼Œå¦‚æžœåœ¨mallocåŽï¼Œç”¨æˆ·è‡ªå·±æ²¡æœ‰å¯¹åŒºå—è¿›è¡Œæž„é€ ï¼Œè€Œåˆæ²¡æœ‰è°ƒç”¨freeï¼Œé‚£ä¹ˆæœ€åŽåœ¨å…¶ä¸Šè°ƒç”¨ä¸€æ¬¡æžè´­å‡½æ•°å¯èƒ½äº§ç”Ÿé”™è¯¯ã€‚ singleton_pool 123456789101112131415struct MyPoolTag&#123;&#125;;typedef boost::singleton_pool&lt;MyPoolTag, sizeof(int)&gt; MyPool;int *pInt = (int *)MyPool::malloc();MyPool::free(pInt);int *pIntArray = (int *)MyPool::ordered_malloc(10);MyPool::ordered_free(pIntArray, 10);struct OtherPoolTag&#123;&#125;;typedef boost::singleton_pool&lt;OtherPoolTag, 10, boost::default_user_allocator_new_delete, boost::mutex, 32&gt; OtherPool; boost::singleton_poolæ˜¯è¢«è®¾è®¡ç”¨æ¥åœ¨å¤šä¸ªæ¨¡å—é—´å…±äº«çš„ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½¿ç”¨singletonæ¨¡å¼å®žçŽ°ï¼Œå¹¶ä¸”å…¶singletoné™æ€å¯¹è±¡ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½¿ç”¨singleton_poolæ—¶ä¸ç”¨å®šä¹‰å¯¹è±¡ï¼Œmalloc/ordered_malloc/free/ordered_freeéƒ½æ˜¯é™æ€çš„ï¼Œè°ƒç”¨æ–¹æ³•å’Œboost::poolç›¸åŒã€‚OtherPoolçš„å®šä¹‰å±•ç¤ºäº†boost::singleton_poolçš„å…¨è²Œï¼Œ10è¡¨ç¤ºè¯·æ±‚åŒºå—å¤§å°ï¼›boost::default_user_allocator_new_deleteä¸ºåˆ†é…å™¨ï¼Œé»˜è®¤å€¼ä¹Ÿæ˜¯å®ƒï¼Œç”¨æˆ·å¯å®šä¹‰å…¶ä»–çš„åˆ†é…å™¨ï¼›boost::mutexæ˜¯ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ä½¿ç”¨çš„é”ï¼Œé»˜è®¤ä¸ºdetails::pool::default_mutexï¼›32ä¸ºnext_chunk_numã€‚ pool_allocator 12345678910std::vector&lt;int, boost::pool_allocator&lt;int&gt; &gt; vecInt;for (int i = 0; i &lt; 10000; i++)&#123; vecInt.push_back(i);&#125;boost::singleton_pool&lt;boost::pool_allocator_tag, sizeof(int)&gt;::release_memory();std::vector&lt;int, boost::pool_allocator&lt;int, boost::default_user_allocator_new_delete, boost::mutex, 32&gt; &gt; otherVecInt; boost::pool_allocatoræä¾›äº†ç¬¦åˆæ ‡å‡†çš„åˆ†é…å™¨ï¼Œå¯ç”¨äºŽSTLå®¹å™¨ã€‚boost::pool_allocatorå†…éƒ¨å®žé™…æ˜¯ä½¿ç”¨singleton_poolè¿›è¡Œçš„å†…å­˜åˆ†é…ï¼Œæ‰€ä»¥å¦‚æžœæƒ³æ‰‹å·¥é‡Šæ”¾å†…å­˜å¯ä»¥åƒä¸Šä¾‹ä¸­ä½¿ç”¨boost::singleton_pool&lt;boost::pool_alocator_tag, sizeof(int)&gt;::release_memory()ã€‚ boostæ™ºèƒ½æŒ‡é’ˆå’Œå†…å­˜æ± çš„ç»“åˆä½¿ç”¨ 12345678910111213141516171819202122232425262728template &lt;typename T&gt;class SmartPool : public boost::noncopyable&#123;public: typedef boost::shared_ptr&lt;T&gt; SmartObjectPtr; SmartObjectPtr ConstructSmartObject() &#123; boost::mutex::scoped_lock lock(m_mtx); return SmartObjectPtr(m_objpool.construct(), boost::bind(&amp;SmartPool::DestroySmartObject, this, _1), boost::pool_allocator&lt;boost::detail::sp_counted_base&gt;()); &#125;private: void DestroySmartObject(T *p) &#123; m_objpool.destroy(p); &#125; boost::object_pool&lt;T&gt; m_objpool; boost::mutex m_mtx;&#125;;struct X&#123;&#125;;SmartPool&lt;X&gt; XSmartPool;SmartPool&lt;X&gt;::SmartObjectPtr objPtr = XSmartPool.ConstructSmartObject(); ä¸Šä¾‹å±•ç¤ºäº†å°†boostæ™ºèƒ½æŒ‡é’ˆå’Œå†…å­˜æ± ç»“åˆä½¿ç”¨çš„æ–¹æ³•ã€‚ä¸Šè¿°æ–¹æ³•çš„é™åˆ¶æ˜¯è¦æ±‚Xæœ‰é»˜è®¤æž„é€ å‡½æ•°ï¼Œå¦å¤–å¿…é¡»XSmartPoolåœ¨æ‰€æœ‰æ™ºèƒ½æŒ‡é’ˆä¹‹åŽé‡Šæ”¾ï¼Œå½“ç„¶è¿™ä¸¤ä¸ªé™åˆ¶æ˜¯æœ‰æ–¹æ³•è§£å†³çš„ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æƒ³ä¸€æƒ³ã€‚ åŽŸç† å¯¹äºŽå›ºå®šå¤§å°å†…å­˜æ± çš„å®žçŽ°åŽŸç†å¹¶ä¸å¤æ‚ï¼Œå³é¢„å…ˆåˆ†é…ä¸€äº›å†…å­˜å—ï¼Œæ¯ä¸ªå†…å­˜å¿«è¢«åˆ’åˆ†æˆç›¸åŒå¤§å°çš„åŒºå—ï¼Œè¿™äº›åŒºå—è¢«é“¾æŽ¥åœ¨ä¸€ä¸ªç©ºé—²é“¾æ¡ä¸­ï¼Œå½“è¦åˆ†é…å†…å­˜æ—¶ï¼Œä»Žç©ºé—²åŒºå—å¤´å–å‡ºä¸€ä¸ªï¼Œå¦‚æžœæ²¡æœ‰ç©ºé—²çš„ï¼Œåˆ™åˆ†é…æ–°çš„å†…å­˜å¿«ï¼Œå½“ä¸å†ä½¿ç”¨åŒºå—æ—¶ï¼Œå°†å…¶åŠ å…¥åˆ°ç©ºé—²é“¾è¡¨ä¸­å³å¯ï¼Œæ‰€ä»¥ä¿è¯äº†åˆ†é…å’Œé‡Šæ”¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¸¸é‡çš„ï¼ˆé™¤ç¬¬ä¸€æ¬¡åˆ†é…æˆ–ä¹‹åŽè¿½åŠ åˆ†é…æ—¶ï¼‰ï¼Œè‚¯å®šæ¯”ç›´æŽ¥ä½¿ç”¨newåˆ†é…è¦å¿«ã€‚boostå†…å­˜æ± çš„å¢žé•¿æ–¹å¼æ˜¯ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨malloc*æ—¶åˆ†é…ä¸€ä¸ªå†…å­˜å¿«ï¼Œå¯å®¹çº³è‹¥å¹²ï¼ˆå¯é…ï¼‰ä¸ªåŒºå—ï¼Œä»¥åŽæ¯æ¬¡ä¸å¤Ÿæ—¶ï¼Œå†åˆ†é…ä¸€ä¸ªå†…å­˜å¿«ï¼Œå¤§å°æ˜¯å‰ä¸€æ¬¡çš„ä¸¤å€ã€‚boostå†…å­˜æ± è¿˜æä¾›äº†åˆ†é…è¿žç»­åŒºå—çš„æŽ¥å£ï¼Œä¸ºäº†ä¿è¯æ¯æ¬¡åˆ†é…è¿žç»­åŒºå—æˆåŠŸçš„æœºä¼šæ›´å¤§ï¼Œåœ¨é‡Šæ”¾æ—¶æä¾›äº†æŽ’åºçš„é‡Šæ”¾æ–¹æ³•ï¼Œå½“ç„¶å…¶æ—¶é—´å¤æ‚åº¦å°±ä¸æ˜¯å¸¸é‡äº†ã€‚boostå†…å­˜æ± è¿˜ä¿è¯äº†å†…å­˜å¯¹é½ï¼Œå¯å¹¿æ³›é€‚ç”¨äºŽä¸åŒå¹³å°ã€‚ å†…å­˜å¸ƒå±€ 1234567891011121314151617 struct Pool&#123; void *firstBlock; void *firstFreeChunk;&#125;;struct Block&#123; union Chunk &#123; void *nextChunk; char chunk[chunk_size]; &#125; Chunks[chunk_num]; void *nextBlock; size_type nextBlockSize;&#125;; æ¯ä¸ªå†…å­˜å¿«ï¼ˆBlockï¼‰çš„å¸ƒå±€å¦‚ä¸Šæ‰€ç¤ºï¼ˆä¸Šè¿°ä»£ç ä»…æ˜¯ä¸ºäº†è¯´æ˜Žé—®é¢˜çš„ä¼ªä»£ç ï¼ŒçœŸå®žæºä»£ç å¹¶ä¸æ˜¯è¿™æ ·ï¼‰ï¼Œé¦–å…ˆæ˜¯è‹¥å¹²ä¸ªè¿žç»­çš„åŒºå—ï¼Œç„¶åŽæ˜¯ä¸‹ä¸€ä¸ªå†…å­˜å¿«çš„æŒ‡é’ˆï¼Œæœ€åŽæ˜¯ä¸‹ä¸€ä¸ªå†…å­˜å¿«çš„å¤§å°ã€‚è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ä¸ªæŠ€å·§æ˜¯å¤ç”¨äº†åŒºå—ä¸­çš„å†…å­˜å­˜å‚¨äº†ä¸‹ä¸€ä¸ªåŒºå—çš„æŒ‡é’ˆï¼Œå°†åŒºå—é“¾æŽ¥èµ·æ¥ã€‚ å†…å­˜å¯¹é½ boostå†…å­˜å¯¹é½ä½¿ç”¨äº†æœ€å°å…¬å€æ•°æ–¹æ³•ï¼ˆå…·ä½“æŽ¨å¯¼è¿‡ç¨‹è§boostæ–‡æ¡£ï¼‰ï¼Œä¿è¯äº†åœ¨å„ç§å¤æ‚çŽ¯å¢ƒä¸‹å†…å­˜çš„å¯¹é½ã€‚è¿™ä¸€ç‚¹ä¹Ÿæ˜¯æˆ‘ä»¬è‡ªå·±å®žçŽ°å†…å­˜æ± å®¹æ˜“å¿½è§†çš„ä¸€ä¸ªé—®é¢˜ã€‚ boost::flyweight åœ¨ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­æè¿°äº†flyweightæ¨¡å¼ï¼Œboost::flyweightå¾—åäºŽæ­¤ã€‚ ä½¿ç”¨ç¤ºä¾‹ 1234567891011121314151617181920212223242526struct user_entry&#123; std::string first_name; std::string last_name; int age;&#125;;struct user_entry&#123; boost::flyweight&lt;std::string&gt; first_name; boost::flyweight&lt;std::string&gt; last_name; int age;&#125;;user_entry ue1;ue1.first_name = "zhang";ue1.last_name = "xxx";user_entry ue2;ue2.first_name = "zhang";ue2.last_name = "yyy";user_entry ue3;ue3.first_name = "zhang";ue3.last_name = "yyy"; boost::flyweightçš„ä½¿ç”¨éžå¸¸ç®€å•ï¼Œå¤§å¤šæ•°æ—¶å€™åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹ç»“æž„ä½“çš„å®šä¹‰ï¼Œå°±èƒ½å¸¦æ¥å†…å­˜çš„èŠ‚çœï¼Œå½“å†—ä½™åº¦è¶Šå¤§æ—¶ï¼Œå†…å­˜èŠ‚çœè¶Šæ˜Žæ˜¾ï¼Œä¾‹å¦‚ä¸Šä¾‹ï¼Œä½¿ç”¨boost::flyweightåŽï¼Œå†…å­˜ä¸­åªæœ‰ä¸€ä»½â€œzhangâ€ï¼Œå½“æœ‰æˆåƒä¸Šä¸‡ä¸ªè¿™æ ·çš„å¯¹è±¡æ—¶ï¼Œå§“ç›¸åŒçš„æ¯”ä¾‹éžå¸¸å¤§ï¼Œè¿™æ ·å°±èƒ½èŠ‚çœå¾ˆå¤šå†…å­˜ã€‚]]></content>
      <categories>
        <category>c++</category>
      </categories>
      <tags>
        <tag>c++</tag>
        <tag>boost</tag>
        <tag>memory</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vscodeä¸­å¯¹pythonè¿›è¡Œä¿®æ”¹ç¬¦å·åé‡æž„æ—¶æ€»æ˜¯å¤±è´¥]]></title>
    <url>%2F2020%2F01%2F31%2F023-python-refactor-rename-failur-in-vscode%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨vscodeä¸­é‡æž„pythonä»£ç ï¼Œä¿®æ”¹ç¬¦å·åæ—¶æ€»æ˜¯å¤±è´¥ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š Refactor failed. expected string or buffer [(â€˜refactor.pyâ€™, 294, â€˜watchâ€™, â€˜self._process_request(self._input.readline())â€™), (â€˜refactor.pyâ€™, 275, â€˜_process_requestâ€™, â€œrequest[â€˜startâ€™]), request[â€˜nameâ€™], int(request[â€˜indent_sizeâ€™]))â€), (â€˜refactor.pyâ€™, 206, â€˜_renameâ€™, â€˜refactor.refactor()â€™), (â€˜refactor.pyâ€™, 117, â€˜refactorâ€™, â€˜self.onRefactor()â€™), (â€˜refactor.pyâ€™, 139, â€˜onRefactorâ€™, â€˜changes = renamed.get_changes(self._newName, task_handle=self.handle)â€™), (â€˜D:\Programs\Anaconda2\lib\site-packages\rope\refactor\rename.pyâ€™, 97, â€˜get_changesâ€™, 'new_content = rename_in_module(finder, new_name, resource=file)â€™), â€¦ ä»ŽæŠ¥é”™ä¸­å¯ä»¥çœ‹åˆ°é‡å‘½åç”¨åˆ°äº†ropeï¼ŒæŽ¨æµ‹å¯èƒ½æ˜¯ropeæœ‰bugï¼Œç»è¿‡ä¸€ç•ªå°è¯•ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ã€‚ æ–¹æ³•1 vscodeï¼š1.41.1 python extensionsï¼š2020.1.58038 ropeï¼š0.10.5 é»˜è®¤å®‰è£…çš„ropeç‰ˆæœ¬ä¸º0.10.5ï¼Œå°è¯•å‡çº§ropeï¼š $ pip install -U rope Collecting rope Using cached https://files.pythonhosted.org/packages/fa/a0/98c936091acad7fe96af3a945a5e4a1ddab9f4a2ba4e6eb56fe469c9457c/rope-0.16.0-py2-none-any.whl Installing collected packages: rope Found existing installation: rope 0.10.5 Uninstalling rope-0.10.5: Successfully uninstalled rope-0.10.5 Successfully installed rope-0.16.0 æœ€æ–°ç‰ˆæœ¬ä¸º0.16.0ï¼Œå†æ¬¡å°è¯•ä¿®æ”¹ç¬¦å·åï¼Œé—®é¢˜æ¶ˆå¤±ï¼Œè¯´æ˜Žropeç¡®å®žæœ‰bugï¼Œå·²ç»è§£å†³ã€‚ æ–¹æ³•2 python extensionsæœ‰ä¸¤ç§è¯­è¨€æœåŠ¡å™¨ï¼šjedi language serverå’Œmicrosoft python language serverï¼ŒåŽè€…æ˜¯2018.10å¼€å§‹æ–°åŠ å…¥ï¼Œæœªæ¥å°†å–ä»£å‰è€…ï¼Œç›®å‰é»˜è®¤ä¸ºå‰è€…ï¼Œå‰è€…æ­£æ˜¯ä½¿ç”¨ropeè¿›è¡Œçš„æ”¹åã€‚ å°è¯•åˆ‡æ¢åˆ°åŽè€…ï¼ŒåŽ»å‹¾é€‰jedi enabledã€‚ é‡å¯vscodeï¼Œä¼šè‡ªåŠ¨ä¸‹è½½microsoft python language serverï¼Œç­‰ä¸‹è½½å®ŒæˆåŽï¼Œå†æ¬¡å°è¯•ä¿®æ”¹ç¬¦å·åï¼Œé—®é¢˜æ¶ˆå¤±ï¼Œåœ¨æ–°çš„language serveræ²¡æœ‰æ­¤é—®é¢˜ã€‚ æ–°çš„language serverå‘å±•æ—¶é—´ä¸é•¿ï¼Œå¯èƒ½æ²¡æœ‰è€çš„ç¨³å®šï¼Œå¤§å®¶æ…Žé‡ä½¿ç”¨ã€‚]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>vscode</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[conanä¸€å¹´ä½¿ç”¨æ€»ç»“]]></title>
    <url>%2F2020%2F01%2F11%2F022-one-year-usage-summary-of-conan%2F</url>
    <content type="text"><![CDATA[å…³æ³¨C++çš„åŒ…ç®¡ç†æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä¸€ç›´éžå¸¸ç¾¡æ…•pythonã€javaçš„åŒå­¦ï¼Œæœ‰éžå¸¸å®Œå–„çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹åº“éžå¸¸æ–¹ä¾¿ã€‚2016å¹´åº•å¼€å§‹æŽ¥è§¦åˆ°conanï¼ŒåŽæ¥åˆå‘çŽ°vcpkgï¼Œä¸¤è€…éƒ½æ˜¯githubå¼€æºé¡¹ç›®ï¼Œå‰è€…åŽæ¥å¾—åˆ°jfrogçš„æ”¯æŒï¼Œå…¶artifactoryä¹Ÿå¢žåŠ äº†å¯¹conanåŒ…çš„æ”¯æŒï¼Œè€ŒåŽè€…æ˜¯å¤§ç‰Œmicrosoftç»´æŠ¤çš„ã€‚ conanå’Œvcpkgçš„å‡ºçŽ°ç»ˆäºŽè®©äººçœ¼å‰ä¸€äº®ï¼Œç»è¿‡1å¹´çš„å‘å±•ï¼Œåˆ°2018å¹´å®ƒä»¬ç›¸å¯¹æˆç†Ÿèµ·æ¥ï¼Œè€Œæˆ‘ä»¬çš„äº§å“ä¹Ÿæ€¥å‰§è†¨èƒ€ï¼Œè¿«åˆ‡éœ€è¦åŒ…ç®¡ç†çš„æœºåˆ¶ï¼Œå› æ­¤æˆ‘ä¸‹å®šå†³å¿ƒå°†åŒ…ç®¡ç†å¼•å…¥åˆ°äº§å“ä¸­ã€‚ åˆ°åº•é€‰æ‹©conanè¿˜æ˜¯vcpkgï¼Œæœ‰ä¸¤ç‚¹ä½¿æˆ‘ä»¬å¿…é¡»é€‰æ‹©conanï¼Œä¸€æ˜¯è·¨å¹³å°ï¼Œä¸ä»…è¦æ”¯æŒwindowsï¼Œè¿˜è¦æ”¯æŒlinuxï¼ŒäºŒæ˜¯è¦èƒ½è‡ªå»ºåŒ…æœåŠ¡å™¨ã€‚å½“æ—¶çš„vcpkgè¿˜åªèƒ½æ”¯æŒwindowsï¼Œå½“ç„¶åŽæ¥çš„ç‰ˆæœ¬ä¹Ÿæ”¯æŒlinuxäº†ï¼Œè€Œè‡ªå»ºåŒ…æœåŠ¡å™¨ï¼Œvcpkgä¸€ç›´éƒ½ä¸å¯ä»¥ã€‚åŽæ¥è¯æ˜Žè¿™ä¸ªé€‰æ‹©æ˜¯æ­£ç¡®çš„ã€‚ é¡¹ç›®èƒŒæ™¯ å…ˆè¯´ä¸‹æˆ‘ä»¬çš„äº§å“ï¼Œè¿™æ˜¯ä¸€ä¸ªCSç»“æž„é€šä¿¡è®¾å¤‡ç®¡ç†ç³»ç»Ÿï¼Œ2010å¹´å¼€å§‹ç ”å‘ï¼ŒæœåŠ¡ç«¯C++å®žçŽ°ï¼Œé‡‡ç”¨äº†åˆ†å¸ƒå¼è®¡ç®—æ¡†æž¶iceï¼Œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚æž¶æž„ä¸Šåˆ†ä¸ºå¹³å°å±‚å’Œäº§å“å±‚ï¼Œå¹³å°å±‚å®žçŽ°äº†ä¸€äº›å…¬å…±æ¡†æž¶å’ŒæœåŠ¡ã€‚æˆªæ­¢åˆ°2018å¹´ä¸­ï¼Œä»£ç è§„æ¨¡äº§å“å±‚è¾¾åˆ°188Wè¡Œï¼Œ86ä¸ªå·¥ç¨‹ï¼Œå¹³å°å±‚è¾¾åˆ°300Wè¡Œï¼Œ245ä¸ªå·¥ç¨‹ã€‚ æœ€åˆäº§å“å±‚å’Œå¹³å°å±‚çš„ä»£ç æ˜¯æ”¾åœ¨ä¸€ä¸ªSVNåº“é‡Œé¢çš„ï¼Œcmakeä¸ºä¸€ä¸ªVCè§£å†³æ–¹æ¡ˆï¼Œæ•´ä½“è¿›è¡Œç¼–è¯‘æ‰“åŒ…ã€‚è¿™ç§æ–¹å¼çš„å¼Šç«¯æ˜¾è€Œæ˜“è§ï¼Œå¹³å°å’Œäº§å“çš„è¾¹ç•Œå¾ˆå®¹æ˜“æ‰“ç ´ï¼Œæ¨¡å—é—´çš„ä¾èµ–å…³ç³»æ— æ³•æŽ§åˆ¶ï¼Œç”šè‡³ä¼šå‡ºçŽ°å¹³å°å¯¹äº§å“çš„ä¾èµ–ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»Ž2015å¹´å¼€å§‹å°±ä¸æ–­å¯¹å¼€å‘æž¶æž„è¿›è¡Œè°ƒæ•´ï¼Œç»åŽ†äº†ä¸¤ä¸ªé˜¶æ®µï¼š ï¼ˆ1ï¼‰SVNåˆ†ç¦»ï¼Œæ‹†åˆ†æˆäº§å“å’Œå¹³å°ä¸¤ä¸ªSVNï¼Œäº§å“å±‚é€šè¿‡SVNå¤–é“¾é“¾æŽ¥åˆ°å¹³å°å±‚SVNï¼Œä»Žäº§å“å±‚æ¥çœ‹è¿˜æ˜¯ä¸€ä¸ªå®Œæ•´çš„SVNã€‚å°†å¹³å°å±‚å¯¹å¤–å¤´æ–‡ä»¶å’Œåº“æ‹†åˆ†åˆ°å•ç‹¬ç›®å½•ï¼Œé€šè¿‡cmakeæ¨¡å—æŽ§åˆ¶å¹³å°å±‚ä¸èƒ½includeäº§å“å±‚å¤´æ–‡ä»¶ä¸”äº§å“å±‚åªèƒ½includeå¹³å°å±‚å¯¹å¤–å¤´æ–‡ä»¶ã€‚cmakeä¸ºäº§å“å±‚å’Œå¹³å°å±‚ä¸¤ä¸ªVCè§£å†³æ–¹æ¡ˆï¼Œåˆ†åˆ«å•ç‹¬ç¼–è¯‘ï¼› ï¼ˆ2ï¼‰è§£é™¤äº§å“å±‚å¯¹å¹³å°å¤–é“¾ï¼Œå¹³å°å±‚ç¼–è¯‘åŽå°†å¯¹å¤–å¤´æ–‡ä»¶å’Œåº“æ‰“åŒ…ä¸ºSDKåŽ‹ç¼©åŒ…ï¼Œå­˜æ”¾åœ¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œäº§å“å±‚å¼€å‘äººå‘˜ä¸‹è½½å¹³å°SDKåŽ‹ç¼©åŒ…åŽè§£åŽ‹åˆ°ç›¸åº”ç›®å½•ï¼Œç„¶åŽè¿›è¡Œäº§å“å±‚å¼€å‘ã€‚ æ­¤æ—¶åŸºæœ¬æŽ§åˆ¶ä½äº†äº§å“å’Œå¹³å°çš„ä»£ç è¾¹ç•Œï¼Œä½†æ˜¯ä»æœ‰è¯¸å¤šä¸ä¾¿å’Œé—®é¢˜ï¼š ï¼ˆ1ï¼‰äº§å“å±‚å¼€å‘äººå‘˜éœ€è¦æ‰‹åŠ¨ä¸‹è½½å¹³å°SDKåŽ‹ç¼©åŒ…ï¼Œä½¿ç”¨ä¸æ–¹ä¾¿ï¼Œè€Œä¸”ç‰ˆæœ¬å¯¹åº”å…³ç³»å®¹æ˜“å‡ºé”™ï¼› ï¼ˆ2ï¼‰å¹³å°å±‚ä»ç„¶æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œæ–°ç‰ˆæœ¬å¼€å‘éœ€è¦æ•´ä½“åˆ†æ”¯ï¼Œæ— æ³•åšåˆ°ç»†ç²’åº¦çš„å¤ç”¨ï¼Œè€Œä¸”æ€»æ˜¯æ•´ä½“ç¼–è¯‘æ‰“åŒ…ï¼Œéžå¸¸è€—æ—¶ï¼› ï¼ˆ3ï¼‰ç¬¬ä¸‰æ–¹åº“æ˜¯æ‰‹å·¥ç¼–è¯‘å¥½ä¹‹åŽå°†å¤´æ–‡ä»¶å’Œåº“æ”¾åˆ°SVNä¸Šçš„ï¼Œæ²¡æœ‰æºä»£ç ï¼Œå¦‚éœ€å‡çº§ç‰ˆæœ¬æˆ–ä¿®æ”¹æºç æˆ–è°ƒè¯•å°±éžå¸¸éº»çƒ¦ã€‚ è¦è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œåªèƒ½å¼•å…¥åŒ…ç®¡ç†æœºåˆ¶ã€‚ æˆåŠŸçš„å…³é”® åœ¨ä¸€ä¸ªå¤§åž‹ç»„ç»‡ä¸­å¼•å…¥ä¸€é¡¹æ–°æŠ€æœ¯è¿˜çœŸä¸æ˜¯ä¸€ä»¶æ˜“äº‹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºŽä¸€ä¸ªæ­£åœ¨æˆé•¿ä¸­çš„æŠ€æœ¯ã€‚ä½†æ˜¯æˆ‘çŸ¥é“è¿™é¡¹æŠ€æœ¯å¯¹äºŽæˆ‘ä»¬éžå¸¸é‡è¦ï¼Œå› æ­¤æˆ‘ä»¬è¿«åˆ‡çš„åªèŠ±äº†å¾ˆçŸ­æ—¶é—´å°†å¹³å°å±‚çš„300Wè¡Œä»£ç å…¨éƒ¨åŒ…åŒ–ï¼Œä»Ž2018å¹´8æœˆå¼€å§‹å‡†å¤‡ï¼Œ2018å¹´11æœˆæˆ‘å¸¦é¢†å›¢é˜ŸèŠ±è´¹3å‘¨æ—¶é—´å°†å¹³å°å±‚å®Œå…¨åŒ…åŒ–ã€‚ å¼•å…¥åŒ…ç®¡ç†ä¸»è¦æ˜¯è§£å†³å¹³å°çš„ä½¿ç”¨é—®é¢˜ï¼Œæ‰€ä»¥è¦åŒ…åŒ–çš„æ˜¯å¹³å°å±‚ï¼Œäº§å“å±‚æ˜¯åŒ…çš„æ¶ˆè´¹è€…ã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯æ€Žä¹ˆå°†å¹³å°å±‚å‡ ç™¾ä¸‡è¡Œä»£ç å¿«é€ŸåŒ…åŒ–çš„å‘¢ï¼ŒæˆåŠŸçš„å…³é”®åœ¨äºŽå¦‚ä¸‹å‡ ç‚¹ã€‚ ç§å­é€‰æ‰‹ åŒ…åŒ–çš„è¿‡ç¨‹ä¸ä»…éœ€è¦æ‡‚å¾—å¦‚ä½•ä½¿ç”¨ï¼Œè¿˜åŒ…æ‹¬å¦‚ä½•æ‹†åˆ†å’Œè®¾è®¡åŒ…ï¼ŒåŒ…çš„ç²’åº¦åº”è¯¥å¤šå¤§ã€‚èµ·åˆï¼Œä¸ºäº†å¿«é€Ÿå¼•å…¥åŒ…ç®¡ç†æœºåˆ¶ï¼Œåœ¨åŽè€…ä¸Šæˆ‘ä»¬è€ƒè™‘çš„ä¸å¤Ÿï¼Œåƒäº†ä¸€äº›äºã€‚ åœ¨åŠ¨æ‰‹ä¹‹å‰è¦å¯¹conanåšåˆ°äº†ç„¶äºŽå¿ƒï¼Œæœ€å¥½çš„åŠžæ³•æ˜¯é˜…è¯»conançš„æ–‡æ¡£ï¼Œæˆ‘èµ·ç ç ”ç©¶äº†ä¸ä¸‹ä¸‰éï¼Œåƒé€äº†conanèƒ½å¤Ÿæä¾›çš„æ–¹æ–¹é¢é¢ï¼Œæ‰€ä»¥åœ¨åŽé¢æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•å°†æ‰€æœ‰åŒ…ä¸€èµ·æœ¬åœ°ç¼–è¯‘æ—¶ï¼Œæˆ‘é©¬ä¸Šæƒ³åˆ°å·¥ä½œåŒºçš„æ–¹æ³•å¹¶æˆåŠŸå®žçŽ°äº†ã€‚ å¦å¤–è¿˜éœ€è¦ä¸€å®špythonç»éªŒï¼Œconanè‡ªèº«è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæœ‰æ—¶éœ€è¦ä¿®æ”¹å…¶æºä»£ç ã€‚ä¹Ÿå¯èƒ½éœ€è¦ä¿®æ”¹æºä»£ç æ»¡è¶³ä¸€äº›ç‰¹åŒ–éœ€æ±‚ã€‚å¥½åœ¨æˆ‘éžå¸¸å–œæ¬¢pythonï¼Œæœ‰å¤šå¹´çš„ä½¿ç”¨ç»éªŒäº†ï¼Œè¿™ä¸€ç‚¹åœ¨åŽé¢èµ·åˆ°é‡è¦ä½œç”¨ã€‚ æˆ‘è‡ªå·±é¦–å…ˆåšåˆ°æˆç«¹åœ¨èƒ¸ï¼Œç„¶åŽå†åŸ¹è‚²ä¸€æ‰¹ç§å­é€‰æ‰‹ï¼Œå¯¹å®ƒä»¬è¿›è¡ŒåŸ¹è®­ã€‚è¿™äº›å‡†å¤‡å·¥ä½œæ˜¯åŽé¢å¿«é€Ÿå®ŒæˆåŒ…åŒ–çš„å…³é”®ã€‚ åˆ¶å®šè§„åˆ™ã€éšè—ç»†èŠ‚ æŠ€æœ¯æœ¬èº«å¾€å¾€å…·æœ‰å¾ˆå¤šçµæ´»æ€§ï¼Œè¿™æ˜¯ä¸ºäº†é€‚åº”å„ç§ä¸åŒåœºæ™¯éœ€è¦ã€‚ä½†æ˜¯è¦è½åœ°åˆ°å…·ä½“åº”ç”¨ï¼Œæœ€å¥½åŠ ä»¥å°è£…ï¼Œé¿å…æš´éœ²è¿‡å¤šç»†èŠ‚ã€‚å¦‚æžœå¼•å…¥conanåŽï¼Œéšä¹‹å¸¦æ¥çš„å˜åŒ–ä¼šé€ æˆå›°æ‰°ï¼Œé‚£ä¹ˆå†å¥½çš„ä¸œè¥¿ä¹Ÿä¼šæ‹›è‡´åæ„Ÿã€‚ä¸è¦ä»¥ä¸ºå°±æ˜¯æ•²ä¸€ä¸ªå‘½ä»¤è¡Œçš„äº‹æƒ…ï¼Œå¼€å‘äººå‘˜éƒ½ä¼šå«Œéº»çƒ¦ï¼Œè¿™æ˜¯åœ¨æˆ‘çš„ç»„ç»‡é‡Œé¢æ™®éå­˜åœ¨çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å°½é‡åšåˆ°ä¿æŒä»¥å¾€çš„å¼€å‘ä¹ æƒ¯ï¼Œå±è”½æŽ‰ä¸€äº›ç»†èŠ‚ï¼Œåœ¨è¿™æ–¹é¢åšäº†å¤§é‡å·¥ä½œã€‚ä¸‹é¢æ¢³ç†ä¸€ä¸‹å¼•å…¥åŒ…ç®¡ç†åŽå¸¦æ¥çš„ä¸€äº›å˜åŒ–ï¼Œä»¥åŠæˆ‘ä»¬æ˜¯å¦‚ä½•åšçš„ã€‚ ï¼ˆ1ï¼‰å¼€å‘çŽ¯å¢ƒ é€šè¿‡ä¸€é”®è„šæœ¬åˆå§‹åŒ–conanå¼€å‘çŽ¯å¢ƒï¼ŒåŒ…æ‹¬registryè®¾ç½®ï¼Œprofileè®¾ç½®ï¼› æž„å»ºçš„å·¥å…·ä¹ŸåŒ…åŒ–ï¼Œä¾‹å¦‚cmakeï¼Œæ€»ä¹‹ä¸€åˆ‡éƒ½æ˜¯åŒ…ã€‚ ï¼ˆ2ï¼‰å¼€å‘è¿‡ç¨‹ åŒ…åçš„åå‘½è§„åˆ™ï¼šconanä¸­æ¯ä¸ªåŒ…çš„åå­—éµå¾ªname/version@user/channelæ ¼å¼ï¼Œæˆ‘ä»¬å°†userå’Œchannelèµ‹äºˆäº†ç‰¹å®šå«ä¹‰ï¼Œuserç”¨äºŽè¡¨ç¤ºå­ç³»ç»Ÿï¼Œå¦‚extè¡¨ç¤ºç¬¬ä¸‰æ–¹åº“ï¼Œcoreè¡¨ç¤ºè‡ªç ”çš„å…¬å…±åº“ç­‰ç­‰ï¼Œchannelç”¨äºŽåŒºåˆ†å¼€å‘ç‰ˆæœ¬ï¼Œä¸»å¹²å¼€å‘ç‰ˆä¸ºdevï¼ŒæŸåˆ†æ”¯å¼€å‘ç‰ˆä¸ºxxx_devï¼Œxxxä¸ºåˆ†æ”¯åã€‚ åŒ…çš„æ‹†åˆ†åŽŸåˆ™ï¼šåŒ…çš„æ‹†åˆ†è¦éµå¾ªä¸¤ä¸ªåŸºæœ¬åŽŸåˆ™ï¼šæœ€å°ä¾èµ–åŽŸåˆ™å’Œæœ€å¤§å¤ç”¨åŽŸåˆ™ã€‚æœ€å¤§å¤ç”¨å°±æ˜¯ï¼Œå¯¹äºŽå¤ç”¨çš„è¦å°½é‡ç»†ï¼Œå¯¹äºŽä¸å¤ç”¨çš„ï¼Œå¯ä»¥ç²—æ”¾ä¸€äº›ã€‚æœ€å°ä¾èµ–å°±æ˜¯ä¸€ä¸ªåŒ…å¯ä»¥ç²¾ç¡®çš„ä¾èµ–å¿…é¡»ä¾èµ–çš„ã€‚conanå¹¶ä¸é™åˆ¶ä¸€ä¸ªåŒ…é‡Œé¢åŒ…å«å¤šå°‘åº“ï¼Œä½†æ˜¯åŒ…æ˜¯ç”¨æ¥å¤ç”¨çš„ï¼Œç²’åº¦è¶Šå°å¤ç”¨åº¦ä¹Ÿè¶Šå¤§ï¼Œæœ€ç†æƒ³çš„æƒ…å†µæ˜¯ä¸€ä¸ªåº“ä¸€ä¸ªåŒ…ï¼Œé™¤äº†å°‘æ•°ä¾‹å¤–ï¼šæœ‰äº›åº“æ˜¯ä¸€ç³»åˆ—åº“çš„ç»„åˆï¼Œå®ƒä»¬çš„æºä»£ç æœ¬ç”Ÿæ²¡æœ‰æ¨¡å—åŒ–æ‹†åˆ†ï¼Œä¾‹å¦‚boostï¼Œiceï¼Œä¸å¥½åšæˆå¤šä¸ªåŒ…ï¼›æœ‰ä¸€äº›ä¸æ˜¯ç”¨æ¥å¤ç”¨çš„ï¼Œä¾‹å¦‚å¹³å°å±‚çš„å…¬å…±æœåŠ¡ï¼Œä¸ºäº†æœ€ç»ˆäº§å“æ‰“åŒ…æ–¹ä¾¿ï¼Œä¹Ÿåšæˆäº†åŒ…ã€‚èµ·åˆä¸ºäº†å°½å¿«å¼•å…¥åŒ…ç®¡ç†ï¼ŒæŒ‰ç…§åŽŸæ¥çš„ç›®å½•ç»“æž„ï¼Œåšæˆäº†å¤§åŒ…ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒ…åŒ…å«å¤šä¸ªåº“ï¼Œè¿™å¸¦æ¥äº†ä¸€ç³»åˆ—é—®é¢˜ï¼Œé¦–å…ˆé€ æˆäº†ä¾èµ–å…³ç³»æ‰©å¤§åŒ–ï¼Œä¹Ÿå°±æ˜¯ä¾èµ–äº†ä¸è¯¥ä¾èµ–çš„åŒ…ï¼Œå¯¼è‡´ç¼–è¯‘æ•ˆçŽ‡ä¸‹é™ï¼Œå› ä¸ºå¤´æ–‡ä»¶æœç´¢è·¯å¾„å’Œå¯¼å…¥åº“æ•°é‡æ˜¾è‘—å¢žåŠ äº†ï¼›å…¶æ¬¡ï¼Œä¼šé‡åˆ°ä¸€äº›å¾ªçŽ¯ä¾èµ–é—®é¢˜ï¼Œè¿™æ—¶å¿…é¡»é€šè¿‡è¿›ä¸€æ­¥æ‹†åˆ†è§£é™¤å¾ªçŽ¯ã€‚ äº§å“å±‚å¦‚ä½•æ¶ˆè´¹åŒ…ï¼šå¯¹äºŽåŒ…çš„æ¶ˆè´¹æ–¹ï¼Œéœ€è¦ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¶ˆè´¹åŒ…ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªç‰¹æ®Šçš„åŒ…ï¼Œé›†æˆåŒ…ï¼Œå°†å¹³å°å±‚æ‰€æœ‰åŒ…requireåˆ°é›†æˆåŒ…ï¼Œäº§å“å±‚åªéœ€è¦ä¾èµ–é›†æˆåŒ…ã€‚ åŒ…çš„å­˜å‚¨å’Œä¸Šä¼ ï¼šåŒ…çš„å­˜å‚¨é‡‡ç”¨äº†å•†ä¸šçš„artifactoryï¼Œæˆ‘ä»¬çš„mavenä»¥åŠnpmå·²ç»ä½¿ç”¨äº†artifactoryï¼Œå‰é¢è¯´äº†ä»–ä¹Ÿæ”¯æŒäº†conanã€‚åŒ…çš„ä¸Šä¼ ä½¿ç”¨å¼€å‘è€…è‡ªå·±çš„è´¦å·ï¼Œè¿™æ ·å¯ä»¥è¿½æº¯è°ä¿®æ”¹äº†åŒ…ï¼Œé€šè¿‡artifactoryé›†æˆADå¯ä»¥å®¹æ˜“åšåˆ°è¿™ç‚¹ã€‚conanæœ¬èº«ä¹Ÿæä¾›ä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯ï¼Œå¯æ»¡è¶³åŸºæœ¬ä½¿ç”¨ã€‚ ç‰ˆæœ¬ç®¡ç†ï¼šåŒ…åŒ–åªæ˜¯ä¸€ä¸ªå¼€å§‹ï¼ŒåŒ…åŒ–ä¹‹åŽå˜æˆäº†ä¸€ä¸ªä¸ªå¯ä»¥ç‹¬ç«‹ç¼–è¯‘çš„åŒ…ï¼Œæ¯ä¸ªåŒ…å¯ä»¥ç‹¬ç«‹ç‰ˆæœ¬æ¼”è¿›ï¼Œè¿™ç»™ç‰ˆæœ¬ç®¡ç†å¸¦æ¥äº†æ›´å¤§çš„æŒ‘æˆ˜ã€‚ç‰ˆæœ¬ç®¡ç†éœ€è¦é‡ç‚¹è€ƒè™‘å‡ ç‚¹ï¼šä¸åŒå¼€å‘åˆ†æ”¯çš„åŒ…ä¸ä¼šäº’ç›¸å½±å“ï¼›ä»€ä¹ˆæƒ…å†µå‡ç‰ˆæœ¬å·ï¼Œå‡å“ªäº›åŒ…çš„ç‰ˆæœ¬å·ï¼›å‡ç‰ˆæœ¬å·çš„è§„åˆ™æ˜¯æ€Žä¹ˆæ ·çš„ï¼›å¦‚ä½•è·Ÿè¸ªç‰ˆæœ¬çš„å˜åŒ–ã€‚æˆ‘ä»¬é‡‡å–çš„æŽªæ–½æ˜¯ï¼šé€šè¿‡channeléš”ç¦»æ¯ä¸ªåˆ†æ”¯ï¼Œå½¼æ­¤äº’ä¸å¹²æ‰°ï¼Œæ¯ä¸ªåˆ†æ”¯æ ¹ç›®å½•ä¸‹å»ºç«‹channel.txtæ–‡ä»¶å¡«å…¥channelåï¼›å¦‚æžœè¿›å…¥é›†æµ‹é˜¶æ®µæˆ–é‡Šæ”¾çš„äº§å“ç‰ˆæœ¬ä¾èµ–çš„å¹³å°åŒ…æœ‰ä¿®æ”¹ï¼Œå°±éœ€è¦å‡çº§ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·å‡çº§è§„åˆ™æŒ‰ç…§SemVerè§„èŒƒï¼Œå¦‚æžœä¿®æ”¹æ˜¯äºŒè¿›åˆ¶å‘å‰å…¼å®¹çš„ï¼Œé‚£ä¹ˆä¾èµ–å®ƒçš„å…¶ä»–åŒ…ä¸éœ€è¦å‡ç‰ˆæœ¬å·ï¼Œä¹Ÿä¸éœ€è¦é‡ç¼–ã€‚å¦‚æžœä¿®æ”¹ä¸æ˜¯äºŒè¿›åˆ¶å‘å‰å…¼å®¹çš„ï¼Œé‚£ä¹ˆä¾èµ–å®ƒçš„å…¶ä»–åŒ…ä¹Ÿéœ€è¦å‡çº§ç‰ˆæœ¬å·ã€‚ä»»ä½•åŒ…æœ‰ç‰ˆæœ¬å‡çº§åŽï¼Œé›†æˆåŒ…ä¹Ÿéœ€è¦å‡çº§ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬ä¼šç»´æŠ¤ä¸€ä¸ªç‰ˆæœ¬åœ°å›¾ï¼ŒåŒ…å«ä»Žäº§å“ç‰ˆæœ¬åˆ°é›†æˆåŒ…çš„å…³ç³»ä»¥åŠé›†æˆåŒ…åŒ…å«çš„æ‰€æœ‰åŒ…ç‰ˆæœ¬çš„å…³ç³»ã€‚ æ•´ä½“ç¼–è¯‘ï¼šåŒ…çš„å¥½å¤„æ˜¯æ¯ä¸ªåŒ…éƒ½å¯ä»¥ç‹¬ç«‹å¼€å‘ï¼Œä½†æ˜¯åœ¨æ–°ç‰ˆæœ¬å¼€å‘é˜¶æ®µï¼Œå¾€å¾€å¾ˆå¤šåŒ…ä¼šä¸€èµ·å¤§é‡ä¿®æ”¹ï¼ˆæˆ‘ä»¬å°†å¾ˆå¤šå¹¶ä¸æ˜¯ä¸ºäº†å¼€å‘æ—¶å¤ç”¨çš„æœåŠ¡ä¹ŸåŒ…åŒ–äº†ï¼‰ï¼Œä¸ºäº†æé«˜å¼€å‘æ•ˆçŽ‡ï¼Œæœ€å¥½èƒ½å°†æ‰€æœ‰åŒ…ä¸€èµ·æœ¬åœ°æ•´ä½“ç¼–è¯‘ï¼Œè¿™æ—¶conançš„å·¥ä½œåŒºå°±æ´¾ä¸Šç”¨åœºäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„1.6.1ç‰ˆæœ¬çš„å·¥ä½œåŒºç‰¹æ€§è¿˜ä¸å®Œå–„ï¼Œæˆ‘ä»¬å¯¹æºä»£ç åšäº†ä¸€äº›ä¿®æ”¹ã€‚åŒæ—¶äº§å“å±‚ç¼–è¯‘ä¹Ÿåšäº†ä¸€äº›é€‚é…ï¼Œä¸ä½¿ç”¨conanç¼“å­˜ï¼Œç›´æŽ¥ä½¿ç”¨å·¥ä½œåŒºä¸­çš„å¤´æ–‡ä»¶å’Œåº“ã€‚ ï¼ˆ3ï¼‰è¿è¡Œå‘å¸ƒ æŒç»­é›†æˆï¼šä¸»è¦çš„å˜åŒ–æ˜¯ç›‘æŽ§çš„ç²’åº¦å˜æˆäº†ä¸€ä¸ªä¸ªåŒ…ï¼Œä½†æ˜¯åŒ…ä¹‹é—´æ˜¯æœ‰å…³è”çš„ã€‚è€ƒè™‘è¿‡å‡ ç§è§£å†³æ–¹æ¡ˆï¼Œæ–¹æ¡ˆä¸€ï¼Œä¸€ä¸ªåŒ…ä¸€ä¸ªjobï¼Œjobè§¦å‘å—å½±å“åŒ…çš„jobï¼›æ–¹æ¡ˆäºŒï¼Œå‚æ•°åŒ–çš„jobï¼Œé€šè¿‡pipelineä»£ç å¹¶å‘æž„å»ºæ‰€æœ‰å—å½±å“åŒ…ï¼Œä»£ç scmçš„hookè§¦å‘jobï¼›æ–¹æ¡ˆä¸‰ï¼Œé€šè¿‡conanå·¥ä½œåŒºæœºåˆ¶ï¼Œæ•´ä½“æž„å»ºæ‰€æœ‰åŒ…ï¼Œç›‘æŽ§ç²’åº¦å®žé™…å˜æˆäº†æ‰€æœ‰åŒ…ã€‚æ–¹æ¡ˆä¸€è¦å»ºç«‹å¾ˆå¤šjobï¼Œä¸å¯å–ã€‚æ–¹æ¡ˆäºŒæ˜¯æœ€åˆç†çš„ï¼Œä½†æ˜¯å¦‚æžœä¸€äº›åº•å±‚åŒ…å˜åŒ–ï¼Œæ•´ä½“ç¼–è¯‘æ—¶é—´è¿˜æ˜¯å¾ˆé•¿ï¼Œå¦å¤–éœ€è¦scmå›žè°ƒciæ”¯æŒã€‚æ–¹æ¡ˆä¸‰çš„é—®é¢˜æ˜¯å³ä½¿æ²¡æœ‰å˜åŒ–çš„åŒ…ä¹Ÿä¼šç¼–è¯‘ä¸Šä¼ ã€‚ç›®å‰ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ–¹æ¡ˆä¸‰ã€‚ æ–¹æ¡ˆä¸€ã€æ–¹æ¡ˆäºŒä¸­åˆ¤æ–­å—å½±å“åŒ…çš„æ–¹æ³•éƒ½æ˜¯é€šè¿‡conan info -boæ¥èŽ·å–çš„ï¼Œè¿™ä»…ä»…æ˜¯é€šè¿‡ä¾èµ–å…³ç³»è®¡ç®—çš„ï¼Œå®žé™…ä¸Šï¼Œæœ‰æ—¶ä¸€ä¸ªåŒ…ä¿®æ”¹äº†ï¼Œå¹¶ä¸ä¸€å®šéœ€è¦é‡æ–°ç¼–è¯‘ä¾èµ–å®ƒçš„åŒ…ï¼Œä½†æ˜¯ç›®å‰æ²¡æœ‰åŠžæ³•è¯†åˆ«è¿™ä¸€ç‚¹ã€‚ è¿è¡Œï¼šåˆ†å®‰è£…åŒ…è¿è¡Œå’Œå¼€å‘çŽ¯å¢ƒè¿è¡Œï¼Œå®‰è£…åŒ…æ˜¯é€šè¿‡conan importå°†åŒ…é‡Œé¢çš„äºŒè¿›åˆ¶ç¨‹åºæ‹·è´åˆ°è¿è¡Œç›®å½•ï¼Œç„¶åŽæ‰“æˆå®‰è£…åŒ…çš„ã€‚å¼€å‘çŽ¯å¢ƒè¿è¡Œï¼Œå¦‚æžœæ¯æ¬¡éƒ½æ‹·è´åˆ°è¿è¡Œç›®å½•ï¼Œä¸€æ¥é€Ÿåº¦æ…¢ï¼ŒäºŒæ¥æµªè´¹å¤§é‡ç£ç›˜ç©ºé—´ï¼Œconanæä¾›äº†ä¸€ä¸ªvirtualrunenvçš„generatorï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬çš„åŒ…å¤ªå¤šäº†ï¼Œå¯¼è‡´å‘½ä»¤è¡Œé•¿åº¦è¿‡é•¿ï¼Œæ— æ³•ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæœ€ç»ˆæˆ‘ä»¬æƒ³äº†ä¸€ä¸ªåŠžæ³•ï¼Œåœ¨è¿è¡Œç›®å½•ä¸­å»ºç«‹äº†åŒ…ä¸­äºŒè¿›åˆ¶ç¨‹åºçš„è½¯é“¾æŽ¥ï¼Œè¿™æ˜¯åœ¨å¼€å‘çŽ¯å¢ƒå¯åŠ¨è„šæœ¬ä¸­è‡ªåŠ¨å®Œæˆçš„ã€‚ åŽ‹ç¼©æºç ï¼šæ¯ä¸ªå®‰è£…åŒ…ï¼ŒåŒæ—¶éœ€è¦æ‰“åŒ…å¯¹åº”çš„æºç ï¼Œä¾¿äºŽä»¥åŽè°ƒè¯•ä½¿ç”¨ã€‚conanåŒ…å¯¹åº”çš„æºä»£ç ä¹Ÿå­˜å‚¨åœ¨åŒ…æœåŠ¡å™¨ä¸Šï¼Œæ‰“åŒ…çš„æ—¶å€™å¯ä»¥ä»Žå…¶ä¸‹è½½æºä»£ç ã€‚ ç¦»çº¿ä½¿ç”¨conanï¼šæœ‰äº›çŽ¯å¢ƒæ— æ³•è®¿é—®åŒ…æœåŠ¡å™¨ï¼Œéœ€è¦èƒ½å¤Ÿç¦»çº¿ä½¿ç”¨conanï¼Œé‚£ä¹ˆå°±éœ€è¦å°†conanç¼“å­˜ç›®å½•ä¹Ÿæ‰“åŒ…ã€‚ åŠæ—¶å“åº”è°ƒæ•´ æœ‰å¾ˆå¤šæƒ…å†µæ˜¯ä¸€å¼€å§‹æ²¡æœ‰æƒ³åˆ°çš„ï¼Œå®ŒæˆåŒ…åŒ–ä¹‹åŽï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¸æ–­è¿›è¡Œè°ƒæ•´ã€‚é‚£æ®µæ—¶é—´æˆ‘å¤©å¤©ç›¯ç€å¾®ä¿¡ç¾¤ï¼Œæœ‰ä»»ä½•é—®é¢˜éƒ½ä¼šç¬¬ä¸€æ—¶é—´å¤„ç†æŽ‰ï¼Œæ¶ˆé™¤å¤§å®¶çš„ç–‘é—®ã€‚ ä¾‹å¦‚ä¸€å¼€å§‹æˆ‘ä»¬è®¾æƒ³çš„äº§å“å±‚åº”è¯¥éƒ½æ˜¯åŸºäºŽäºŒè¿›åˆ¶çš„åŒ…åŽ»è®¿é—®å¹³å°å±‚ï¼Œä½†æ˜¯å®žé™…æƒ…å†µæ˜¯æ­¤æ—¶å¹³å°å±‚ä¹Ÿåœ¨å¤§é‡çš„å¼€å‘ï¼Œç»å¸¸å‡ºçŽ°å¹³å°å±‚æ²¡æœ‰åŠæ—¶ä¸Šä¼ åŒ…è€Œå¯¼è‡´äº§å“å±‚ç¼–è¯‘ä¸è¿‡ã€‚è¿˜æœ‰å¹³å°å±‚æ”¹åŠ¨ä¸€ä¸ªåŒ…ä¹‹åŽï¼Œå¸¸å¸¸è¿žé”çš„éœ€è¦é‡ç¼–å…¶ä»–åŒ…ä¸Šä¼ ï¼Œå¼€å‘æ•ˆçŽ‡ç›¸æ¯”ä¹‹å‰æ˜¾è‘—ä¸‹é™ï¼Œå¤§å®¶è¿«åˆ‡éœ€è¦åƒä»¥å‰ä¸€æ ·ï¼Œcmakeä¸ºä¸€ä¸ªVCè§£å†³æ–¹æ¡ˆï¼Œæ•´ä½“è¿›è¡Œç¼–è¯‘ã€‚å¹¸å¥½conançš„å·¥ä½œåŒºç‰¹æ€§æ­£æ˜¯åº”å¯¹è¿™ç§åœºæ™¯ï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„1.6.1ç‰ˆæœ¬è¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæˆ‘å¯¹æºä»£ç è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œå¦å¤–è¿˜åšäº†ä¸€äº›ä¼˜åŒ–ã€‚ è¿™ç§ä¾‹å­è¿˜éžå¸¸å¤šï¼Œå¹¸å¥½éƒ½ä¸€ä¸€åŠæ—¶åŒ–è§£ã€‚åˆ°å¦‚ä»Šå·²ç»ç¨³å®šè¿è¡Œä¸€å¹´å¤šã€‚ å¸¸è§é—®é¢˜æ€»ç»“ ä»¥ä¸‹æ€»ç»“äº†åœ¨ä½¿ç”¨conanè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›å…·ä½“é—®é¢˜ï¼Œå¸Œæœ›å¯¹é‡åˆ°ç›¸ä¼¼é—®é¢˜çš„åŒå­¦æœ‰æ‰€å¸®åŠ©ã€‚æˆ‘ä»¬ä½¿ç”¨çš„conanç‰ˆæœ¬æ˜¯1.6.1ï¼Œæœ‰äº›é—®é¢˜åœ¨åŽç»­ç‰ˆæœ¬å·²ç»è§£å†³ï¼Œå¦‚æžœä½ ä½¿ç”¨çš„æ›´é«˜ç‰ˆæœ¬ï¼Œå¯èƒ½ä¸ä¼šé‡åˆ°ã€‚ å¼€å‘çŽ¯å¢ƒç»Ÿä¸€é—®é¢˜ åˆæœŸåˆšå¼•å…¥conanæ—¶ï¼Œç»å¸¸æŠ¥æ‰¾ä¸åˆ°åŒ…å’Œregistryè¿žä¸ä¸Šé—®é¢˜ã€‚æ‰¾ä¸åˆ°åŒ…é€šå¸¸æ˜¯å¼€å‘çŽ¯å¢ƒçš„conanå…¨å±€ç¼–è¯‘å‚æ•°CONAN_USER_HOME/profiles/defaultè®¾ç½®çš„ä¸å¯¹ï¼Œè€Œè¿žä¸ä¸Šregistryé€šå¸¸æ˜¯å› ä¸ºï¼Œé»˜è®¤çš„conan-centeræŽ’åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œå†…ç½‘çŽ¯å¢ƒè¿žä¸ä¸Šã€‚ è§£å†³æŽªæ–½ï¼šåœ¨æž„å»ºè„šæœ¬ä¸­é€šè¿‡-så’Œ-oå‚æ•°å°†ç¼–è¯‘å‚æ•°å›ºå®šï¼Œä¸ä¾èµ–å¼€å‘è€…çŽ¯å¢ƒä¸Šçš„å…¨å±€é…ç½®ã€‚æž„å»ºè„šæœ¬ä¸­é€šè¿‡-rå‚æ•°å›ºå®šregistryï¼Œä¸ä¾æ¬¡æŸ¥è¯¢æ‰€æœ‰registryã€‚ æ•´ä½“æž„å»ºé—®é¢˜ åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¤šä¸ªåŒ…ä¼šä¸€èµ·å¼€å‘ï¼Œæ¯ä¸ªåŒ…å•ç‹¬æž„å»ºï¼Œæ—¶é—´å¤ªæ…¢ï¼Œè€Œä¸”conan createæž„å»ºåŒ…æ˜¯åœ¨conanç¼“å­˜ç›®å½•ä¸­ï¼Œæ¯æ¬¡ä½ å¾—åˆ‡æ¢åˆ°ç¼“å­˜ç›®å½•ï¼Œåœ¨buildç›®å½•æ‰¾åˆ°VCå·¥ç¨‹ï¼Œæ¯æ¬¡conan createé»˜è®¤åˆä¼šåˆ é™¤ä¸Šæ¬¡çš„æž„å»ºï¼Œæ‰€ä»¥éžå¸¸éº»çƒ¦ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ä½¿ç”¨äº†conanå·¥ä½œåŒºçš„ç‰¹æ€§ï¼Œå·¥ä½œåŒºæœ‰ä¸€ä¸ªé™åˆ¶æ˜¯åªèƒ½ç”¨äºŽcmakeé›†æˆï¼Œå·¥ä½œåŒºæ˜¯å°±åœ°æž„å»ºçš„ï¼Œä¸ä¼šæ‹·è´åˆ°conanç¼“å­˜æž„å»ºï¼Œå¹¶ä¸”å¯ä»¥å°†å·¥ä½œåŒºä¸­çš„æ‰€æœ‰åŒ…cmakeä¸ºä¸€ä¸ªå·¥ç¨‹ã€‚1.6.1ç‰ˆæœ¬çš„å·¥ä½œåŒºè¿˜ä¸å®Œå–„ï¼Œæˆ‘ä»¬è§£å†³äº†å¦‚ä¸‹é—®é¢˜ï¼š ï¼ˆ1ï¼‰è‡ªåŠ¨ç”Ÿæˆconanws.ymlæ–‡ä»¶ è¦ä½¿ç”¨å·¥ä½œåŒºï¼Œéœ€è¦åœ¨å·¥ä½œåŒºæ ¹ç›®å½•ç¼–å†™coannws.ymlæ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰äº†æ¯ä¸ªåŒ…çš„ç›®å½•ã€å¤´æ–‡ä»¶ç›®å½•å’Œå¯¼å‡ºåº“ç›®å½•ä»¥åŠè°æ˜¯æ ¹åŒ…ã€‚æ¯å½“å¢žåŠ æ–°çš„åŒ…æˆ–è€…å¤´æ–‡ä»¶ç›®å½•æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œå°±éœ€è¦åŒæ­¥ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯è¿™äº›ä¿¡æ¯å®žé™…ä¸Šåœ¨conanfile.pyæ–‡ä»¶ä¸­éƒ½æœ‰ï¼Œæ‰€ä»¥æˆ‘åšäº†ä¸€ä¸ªpythonè„šæœ¬è‡ªåŠ¨ç”Ÿæˆconanws.ymlæ–‡ä»¶ã€‚ åŽŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯è§£æžconanfile.pyæ–‡ä»¶ï¼Œæå–package_infoæ–¹æ³•ä¸­çš„å¤´æ–‡ä»¶ç›®å½•ä¿¡æ¯ï¼Œè€Œæ ¹åŒ…å°±æ˜¯é›†æˆåŒ…ã€‚è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œconanws.ymlä¸­åŒ…çš„é¡ºåºæ˜¯æœ‰æ„ä¹‰çš„ï¼Œå¿…é¡»æŒ‰ç…§ä¾èµ–çš„é¡ºåºï¼Œè¿™å¯ä»¥é€šè¿‡conan info -bo ALLèŽ·å–ï¼Œpythonè„šæœ¬ä¸­ç”¨OrderedDictå­˜å‚¨ï¼Œç„¶åŽdumpåˆ°ymlæ–‡ä»¶ã€‚ ï¼ˆ2ï¼‰ä¾èµ–åŒ…çš„å¯¼å‡ºåº“æ²¡æœ‰åŠ å…¥åˆ°å½“å‰å·¥ç¨‹ å·¥ä½œåŒºé‡Œé¢cmakeçš„æ—¶å€™ï¼Œå› ä¸ºè¿˜æ²¡æœ‰ç¼–è¯‘è¿‡ï¼Œè¿˜æ²¡æœ‰ç”Ÿæˆlibæ–‡ä»¶æˆ–soæ–‡ä»¶ï¼Œpckage_infoä¸­é€šè¿‡collect_libs()æ˜¯æ”¶é›†ä¸åˆ°åº“æ–‡ä»¶çš„ï¼Œå¦å¤–conançš„æºä»£ç ä¹Ÿéœ€è¦ä¿®æ”¹ã€‚ è§£å†³æŽªæ–½ï¼šconanfile.pyæ–‡ä»¶çš„package_infoæ˜¾å¼è®¾ç½®self.cpp_info.libsï¼Œä¸è¦ä½¿ç”¨tools.collect_libs()ï¼Œä¿®æ”¹conanæºä»£ç ï¼Œåœ¨å®šä¹‰targetçš„æ—¶å€™ï¼Œå¦‚æžœlibç›®å½•ä¸åŒ…å«.conanï¼ˆä¹Ÿå°±æ˜¯ä¸æ˜¯ä»Žç¼“å­˜ä¸­æ¥æ—¶ï¼‰ç›´æŽ¥æ‹¼å‡ºåº“è·¯å¾„ï¼Œä¸ä½¿ç”¨find_libraryã€‚ client/generators/cmake_common.pyï¼š ï¼ˆ3ï¼‰å¶å°”ä¾èµ–åŒ…çš„å¤´æ–‡ä»¶ç›®å½•å’Œå¯¼å…¥åº“ç›®å½•æ²¡æœ‰åŠ å…¥åˆ°å½“å‰å·¥ç¨‹ åŽŸå› å’Œä¸Šé¢ç±»ä¼¼ï¼Œcmakeé˜¶æ®µç›®å½•è¿˜æ²¡ç”Ÿæˆï¼Œç©ºç›®å½•è¢«è¿‡æ»¤æŽ‰äº†ã€‚ 1.13.0ç‰ˆæœ¬å·²ç»ä¿®å¤ï¼Œreleaseè¯´æ˜Žå¦‚ä¸‹ï¼Œå·¥ä½œåŒºç‰¹æ€§å·²ç»å½»åº•é‡æž„ï¼š Feature: Re-implement Workspaces based on Editable packages. (#4481). Docs: ðŸ“ƒ å…³é”®ä»£ç build_info.pyï¼š æˆ‘çš„ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼š client/generators/__init__.py ï¼ˆ4ï¼‰ç”ŸæˆVCè§£å†³æ–¹æ¡ˆæ—¶ï¼Œå·¥ç¨‹é—´ä¾èµ–æ²¡æœ‰å»ºç«‹ äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„åŽŸå› è¦å…ˆè¯´ä¸€ä¸‹conanæ˜¯å¦‚ä½•è®¾ç½®ä¸€ä¸ªåŒ…çš„å¯¼å…¥åº“çš„ï¼Œgeneratorä¸ºcmakeæ—¶ï¼Œconan installæ—¶ä¼šç”Ÿæˆconanbuildinfo.cmakeæ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰äº†conan_target_link_librarieså‡½æ•°ï¼Œå‡è®¾AåŒ…ä¾èµ–BåŒ…ï¼Œé‚£ä¹ˆAçš„CMakeLists.txtä¸­åŒ…å«conanbuildinfo.cmakeï¼Œç„¶åŽè°ƒç”¨conan_target_link_libraries(A)ï¼Œæˆ–è€…å¦‚æžœå¯ç”¨äº†TARGETESï¼Œå°±æ˜¯target_link_libraries(A CONAN_PKG::B)ï¼Œè¿™æ ·å°±è‡ªåŠ¨å°†BåŒ…çš„åº“å¯¼å…¥åˆ°AåŒ…åº“ä¸Šï¼Œconan_target_link_librariesä¸­å®žé™…ä¸Šå°±æ˜¯è°ƒç”¨çš„target_link_librariesï¼Œä¼ è¾“çš„å‚æ•°æ˜¯åº“åã€‚ target_link_librariesçš„å‚æ•°å¯ä»¥æ˜¯targetåï¼Œä¹Ÿå¯ä»¥æ˜¯åº“åï¼Œå½“ä¸ºtargetåæ—¶ï¼Œä¼šè‡ªåŠ¨åŠ å…¥å·¥ç¨‹çš„ä¾èµ–ï¼Œä½†æ˜¯å½“ä¸ºåº“åæ—¶ï¼Œå°±ä¸ä¼šè‡ªåŠ¨åŠ å…¥ä¹Ÿåšä¸åˆ°è‡ªåŠ¨ã€‚ä½†æ˜¯å½“åº“åå’Œtargetåä¸€æ ·æ—¶ï¼Œä¾èµ–æ˜¯å¯ä»¥åŠ ä¸Šçš„ï¼Œå¤§å¤šæ•°æƒ…å†µå…¶å®žæ˜¯ä¸€æ ·çš„ã€‚å¯æ˜¯åå·§æˆ‘ä»¬çš„åº“åå’Œtargetåå°±ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ‰æœ‰æ­¤é—®é¢˜ã€‚ è§£å†³æŽªæ–½ï¼šä¿®æ”¹conanæºç ï¼Œåœ¨conan_target_link_librariesä¸­æ˜¾å¼è°ƒç”¨add_dependenciesåŠ å…¥ä¾èµ–ï¼Œæˆ‘ä»¬çš„åº“åå’Œtargetåæ˜¯æœ‰å¯¹åº”å…³ç³»çš„ï¼Œä»Žåº“åå¾—åˆ°targetåï¼Œç„¶åŽè°ƒç”¨add_dependenciesã€‚ ï¼ˆ5ï¼‰ä¼šå‡ºçŽ°å‰¯ä½œç”¨ï¼ŒåŒ…ä¸èƒ½å•ç‹¬ç¼–è¯‘äº† ä½¿ç”¨æ•´ä½“æž„å»ºåŽï¼Œä¼šå‡ºçŽ°æœ‰äººé€šè¿‡â€¦è·³å‡ºåŒ…çš„æ ¹ç›®å½•ï¼Œè®¿é—®å…¶ä»–åŒ…çš„å¤´æ–‡ä»¶ï¼Œè¿™æ—¶æ˜¯å¯ä»¥æˆåŠŸç¼–è¯‘äº†ï¼Œä»Žè€ŒæŽ©ç›–äº†é—®é¢˜ã€‚ä½†æ˜¯å½“å•ç‹¬ç¼–è¯‘åŒ…æ—¶é—®é¢˜æš´éœ²äº†ã€‚ è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯å°†add_libraryç­‰æ–¹æ³•å°è£…äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ‰€æœ‰åŒ…ç»Ÿä¸€è°ƒç”¨å°è£…çš„ï¼Œç„¶åŽåœ¨å°è£…ç‰ˆæœ¬ä¸­æ£€æŸ¥targetçš„include_directoriesã€‚è¿™ä¸ªåŠžæ³•åªèƒ½æ£€æŸ¥include_directorieså±žæ€§ï¼Œå¤´æ–‡ä»¶é‡Œé¢#includeçš„æ— æ³•æ£€æŸ¥ã€‚ ï¼ˆ6ï¼‰å·¥ä½œåŒºçš„å…¶ä»–é™åˆ¶ buildæ–¹æ³•ä¸èƒ½æœ‰ç¼–è¯‘é€»è¾‘ï¼ŒåŒ…æ‹¬å‘CMakeä¼ é€’å˜é‡ï¼Œåªèƒ½ç›´æŽ¥è°ƒç”¨CMakeï¼Œæ‰€æœ‰ç¼–è¯‘é€»è¾‘å¿…é¡»åœ¨CMakeLists.txtä¸­ï¼› æ¯ä¸ªåŒ…å¯¼å‡ºçš„ç›®å½•ç»“æž„ï¼ˆäºŒè¿›åˆ¶åŒ…ä¸­çš„ç»“æž„ï¼‰å’Œæºç æœ¬èº«çš„ç›®å½•ç»“æž„å¿…é¡»ä¸€è‡´ã€‚æ‰€è°“åŒ…å¯¼å‡ºçš„ç›®å½•ç»“æž„ï¼Œå°±æ˜¯packageæ–¹æ³•ä¸­æ‹·è´çš„ç›®çš„ç›®å½•ã€‚å¦‚æžœä¸ä¸€è‡´ï¼Œä¸€ä¸ªè¡¥æ•‘æ–¹æ³•æ˜¯åœ¨package_infoæ–¹æ³•ä¸­çš„self.cpp_info.includedirs.appendåŠ å…¥å’Œå¯¼å‡ºç›®å½•ä¸ä¸€è‡´çš„æœ¬åœ°ç›®å½•ã€‚ ä¾‹å¦‚ï¼šæŸåŒ…ï¼Œå¯¼å‡ºç›®å½•æœ‰include/gsclientï¼Œä½†æœ¬åœ°ç›®å½•ä¸ºgsclient/includeï¼Œè¦ä¹ˆè°ƒæ•´æœ¬åœ°ç›®å½•ï¼Œä¹Ÿå˜æˆinclude/gsclientï¼Œè¦ä¹ˆåŠ å…¥self.cpp_info.includedirs.append(â€œgsclient/includeâ€)ã€‚ ä¸èƒ½é€šè¿‡self.deps_cpp_info[xxx].rootpathè®¿é—®libã€binå¤–çš„å…¶ä»–ç›®å½•ï¼Œå› ä¸ºåœ¨ç¼“å­˜ä¸­äºŒè¿›åˆ¶åŒ…çš„å¸ƒå±€æ˜¯æ‰€æœ‰å†…å®¹éƒ½åœ¨rootpathä¸‹ï¼Œä½†æ˜¯å·¥ä½œåŒºä¸­ï¼Œåªæœ‰äºŒè¿›åˆ¶å†…å®¹åœ¨rootpathä¸‹ï¼Œå…¶ä»–åœ¨æºç ç›®å½•ä¸‹ã€‚è¦æƒ³åœ¨ç¼“å­˜å’Œå·¥ä½œåŒºéƒ½èƒ½å·¥ä½œçš„æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡self.deps_cpp_info[xxx].include_pathsï¼Œç„¶åŽâ€¦è·³åˆ°ä¸Šä¸€çº§è®¿é—®ã€‚ ç¼–è¯‘æ—¶é—´å˜æ…¢é—®é¢˜ å‰é¢è¯´æ˜Žè¿‡åŒ…çš„æ‹†åˆ†åŽŸåˆ™ï¼Œå¯¹äºŽå¤ç”¨çš„åŒ…ï¼Œæœ€å¥½ä¸€ä¸ªåº“ä¸€ä¸ªåŒ…ï¼Œå› ä¸ºç›´æŽ¥çš„ä¸€ä¸ªé—®é¢˜æ˜¯ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é—´å˜é•¿ï¼ŒåŽŸå› æ˜¯å¤´æ–‡ä»¶æœç´¢è·¯å¾„å˜å¤šï¼Œå¯¼å…¥åº“å˜å¤šã€‚ä¾‹å¦‚å‡è®¾AåŒ…æœ‰2ä¸ªåº“a_1ã€a_2ï¼Œa_1éœ€è¦ä¾èµ–BåŒ…ï¼Œa_2éœ€è¦ä¾èµ–CåŒ…ï¼ŒBå’ŒCå„æœ‰10ä¸ªå¤´æ–‡ä»¶è·¯å¾„ï¼Œé‚£ä¹ˆa_1å’Œa_2çš„æœç´¢è·¯å¾„å°±éƒ½æ˜¯20ä¸ªï¼Œä¸æ˜¯10ä¸ªã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹conançš„å¤´æ–‡ä»¶è·¯å¾„å’Œåº“éƒ½æ˜¯ä»¥åŒ…ä¸ºç²’åº¦çš„ã€‚ ä¸€ä¸ªç¼“è§£çš„åŠžæ³•æ˜¯å¯ç”¨TARGETESï¼ŒåŽŸæ¥æ˜¯è°ƒç”¨conan_basic_setup()ï¼ŒçŽ°åœ¨å˜æˆè°ƒç”¨conan_basic_setup(TARGETES)ï¼Œç„¶åŽåŽŸæ¥a_1ã€a_2æ˜¯è°ƒç”¨conan_target_link_libraries(a_1)ã€conan_target_link_libraries(a_2)ï¼ŒçŽ°åœ¨å˜æˆäº†target_link_libraries(a_1 CONAN_PKG::B)ã€target_link_libraries(a_2 CONAN_PKG::C)ã€‚è¿™æ ·a_1å’Œa_2çš„æœç´¢è·¯å¾„å°±éƒ½æ˜¯10ä¸ªã€‚ å¦å¤–å°½é‡é¿å…å› ä¸ºä¾èµ–ä¼ é€’è€Œå¯¼è‡´ä¾èµ–ä¸éœ€è¦çš„åº“ï¼Œå¯ä½¿ç”¨privateä¾èµ–ã€‚å½“åªæœ‰cppä¾èµ–æŸä¸ªåŒ…ï¼Œå¯¼å‡ºå¤´æ–‡ä»¶ä¸éœ€è¦ä¾èµ–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨privateä¾èµ–ï¼Œè¿™æ ·è¿™ä¸ªä¾èµ–çš„åŒ…å°±ä¸ä¼šæ‰©æ•£å‡ºåŽ»ã€‚ ä»¥ä¸Šåªæ˜¯ç¼“è§£çš„åŠžæ³•ï¼Œæœ€å¥½çš„åŠžæ³•è¿˜æ˜¯ä¸€ä¸ªåº“ä¸€ä¸ªåŒ…ï¼Œåšåˆ°ä¾èµ–æœ€å°åŒ–ï¼Œç²¾ç¡®çš„ä¾èµ–ã€‚ ç£ç›˜ç©ºé—´é—®é¢˜ æˆ‘ä»¬çš„å¼€å‘çŽ¯å¢ƒé‡‡ç”¨çš„äº‘æ¡Œé¢ï¼Œæ¯ä¸ªäººåªæœ‰40Gç£ç›˜ç©ºé—´ï¼Œæ‰€ä»¥ç£ç›˜ç©ºé—´æˆäº†ä¸€ä¸ªé‡è¦é—®é¢˜ã€‚æŒ‰ç…§å¸¸è§„çš„åšæ³•ï¼Œæ¶ˆè´¹åŒ…çš„ä¸€æ–¹ï¼Œåªèƒ½ä»Žconanç¼“å­˜ä¸­èŽ·å–ã€‚è¿™æ ·é‡‡ç”¨å·¥ä½œåŒºç¼–è¯‘åŽï¼Œè¿˜éœ€è¦export-pkgåˆ°ç¼“å­˜ï¼Œç„¶åŽè¿è¡Œçš„æ—¶å€™è¿˜éœ€è¦importåˆ°è¿è¡Œç›®å½•ï¼Œè¿™æ ·å°±ä¼šåŒæ ·çš„å†…å®¹æœ‰ä¸‰ä»½ã€‚æˆ‘ä»¬çš„ç¨‹åºç”¨çš„debugç‰ˆï¼Œå¸¦pdbæ–‡ä»¶ï¼Œæ›´åŠ é‡ç£ç›˜è´Ÿæ‹…ï¼Œä¸Šè¿°40Gç©ºé—´è¿œè¿œä¸å¤Ÿã€‚ ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œé¦–å…ˆæ¶ˆè´¹åŒ…çš„ä¸€æ–¹èƒ½å¦ç›´æŽ¥ä»Žå·¥ä½œåŒºè®¿é—®å¤´æ–‡ä»¶å’Œå¯¼å‡ºåº“ï¼Œæˆ‘æƒ³äº†ä¸€ä¸ªåŠžæ³•ï¼Œç›´æŽ¥å°†å·¥ä½œåŒºä¸­é›†æˆåŒ…çš„conanbuildinfo.cmakeã€conanbuildinfo.txtã€conaninfo.txtæ–‡ä»¶æ‹·è´åˆ°æ¶ˆè´¹åŒ…ï¼Œä¸è¿è¡Œconan installï¼Œæ‰“é€šäº†ç¬¬ä¸€å…³ã€‚å…¶æ¬¡è¿è¡Œæ—¶èƒ½å¦ä¸ç”¨importï¼Œå‰é¢æåˆ°äº†virtualrunenvç”¨ä¸äº†ï¼Œæœ€åŽä½¿ç”¨çš„åŠžæ³•æ˜¯è§£æžconanbuildinfo.txtæ–‡ä»¶ï¼Œå°†ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶å»ºç«‹è½¯é“¾æŽ¥åˆ°è¿è¡Œç›®å½•ä¸‹ï¼Œwindowsä¸‹æ˜¯mklinkå‘½ä»¤ã€‚è¿™æ ·å°±ç¡®ä¿äº†åŒ…çš„äºŒè¿›åˆ¶æ–‡ä»¶åªå­˜åœ¨ä¸€ä»½ã€‚ å…¼å®¹æ€§é—®é¢˜ package_id conanæ˜¯ç”¨package_idå”¯ä¸€æ ‡è¯†ä¸€ä¸ªäºŒè¿›åˆ¶åŒ…ï¼ŒåŒä¸€ä¸ªåŒ…çš„ä¸åŒäºŒè¿›åˆ¶åŒ…çš„package_idæ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ä¸å…¼å®¹çš„ã€‚package_idæ˜¯æŽ§åˆ¶å…¼å®¹æ€§çš„ä¸€ç§æ‰‹æ®µï¼Œå¦‚æžœä¸å…¼å®¹äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦è®©package_idäº§ç”Ÿæ–°çš„ã€‚å¦‚æžœpackage_idæ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆä¹‹å‰uploadåˆ°remoteçš„äºŒè¿›åˆ¶åŒ…è¿˜å¯ä»¥ä½¿ç”¨ï¼Œä¹Ÿå°±æ„å‘³ç€æ‰¿è®¤æ˜¯å…¼å®¹çš„ã€‚ package_idæœ‰ä¸€ä¸ªé»˜è®¤çš„ç”Ÿæˆè§„åˆ™ï¼Œæ ¹æ®å¦‚ä¸‹å†…å®¹çš„å˜åŒ–ï¼š ï¼ˆ1ï¼‰è‡ªèº«settingsæˆ–optionså˜åŒ–ï¼› ï¼ˆ2ï¼‰requireåŒ…çš„å¢žå‡ï¼Œä¹Ÿå°±æ˜¯nameå˜åŒ–ï¼› ï¼ˆ3ï¼‰requireåŒ…çš„ç‰ˆæœ¬å˜åŒ–ï¼Œè¿™æ—¶é»˜è®¤æ˜¯æŒ‰ç…§SemVerè§„èŒƒï¼Œ1.0.0ä¹‹å‰æ€»æ˜¯å½±å“ï¼Œ1.0.0ä¹‹åŽåªæœ‰ä¸»ç‰ˆæœ¬å·å˜åŒ–æ‰å½±å“ã€‚ ä¸Šè¿°ï¼ˆ2ï¼‰ï¼ˆ3ï¼‰ä¸ä»…å½±å“è‡ªå·±ï¼Œä¸‹æ¸¸çš„åŒ…éƒ½ä¼šå—å½±å“ï¼Œæ‰€è°“ä¸‹æ¸¸ï¼Œä¾‹å¦‚Aä¾èµ–Bï¼ŒAå°±æ˜¯ä¸‹æ¸¸ï¼Œé‚£ä¹ˆè‡ªèº«å’Œä¸‹æ¸¸å…¨éƒ¨éƒ½éœ€è¦é‡æ–°ç¼–è¯‘ä¸Šä¼ ï¼Œäº†è§£äº†ä¸Šè¿°è§„åˆ™ä¹‹åŽï¼Œä¼šå¸®åŠ©æˆ‘ä»¬è§£å†³ä¸¤ç±»é—®é¢˜ï¼š ï¼ˆ1ï¼‰ä¿®æ”¹conanfile.pyæ–‡ä»¶åŽï¼Œå¯¼è‡´æ‰¾ä¸åˆ°æŸäº›äºŒè¿›åˆ¶åŒ…ï¼Œå°±æ˜¯å› ä¸ºpackage_idå‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ä¸Šä¼ ï¼› ï¼ˆ2ï¼‰å¦‚æžœæ‰€æœ‰åŒ…çš„ç‰ˆæœ¬ä¸¥æ ¼æŒ‰ç…§SemVerè§„èŒƒï¼Œé‚£ä¹ˆæŒ‰ç…§é»˜è®¤çš„package_idç”Ÿæˆè§„åˆ™æ˜¯å¯ä»¥è‰¯å¥½è¿è¡Œçš„ï¼Œä½†æ˜¯ä¹Ÿä¼šæœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œconanæä¾›äº†æ–¹æ³•ä¿®æ”¹ä¸Šè¿°é»˜è®¤è§„åˆ™ï¼Œä¾‹å¦‚å¯ä»¥è®©requireåŒ…çš„minoræˆ–patchç‰ˆæœ¬å·ä¹Ÿå‚ä¸Žè®¡ç®—ã€‚ å‡çº§åŒ…ç‰ˆæœ¬ å‡çº§æŸä¸ªåŒ…ä¾èµ–çš„åŒ…çš„ç‰ˆæœ¬ä¹‹åŽï¼Œè‡ªèº«çš„ç‰ˆæœ¬å·æ˜¯å¦éœ€è¦å‡çº§ï¼Œè¿™ä¹Ÿæ˜¯å›°æ‰°æˆ‘ä»¬çš„é—®é¢˜ã€‚ ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜Žï¼Œå‡è®¾A/1.0.0ï¼ŒA/1.1.0éƒ½ä¾èµ–C/1.0.0ï¼ŒC/1.0.0ä¾èµ–D/1.0.0ã€‚A/1.0.0æ˜¯ä¹‹å‰é‡Šæ”¾çš„ç‰ˆæœ¬ï¼ŒA/1.1.0æ˜¯æ­£åœ¨å¼€å‘çš„ç‰ˆæœ¬ï¼ŒC/1.0.0ï¼ŒD/1.0.0æ˜¯å…¬å…±åº“ã€‚åœ¨å¼€å‘A/1.1.0çš„è¿‡ç¨‹ä¸­å‡çº§Dä¸º1.1.0ï¼ŒCçš„ä»£ç æ²¡æœ‰æ”¹åŠ¨ã€‚é‚£ä¹ˆæ­¤æ—¶Cçš„ç‰ˆæœ¬æ˜¯å¦éœ€è¦å‡çº§ï¼Ÿ æ–¹æ¡ˆ é—®é¢˜ è§£å†³æŽªæ–½ æ˜¯å¦æŽ¨è æ–¹æ¡ˆä¸€ Cå‡çº§ç‰ˆæœ¬å·ä¸º1.1.0 ä»£ç æ²¡æœ‰ä»»ä½•æ”¹åŠ¨å´å‡çº§ç‰ˆæœ¬å· å¦ æ–¹æ¡ˆäºŒ Cä¸å‡çº§ç‰ˆæœ¬å·ä½†requireæ”¹ä¸ºD/1.1.0 å¯¼è‡´A/1.0.0å†æ¬¡ç¼–è¯‘æ—¶ä½¿ç”¨äº†æ–°ç‰ˆæœ¬Dï¼Œä½†æ˜¯A/1.0.0æ˜¯å·²ç»é‡Šæ”¾çš„ å¦ æ–¹æ¡ˆä¸‰ Cä¸å‡çº§ç‰ˆæœ¬å·ä¸”ä¸ä¿®æ”¹requireï¼Œåœ¨A/1.1.0ä¸­overrideä¸ºD/1.1.0 ä»ŽCçš„recipeæ— æ³•createå‡ºä¾èµ–æ–°ç‰ˆDçš„åŒ…(è¿™ä¸ªä¾‹å­ä¸­Dä»Ž1.0.0åˆ°1.1.0æ˜¯å…¼å®¹çš„ï¼Œä¸éœ€è¦é‡ç¼–Cï¼Œå¦‚æžœDå˜æˆ2.0.0å°±éœ€è¦é‡ç¼–C) ä¸‹æ¸¸åŒ…ä½¿ç”¨â€“build=missing æ˜¯ æ€»ä¹‹ï¼Œåªæœ‰ä¿®æ”¹äº†ä»£ç æ‰å‡çº§ç‰ˆæœ¬å·ã€‚ override å‰é¢æåˆ°ä¸Šæ¸¸åŒ…æˆ–è€…æ¶ˆè´¹åŒ…ä¸­å¯ä»¥overrideä¸‹æ¸¸åŒ…çš„ç‰ˆæœ¬ã€‚ requireè¿˜å¯ä»¥å¢žåŠ overrideå‚æ•°ï¼Œå†™æ³•æ˜¯self.requires(â€œX/1.0.0@user/channelâ€, override=True)æˆ–è€…requires = ((â€œX/1.0.0@user/channelâ€, â€œoverrideâ€))ã€‚ é‚£ä¹ˆå¸¦ä¸Šoverrideå‚æ•°æ˜¯ä»€ä¹ˆä½œç”¨å‘¢ï¼Œå…¶å®žæ˜¯é’ˆå¯¹æ¡ä»¶åŒ–requireçš„ï¼Œå¦‚æžœå­˜åœ¨overrideçš„åŒ…ï¼Œå°±overrideç‰ˆæœ¬å·ï¼Œå¦‚æžœä¸å­˜åœ¨ï¼Œå°±ä¸ä¼šå¼•å…¥ä¾èµ–ã€‚æ‰€ä»¥è¿™ä¸ªoverrideåå­—å–å¾—ä¸å¤ªå¥½ï¼Œå…¶å®žä¸å¸¦overrideå‚æ•°ä¹Ÿæ˜¯overrideçš„ï¼Œåªæ˜¯è¿™æ—¶å³ä½¿ä¸Šæ¸¸æ²¡æœ‰è¿™ä¸ªåŒ…ï¼Œä¹Ÿä¼šå¼•å…¥ä¾èµ–ã€‚ overrideä¸€èˆ¬æ˜¯æ–°ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯ä»¥å›žé€€ç‰ˆæœ¬å—ï¼Ÿç­”æ¡ˆæ˜¯ç¼–è¯‘è™½ç„¶å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯å¯èƒ½å‡ºçŽ°å…¼å®¹æ€§é—®é¢˜ï¼Œæœ€å¥½åªç”¨äºŽå‡çº§ç‰ˆæœ¬ã€‚ è¿˜æœ‰ä¼šå‡ºçŽ°åŒæ—¶å­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬åŒ…å—ï¼Ÿç­”æ¡ˆæ˜¯ä¸ä¼šï¼Œconanä¼šæŠ¥é”™ï¼Œè¿™æ—¶å¿…é¡»åœ¨ä¸Šæ¸¸åŒ…overrideç‰ˆæœ¬å·ã€‚ ERROR: Conflict in CC/1.2.0@zhongpan/testing Requirement DD/1.1.0@zhongpan/testing conflicts with already defined DD/1.0.0@zhongpan/testing Keeping DD/1.0.0@zhongpan/testing To change it, override it in your base requirements è¿½è¸ªåŒ…ä¸Šä¼ æ—¥å¿— æœ‰æ—¶ä¼šå‡ºçŽ°æŸä¸ªäººæäº¤ä¸€ä¸ªåŒ…å¯¼è‡´äº§å“ç¼–è¯‘ä¸è¿‡ï¼Œå¦‚ä½•è¿½è¸ªè°æäº¤è¿‡åŒ…ï¼Œé€šè¿‡artifactoryæä¾›çš„aqlæŽ¥å£ï¼Œå¯ä»¥å¾ˆå®¹æ˜“æŸ¥è¯¢åˆ°ï¼Œä¸‹é¢çš„ä¾‹å­æŸ¥è¯¢äº†éžunm_ciç”¨æˆ·æäº¤çš„ï¼Œè¿‘å‡ å¤©æ»¡è¶³æ¡ä»¶çš„ä¸Šä¼ è®°å½•ï¼Œæ³¨æ„è¿™äº›è®°å½•æ˜¯ä»¥æ–‡ä»¶ä¸ºç²’åº¦çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#!/usr/bin/python# -*- coding: UTF-8 -*-import jsonimport requestsimport argparsefrom collections import OrderedDicturl = "http://10.170.3.50:8040/artifactory/api/search/aql"headers = &#123;"Content-Type":"text/plain","X-JFrog-Art-Api":"AKCp5dLCa9UmtgDdQGJzm87onMPyKHxpGJ7YDNTbQomQ8aEzEW8fXcFWMzbSJwufckLkSe6oU"&#125;data = '''items.find( &#123; "$and":[ &#123;"$or":[ &#123;"@conan.package.user":&#123;"$eq":"ext"&#125;&#125;, &#123;"@conan.package.user":&#123;"$eq":"core"&#125;&#125;, &#123;"@conan.package.channel":&#123;"$eq":"stable"&#125;&#125;, &#123;"@conan.package.channel":&#123;"$match":"%s"&#125;&#125; ]&#125;, &#123;"$rf":[ &#123;"$or":[ &#123;"property.key":&#123;"$eq":"conan.package.name"&#125;&#125;, &#123;"property.key":&#123;"$eq":"conan.package.version"&#125;&#125;, &#123;"property.key":&#123;"$eq":"conan.package.user"&#125;&#125;, &#123;"property.key":&#123;"$eq":"conan.package.channel"&#125;&#125;, &#123;"property.key":&#123;"$eq":"conan.settings.os"&#125;&#125;, &#123;"property.key":&#123;"$eq":"conan.settings.arch"&#125;&#125;, &#123;"property.key":&#123;"$eq":"conan.settings.build_type"&#125;&#125;, &#123;"property.key":&#123;"$eq":"conan.settings.compiler"&#125;&#125; ]&#125; ]&#125;, &#123;"modified":&#123;"$last":"%dd"&#125;&#125;, &#123;"modified_by":&#123;"$ne":"unm_ci"&#125;&#125; ] &#125;).include("modified_by","modified","name","type","path","archive").sort(&#123;"$desc" : ["modified"]&#125;)''' if __name__ == "__main__": parser = argparse.ArgumentParser() parser.add_argument("--channel", "-ch", help="channel in package recipe", type=str, default="*") parser.add_argument("--days", "-d", help="modified last days", type=int, default="1") args = parser.parse_args() try: r = requests.post(url, headers=headers, data=data % (args.channel, args.days)) if r.status_code == 200: results = OrderedDict() items = r.json()['results'] for item in items: paths = item['path'].split('/') if len(paths) &lt; 4: continue recipe = "%s/%s@%s/%s" % (paths[1], paths[2], paths[0], paths[3]) results[item['modified']] = (recipe, item['modified_by']) print u"æœ€è¿‘%då¤©ä¸Šä¼ åŒ…åˆ—è¡¨ï¼š" % args.days for key in results.keys(): print "%s, %s, %s" % (results[key][0],results[key][1],key) except Exception,e: print e é›†æˆIncrediBuildï¼ŒåŠ é€Ÿç¼–è¯‘é€Ÿåº¦ client/build/cmake.pyï¼š å…¨å±€ç¼–è¯‘é“¾æŽ¥å‚æ•° é€šè¿‡å¢žåŠ cmakeæ¨¡å—ï¼Œå°†add_libraryç­‰å°è£…ï¼Œæ‰€æœ‰åŒ…ä½¿ç”¨å°è£…ç‰ˆæœ¬ï¼Œåœ¨å°è£…ç‰ˆæœ¬ä¸­å¢žåŠ å…¨å±€ç¼–è¯‘é“¾æŽ¥å‚æ•°ã€‚ å…¶ä»–ä¸€äº›Bug ï¼ˆ1ï¼‰åŒ…åŽ‹ç¼©æ–‡ä»¶ä¸­æ²¡æœ‰åŒ…å«æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œå¯¼è‡´æ¯æ¬¡installä¸‹æ¥æ—¶é—´æ”¹å˜ï¼Œå¯¼è‡´é‡ç¼– client/remote_manager.pyï¼š ï¼ˆ2ï¼‰reading .count-fileæ–‡ä»¶ç¼–ç å¼•èµ·çš„é—®é¢˜ æ–°ç‰ˆæœ¬å·²ç»ä¿®æ”¹ï¼Œè§githubã€‚ æˆ‘çš„ä¿®æ”¹æ–¹æ³•ï¼Œutil/locks.pyï¼š ï¼ˆ3ï¼‰çŽ¯å¢ƒå˜é‡å¤„ç†å¼‚å¸¸ åœ¨å°‘æ•°çŽ¯å¢ƒé‡åˆ°è¿‡æ­¤é—®é¢˜ï¼Œä¸æ˜¯æ‰€æœ‰çŽ¯å¢ƒéƒ½æœ‰ï¼Œåšäº†å¦‚ä¸‹ä¿®æ”¹ã€‚ client/tools/env.pyï¼š åŒ…çš„è®¾è®¡ ä¸ºäº†å¿«é€Ÿå¼•å…¥åŒ…ç®¡ç†ï¼Œæˆ‘ä»¬å°†å¹³å°å±‚æ•´ä½“è¿›è¡Œäº†åŒ…åŒ–ï¼Œå…¶ä¸­å®žé™…ä¸ŠåŒ…å«ä¸€äº›å¹¶ä¸æ˜¯ä¸ºäº†å¤ç”¨çš„æ¨¡å—ï¼Œè¿™æ˜¯å¯¹çŽ°çŠ¶çš„å¦¥åï¼ŒåŒ…åŒ–çš„è¿‡ç¨‹å¹¶æ²¡æœ‰å¯¹åŽŸæœ‰æ¨¡å—ç»“æž„è¿›è¡Œè°ƒæ•´ï¼Œåªæ˜¯å°†å®ƒä»¬ç®€å•èšåˆä¸ºåŒ…ã€‚ å›žè¿‡å¤´å†æ¥æƒ³ï¼Œå¦‚æžœä»Žé›¶å¼€å§‹è®¾è®¡ï¼Œæœ€å…³é”®çš„è¿˜æ˜¯åˆ’åˆ†å¥½æ¨¡å—ï¼Œç„¶åŽæ‰è€ƒè™‘å“ªäº›ç”¨conanç®¡ç†ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå…±æœ‰70å¤šä¸ªæœåŠ¡ï¼Œä»£ç è€¦åˆä¸¥é‡ï¼š ï¼ˆ1ï¼‰åˆ†æˆäº†å¹³å°å±‚å’Œäº§å“å±‚2ä¸ªSVNï¼Œä»£ç æ‰åœ¨ä¸€èµ·ï¼ŒæœåŠ¡ä¸èƒ½å•ç‹¬ç¼–è¯‘ï¼Œä¸èƒ½ç‹¬ç«‹ç»´æŠ¤ï¼› ï¼ˆ2ï¼‰ç”±äºŽä¸Šé¢ä»£ç æ‰åœ¨ä¸€èµ·ï¼Œæ¨¡å—é—´çš„ä¾èµ–å…³ç³»é”™ç»¼å¤æ‚ï¼Œå®Œå…¨å¤±æŽ§ï¼› è¿™æ ·ä¸€é”…ç²¥çš„ä»£ç å¯æƒ³è€ŒçŸ¥ç»´æŠ¤æ˜¯å¾ˆç—›è‹¦çš„ï¼Œæœ€å¤§çš„é—®é¢˜æ˜¯åˆ†æ”¯å¤šã€åˆå¹¶éš¾ã€æµ‹è¯•å·¥ä½œé‡å¤§ã€‚å½“ä¸‹æµè¡Œçš„å¾®æœåŠ¡çš„ç†å¿µæ­£æ˜¯æ‹¯æ•‘æˆ‘ä»¬çš„è‰¯è¯ï¼Œä½•å†µæˆ‘ä»¬æœ¬æ¥å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚æˆ‘è®¾æƒ³çš„éœ€è¦åšå¦‚ä¸‹æ‹†åˆ†ï¼š ï¼ˆ1ï¼‰æŒ‰ç…§æœåŠ¡å°†ä»£ç æ‹†åˆ†åˆ°ä¸åŒçš„Groupï¼Œæ¯ä¸ªGroupæœ‰è‹¥å¹²ç›¸å…³çš„projectï¼Œæ¯ä¸ªprojectå¯ä»¥ç‹¬ç«‹ç¼–è¯‘ï¼› ï¼ˆ2ï¼‰æ¯ä¸ªæœåŠ¡èƒ½å¤Ÿç‹¬ç«‹éƒ¨ç½²ã€ç‹¬ç«‹è¿è¡Œï¼› ï¼ˆ3ï¼‰æœåŠ¡ä¹‹é—´ä¸èƒ½æœ‰ç¼–è¯‘æ—¶çš„ä¾èµ–ï¼Œåªä¾èµ–æŽ¥å£å¥‘çº¦æˆ–APIï¼› ç†æƒ³çš„æƒ…å†µæœåŠ¡ä¹‹é—´åªé€šè¿‡æŽ¥å£é”²çº¦è®¿é—®ï¼Œä¸ä¾èµ–æœåŠ¡å†…éƒ¨ä¸šåŠ¡å¯¹è±¡å®šä¹‰ï¼Œç”±æŽ¥å£é”²çº¦è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œç¼–è¯‘åˆ°å®¢æˆ·ç«¯æœåŠ¡é‡Œé¢ã€‚å¯¹äºŽä¸€äº›å¤æ‚çš„åœºæ™¯ï¼Œä¾‹å¦‚éœ€è¦å¢žåŠ ä¸€äº›ç¼“å­˜æœºåˆ¶ï¼Œä¼˜åŒ–å®¢æˆ·ç«¯çš„è®¿é—®æ•ˆçŽ‡ï¼Œå¯ä»¥å°è£…ä¸ºæœ¬åœ°APIï¼Œä¾›å…¶ä»–æœåŠ¡è°ƒç”¨ã€‚ ï¼ˆ4ï¼‰æ¯ä¸ªæœåŠ¡è®¿é—®ä¸åŒçš„æ•°æ®åº“ï¼› ï¼ˆ5ï¼‰æœåŠ¡ç‹¬äº«çš„åº“æ”¾åˆ°æœåŠ¡é‡Œé¢ï¼Œåªæœ‰å¤šä¸ªæœåŠ¡å…±äº«çš„åº“æ”¾åˆ°ç‹¬ç«‹çš„å…¬å…±åº“ä¸­ï¼›æžç«¯æƒ…å†µä¸‹ï¼Œå…¬å…±åº“éƒ½æ˜¯ä¸šåŠ¡æ— å…³çš„ï¼Œå‡¡ä¸šåŠ¡ç›¸å…³çš„é€šè¿‡æœåŠ¡æä¾›RPCæŽ¥å£ï¼› ï¼ˆ6ï¼‰ä¸åŒæœåŠ¡è¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„å…¬å…±åº“ã€‚ æŒ‰ç…§è¿™æ ·çš„æ¨¡å—åˆ’åˆ†ä¹‹åŽï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰projectéƒ½éœ€è¦ä½¿ç”¨conanç®¡ç†ï¼Œåªæœ‰å¤ç”¨çš„projectéœ€è¦ï¼Œä¹Ÿå°±æŽ¥å£å¥‘çº¦ã€APIã€å…¬å…±åº“è¿™äº›ï¼ŒæœåŠ¡å°±ä½œä¸ºåŒ…æ¶ˆè´¹è€…å°±å¯ä»¥äº†ã€‚ æœ€åŽ ä»¥ä¸Šå°±æ˜¯æˆ‘ä½¿ç”¨conanä¸€å¹´æ¥çš„ä¸€äº›æ€»ç»“å’Œæ€è€ƒï¼Œå¸Œæœ›å¯¹C++çš„åŒå­¦æœ‰æ‰€å¸®åŠ©ã€‚conanæ˜¯ä¸€ä¸ªå¿«é€Ÿæˆé•¿çš„å¼€æºé¡¹ç›®ï¼Œè¿­ä»£éžå¸¸å¿«ï¼Œæˆ‘ä¸ªäººè§‰å¾—å¾ˆå¯èƒ½æˆä¸ºC++åŒ…ç®¡ç†çš„äº‹å®žæ ‡å‡†ï¼Œéžå¸¸çœ‹å¥½å®ƒã€‚å¦å¤–C++æœ¬èº«åœ¨ä»Šå¹´å°†è¿Žæ¥ä¸€ä¸ªé‡é‡çº§ç‰ˆæœ¬C++20ï¼Œå…¶ä¸­æ¨¡å—ã€åç¨‹ç›¸ä¿¡æ˜¯å¤§å®¶æœŸå¾…å·²ä¹…çš„ç‰¹æ€§ã€‚éšç€C++è‡ªèº«çš„ä¸æ–­é©æ–°å’Œå‘¨è¾¹å·¥å…·çš„å……å®žï¼Œæˆ‘ç›¸ä¿¡è¿™äº›ä¼šâ€Make CPP great again!â€œã€‚]]></content>
      <categories>
        <category>åŒ…ç®¡ç†</category>
      </categories>
      <tags>
        <tag>c++</tag>
        <tag>conan</tag>
        <tag>åŒ…ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨traefikåå‘ä»£ç†k8s dashboard]]></title>
    <url>%2F2019%2F11%2F28%2F021-ingress-k8s-dashboard-with-traefik%2F</url>
    <content type="text"><![CDATA[ç”Ÿäº§çŽ¯å¢ƒä¸‹ï¼Œk8sé›†ç¾¤å¯¹å¤–æš´éœ²æœåŠ¡ä¸»è¦æœ‰LoadBalancerå’ŒIngressä¸¤ç§æ–¹å¼ï¼š LoadBalancerï¼šéœ€è¦äº‘åŽ‚å•†æ”¯æŒï¼Œä½¿ç”¨k8s serviceçš„è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯ä¾é iptables/ipvsçš„èƒ½åŠ›ï¼Œå¯ç”¨äºŽå„ç§åè®® Ingressï¼šç›¸å¯¹æ›´åŠ çµæ´»ï¼Œé€šè¿‡åå‘ä»£ç†æœåŠ¡å™¨å®žçŽ°è´Ÿè½½å‡è¡¡ï¼Œä»…ç”¨äºŽhttp/httpsåè®®ï¼Œè¿™ç§åœºæ™¯ä¸‹éœ€è¦é¢å¤–çš„åå‘ä»£ç†æœåŠ¡ä»¥åŠingress controllerï¼Œnginxæ˜¯å¤§å®¶ç†ŸçŸ¥çš„åå‘ä»£ç†ï¼Œåœ¨k8sæ—¶ä»£ï¼Œå‡ºçŽ°äº†nginx-ingressï¼Œå°±æ˜¯nginx+ingress controllerçš„ç»„åˆï¼Œingress controllerè´Ÿè´£æ ¹æ®ingressèµ„æºç”Ÿæˆnginxé…ç½®ï¼Œå½“é…ç½®æœ‰å˜åŒ–æ—¶é‡å¯nginxã€‚åŒæ—¶ä¹Ÿå‡ºçŽ°äº†äº‘åŽŸç”Ÿçš„åå‘ä»£ç†traefikï¼Œå®ƒç›¸å½“äºŽæŠŠingress controlleråŒ…å«åˆ°å…¶ä¸­åˆä¸ºä¸€ä½“ï¼Œå¹¶ä¸”èƒ½å¤ŸåŠ¨æ€æ„ŸçŸ¥è·¯ç”±è§„åˆ™å˜åŒ–ï¼Œä¸éœ€é‡å¯ã€‚ traefikæ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„åå‘ä»£ç†ï¼Œç½‘ä¸Šç›¸å…³èµ„æ–™ä¸æ˜¯ç‰¹åˆ«ä¸°å¯Œï¼Œç ”ç©¶äº†å¥½å‡ å¤©ï¼Œæ‰æˆåŠŸè®¿é—®åˆ°k8s dashboardï¼Œå°†å…¶ä¸­çš„å…³é”®ç‚¹è®°å½•äºŽæ­¤ã€‚ å®‰è£…traefik ä½¿ç”¨helmå®‰è£…ï¼Œæœ€æ–°chartä½¿ç”¨çš„traefik 1.7.19ï¼š 1helm install stable/traefik -f traefik-values.yaml traefik-values.yamlï¼š 1234567891011121314151617181920212223rbac: enabled: truedashboard: enabled: true # å¯ç”¨traefik dashboard ingress: annotations: traefik.ingress.kubernetes.io/rule-type: PathPrefixStripdeployment: hostPort: httpEnabled: true # traefik podæ‰€åœ¨nodeä¸Šå¼€å¯80ç«¯å£ httpsEnabled: true # traefik podæ‰€åœ¨nodeä¸Šå¼€å¯443ç«¯å£ dashboardEnabled: true # traefik podæ‰€åœ¨nodeä¸Šå¼€å¯8080ç«¯å£ï¼Œå…±traefik dashboardä½¿ç”¨ssl: insecureSkipVerify: true # frontendä¸éªŒè¯httpsçš„benkend enabled: true # å¯ç”¨httpså…¥å£extraVolumes: - name: traefik-ssl hostPath: path: /share/k8s/traefik/ssl # å…¶ä¸­å­˜æ”¾httpså…¥å£çš„è¯ä¹¦å’Œkeyï¼Œåå­—å¿…é¡»ä¸ºtls.crt,tls.key type: DirectoryOrCreateextraVolumeMounts: - name: traefik-ssl mountPath: /ssl # traefik podä»Ž/sslç›®å½•è¯»å–ä¸Šè¿°tls.crt,tls.key è¯¦ç»†çš„é…ç½®æ–¹æ³•è§å®˜æ–¹æ–‡æ¡£ï¼Œä¸Šè¿°å…³é”®ç‚¹å¦‚ä¸‹ï¼š å¼€å¯httpså…¥å£ï¼Œè®¾ç½®ssl.enabled=trueï¼Œç„¶åŽæä¾›è¯ä¹¦å’Œkeyï¼Œä¸Šè¿°é€šè¿‡ä»ŽnodeèŠ‚ç‚¹æœ¬åœ°ç›®å½•mountåˆ°podçš„æ–¹å¼ï¼Œæ‰€ä»¥æ¯ä¸ªnodeèŠ‚ç‚¹è¦å…ˆæ”¾å¥½è¯ä¹¦å’Œkeyï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡k8s secretï¼Œåˆ›å»ºsecretç„¶åŽmountåˆ°pod å¦‚ä½•è®¿é—®åˆ°å…¥å£ï¼Œæˆ‘æ˜¯é€šè¿‡åœ¨nodeä¸Šæ‰“å¼€ç«¯å£ï¼Œè¿™æ—¶é€šè¿‡podæ‰€åœ¨nodeå°±å¯ä»¥è®¿é—®åˆ°å…¥å£ï¼Œé€šè¿‡http://nodeipæˆ–https://nodeipï¼›è¿˜å¯ä»¥ä½¿ç”¨NodePortç±»åž‹serviceï¼Œè¿™æ ·é€šè¿‡http://any-nodeip:http-nodeportæˆ–https://any-nodeip:https-nodeportè®¿é—®ï¼Œvalueè®¾ç½® serviceType: NodePort è·¯ç”±åŒ¹é…è§„åˆ™æˆ‘ä½¿ç”¨çš„PathPrefixStripï¼Œé»˜è®¤æ˜¯hostååŒ¹é… å› ä¸ºå¯ç”¨äº†traefik dashboardï¼Œå®‰è£…traefikä¼šè‡ªåŠ¨åˆ›å»ºdashboardçš„ingressï¼š 1234567891011121314151617181920apiVersion: extensions/v1beta1kind: Ingressmetadata: annotations: traefik.ingress.kubernetes.io/rule-type: PathPrefixStrip labels: app: traefik chart: traefik-1.82.1 heritage: Tiller release: traefik name: traefik-dashboard namespace: defaultspec: rules: - host: traefik.example.com http: paths: - backend: serviceName: traefik-dashboard servicePort: dashboard-http traefikæ˜¯é€šè¿‡æ ‡ç­¾app: traefiké€‰æ‹©åˆ°éœ€è¦æ„ŸçŸ¥çš„ingressã€‚è‡ªå·±æ·»åŠ çš„ingressæ³¨æ„åŒ…å«è¿™ä¸ªæ ‡ç­¾ã€‚ä¸Šè¿°annotationså’Œhostæ˜¯ä»Žvalueè€Œæ¥ã€‚å› ä¸ºæˆ‘ä¸æƒ³é…hostï¼Œæ‰€ä»¥ç”¨PathPrefixStripè·¯ç”±è§„åˆ™ï¼Œæˆ‘ä¿®æ”¹äº†ä¸Šè¿°ingresså¦‚ä¸‹: 12345678spec: rules: - http: paths: - backend: serviceName: traefik-dashboard servicePort: dashboard-http path: /traefik è¿™æ ·å½“ä½¿ç”¨http://nodeip/traefikå°±å¯ä»¥è®¿é—®åˆ°dashboardï¼Œå› ä¸ºåœ¨nodeä¸Šä¹Ÿå¼€å¯äº†dashboardç«¯å£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡http://nodeip:8080è®¿é—®ã€‚ ä»£ç†k8s dashboard ç›®å‰æœ€æ–°çš„k8s dashboard(v2.0.0-beta6)å®‰è£…åœ¨kubernetes-dashboard namespaceï¼š 1234kubectl get svc -n kubernetes-dashboardNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEdashboard-metrics-scraper ClusterIP 10.254.238.13 &lt;none&gt; 8000/TCP 21dkubernetes-dashboard LoadBalancer 10.254.253.226 &lt;pending&gt; 443:30223/TCP 21d å¢žåŠ ingressï¼š 1234567891011121314151617apiVersion: extensions/v1beta1kind: Ingressmetadata: annotations: traefik.ingress.kubernetes.io/rule-type: PathPrefixStrip labels: app: traefik name: kubernetes-dashboard namespace: defaultspec: rules: - http: paths: - backend: serviceName: kubernetes-dashboard servicePort: 443 path: /k8s ä»£ç†httpsåŽç«¯ k8s dashboardåªæ”¯æŒhttpsè®¿é—®ï¼Œé¦–å…ˆå¡ä½çš„é—®é¢˜æ˜¯å¦‚ä½•ä»£ç†httpsæœåŠ¡ï¼Œfrontendåˆ°backendçš„è·¯ç”±ä¼šå‡ºçŽ°ä»¥ä¸‹å‡ ç§æƒ…å½¢ï¼š http-&gt;http http-&gt;https https-&gt;http https-&gt;https å½“backendä¸ºhttpsæ—¶ï¼Œæ— è®ºfrontendæ˜¯httpæˆ–httpsï¼Œä¹Ÿå°±æ˜¯2å’Œ4ï¼Œéƒ½ä¼šæŠ¥500é”™è¯¯ï¼Œå› ä¸ºfrontendæ— æ³•éªŒè¯backendï¼Œæ­¤æ—¶è§£å†³æ–¹æ³•ï¼š è¦ä¹ˆè®¾ç½®insecureSkipVerifyï¼Œè¿™æ ·æ¯”è¾ƒç®€å•ï¼Œå¦‚æžœé‡‡ç”¨è¿™ç§æ–¹å¼frontendæœ€å¥½æ€»æ˜¯é‡‡ç”¨httpsï¼Œä¹Ÿå°±æ˜¯è®¾ç½®redirect è¦ä¹ˆè®¾ç½®ingress tlsï¼Œé…ç½®hostçš„tlsè¯ä¹¦ä¿¡æ¯ æˆ‘é‡‡ç”¨çš„è®¾ç½®insecureSkipVerifyçš„æ–¹æ³•ã€‚ä¸€èˆ¬æœ€ä½³çš„ä½¿ç”¨æ–¹å¼ä¹Ÿæ˜¯å…¥å£æ€»æ˜¯ç”¨httpsï¼Œç„¶åŽç»ˆç»“tlsï¼ŒåŽç«¯æ˜¯å¦httpsä¸é‡è¦ã€‚ ä»£ç†ä¸åŒnamespaceæœåŠ¡ è§£å†³ä¸Šè¿°é—®é¢˜åŽï¼ŒæŽ¥ä¸‹æ¥é‡åˆ°k8s dashboardæœåŠ¡æ— æ³•è®¿é—®é—®é¢˜ï¼Œåœ¨traefik dashboardä¸­æ˜¾ç¤ºä¸ºçº¢è‰²ï¼ŒåŽŸå› æ˜¯helmå®‰è£…traefiké»˜è®¤åœ¨default namespaceä¸­ï¼Œè€Œk8s dashboardå®‰è£…åœ¨kubernetes-dashboard namespaceä¸­ï¼Œä¸èƒ½è·¨namespaceè®¿é—®åˆ°æœåŠ¡ï¼Œè§£å†³æ–¹æ³•ï¼š è¦ä¹ˆå°†traefikå®‰è£…åˆ°å’Œk8s dashboardåŒä¸€ç©ºé—´ è¦ä¹ˆé€šè¿‡ExternalNameå°†dashboard serviceå¼•å…¥åˆ°default namespace 1234567891011121314apiVersion: v1kind: Servicemetadata: name: kubernetes-dashboard namespace: defaultspec: ports: - name: https port: 443 protocol: TCP targetPort: 443 sessionAffinity: None type: ExternalName externalName: kubernetes-dashboard.kubernetes-dashboard.svc.cluster.local æˆ‘é‡‡ç”¨çš„ExternalNameæ–¹æ³•ã€‚serviceçš„å®Œæ•´åŸŸåæ˜¯servicename.namespace.svc.cluster.localï¼Œcluster.localæ˜¯kubeletä¸­é…ç½®çš„ã€‚ åŸºäºŽpathè·¯ç”± æœåŠ¡å¯ä»¥è®¿é—®äº†ï¼Œä½†æ˜¯åˆå‡ºçŽ°äº†MIME type is not a supported stylesheet MIME typeé”™è¯¯ã€‚ ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯traefikåœ¨reponse headerä¸­åŠ å…¥äº† X-Content-Type-Options: nosniffï¼Œä½†æ˜¯å‘çŽ°traefiké»˜è®¤æ˜¯ä¸åŠ å…¥çš„ã€‚ æœ€åŽå‘çŽ°æ˜¯urlè·¯å¾„é—®é¢˜ï¼Œæˆ‘çš„ingressä»…ä½¿ç”¨pathè·¯ç”±ï¼Œæ²¡æœ‰ä½¿ç”¨hostã€‚ å½“ä½¿ç”¨https://nodeip/k8sè®¿é—®k8s dashboardæ—¶ï¼Œå› ä¸ºè·¯ç”±è§„åˆ™æ˜¯PathPrefixStripï¼Œåˆ°åŽç«¯çš„è¯·æ±‚æ˜¯https://nodeipï¼Œè¿™æ—¶å¾—åˆ°ä¸»é¡µï¼Œæ–‡ä»¶åæ˜¯k8sï¼Œä¸»é¡µé¢k8sä¸­çš„css,jsç­‰æ–‡ä»¶è·¯å¾„æ˜¯ç›¸å¯¹äºŽå½“å‰æ–‡æ¡£è·¯å¾„çš„ï¼Œæ‰€ä»¥request urlæ˜¯https://nodeip/xxx.cssï¼Œè¿™æ—¶å°±åŒ¹é…ä¸ä¸Šè·¯ç”±è§„åˆ™ï¼Œå‡ºçŽ°ä¸Šè¿°é”™è¯¯ã€‚ å¦‚æžœä½¿ç”¨https://nodeip/k8s/è®¿é—®dashboardï¼Œå°±ä¸€åˆ‡æ­£å¸¸äº†ã€‚ æ‰€ä»¥ä½¿ç”¨è·¯å¾„åŒ¹é…è·¯ç”±æ—¶æ˜¯å­˜åœ¨ä¸€å®šé£Žé™©çš„ï¼Œå’Œä¸»é¡µä¸­çš„èµ„æºè·¯å¾„å®šä¹‰æœ‰å…³ï¼š ä¸»é¡µä¸­css,jsç­‰èµ„æºè·¯å¾„å®šä¹‰æ–¹å¼ è¯´æ˜Ž æ²¡æœ‰å®šä¹‰baseï¼Œèµ„æºè·¯å¾„ä¸ä»¥./æˆ–â€¦/æˆ–/å¼€å¤´æˆ–&lt;base href=&quot;./&quot;&gt;ï¼Œèµ„æºè·¯å¾„ä»¥./å¼€å¤´ 1.åŒ¹é…/pathæ—¶ï¼Œåªèƒ½é€šè¿‡https://xxxx/path/è®¿é—®2.åŒ¹é…/pathï¼Œå¹¶ä¸”åŽç«¯é‡å®šå‘åˆ°sub/ï¼Œè¿™æ—¶é€šè¿‡https://xxxx/path/æˆ–https://xxxx/pathéƒ½å¯ä»¥è®¿é—® &lt;base href=&quot;/&quot;&gt;ï¼Œèµ„æºè·¯å¾„ä¸ä»¥./æˆ–â€¦/æˆ–/å¼€å¤´ åªèƒ½åŒ¹é…/ï¼Œå…¶ä»–è·¯å¾„åŒ¹é…éƒ½æ— æ³•æ­£å¸¸å·¥ä½œç¡®å®žç¢°åˆ°è¿™ç§æƒ…å†µï¼Œä¾‹å¦‚monocular æ‰€ä»¥æœ€å¥½çš„æ–¹å¼è¿˜æ˜¯é€šè¿‡hoståŒ¹é…è·¯ç”±ã€‚ dashboardè®¤è¯ äº†è§£ä¸Šè¿°é—®é¢˜åŽï¼Œç»ˆäºŽè¿›å…¥åˆ°dashboardç™»é™†ç•Œé¢ï¼š ä¸€å¼€å§‹æˆ‘æ˜¯ä½¿ç”¨çš„httpå…¥å£ï¼Œä½¿ç”¨Tokenæ–¹å¼ç™»é™†ï¼Œæ²¡æœ‰ä»»ä½•å“åº”ï¼Œé€šè¿‡å¼€å‘è€…å·¥å…·æŸ¥çœ‹ï¼Œå‘çŽ°é—®é¢˜æ˜¯åœ¨ä½¿ç”¨httpå…¥å£æ—¶ï¼Œheaderä¸­æ²¡æœ‰æºå¸¦jweTokenï¼Œå¯¼è‡´è®¤è¯å¤±è´¥ï¼Œå¿…é¡»ä½¿ç”¨httpså…¥å£ã€‚ å›žæƒ³èµ·ä¹‹å‰é€šè¿‡kubectl proxyï¼Œå³http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/ä¹Ÿæ˜¯ç™»é™†ä¸äº†ï¼Œå…¶å®žæ˜¯ä¸€æ ·çš„é—®é¢˜ã€‚ ä½¿ç”¨httpå…¥å£ç™»é™†å¤±è´¥ï¼š ä½¿ç”¨httpså…¥å£æ—¶ï¼ŒjweTokenæ˜¯æºå¸¦äº†ï¼Œç™»é™†æˆåŠŸï¼š ) æ‰€ä»¥æžœæ–­è®¾ç½®frontendæ€»æ˜¯httpsï¼Œvalueså¢žåŠ traefik.ingress.kubernetes.io/redirect-entry-point: httpsï¼Œç„¶åŽhelm upgradeï¼Œè‡ªå·±å¢žåŠ çš„ingresséœ€è¦è‡ªå·±ä¿®æ”¹ï¼š 1234567dashboard: enabled: true ingress: annotations: traefik.ingress.kubernetes.io/rule-type: PathPrefixStrip traefik.ingress.kubernetes.io/redirect-entry-point: https # ä¸è¦ä½¿ç”¨ingress.kubernetes.io/ssl-redirect: "true"ï¼Œå› ä¸ºä¼šä¸¢æŽ‰path è¿™æ ·æ— è®ºä½¿ç”¨http://nodeip/k8s/è¿˜æ˜¯https://nodeip/k8s/éƒ½å¯ä»¥æˆåŠŸç™»é™†ã€‚]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>traefik</tag>
        <tag>k8s dashboard</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesç‰ˆæœ¬å·æ˜¯æ€Žä¹ˆç”Ÿæˆçš„]]></title>
    <url>%2F2019%2F11%2F19%2F020-kubernetes-version%2F</url>
    <content type="text"><![CDATA[é€šè¿‡æºç ç¼–è¯‘kubernetesæ—¶ï¼Œå¯ä»¥ä½¿ç”¨go build(æˆ–go install)å•ç‹¬ç¼–è¯‘æŸä¸ªç»„ä»¶ï¼Œä¾‹å¦‚å¯¹äºŽapiserverï¼Œå¯ä»¥cdåˆ°k8s.io/kubernetes/cmd/kube-apiserverï¼Œç„¶åŽæ‰§è¡Œï¼š 1go install -i -v -gcflags='-N -l' ç¼–è¯‘ç»“æžœå®‰è£…åˆ°GOBINä¸‹ï¼Œå³GOBIN/kube-apiserverï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ç¼–è¯‘æ—¶æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œç‰ˆæœ¬å·æ˜¯ä¸€æ®µå¥‡æ€ªçš„å­—ç¬¦ä¸²ï¼š 12kube-apiserver --versionKubernetes v0.0.0-master+$Format:%h$ åœ¨é‡åˆ°ä¸€äº›éœ€è¦ä¾èµ–kubernetesç‰ˆæœ¬å·çš„åœºæ™¯å°±ä¼šæœ‰é—®é¢˜ï¼Œä¾‹å¦‚ä½¿ç”¨helmå®‰è£…chartæ—¶ï¼Œæœ‰äº›chartå¯¹kubernetesç‰ˆæœ¬å·æœ‰è¦æ±‚ï¼Œå°±ä¼šæ— æ³•å®‰è£…ã€‚ æœ‰å“ªäº›ç‰ˆæœ¬å· kubernetesåœ¨å¾ˆå¤šåœºåˆéƒ½ä¼šçœ‹åˆ°ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹ã€‚ â€“version æ¯ä¸ªç»„ä»¶æœ‰â€“versionå‚æ•°ï¼Œè¿™æ—¶è¾“å‡ºæœ¬ç»„ä»¶çš„ç‰ˆæœ¬å·ã€‚ kubectl version 123kubectl versionClient Version: version.Info&#123;Major:"", Minor:"", GitVersion:"v0.0.0-master+$Format:%h$", GitCommit:"$Format:%H$", GitTreeState:"", BuildDate:"1970-01-01T00:00:00Z", GoVersion:"go1.12.9", Compiler:"gc", Platform:"linux/amd64"&#125;Server Version: version.Info&#123;Major:"1", Minor:"17+", GitVersion:"v1.17.0-alpha.3.227+7d13dfe3c34f44-dirty", GitCommit:"7d13dfe3c34f44ff505afe397c7b05fe6e5414ed", GitTreeState:"dirty", BuildDate:"2019-11-18T14:42:24Z", GoVersion:"go1.12.9", Compiler:"gc", Platform:"linux/amd64"&#125; Client Versionå³kubectlçš„ç‰ˆæœ¬å·ï¼ŒServer Versionå³apiserverçš„ç‰ˆæœ¬å·ã€‚ kubectl get nodes 1234kubectl get nodesNAME STATUS ROLES AGE VERSION10.10.10.15 Ready &lt;none&gt; 12d v1.17.0-alpha.3.227+7d13dfe3c34f44-dirty10.10.10.16 Ready &lt;none&gt; 11d v1.17.0-alpha.3.227+7d13dfe3c34f44-dirty æ­¤å¤„çš„ç‰ˆæœ¬å·ä¸ºkubeletçš„ç‰ˆæœ¬å·ã€‚ ç‰ˆæœ¬å·çš„å«ä¹‰ ä¸Šè¿°é•¿é•¿çš„ä¸€ä¸²ç‰ˆæœ¬å·v1.17.0-alpha.3.227+7d13dfe3c34f44-dirtyï¼Œçœ‹èµ·æ¥éžå¸¸å¤æ‚ï¼Œå…¶å®žç†Ÿæ‚‰gitçš„åŒå­¦ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ­£æ˜¯gitçš„æºç ç‰ˆæœ¬ä¿¡æ¯ã€‚ åˆ†è§£å­—æ®µ è¯´æ˜Ž v1.17.0-alpha.3 ä¸Šä¸€æ¬¡tagï¼Œè¡¨ç¤ºv1.17.0çš„ç¬¬3ä¸ªalphaç‰ˆæœ¬ 227 ä¸Šä¸€æ¬¡tagä¹‹åŽæäº¤æ•° 7d13dfe3c34f44 æœ€æ–°ä¸€æ¬¡æäº¤id dirty æºç æ˜¯å¦ä¿®æ”¹ è¿™é‡Œæè¿°äº†kubernetesçš„ç‰ˆæœ¬ç®¡ç†è§„åˆ™ï¼Œæ®æ­¤å¯ä»¥çœ‹å‡ºä¸Šè¿°ç‰ˆæœ¬ä¸€å®šæ˜¯åœ¨masteråˆ†æ”¯ä¸Šã€‚ ç‰ˆæœ¬å·å¦‚ä½•ç”Ÿæˆ é‚£ä¹ˆç‰ˆæœ¬å·æ˜¯å¦‚ä½•å†™å…¥åˆ°ç¨‹åºä¸­çš„ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š ä»ŽgitèŽ·å–æºç ç‰ˆæœ¬ä¿¡æ¯ v1.17.0-alpha.3.227+7d13dfe3c34f44è¿™ä¸€æ®µæ˜¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤èŽ·å–ï¼Œå¹¶ç¨ä½œè½¬æ¢ï¼š 12git describe --tags --match='v*' --abbrev=14v1.17.0-alpha.3-227-g7d13dfe3c34f44 å¦‚æžœtagä¹‹åŽæ²¡æœ‰å†æäº¤è¿‡ï¼Œåˆ™åŽé¢å°±æ²¡æœ‰æäº¤æ¬¡æ•°å’Œæœ€æ–°æäº¤idï¼Œåªæœ‰tagï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨releaseåˆ†æ”¯ä¸Šæœ€åŽé‡Šæ”¾æ—¶ã€‚ -dirtyæ˜¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤èŽ·å–ï¼Œå¦‚æžœæºç ä¿®æ”¹è¿‡åˆ™ç‰ˆæœ¬å·æ·»åŠ -dirtyï¼š 1git status --porcelain é€šè¿‡ldflagså°†ä¸Šè¿°èŽ·å–ç‰ˆæœ¬ä¿¡æ¯å†™å…¥ç¨‹åº golangä¸­åœ¨é“¾æŽ¥é˜¶æ®µå¯ä»¥è¦†ç›–ç¨‹åºä¸­çš„å…¨å±€å˜é‡ï¼Œé€šè¿‡åœ¨go buildæ—¶å¢žåŠ å¦‚ä¸‹å‚æ•°ã€‚ 1-ldflags -X importpath.name=value å…¶ä¸­importpathä¸ºåŒ…çš„å¯¼å…¥è·¯å¾„ï¼Œnameä¸ºå˜é‡åï¼Œvalueä¸ºæ–°çš„å€¼ã€‚ å¯¹äºŽkubernetesï¼Œç‰ˆæœ¬ä¿¡æ¯ç›¸å…³çš„å˜é‡ï¼ŒæœåŠ¡ç«¯å®šä¹‰åœ¨k8s.io/component-base/versionåŒ…ä¸­ï¼Œæºç è§k8s.io/component-base/version/base.goï¼Œå®¢æˆ·ç«¯å®šä¹‰åœ¨k8s.io/client-go/pkg/versionä¸­ï¼Œæºç è§k8s.io/client-go/pkg/version/base.goï¼Œä¸¤ä¸ªbase.goçš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼š 12345678910111213141516171819202122232425262728var ( // TODO: Deprecate gitMajor and gitMinor, use only gitVersion // instead. First step in deprecation, keep the fields but make // them irrelevant. (Next we'll take it out, which may muck with // scripts consuming the kubectl version output - but most of // these should be looking at gitVersion already anyways.) gitMajor string = "" // major version, always numeric gitMinor string = "" // minor version, numeric possibly followed by "+" // semantic version, derived by build scripts (see // https://git.k8s.io/community/contributors/design-proposals/release/versioning.md // for a detailed discussion of this field) // // TODO: This field is still called "gitVersion" for legacy // reasons. For prerelease versions, the build metadata on the // semantic version is a git hash, but the version itself is no // longer the direct output of "git describe", but a slight // translation to be semver compliant. // NOTE: The $Format strings are replaced during 'git archive' thanks to the // companion .gitattributes file containing 'export-subst' in this same // directory. See also https://git-scm.com/docs/gitattributes gitVersion string = "v0.0.0-master+$Format:%h$" gitCommit string = "$Format:%H$" // sha1 from git, output of $(git rev-parse HEAD) gitTreeState string = "" // state of git tree, either "clean" or "dirty" buildDate string = "1970-01-01T00:00:00Z" // build date in ISO8601 format, output of $(date -u +'%Y-%m-%dT%H:%M:%SZ')) ä¸€å¼€å§‹å‡ºçŽ°çš„å¥‡æ€ªçš„å­—ç¬¦ä¸²v0.0.0-master+$Format:%h$å°±æ˜¯å‡ºåœ¨è¿™é‡Œã€‚å½“ç„¶ç›´æŽ¥ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ä¹Ÿå¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç‰ˆæœ¬å·ï¼Œä½†æ˜¯æ¯æ¬¡æºç ç‰ˆæœ¬å˜åŒ–éƒ½éœ€è¦ä¿®æ”¹ï¼Œéžå¸¸éº»çƒ¦ï¼Œé‡‡ç”¨ldflagså°±éžå¸¸ç®€å•ï¼š 1go build -ldflags='-X k8s.io/component-base/version.gitVersion=v1.17.0-alpha.3.227+7d13dfe3c34f44-dirty -X k8s.io/client-go/pkg/version.gitVersion=v1.17.0-alpha.3.227+7d13dfe3c34f44-dirty' ä¸Šè¿°å‘½ä»¤å°±å°†gitVersionå˜é‡ä¿®æ”¹ä¸ºä»Žgitä¸­å¾—åˆ°çš„æºç ç‰ˆæœ¬å·ï¼Œè¿™ä¸ªè¿‡ç¨‹é€šè¿‡è„šæœ¬å®Œå…¨å¯ä»¥åšåˆ°è‡ªåŠ¨åŒ–ï¼Œè¿™ä¸ªè„šæœ¬å°±æ˜¯k8s.io/kubernetes/hack/lib/version.shã€‚ go buildæ—¶æ¤å…¥ç‰ˆæœ¬å· åœ¨ä½¿ç”¨makeç¼–è¯‘kubernetesæ—¶ä¼šè‡ªåŠ¨ä»ŽgitèŽ·å–ç‰ˆæœ¬ä¿¡æ¯å¹¶é€šè¿‡ldflagsæ¤å…¥ç¨‹åºä¸­ï¼Œä½†æ˜¯é€šè¿‡go buildç¼–è¯‘æ—¶kuberneteså¹¶æ²¡æœ‰æä¾›è„šæœ¬å®žçŽ°ä¸Šè¿°è¿‡ç¨‹ï¼Œè¿™å°±å¯¼è‡´äº†ç‰ˆæœ¬å·æ€»æ˜¯v0.0.0-master+$Format:%h$ã€‚ ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œåªéœ€è¦å¯¹k8s.io/kubernetes/hack/lib/version.shç¨ä½œæ”¹é€ ï¼Œå¤ç”¨å…¶é€»è¾‘å³å¯ï¼š é¦–å…ˆä¿®æ”¹version.shï¼Œå› ä¸ºå¯ç”¨äº†go moduleï¼Œå¦‚æžœä½ æ²¡æœ‰æ˜¾ç¤ºå¯ç”¨å¯ä»¥ä¸éœ€è¦ä¿®æ”¹ï¼š 1234ldflags+=( "-X '$&#123;KUBE_GO_PACKAGE&#125;/vendor/k8s.io/client-go/pkg/version.$&#123;key&#125;=$&#123;val&#125;'" "-X '$&#123;KUBE_GO_PACKAGE&#125;/vendor/k8s.io/component-base/version.$&#123;key&#125;=$&#123;val&#125;'") æ”¹ä¸ºï¼š 1234ldflags+=( "-X '$&#123;KUBE_GO_PACKAGE&#125;/client-go/pkg/version.$&#123;key&#125;=$&#123;val&#125;'" "-X '$&#123;KUBE_GO_PACKAGE&#125;/component-base/version.$&#123;key&#125;=$&#123;val&#125;'") ç„¶åŽåœ¨k8s.io/kubernetes/hackç›®å½•ä¸‹æ·»åŠ è„šæœ¬æ–‡ä»¶goinstallå¦‚ä¸‹ï¼š 12345678#!/usr/bin/env bashbasepath=$(cd `dirname $0`; pwd)KUBE_ROOT=$&#123;basepath&#125;/..source "$&#123;KUBE_ROOT&#125;/hack/lib/version.sh"KUBE_GO_PACKAGE="k8s.io"ldflags=$(kube::version::ldflags)echo ldflags:$&#123;ldflags&#125;go install -i -v -gcflags='-N -l' -ldflags="$&#123;ldflags&#125;" å°†k8s.io/kubernetes/hackç›®å½•æ·»åŠ åˆ°pathï¼Œç„¶åŽåœ¨å•ä¸ªç»„ä»¶ç›®å½•ä¸‹å°±å¯ä»¥ç›´æŽ¥æ‰§è¡Œï¼š 1goinstall]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>version</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£kubeletè®¤è¯å’ŒæŽˆæƒ]]></title>
    <url>%2F2019%2F11%2F12%2F019-access-pod-forbidden%2F</url>
    <content type="text"><![CDATA[åœ¨é€šè¿‡kubectlè®¿é—®podä¿¡æ¯ï¼Œä¾‹å¦‚æ‰§è¡Œkubectl logsï¼Œå¸¸å¸¸ä¼šé‡åˆ°ç±»ä¼¼å¦‚ä¸‹é”™è¯¯ï¼š Error from server (Forbidden): Forbidden (user=system:anonymous, verb=get, resource=nodes, subresource=proxy) ( pods/log tiller-deploy-6b5ffb6f-lg9jb) ç½‘ä¸Šæœç´¢å¯ä»¥é€šè¿‡å¯ç”¨anonymousè®¿é—®ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨â€“anonymous-auth=trueæˆ–è€…é…ç½®æ–‡ä»¶æ·»åŠ ï¼š 123authentication: anonymous: enabled: true ä½†æ˜¯è®¾ç½®ä¹‹åŽé”™è¯¯ä¾æ—§ï¼Œä¸ºæ­¤æˆ‘æŽ¢ç©¶äº†ä¸€ä¸‹kubeletçš„è®¤è¯æœºåˆ¶ï¼Œç»ˆäºŽå°†é—®é¢˜è§£å†³ï¼Œå…¶å®žå¾ˆç®€å•ï¼Œç­”æ¡ˆåŽé¢æ­æ™“ã€‚ æˆ‘ä»¬çŸ¥é“kubectlåªä¼šå’Œapiserveräº¤äº’ï¼Œå¯¹äºŽkubectl logsã€kubectl execç­‰éœ€è¦è®¿é—®podçš„è¿™äº›å‘½ä»¤ï¼Œå®žé™…ä¸Šæ˜¯apiserverè°ƒç”¨kubeletæŽ¥å£å®Œæˆçš„ï¼Œä¸Šè¿°é”™è¯¯æ­£æ˜¯å‡ºåœ¨è¿™ä¸ªè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯kubectlåˆ°apiserverçš„è¿‡ç¨‹ã€‚ kubeleté€šè¿‡portæŒ‡å®šçš„ç«¯å£ï¼ˆé»˜è®¤10250ï¼‰å¯¹å¤–æš´éœ²æœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡æ˜¯éœ€è¦TLSè®¤è¯çš„ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ readOnlyPort ç«¯å£ï¼ˆé»˜è®¤10255ï¼Œ0è¡¨ç¤ºå…³é—­ï¼‰å¯¹å¤–æš´éœ²åªè¯»æœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡æ˜¯ä¸éœ€è¦è®¤è¯çš„ã€‚apiserveré€šè¿‡â€“kubelet-httpså‚æ•°æŒ‡å®šè°ƒç”¨å“ªä¸ªæœåŠ¡ï¼Œtrueä¸ºå‰è€…ï¼Œfalseä¸ºåŽè€…ï¼Œæ­¤æ—¶åªèƒ½æ‰§è¡Œåªè¯»æ“ä½œã€‚ä¸‹é¢ä¸»è¦è¯´ä¸€ä¸‹å‰è€…ã€‚ è®¤è¯è¿‡ç¨‹ é…ç½®è®¤è¯æ–¹å¼ æœ‰ä¸‰ç§å¯é…ç½®è®¤è¯æ–¹å¼ï¼š TLSè®¤è¯ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤çš„ 1234567authentication: anonymous: enabled: false webhook: enabled: false x509: clientCAFile: xxxx å…è®¸anonymousï¼Œè¿™æ—¶å¯ä¸é…ç½®å®¢æˆ·ç«¯è¯ä¹¦ 123authentication: anonymous: enabled: true webhookï¼Œè¿™æ—¶å¯ä¸é…ç½®å®¢æˆ·ç«¯è¯ä¹¦ 123authentication: webhook: enabled: true è¿™æ—¶kubeleté€šè¿‡bearer tokensï¼Œæ‰¾apiserverè®¤è¯ï¼Œå¦‚æžœå­˜åœ¨å¯¹åº”çš„serviceaccountï¼Œåˆ™è®¤è¯é€šè¿‡ã€‚ å¦‚æžœ2å¼€å¯ï¼Œåˆ™å¿½ç•¥x509å’Œwebhookè®¤è¯ï¼›å¦åˆ™ï¼Œå¦‚æžœ1å’Œ3åŒæ—¶å¼€å¯ï¼Œåˆ™æŒ‰1ã€3çš„é¡ºåºä¾æ¬¡è®¤è¯ï¼Œä»»ä½•ä¸€ä¸ªè®¤è¯é€šè¿‡åˆ™è¿”å›žé€šè¿‡ï¼Œå¦åˆ™è®¤è¯ä¸é€šè¿‡ã€‚ é€šè¿‡kubectlå‘½ä»¤è¡Œè®¿é—®kubeletæ—¶ï¼Œæ— æ³•ä¼ é€’bearer tokensï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨webhookè®¤è¯ï¼Œè¿™æ—¶åªèƒ½ä½¿ç”¨x509è®¤è¯ã€‚ è¯ä¹¦é…ç½® kubeletå¯¹å¤–æš´éœ²httpsæœåŠ¡ï¼Œå¿…é¡»è®¾ç½®æœåŠ¡ç«¯è¯ä¹¦ï¼Œå¦‚æžœé€šè¿‡x509è¯ä¹¦è®¤è¯å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆè¿˜éœ€è¦é…ç½®å®¢æˆ·ç«¯è¯ä¹¦ã€‚ä¸‹é¢è¯´æ˜Žè¯ä¹¦é…ç½®çš„ä¸‰ç§æ–¹æ³•ï¼š æ‰‹å·¥æŒ‡å®šè¯ä¹¦ å‡è®¾caçš„è¯ä¹¦å’Œkeyï¼šca.pemï¼Œca-key.pem ç”¨ä¸Šè¿°caç”ŸæˆkubeletæœåŠ¡ç«¯è¯ä¹¦å’Œkeyï¼škubelet-server.pemã€kubelet-server-key.pem ç”¨ä¸Šè¿°caç”Ÿæˆapiserverä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œkeyï¼škubelet-client.pemã€kubelet-client-key.pemï¼Œè¯ä¹¦CNä¸ºkubelet-client ä¿®æ”¹kubeletçš„é…ç½®æ–‡ä»¶ï¼š 12345tlsCertFile: kubelet-server.pemtlsPrivateKeyFile: kubelet-server-key.pemauthentication: x509: clientCAFile: ca.pem ä¿®æ”¹apiserverå‚æ•°ï¼š 1--kubelet-certificate-authority=ca.pem --kubelet-client-certificate=kubelet-client.pem --kubelet-client-key=kubelet-client-key.pem æŽˆæƒkubelet-clientç”¨æˆ·ï¼š 1kubectl create clusterrolebinding kubelet-admin --clusterrole=system:kubelet-api-admin --user=kubelet-client ç»è¿‡ä¸Šé¢5æ­¥ï¼Œè®¤è¯çš„è¿‡ç¨‹å®žé™…å·²ç»OKäº†ï¼Œç¬¬6æ­¥æ˜¯ä¸ºæŽˆæƒè¿‡ç¨‹æœåŠ¡çš„ï¼Œkubeletçš„æŽˆæƒæ˜¯é€šè¿‡webhookå§”æ‰˜ç»™apiserverçš„ã€‚ è‡ªç­¾åè¯ä¹¦å’Œkey å®žé™…ä¸Šæ˜¯ä¸Šè¿°è¿‡ç¨‹çš„ç‰¹åŒ–ï¼Œä¸æŒ‡å®štlsCertFileå’ŒtlsPrivateKeyFileæ—¶ï¼Œkubeletä¼šè‡ªåŠ¨ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦ä¿å­˜åœ¨â€“cert-diræŒ‡å®šç›®å½•ä¸­ï¼Œæ–‡ä»¶åä¸ºkubelet.crtå’Œkubelet.keyï¼Œè¿™ä¸ªè¯ä¹¦æ˜¯è‡ªç­¾åçš„ï¼Œæ‰€ä»¥apiserverä¸éœ€è¦æŒ‡å®šâ€“kubelet-certificate-authorityï¼Œå…¶ä»–é…ç½®æ˜¯ä¸€æ ·çš„ã€‚ é€šè¿‡TLS bootstrapæœºåˆ¶ è¿˜å¯ä»¥é€šè¿‡TLS bootstrapæœºåˆ¶åˆ†é…kubeletæœåŠ¡è¯ä¹¦ã€‚è·Ÿé…ç½®åˆ†é…è®¿é—®apiserverçš„å®¢æˆ·ç«¯è¯ä¹¦æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼ˆå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰ï¼Œé¢å¤–çš„é…ç½®å¦‚ä¸‹ï¼š ä¿®æ”¹kubeleté…ç½®æ–‡ä»¶ï¼š 1serverTLSBootstrap: true æŽˆæƒå…è®¸åˆ›å»ºkubeletæœåŠ¡ç«¯è¯ä¹¦ é¦–å…ˆåˆ›å»ºsystem:certificates.k8s.io:certificatesigningrequests:selfnodeserverï¼Œé»˜è®¤æ˜¯æ²¡æœ‰åˆ›å»ºçš„ã€‚ selfnodeserver.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š 12345678910# A ClusterRole which instructs the CSR approver to approve a node requesting a# serving cert matching its client cert.kind: ClusterRoleapiVersion: rbac.authorization.k8s.io/v1metadata: name: system:certificates.k8s.io:certificatesigningrequests:selfnodeserverrules:- apiGroups: ["certificates.k8s.io"] resources: ["certificatesigningrequests/selfnodeserver"] verbs: ["create"] 1kubectl create -f selfnodeserver.yaml ç„¶åŽåˆ›å»ºç»‘å®šï¼š 1kubectl create clusterrolebinding node-server-auto-renew-crt --clusterrole=system:certificates.k8s.io:certificatesigningrequests:selfnodeserver --group=system:nodes æ‰‹å·¥æ‰¹å‡†è¯ä¹¦è¯·æ±‚ï¼š å…ˆæŸ¥è¯¢è¯ä¹¦è¯·æ±‚ï¼š 123[vagrant@localhost etc]$ kubectl get csrNAME AGE REQUESTOR CONDITIONcsr-2jxvn 76s system:node:10.10.10.16 Pending ç„¶åŽæ‰¹å‡†è¯ä¹¦ï¼š 1kubectl certificate approve csr-2jxvn ä¹‹åŽåœ¨ç›¸åº”kubeletçš„â€“cert-dirç›®å½•å¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯è¯ä¹¦å·²ç»ç”Ÿæˆã€‚ é…ç½®å®¢æˆ·ç«¯è¯ä¹¦å’Œå‰é¢çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œä¸Šé¢3æ­¥åªæ˜¯ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦ã€‚ é€‰æ‹©å“ªç§æ–¹å¼ å®¢æˆ·ç«¯è¯ä¹¦é…ç½®æ˜¯å…ä¸äº†çš„ï¼ŒåŒºåˆ«æ˜¯åœ¨æœåŠ¡ç«¯è¯ä¹¦ï¼Œæ˜¾ç„¶è‡ªåŠ¨ç”Ÿæˆæ›´åŠ æ–¹ä¾¿ï¼ŒTLS bootstrapç›¸å¯¹äºŽè‡ªç­¾åè¯ä¹¦æ›´åŠ å®‰å…¨ï¼Œé›†ç¾¤ç»Ÿä¸€ä½¿ç”¨ä¿¡ä»»çš„CAç­¾åã€‚ TLS bootstrapè¿˜å¯ä»¥é…ç½®è¯ä¹¦è¿‡æœŸåŽè‡ªåŠ¨é‡æ–°ç”Ÿæˆï¼Œæ–¹æ³•æ˜¯ä¿®æ”¹kubeleté…ç½®æ–‡ä»¶ï¼š 1rotateCertificates: true TLS bootstrapåˆ†é…è¯ä¹¦çš„æœ‰æ•ˆæœŸå¯ä»¥é€šè¿‡kube-controller-managerå¦‚ä¸‹å‚æ•°ä¿®æ”¹ï¼Œé»˜è®¤8760h0m0sï¼Œä¹Ÿå°±æ˜¯1å¹´ï¼š 1--experimental-cluster-signing-duration æŽˆæƒè¿‡ç¨‹ é…ç½®æŽˆæƒæ–¹å¼ å¯é…ç½®ä¸¤ç§æŽˆæƒæ–¹å¼ï¼š AlwaysAllowï¼šä»Žå­—é¢æ„æ€å°±å¯çŸ¥é“ 12authorization: mode: AlwaysAllow Webhookï¼šè¿™æ˜¯é»˜è®¤æ¨¡å¼ 12authorization: mode: Webhook è¿™æ—¶æŽˆæƒè¿‡ç¨‹æ˜¯å§”æ‰˜ç»™apiserverçš„ï¼Œä½¿ç”¨apiserverä¸€æ ·çš„æŽˆæƒæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯RBACã€‚ é…ç½®æƒé™ å¦‚æžœé€šè¿‡WebhookæŽˆæƒï¼Œå°±éœ€è¦é€šè¿‡RBACä¸ºç”¨æˆ·é…ç½®æƒé™ã€‚ é¦–å…ˆè¦å¼„æ¸…æ¥šé€šè¿‡è®¤è¯çš„ç”¨æˆ·æ˜¯ä»€ä¹ˆï¼Œé€šè¿‡x509è¯ä¹¦è®¤è¯çš„ç”¨æˆ·åæ˜¯å®¢æˆ·ç«¯è¯ä¹¦ä¸­çš„CNå­—æ®µï¼Œç”¨æˆ·ç»„ä¸ºOå­—æ®µï¼›é€šè¿‡webhookè®¤è¯çš„ç”¨æˆ·æ˜¯tokenå¯¹åº”çš„serviceaccountï¼›æ²¡æœ‰é€šè¿‡è®¤è¯æˆ–ä½¿èƒ½anonymousï¼Œåˆ™ç”¨æˆ·ä¸ºsystem:anonymousã€‚ å…¶æ¬¡è¦å¼„æ¸…æ¥šåº”è¯¥æŽˆæƒä»€ä¹ˆæƒé™ï¼Œç³»ç»Ÿå·²ç»å­˜åœ¨ä¸€ä¸ªsystem:kubelet-api-adminè§’è‰²ï¼Œè¿™æ˜¯æœ€é«˜çš„æƒé™ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºä½Žæƒé™è§’è‰²ã€‚ 12345678910111213[vagrant@localhost kube-apiserver]$ kubectl describe clusterrole system:kubelet-api-adminName: system:kubelet-api-adminLabels: kubernetes.io/bootstrapping=rbac-defaultsAnnotations: rbac.authorization.kubernetes.io/autoupdate: truePolicyRule: Resources Non-Resource URLs Resource Names Verbs --------- ----------------- -------------- ----- nodes/log [] [] [*] nodes/metrics [] [] [*] nodes/proxy [] [] [*] nodes/spec [] [] [*] nodes/stats [] [] [*] nodes [] [] [get list watch proxy] æœ€åŽå°†ç”¨æˆ·å’Œè§’è‰²ç»‘å®šï¼Œå³å®Œæˆæƒé™çš„é…ç½®ã€‚ æ€»ç»“ å¦‚ä½•é…ç½®kubeletçš„è®¤è¯å’ŒæŽˆæƒï¼Œå½’ç»“èµ·æ¥å¸¸ç”¨å¦‚ä¸‹2ç§åšæ³•ï¼š çœäº‹åž‹ï¼Œå¯ç”¨äºŽå¼€å‘çŽ¯å¢ƒ 12345authentication: anonymous: enabled: trueauthorization: mode: AlwaysAllow ä¸€å¼€å§‹å‡ºçŽ°çš„Forbiddené—®é¢˜å°±æ˜¯æ²¡æœ‰é…ç½®AlwaysAllowï¼Œé»˜è®¤æ˜¯Webhookã€‚ å®‰å…¨åž‹ï¼Œç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨ 12345authentication: anonymous: enabled: falseauthorization: mode: Webhook æœåŠ¡ç«¯è¯ä¹¦é€šè¿‡TLS bootstrapï¼Œå®¢æˆ·ç«¯è¯ä¹¦éœ€è¦æ‰‹å·¥é…ç½®ã€‚]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>kubelet</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»€ä¹ˆæ˜¯kubernetesæœåŠ¡ç«¯æ‰“å°]]></title>
    <url>%2F2019%2F10%2F30%2F018-output-change-kubectl-get-cs%2F</url>
    <content type="text"><![CDATA[å–œæ¬¢å°é²œçš„åŒå­¦å¯èƒ½ä¼šæ³¨æ„åˆ°æœ€æ–°çš„kubernetesåœ¨æ‰§è¡Œkubectl get csæ—¶è¾“å‡ºå†…å®¹æœ‰ä¸€äº›å˜åŒ–ï¼Œä»¥å‰æ˜¯è¿™æ ·çš„ï¼š 12345&gt; kubectl get componentstatusesNAME STATUS MESSAGE ERRORcontroller-manager Healthy okscheduler Healthy oketcd-0 Healthy &#123;"health":"true"&#125; çŽ°åœ¨å˜æˆäº†ï¼š 12345&gt; kubectl get componentstatusesNAME Age controller-manager &lt;unknown&gt;scheduler &lt;unknown&gt;etcd-0 &lt;unknown&gt; èµ·åˆå¯èƒ½ä¼šä»¥ä¸ºé›†ç¾¤éƒ¨ç½²æœ‰é—®é¢˜ï¼Œé€šè¿‡kubectl get cs -o yamlå‘çŽ°statusã€messageç­‰ä¿¡æ¯éƒ½æœ‰ï¼Œåªæ˜¯æ²¡æœ‰æ‰“å°å‡ºæ¥ã€‚åŽŸæ¥æ˜¯kubectl get csçš„è¾“å‡ºæ ¼å¼æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰æ­¤å˜åŒ–ï¼Œæˆ‘ä»¬æ¥ä¸€æŽ¢ç©¶ç«Ÿã€‚ å®šä½é—®é¢˜åŽŸå›  å°è¯•ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå‘çŽ°1.15è¿˜æ˜¯æ­£å¸¸çš„ï¼Œè°ƒè¯•ä»£ç å‘çŽ°å¯¹componentstatusesçš„æ‰“å°ä»£ç åœ¨k8s.io/kubernetes/pkg/printers/internalversion/printers.goä¸­ï¼Œå…¶ä¸­çš„AddHandlersæ–¹æ³•è´Ÿè´£æŠŠå„ç§èµ„æºçš„æ‰“å°å‡½æ•°æ³¨å†Œè¿›æ¥ã€‚ 123456789101112// AddHandlers adds print handlers for default Kubernetes types dealing with internal versions.// TODO: handle errors from Handlerfunc AddHandlers(h printers.PrintHandler) &#123;...... componentStatusColumnDefinitions := []metav1beta1.TableColumnDefinition&#123; &#123;Name: "Name", Type: "string", Format: "name", Description: metav1.ObjectMeta&#123;&#125;.SwaggerDoc()["name"]&#125;, &#123;Name: "Status", Type: "string", Description: "Status of the component conditions"&#125;, &#123;Name: "Message", Type: "string", Description: "Message of the component conditions"&#125;, &#123;Name: "Error", Type: "string", Description: "Error of the component conditions"&#125;, &#125; h.TableHandler(componentStatusColumnDefinitions, printComponentStatus) h.TableHandler(componentStatusColumnDefinitions, printComponentStatusList) å¯¹AddHandlersçš„è°ƒç”¨ä½äºŽk8s.io/kubernetes/pkg/kubectl/cmd/get/humanreadable_flags.go(æ­£åœ¨è¿ç§»åˆ°stagingä¸­ï¼Œå¦‚æžœæ‰¾ä¸åˆ°å°±åŽ»stagingä¸­æ‰¾)ä¸­ï¼Œå¦‚ä¸‹32è¡Œä½ç½®ï¼š 12345678910111213141516171819202122232425262728293031323334353637// ToPrinter receives an outputFormat and returns a printer capable of// handling human-readable output.func (f *HumanPrintFlags) ToPrinter(outputFormat string) (printers.ResourcePrinter, error) &#123; if len(outputFormat) &gt; 0 &amp;&amp; outputFormat != "wide" &#123; return nil, genericclioptions.NoCompatiblePrinterError&#123;Options: f, AllowedFormats: f.AllowedFormats()&#125; &#125; showKind := false if f.ShowKind != nil &#123; showKind = *f.ShowKind &#125; showLabels := false if f.ShowLabels != nil &#123; showLabels = *f.ShowLabels &#125; columnLabels := []string&#123;&#125; if f.ColumnLabels != nil &#123; columnLabels = *f.ColumnLabels &#125; p := printers.NewTablePrinter(printers.PrintOptions&#123; Kind: f.Kind, WithKind: showKind, NoHeaders: f.NoHeaders, Wide: outputFormat == "wide", WithNamespace: f.WithNamespace, ColumnLabels: columnLabels, ShowLabels: showLabels, &#125;) printersinternal.AddHandlers(p) // TODO(juanvallejo): handle sorting here return p, nil&#125; æŸ¥çœ‹humanreadable_flags.goæ–‡ä»¶çš„ä¿®æ”¹åŽ†å²ï¼Œå‘çŽ°æ˜¯åœ¨2019.6.28æ—¥ç‰¹æ„åŽ»æŽ‰äº†å¯¹å†…éƒ¨å¯¹è±¡çš„æ‰“å°ï¼Œå½±å“ç‰ˆæœ¬ä»Ž1.16ä¹‹åŽã€‚ ä¸ºä»€ä¹ˆä¿®æ”¹ æˆ‘æ²¡æœ‰æŸ¥åˆ°å®˜æ–¹çš„è¯´æ˜Žï¼Œåœ¨æ­¤åšä¸€äº›ä¸ªäººçŒœæµ‹ï¼Œè¿˜åŽŸæ•´ä¸ªè¿‡ç¨‹ï¼š æœ€åˆå¯¹api resourceçš„è¡¨æ ¼æ‰“å°éƒ½æ˜¯åœ¨kubectlä¸­å®žçŽ° è¿™æ ·å¯¹äºŽå…¶ä»–å®¢æˆ·ç«¯éœ€è¦åšé‡å¤çš„äº‹æƒ…ï¼Œè€Œä¸”å¯èƒ½å®žçŽ°çš„è¡Œä¸ºä¸ä¸€è‡´ï¼Œå› æ­¤æœ‰å¿…è¦å°†è¡¨æ ¼æ‰“å°æ”¾åˆ°æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯apiserverä¸­ æœåŠ¡ç«¯æ‰“å°çš„æ”¯æŒç»è¿‡ä¸€ä¸ªé€æ­¥çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å¹¶æ²¡æœ‰å®Œå…¨åŽ»é™¤ï¼Œæ˜¯åŒæ—¶æ”¯æŒçš„ï¼Œkubectlåˆ¤æ–­æœåŠ¡ç«¯è¿”å›žçš„Tableå°±ç›´æŽ¥æ‰“å°ï¼Œå¦åˆ™ä½¿ç”¨å…·ä½“å¯¹è±¡çš„æ‰“å°ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯¹ç‰¹å®šå¯¹è±¡çš„æ‰“å°éƒ½æ˜¯è°ƒç”¨k8s.io/kubernetes/pkg/printers/internalversion/printers.goæ¥å®žçŽ° 1.11ç‰ˆæœ¬å°†kubectlçš„å‘½ä»¤è¡Œå‚æ•°--server-printé»˜è®¤è®¾ç½®ä¸ºtrue åˆ°äº†1.16ç‰ˆæœ¬ï¼Œç¤¾åŒºå¯èƒ½è®¤ä¸ºæ‰€æœ‰çš„å¯¹è±¡éƒ½ç§»åˆ°æœåŠ¡ç«¯äº†ï¼Œè¿™æ—¶å°±åŽ»é™¤äº†å®¢æˆ·ç«¯kubectlä¸­çš„æ‰“å° ä½†å®žé™…ä¸Šcomponentstatusesè¢«é—æ¼äº†ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆé—æ¼ï¼Œå¯èƒ½ä¸»è¦æ˜¯å› ä¸ºcomponentstatuseså¯¹è±¡è·Ÿå…¶ä»–å¯¹è±¡ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯æ¯æ¬¡å®žæ—¶èŽ·å–ï¼Œè€Œä¸æ˜¯ä»Žç¼“å­˜èŽ·å–ï¼Œå…¶ä»–å¯¹è±¡ï¼Œä¾‹å¦‚podæ˜¯ä»ŽetcdèŽ·å–ï¼Œå¯¹ç»“æžœçš„æ ¼å¼åŒ–å®šä¹‰åœ¨k8s.io/kubernetes/pkg/registry/core/pod/storage/storage.goä¸­ï¼Œå¦‚ä¸‹15è¡Œä½ç½®ï¼š 12345678910111213141516// NewStorage returns a RESTStorage object that will work against pods.func NewStorage(optsGetter generic.RESTOptionsGetter, k client.ConnectionInfoGetter, proxyTransport http.RoundTripper, podDisruptionBudgetClient policyclient.PodDisruptionBudgetsGetter) PodStorage &#123; store := &amp;genericregistry.Store&#123; NewFunc: func() runtime.Object &#123; return &amp;api.Pod&#123;&#125; &#125;, NewListFunc: func() runtime.Object &#123; return &amp;api.PodList&#123;&#125; &#125;, PredicateFunc: pod.MatchPod, DefaultQualifiedResource: api.Resource("pods"), CreateStrategy: pod.Strategy, UpdateStrategy: pod.Strategy, DeleteStrategy: pod.Strategy, ReturnDeletedObject: true, TableConvertor: printerstorage.TableConvertor&#123;TableGenerator: printers.NewTableGenerator().With(printersinternal.AddHandlers)&#125;, &#125; componentstatusesæ²¡æœ‰ç”¨åˆ°çœŸæ­£çš„Storgeï¼Œè€Œå®ƒåˆç›¸å¯¹ä¸èµ·çœ¼ï¼Œæ‰€ä»¥è¢«é—æ¼äº†ã€‚ æš‚æ—¶è§£å†³åŠžæ³• å¦‚æžœå¸Œæœ›æ‰“å°å’ŒåŽŸæ¥ç±»ä¼¼çš„å†…å®¹ï¼Œç›®å‰åªæœ‰é€šè¿‡æ¨¡æ¿ï¼š 1kubectl get cs -o=go-template='&#123;&#123;printf "|NAME|STATUS|MESSAGE|\n"&#125;&#125;&#123;&#123;range .items&#125;&#125;&#123;&#123;$name := .metadata.name&#125;&#125;&#123;&#123;range .conditions&#125;&#125;&#123;&#123;printf "|%s|%s|%s|\n" $name .status .message&#125;&#125;&#123;&#123;end&#125;&#125;&#123;&#123;end&#125;&#125;' è¾“å‡ºç»“æžœï¼š 1234|NAME|STATUS|MESSAGE||controller-manager|True|ok||scheduler|True|ok||etcd-0|True|&#123;&quot;health&quot;:&quot;true&quot;&#125;| æ·±å…¥æ‰“å°å¤„ç†æµç¨‹ kubectlé€šè¿‡-oå‚æ•°æŽ§åˆ¶è¾“å‡ºçš„æ ¼å¼ï¼Œæœ‰yamlã€jsonã€æ¨¡æ¿å’Œè¡¨æ ¼å‡ ç§æ ·å¼ï¼Œä¸Šè¿°é—®é¢˜æ˜¯å‡ºåœ¨è¡¨æ ¼æ‰“å°æ—¶ï¼Œä¸åŠ -oå‚æ•°é»˜è®¤å°±æ˜¯è¡¨æ ¼æ‰“å°ï¼Œä¸‹é¢æˆ‘ä»¬è¯¦ç»†åˆ†æžä¸€ä¸‹kubectl getçš„æ‰“å°è¾“å‡ºè¿‡ç¨‹ã€‚ kubectl kubectl getçš„ä»£ç å…¥å£åœ¨k8s.io/kubernetes/pkg/kubectl/cmd/get/get.goä¸­ï¼ŒRunå­—æ®µå°±æ˜¯å‘½ä»¤æ‰§è¡Œæ–¹æ³•ï¼š 123456789func NewCmdGet(parent string, f cmdutil.Factory, streams genericclioptions.IOStreams) *cobra.Command &#123;...... Run: func(cmd *cobra.Command, args []string) &#123; cmdutil.CheckErr(o.Complete(f, cmd, args)) cmdutil.CheckErr(o.Validate(cmd)) cmdutil.CheckErr(o.Run(f, cmd, args)) &#125;,...... &#125; Completeæ–¹æ³•å®Œæˆäº†Printeråˆå§‹åŒ–ï¼Œä½äºŽk8s.io/kubernetes/pkg/kubectl/cmd/get/get_flags.goä¸­ï¼š 1234567func (f *PrintFlags) ToPrinter() (printers.ResourcePrinter, error) &#123;...... if p, err := f.HumanReadableFlags.ToPrinter(outputFormat); !genericclioptions.IsNoCompatiblePrinterError(err) &#123; return p, err &#125;......&#125; ä¸å¸¦-oå‚æ•°æ—¶ï¼Œä¸Šè¿°æ–¹æ³•è¿”å›žçš„æ˜¯f.HumanReadableFlags.ToPrinter(outputFormat)ï¼Œæœ€åŽè¿”å›žçš„æ˜¯HumanReadablePrinterå¯¹è±¡ï¼Œä½äºŽk8s.io/cli-runtime/pkg/printers/tableprinter.goä¸­ï¼š 1234567// NewTablePrinter creates a printer suitable for calling PrintObj().func NewTablePrinter(options PrintOptions) ResourcePrinter &#123; printer := &amp;HumanReadablePrinter&#123; options: options, &#125; return printer&#125; å†å›žåˆ°å‘½ä»¤æ‰§è¡Œä¸»æµç¨‹ï¼ŒCompleteä¹‹åŽä¸»è¦æ˜¯Runï¼Œå…¶ä¸­å®Œæˆå‘apiserverå‘é€httpè¯·æ±‚å¹¶æ‰“å°ç»“æžœçš„åŠ¨ä½œï¼Œåœ¨å‘é€httpè¯·æ±‚å‰ï¼Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŠ¨ä½œï¼ŒåŠ å…¥æœåŠ¡ç«¯æ‰“å°çš„headerï¼ŒæœåŠ¡ç«¯æ‰“å°å¯ä»¥é€šè¿‡--server-printå‚æ•°æŽ§åˆ¶ï¼Œä»Ž1.11é»˜è®¤ä¸ºtrueï¼Œè¿™æ ·æœåŠ¡ç«¯å¦‚æžœæ”¯æŒè½¬æ¢å°±ä¼šè¿”å›žmetav1beta1.Tableç±»åž‹ï¼Œç½®ä¸ºfalseä¹Ÿå¯ä»¥ç¦ç”¨æœåŠ¡ç«¯æ‰“å°ï¼š 1234567891011121314func (o *GetOptions) transformRequests(req *rest.Request) &#123;...... if !o.ServerPrint || !o.IsHumanReadablePrinter &#123; return &#125; group := metav1beta1.GroupName version := metav1beta1.SchemeGroupVersion.Version tableParam := fmt.Sprintf("application/json;as=Table;v=%s;g=%s, application/json", version, group) req.SetHeader("Accept", tableParam)......&#125; æœ€åŽæ‰“å°æ˜¯è°ƒç”¨çš„HumanReadablePrinter.PrintObjæ–¹æ³•ï¼Œå…ˆåˆ¤æ–­æœåŠ¡ç«¯å¦‚æžœè¿”å›žçš„metav1beta1.Tableç±»åž‹å°±ç›´æŽ¥æ‰“å°ï¼Œå…¶æ¬¡å¦‚æžœæ˜¯metav1.Statusç±»åž‹ä¹Ÿæœ‰ä¸“é—¨çš„å¤„ç†å™¨ï¼Œæœ€åŽå°±ä¼šåˆ°é»˜è®¤å¤„ç†å™¨ï¼š 123456789101112131415161718192021222324func (h *HumanReadablePrinter) PrintObj(obj runtime.Object, output io.Writer) error &#123;...... // Parameter "obj" is a table from server; print it. // display tables following the rules of options if table, ok := obj.(*metav1beta1.Table); ok &#123; return printTable(table, output, localOptions) &#125; // Could not find print handler for "obj"; use the default or status print handler. // Print with the default or status handler, and use the columns from the last time var handler *printHandler if _, isStatus := obj.(*metav1.Status); isStatus &#123; handler = statusHandlerEntry &#125; else &#123; handler = defaultHandlerEntry &#125;...... if err := printRowsForHandlerEntry(output, handler, eventType, obj, h.options, includeHeaders); err != nil &#123; return err &#125;...... return nil&#125; é»˜è®¤å¤„ç†å™¨ä¼šæ‰“å°Nameå’ŒAgeä¸¤åˆ—ï¼Œå› ä¸ºcomponetstatusesæ˜¯å®žæ—¶èŽ·å–ï¼Œæ²¡æœ‰å­˜å‚¨åœ¨etcdä¸­ï¼Œæ²¡æœ‰åˆ›å»ºæ—¶é—´ï¼Œæ‰€ä»¥Ageæ‰“å°å‡ºæ¥å°±æ˜¯unknownã€‚ apiserver å†æ¥çœ‹æœåŠ¡ç«¯çš„å¤„ç†æµç¨‹ï¼Œapiserverå¯¹å¤–æä¾›RESTæŽ¥å£å®žçŽ°åœ¨k8s.io/apiserver/pkg/endpoints/handlersç›®å½•ä¸‹ï¼Œkubectl get csä¼šè¿›å…¥get.goä¸­ListResourceæ–¹æ³•ï¼Œå¦‚ä¸‹åˆ—å‡ºå…³é”®çš„ä¸‰ä¸ªæ­¥éª¤ï¼š 12345678910111213func ListResource(r rest.Lister, rw rest.Watcher, scope *RequestScope, forceWatch bool, minRequestTimeout time.Duration) http.HandlerFunc &#123; return func(w http.ResponseWriter, req *http.Request) &#123;...... outputMediaType, _, err := negotiation.NegotiateOutputMediaType(req, scope.Serializer, scope)...... result, err := r.List(ctx, &amp;opts)...... transformResponseObject(ctx, scope, trace, req, w, http.StatusOK, outputMediaType, result)...... &#125;&#125; NegotiateOutputMediaTypeä¸­æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚headerè®¾ç½®æœåŠ¡ç«¯çš„ä¸€äº›è¡Œä¸ºï¼ŒåŒ…æ‹¬æ˜¯å¦æœåŠ¡ç«¯æ‰“å°ï¼›r.Listä»ŽStorageå±‚èŽ·å–èµ„æºæ•°æ®ï¼Œå…·ä½“å®žçŽ°åœ¨k8s.io/kubernetes/pkg/registryä¸‹ï¼›transformResponseObjectå°†ç»“æžœè¿”å›žç»™å®¢æˆ·ç«¯ã€‚ å…ˆè¯´transformResponseObjectï¼Œå…¶ä¸­å°±ä¼šæ ¹æ®NegotiateOutputMediaTypeè¿”å›žçš„outputMediaTypeçš„Convertå­—æ®µåˆ¤æ–­æ˜¯å¦è½¬ä¸ºæ¢ç›®æ ‡ç±»åž‹ï¼Œå¦‚æžœä¸ºTableå°±ä¼šå°†r.Listè¿”å›žçš„å…·ä½“èµ„æºç±»åž‹è½¬æ¢ä¸ºTableç±»åž‹ï¼š 12345678910111213141516func doTransformObject(ctx context.Context, obj runtime.Object, opts interface&#123;&#125;, mediaType negotiation.MediaTypeOptions, scope *RequestScope, req *http.Request) (runtime.Object, error) &#123;...... switch target := mediaType.Convert; &#123; case target == nil: return obj, nil ...... case target.Kind == "Table": options, ok := opts.(*metav1beta1.TableOptions) if !ok &#123; return nil, fmt.Errorf("unexpected TableOptions, got %T", opts) &#125; return asTable(ctx, obj, options, scope, target.GroupVersion())......g &#125;&#125; ä¸Šè¿°asTableæœ€ç»ˆè°ƒç”¨scope.TableConvertor.ConvertToTableå®Œæˆè¡¨æ ¼è½¬æ¢å·¥ä½œï¼Œåœ¨æœ¬æ–‡çš„é—®é¢˜ä¸­ï¼Œå°±æ˜¯å› ä¸ºmediaType.Convertä¸ºç©ºè€Œæ²¡æœ‰è§¦å‘è¿™ä¸ªè½¬æ¢ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸ºç©ºå‘¢ï¼Œé—®é¢˜å°±å‡ºåœ¨NegotiateOutputMediaTypeï¼Œå®ƒæœ€ç»ˆä¼šè°ƒç”¨åˆ°k8s.io/apiserver/pkg/endpoints/handlers/rest.goçš„AllowsMediaTypeTransformæ–¹æ³•ï¼Œæ˜¯å› ä¸ºscope.TableConvertorä¸ºç©ºï¼Œæœ€ç»ˆè½¬æ¢ä¸ºTableä¹Ÿæ˜¯è°ƒç”¨çš„å®ƒï¼š 12345678910func (scope *RequestScope) AllowsMediaTypeTransform(mimeType, mimeSubType string, gvk *schema.GroupVersionKind) bool &#123;...... if gvk.GroupVersion() == metav1beta1.SchemeGroupVersion || gvk.GroupVersion() == metav1.SchemeGroupVersion &#123; switch gvk.Kind &#123; case &quot;Table&quot;: return scope.TableConvertor != nil &amp;&amp; mimeType == &quot;application&quot; &amp;&amp; (mimeSubType == &quot;json&quot; || mimeSubType == &quot;yaml&quot;)......&#125; è¿›ä¸€æ­¥è·Ÿè¸ªï¼ŒRequestScopeæ˜¯åœ¨apiserveråˆå§‹åŒ–çš„æ—¶å€™åˆ›å»ºçš„ï¼Œæ¯ç±»èµ„æºä¸€ä¸ªï¼Œæ¯”å¦‚componentstatusesæœ‰ä¸€ä¸ªå…¨å±€çš„ï¼Œpodæœ‰ä¸€ä¸ªå…¨å±€çš„ï¼Œåˆå§‹åŒ–çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š apiserveråˆå§‹åŒ–å…¥å£åœ¨k8s.io/kubernetes/pkg/master/master.goçš„InstallLegacyAPIå’ŒInstallAPIsæ–¹æ³•ä¸­ï¼Œå‰è€…ä¸»è¦é’ˆå¯¹ä¸€äº›è€çš„èµ„æºï¼Œå…·ä½“æœ‰å“ªäº›è§ä¸‹é¢çš„NewLegacyRESTStorageæ–¹æ³•ï¼Œå…¶ä¸­å°±åŒ…å«componentStatusesï¼Œå…¶ä»–èµ„æºé€šè¿‡InstallAPIsåˆå§‹åŒ–ï¼š 12345// InstallLegacyAPI will install the legacy APIs for the restStorageProviders if they are enabled.func (m *Master) InstallLegacyAPI(c *completedConfig, restOptionsGetter generic.RESTOptionsGetter, legacyRESTStorageProvider corerest.LegacyRESTStorageProvider) error &#123; legacyRESTStorage, apiGroupInfo, err := legacyRESTStorageProvider.NewLegacyRESTStorage(restOptionsGetter)......&#125; åˆå§‹åŒ–Storageï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859func (c LegacyRESTStorageProvider) NewLegacyRESTStorage(restOptionsGetter generic.RESTOptionsGetter) (LegacyRESTStorage, genericapiserver.APIGroupInfo, error) &#123; apiGroupInfo := genericapiserver.APIGroupInfo&#123; PrioritizedVersions: legacyscheme.Scheme.PrioritizedVersionsForGroup(&quot;&quot;), VersionedResourcesStorageMap: map[string]map[string]rest.Storage&#123;&#125;, Scheme: legacyscheme.Scheme, ParameterCodec: legacyscheme.ParameterCodec, NegotiatedSerializer: legacyscheme.Codecs, &#125;...... restStorageMap := map[string]rest.Storage&#123; &quot;pods&quot;: podStorage.Pod, &quot;pods/attach&quot;: podStorage.Attach, &quot;pods/status&quot;: podStorage.Status, &quot;pods/log&quot;: podStorage.Log, &quot;pods/exec&quot;: podStorage.Exec, &quot;pods/portforward&quot;: podStorage.PortForward, &quot;pods/proxy&quot;: podStorage.Proxy, &quot;pods/binding&quot;: podStorage.Binding, &quot;bindings&quot;: podStorage.LegacyBinding, &quot;podTemplates&quot;: podTemplateStorage, &quot;replicationControllers&quot;: controllerStorage.Controller, &quot;replicationControllers/status&quot;: controllerStorage.Status, &quot;services&quot;: serviceRest, &quot;services/proxy&quot;: serviceRestProxy, &quot;services/status&quot;: serviceStatusStorage, &quot;endpoints&quot;: endpointsStorage, &quot;nodes&quot;: nodeStorage.Node, &quot;nodes/status&quot;: nodeStorage.Status, &quot;nodes/proxy&quot;: nodeStorage.Proxy, &quot;events&quot;: eventStorage, &quot;limitRanges&quot;: limitRangeStorage, &quot;resourceQuotas&quot;: resourceQuotaStorage, &quot;resourceQuotas/status&quot;: resourceQuotaStatusStorage, &quot;namespaces&quot;: namespaceStorage, &quot;namespaces/status&quot;: namespaceStatusStorage, &quot;namespaces/finalize&quot;: namespaceFinalizeStorage, &quot;secrets&quot;: secretStorage, &quot;serviceAccounts&quot;: serviceAccountStorage, &quot;persistentVolumes&quot;: persistentVolumeStorage, &quot;persistentVolumes/status&quot;: persistentVolumeStatusStorage, &quot;persistentVolumeClaims&quot;: persistentVolumeClaimStorage, &quot;persistentVolumeClaims/status&quot;: persistentVolumeClaimStatusStorage, &quot;configMaps&quot;: configMapStorage, &quot;componentStatuses&quot;: componentstatus.NewStorage(componentStatusStorage&#123;c.StorageFactory&#125;.serversToValidate), &#125;...... apiGroupInfo.VersionedResourcesStorageMap[&quot;v1&quot;] = restStorageMap return restStorage, apiGroupInfo, nil&#125; æ³¨å†ŒRESTæŽ¥å£çš„handlerï¼Œhandlerä¸­åŒ…å«RequestScopeï¼ŒRequestScopeä¸­çš„TableConvertorå­—æ®µæ˜¯ä»Žstorageå–å‡ºï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°NewLegacyRESTStorageåˆ›å»ºçš„èµ„æºå¯¹åº”çš„storageï¼Œä¾‹å¦‚componentStatusesï¼Œå°±æ˜¯componentstatus.NewStorage(componentStatusStorage{c.StorageFactory}.serversToValidate)ï¼Œæå–çš„æ–¹æ³•æ˜¯ç±»åž‹æ–­è¨€storage.(rest.TableConvertor)ï¼Œä¹Ÿå°±æ˜¯storageè¦å®žçŽ°rest.TableConvertoræŽ¥å£ï¼Œå¦åˆ™å–å‡ºæ¥ä¸ºç©ºï¼š 123456789101112131415161718192021222324252627282930func (a *APIInstaller) registerResourceHandlers(path string, storage rest.Storage, ws *restful.WebService) (*metav1.APIResource, error) &#123;...... tableProvider, _ := storage.(rest.TableConvertor) var apiResource metav1.APIResource...... reqScope := handlers.RequestScope&#123;...... // TODO: Check for the interface on storage TableConvertor: tableProvider,...... for _, action := range actions &#123;...... switch action.Verb &#123;...... case "LIST": // List all resources of a kind. doc := "list objects of kind " + kind if isSubresource &#123; doc = "list " + subresource + " of objects of kind " + kind &#125; handler := metrics.InstrumentRouteFunc(action.Verb, group, version, resource, subresource, requestScope, metrics.APIServerComponent, restfulListResource(lister, watcher, reqScope, false, a.minRequestTimeout))...... &#125; // Note: update GetAuthorizerAttributes() when adding a custom handler. &#125;......&#125; å…·ä½“çœ‹componentStatusesçš„storageï¼Œåœ¨k8s.io/kubernetes/pkg/registry/core/componentstatus/rest.goä¸­ï¼Œç¡®å®žæ²¡æœ‰å®žçŽ°rest.TableConvertoræŽ¥å£ï¼Œæ‰€ä»¥componentStatusesçš„handlerçš„RequestScopeä¸­çš„TableConvertorå­—æ®µå°±ä¸ºç©ºï¼Œæœ€ç»ˆå¯¼è‡´äº†é—®é¢˜ï¼š 12345678910type REST struct &#123; GetServersToValidate func() map[string]*Server &#125;// NewStorage returns a new REST.func NewStorage(serverRetriever func() map[string]*Server) *REST &#123; return &amp;REST&#123; GetServersToValidate: serverRetriever, &#125;&#125; ä»£ç ä¿®å¤ æ‰¾åˆ°äº†æ ¹æœ¬åŽŸå› ä¹‹åŽï¼Œä¿®å¤å°±æ¯”è¾ƒç®€å•äº†ï¼Œå°±æ˜¯storageéœ€è¦å®žçŽ°rest.TableConvertoræŽ¥å£ï¼ŒæŽ¥å£å®šä¹‰åœ¨k8s.io/apiserver/pkg/registry/rest/rest.goä¸­ï¼š 123type TableConvertor interface &#123; ConvertToTable(ctx context.Context, object runtime.Object, tableOptions runtime.Object) (*metav1beta1.Table, error)&#125; å‚ç…§å…¶ä»–èµ„æºstorageä»£ç ï¼Œä¿®æ”¹k8s.io/kubernetes/pkg/registry/core/componentstatus/rest.goä»£ç å¦‚ä¸‹ï¼Œé—®é¢˜å¾—åˆ°è§£å†³ï¼Œkubectl get csæ‰“å°å‡ºç†Ÿæ‚‰çš„è¡¨æ ¼ï¼Œå¦‚æžœä½¿ç”¨kubectl get cs --server-print=falseä»ä¼šåªæ‰“å°Nameã€Ageä¸¤åˆ—ï¼š 123456789101112131415type REST struct &#123; GetServersToValidate func() map[string]*Server tableConvertor printerstorage.TableConvertor&#125;// NewStorage returns a new REST.func NewStorage(serverRetriever func() map[string]*Server) *REST &#123; return &amp;REST&#123; GetServersToValidate: serverRetriever, tableConvertor: printerstorage.TableConvertor&#123;TableGenerator: printers.NewTableGenerator().With(printersinternal.AddHandlers)&#125;, &#125;&#125;func (r *REST) ConvertToTable(ctx context.Context, object runtime.Object, tableOptions runtime.Object) (*metav1beta1.Table, error) &#123; return r.tableConvertor.ConvertToTable(ctx, object, tableOptions)&#125; æœ€åŽ æœ¬æƒ³æäº¤ä¸€ä¸ªPRç»™kubernetesï¼Œå‘çŽ°å·²ç»æœ‰äººå…ˆä¸€æ­¥æäº†ï¼Œè§£å†³æ–¹æ³•å’Œæˆ‘ä¸€æ‘¸ä¸€æ ·ï¼Œåªæ˜¯ä¸Šè¿°tableConvertorå­—æ®µæ˜¯å¤§å†™å¼€å¤´ï¼Œæˆ‘è§‰å¾—å°å†™æ›´å¥½ï¼Œæœ‰ç‚¹é—æ†¾ã€‚è€Œè¿™ä¸ªé—®é¢˜åœ¨2019.9.23å·²ç»æœ‰äººæå‡ºï¼Œä¹Ÿå°±æ˜¯1.16åˆšå‘å¸ƒçš„æ—¶å€™ï¼Œ9.24å°±æœ‰äººæäº†PRï¼Œè§£å†³é€Ÿåº¦éžå¸¸ä¹‹å¿«ï¼Œå¯è§å¼€æºè½¯ä»¶çš„ä¼˜åŠ¿ä»¥åŠk8sçƒ­åº¦ä¹‹é«˜ï¼Œæœ‰æ— æ•°çš„å¼€å‘è€…ä¸ºå…¶è´¡çŒ®åŠ›é‡ï¼Œk8så°±åƒèšå…‰ç¯ä¸‹çš„æ˜Žæ˜Ÿï¼Œæ— æ•°åŒçœ¼ç›æ³¨ç›®ç€ã€‚ä¸è¿‡è¿™ä¸ªPRçŽ°åœ¨è¿˜æ²¡æœ‰åˆå…¥ä¸»å¹²ï¼Œè¿˜åœ¨ä»£ç å®¡æŸ¥é˜¶æ®µï¼Œè¿™ä¸ªbugç›¸å¯¹æ¥è®²ä¸æ˜¯å¾ˆä¸¥é‡ï¼Œæ‰€ä»¥ä¼˜å…ˆçº§ä¸é‚£ä¹ˆé«˜ï¼Œè¦çŸ¥é“çŽ°åœ¨è¿˜æœ‰1097ä¸ªPRã€‚è™½ç„¶æœ€åŽæœ‰ä¸€ç‚¹å°é—æ†¾ï¼Œä¸è¿‡åœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­å¯¹kubernetesçš„ç†è§£ä¹Ÿæ›´è¿›ä¸€æ­¥ï¼Œè¿˜æ˜¯æ”¶èŽ·è‰¯å¤šã€‚åœ¨é˜…è¯»ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œéšå¤„å¯è§å„ç§TODOï¼Œå‘çŽ°ä»£ç ä¸æ–­åœ¨é‡æž„ï¼Œä»Šå¤©ä»£ç åœ¨è¿™é‡Œï¼Œæ˜Žå¤©ä»£ç å°±æ¬åˆ°å¦ä¸€ä¸ªåœ°æ–¹äº†ï¼Œk8sè¿™ä¹ˆä¸€ä¸ªå†‰å†‰å‡èµ·çš„æ–°æ˜Ÿï¼Œè™½ç„¶ä»Ž2017å¹´èµ·å°±æˆä¸ºå®¹å™¨ç¼–æŽ’çš„äº‹å®žæ ‡å‡†ï¼Œå¹¶è¢«å¹¿æ³›åº”ç”¨åˆ°ç”Ÿäº§çŽ¯å¢ƒï¼Œä½†å®ƒæœ¬èº«è¿˜åœ¨ä¸æ–­è¿›åŒ–ï¼Œè¿˜éœ€ä¸æ–­å®Œå–„ã€‚]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>go template</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CAè¯ä¹¦å’Œè‡ªç­¾åè¯ä¹¦]]></title>
    <url>%2F2019%2F10%2F25%2F017-what-is-a-self-signed-certificate%2F</url>
    <content type="text"><![CDATA[åœ¨kubernetesé›†ç¾¤çš„æ­å»ºè¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä½¿ç”¨è®¸å¤šè¯ä¹¦ï¼Œä¾‹å¦‚è¿è¡Œkube-apiserveréœ€è¦æŒ‡å®šå®¢æˆ·ç«¯CAè¯ä¹¦ã€æœåŠ¡ç«¯è¯ä¹¦å’Œç§é’¥ï¼Œè€Œå®¢æˆ·ç«¯ç»„ä»¶å¦‚kubectléœ€è¦æŒ‡å®šè‡ªå·±çš„è¯ä¹¦ã€ç§é’¥ä»¥åŠæœåŠ¡ç«¯CAè¯ä¹¦ã€‚ 1kube-apiserver --tls-cert-file=/etc/kubernetes/ssl/kubernetes.pem --tls-private-key-file=/etc/kubernetes/ssl/kubernetes-key.pem --client-ca-file=/etc/kubernetes/ssl/ca.pem kube-controller-managerç»„ä»¶è¿˜éœ€è¦æŒ‡å®šCAç§é’¥ï¼Œç”¨äºŽä¸ºkubeletç­¾åè¯ä¹¦ã€‚ 1kube-controller-manager --cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem --cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem è¿™äº›æ–‡ä»¶åœ¨TLSè®¤è¯è¿‡ç¨‹ä¸­å‘æŒ¥ä»€ä¹ˆä½œç”¨ï¼Œå…³é”®éœ€è¦ç†è§£CAè¯ä¹¦ä»¥åŠè‡ªç­¾åè¯ä¹¦ã€‚ å¯¹ç§°åŠ å¯†å’Œéžå¯¹ç§°åŠ å¯† å¯¹ç§°åŠ å¯†ï¼šå¦‚AESï¼Œé€Ÿåº¦å¿«ï¼Œä½†å¯†é’¥ç®¡ç†å›°éš¾ éžå¯¹ç§°åŠ å¯†ï¼šå¦‚RSAï¼Œé€Ÿåº¦æ…¢ï¼Œä¸¤ç§ç”¨é€”ï¼š(1)åŠ å¯†ä¼ è¾“è¿‡ç¨‹ï¼šå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼›(2)ç­¾åè¿‡ç¨‹ï¼šç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯† ä¸€èˆ¬ä¼ è¾“æ•°æ®ç”¨å¯¹ç§°åŠ å¯†ï¼Œå¯¹å¯¹ç§°å¯†é’¥çš„ä¼ è¾“ç”¨éžå¯¹ç§°åŠ å¯†ï¼Œä¾‹å¦‚TLSåè®®æ¡æ‰‹é˜¶æ®µé€šè¿‡éžå¯¹ç§°åŠ å¯†äº¤æ¢ä¸€äº›ä¿¡æ¯ï¼Œä»Žè€Œç”Ÿæˆå¯¹ç§°å¯†é’¥ï¼ŒåŽç»­æ•°æ®ä¼ è¾“å°±ç”¨æ­¤å¯†é’¥ã€‚ ç­¾åå’Œè¯ä¹¦ ç­¾åçš„ä½œç”¨ ç¡®ä¿ä¿¡æ¯ä¸è¢«ç¯¡æ”¹ ç¡®ä¿ä¿¡æ¯æ¥è‡ªå‘å¸ƒè€… ç­¾åçš„åŽŸç† å¯¹ä¿¡æ¯HASHåŽå¾—åˆ°æ‘˜è¦ï¼Œç„¶åŽç”¨ç§é’¥åŠ å¯†å¾—åˆ°ç­¾åï¼ŒæŽ¥æ”¶æ–¹èƒ½å¤Ÿç”¨å…¬é’¥è§£å¯†è¯´æ˜Žæ˜¯å¯¹æ–¹å‘é€çš„ï¼Œç„¶åŽå†æ¬¡å¯¹ä¿¡æ¯HASHå¾—åˆ°ç›¸åŒçš„æ‘˜è¦å€¼è¯´æ˜Žä¿¡æ¯æ²¡æœ‰è¢«ä¿®æ”¹ã€‚ è¯ä¹¦ ç®€å•æ¥è¯´å°±æ˜¯å¯¹å…¬é’¥ç­¾åï¼Œä¸Šè¿°ç­¾åè¿‡ç¨‹çš„æ¼æ´žåœ¨äºŽæŽ¥æ”¶æ–¹æŒæœ‰çš„å…¬é’¥å¦‚æžœè¢«äººæ›¿æ¢ï¼Œå°±å¯ä»¥è¢«å‡å†’è€…å›žå¤ä¿¡æ¯ï¼Œè§£å†³çš„åŠžæ³•æ˜¯å¯¹å…¬é’¥è¿›è¡Œè®¤è¯ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡CAå¯†é’¥å¯¹å…¬é’¥è¿›è¡ŒåŠ å¯†å¾—åˆ°è¯ä¹¦ï¼ŒæŽ¥æ”¶äººä¸ç›´æŽ¥æ‹¿åˆ°å…¬é’¥ï¼Œè€Œæ˜¯è¯ä¹¦ï¼ŒæŽ¥æ”¶äººé€šè¿‡CAçš„å…¬é’¥å¯ä»¥ä»Žè¯ä¹¦ä¸­éªŒè¯å¾—åˆ°å‘é€äººçš„å…¬é’¥ã€‚åªè¦CAç§é’¥ä¸æ³„éœ²ï¼Œå°±ä¸å¯èƒ½è¢«å…¶ä»–äººå†’å……ã€‚ CAè¯ä¹¦ CAæ˜¯ä¸€ä¸ªæœºæž„ï¼Œä¸“é—¨ä¸ºå…¶ä»–äººç­¾å‘è¯ä¹¦ï¼Œè¿™ä¸ªè¯ä¹¦ä¿å­˜å…¶ä»–äººçš„å…¬é’¥ï¼Œç¡®ä¿äº†å…¬é’¥çš„æ¥æºä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ CAæœ¬èº«æœ‰è‡ªå·±çš„å…¬ç§é’¥å¯¹ï¼Œç§é’¥ç”¨äºŽç­¾å‘å…¶ä»–è¯ä¹¦ï¼Œå…¬é’¥ç”¨äºŽéªŒè¯è¯ä¹¦ï¼ŒCAå…¬é’¥åŒæ ·éœ€è¦ä¿æŠ¤ï¼Œè¿™å°±æ˜¯CAè¯ä¹¦ã€‚ é‚£ä¹ˆCAè¯ä¹¦æ˜¯è°ç­¾å‘å‘¢ï¼Œä»Žç­¾åçš„åŽŸç†æ¥çœ‹ï¼Œå¿…ç„¶å­˜åœ¨CAè‡ªå·±ç»™è‡ªå·±ç­¾åï¼Œè¿™å°±æ˜¯æ ¹CAè¯ä¹¦ã€‚ æ ¹CAæ˜¯éžå¸¸å®è´µçš„ï¼Œé€šå¸¸å‡ºäºŽå®‰å…¨çš„è€ƒè™‘ä¼šç­¾å‘ä¸€äº›ä¸­é—´CAè¯ä¹¦ï¼Œç„¶åŽç”±ä¸­é—´CAç­¾å‘æœ€ç»ˆç”¨æˆ·è¯ä¹¦ï¼Œè¿™æ ·å°±æž„æˆäº†ä¸€ä¸ªä¿¡ä»»é“¾ã€‚æŽ¥æ”¶è€…ä¿¡ä»»æŸä¸ªCAè¯ä¹¦ï¼Œé‚£ä¹ˆç”±æ­¤CAç­¾å‘çš„è¯ä¹¦å°±éƒ½è¢«ä¿¡ä»»ã€‚ å…¬ä¿¡çš„æ ¹CAå…¨çƒåªæœ‰æœ‰é™çš„ä¸€äº›ï¼Œå®ƒä»¬é€šè¿‡ç¬¬ä¸‰æ–¹æœºæž„å®¡è®¡ï¼Œå…·æœ‰æƒå¨æ€§å’Œå…¬æ­£æ€§ï¼Œé€šå¸¸æ“ä½œç³»ç»Ÿæˆ–æµè§ˆå™¨å·²ç»å†…ç½®å®‰è£…ï¼Œç”±è¿™äº›æ ¹CAç­¾å‘çš„è¯ä¹¦éƒ½ä¼šè¢«ä¿¡ä»»ã€‚ ç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªè¡Œå®‰è£…ä¿¡ä»»çš„è¯ä¹¦ï¼Œå…¶é£Žé™©éœ€è¦ç”¨æˆ·è‡ªå·±æ‰¿æ‹…ï¼Œä¸€å®šè¦ç¡®ä¿è¯ä¹¦æ¥æºå¯é ã€‚ è‡ªç­¾åè¯ä¹¦ æ‰€ä»¥æ ¹è¯ä¹¦ä¸€å®šæ˜¯è‡ªç­¾åçš„ã€‚ å…¬ä¿¡çš„CAæ˜¯éžå¸¸å®è´µçš„èµ„æºï¼Œä»Žå…¶ç”³è¯·è¯ä¹¦æ˜¯éœ€è¦ä»˜è´¹çš„ï¼Œå¹¶ä¸”æœ‰äº›åœºæ™¯å¹¶ä¸éœ€è¦å…¬ä¿¡çš„è¯ä¹¦ï¼Œè¿™æ—¶å°±ä¼šè‡ªå»ºCAï¼Œéœ€è¦ç”¨åˆ°è‡ªç­¾åï¼Œä¸‹é¢é€šè¿‡ä¸¤å¼ å›¾è¯´æ˜Žè‡ªç­¾åè¯ä¹¦å’Œéžè‡ªç­¾åè¯ä¹¦çš„åŒºåˆ«ã€‚ è‡ªç­¾åè¯ä¹¦ éžè‡ªç­¾åè¯ä¹¦ kubernetesé›†ç¾¤å°±æ˜¯é‡‡ç”¨è‡ªå»ºçš„CAï¼Œç”¨è‡ªå»ºCAç­¾å‘å„ç»„ä»¶äº¤äº’éœ€è¦çš„è¯ä¹¦ï¼ŒCAè¯ä¹¦èµ·åˆ°éªŒè¯å¯¹ç«¯èº«ä»½çš„ä½œç”¨ï¼Œäº¤äº’çš„åŒæ–¹éƒ½éœ€è¦çŸ¥é“å¯¹æ–¹çš„CAè¯ä¹¦ã€‚kube-controller-manageréœ€è¦ä¸ºkubeleteç­¾å‘è¯ä¹¦ï¼Œæ‰€ä»¥å®ƒè¿˜éœ€è¦CAçš„ç§é’¥ã€‚]]></content>
      <categories>
        <category>å®‰å…¨</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>certificate</tag>
        <tag>self-signed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨vscodeè¿œç¨‹è°ƒè¯•golang]]></title>
    <url>%2F2019%2F10%2F21%2F016-remote-debug-golang-with-vscode%2F</url>
    <content type="text"><![CDATA[åœ¨å­¦ä¹ ä¸€äº›å¤§åž‹golangé¡¹ç›®æ—¶ï¼Œä¾‹å¦‚kubernetesï¼Œé€šè¿‡è°ƒè¯•å™¨ä¸€è¾¹è·Ÿè¸ªä»£ç ä¸€è¾¹å­¦ä¹ å…¶åŽŸç†æ˜¯å¾ˆå¥½çš„æ–¹æ³•ï¼Œä¸€èˆ¬k8séƒ¨ç½²åœ¨è¿œç¨‹çŽ¯å¢ƒï¼Œåœ¨æœ¬æœºè¿›è¡Œå¼€å‘ï¼Œå¾ˆè‡ªç„¶å¯¹è¿œç¨‹è°ƒè¯•æœ‰è¿«åˆ‡éœ€æ±‚ï¼Œè¿™ä¹Ÿæ˜¯å’Œè°ƒè¯•ä¸€èˆ¬golangç¨‹åºæœ€ä¸»è¦çš„è¯‰æ±‚åŒºåˆ«ç‚¹ï¼Œæœ¬æ–‡é‡ç‚¹ä»‹ç»è¿œç¨‹è°ƒè¯•è¿™ç§åœºæ™¯ã€‚ vscodeè¿œç¨‹è°ƒè¯• vscodeçš„æˆåŠŸå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯è¿›ç¨‹éš”ç¦»çš„æ’ä»¶è®¾è®¡ï¼Œæž„å»ºå‡ºäº†ä¸°å¯Œçš„ç”Ÿæ€çŽ¯å¢ƒï¼Œè€Œvscodeè‡ªèº«ä¿æŒè½»é‡å¹¶æä¾›ç¨³å®šæµç•…çš„ç¼–è¾‘ä½“éªŒã€‚ vscodeå®žçŽ°è¿œç¨‹è°ƒè¯•æœ‰ä¸¤ç§æ–¹æ³•ï¼š ç¬¬ä¸€ç§æ˜¯ç½‘ç»œä¸Šæœç´¢å‡ºæ¥æœ€å¤šçš„ï¼Œé€šè¿‡dlvçš„è¿œç¨‹è°ƒè¯•åŠŸèƒ½ï¼Œåœ¨æœåŠ¡ç«¯å¯åŠ¨dlv serverï¼Œå®¢æˆ·ç«¯vscodeè¿žæŽ¥dlv server è¿™ç§æ–¹æ³•å­˜åœ¨æ˜Žæ˜¾ç¼ºé™·ï¼š åªèƒ½attachè°ƒè¯• æµè§ˆçš„ä»£ç æ˜¯æœ¬åœ°çš„ï¼Œè¿œç¨‹ä¿®æ”¹åŽè¦åŒæ­¥åˆ°æœ¬åœ° ç¬¬äºŒç§æ˜¯ä½¿ç”¨vscodeçš„è¿œç¨‹å¼€å‘åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½æœ€æ—©æ˜¯2019.5æœˆå‘å¸ƒï¼Œå½“æ—¶åªåœ¨insiderç‰ˆæœ¬åŒ…å«ï¼ŒåŽç»­stableç‰ˆæ˜¯ä»Ž1.35.1å¼€å§‹åŒ…å«ã€‚è¿™ä¸ªåŠŸèƒ½ä¹Ÿæ˜¯é€šè¿‡æ’ä»¶å®žçŽ°çš„ï¼Œæœ‰Remote-SSHã€Remote-WSLã€Remote-Containersä¸‰ä¸ªæ’ä»¶ï¼Œé€‚åº”ä¸‰ç§ä¸åŒçš„å¼€å‘çŽ¯å¢ƒï¼Œåå­—ä¸€ç›®äº†ç„¶ è¿™ç§æ–¹æ³•æ•´ä¸ªå¼€å‘çŽ¯å¢ƒå°±åœ¨è¿œç¨‹ä¸»æœºä¸Šï¼Œæœ¬åœ°æœºå™¨ä¸Šåªæ˜¯UIï¼Œå®ƒèƒ½å®žçŽ°çš„ä¸åªæ˜¯è°ƒè¯•ï¼Œè€Œæ˜¯æ•´ä¸ªå¼€å‘è¿‡ç¨‹ï¼Œæ‰€ä»¥è¿™ä¸ªåŠŸèƒ½å«è¿œç¨‹å¼€å‘ï¼ˆRemote Developmentï¼‰ attachæˆ–launchéƒ½å¯ä»¥ï¼Œå’Œæœ¬åœ°è°ƒè¯•ä½“éªŒä¸€è‡´ attachæ—¶modeæœ‰localå’Œremoteä¸¤ç§ï¼Œå‰è€…vscodeè‡ªåŠ¨dlv attachï¼ŒåŽè€…æ‰‹å·¥è¿è¡Œdlv attachï¼Œä¸€èˆ¬åœ¨è¢«è°ƒè¯•çš„è¿›ç¨‹æ²¡æœ‰æƒé™attachæ—¶ä½¿ç”¨ æœ¬åœ°ä¸éœ€è¦æºä»£ç ï¼Œç›´æŽ¥ä¿®æ”¹è¿œç¨‹ä¸»æœºæºä»£ç  ç¬¬äºŒç§æ–¹æ³•æ— ç–‘æ˜¯å½“å‰æœ€å¥½çš„é€‰æ‹©ã€‚å½“ç„¶æ— è®ºé‡‡ç”¨å“ªç§æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒè¯•å…¶å®žéƒ½æ˜¯é€šè¿‡dlvã€‚ vscode Remote-SSHä½¿ç”¨æ–¹æ³• ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹Remote-SSHçš„ä½¿ç”¨æ–¹æ³•ï¼Œvscodeè¯·ä½¿ç”¨1.35åŠä»¥ä¸Šç‰ˆæœ¬ã€‚ å»ºç«‹Local Hoståˆ°Remote Hostçš„SSHé€šé“ å¦‚æžœä½¿ç”¨vagrantï¼Œå®ƒå·²ç»ä¸ºæˆ‘ä»¬é…ç½®å¥½ï¼Œè¿è¡Œvagrant ssh-configä¼šæ˜¾ç¤ºsshçš„ç«¯å£ã€å¯†é’¥æ–‡ä»¶ç­‰ä¿¡æ¯ã€‚ $ vagrant ssh-config Host master HostName 127.0.0.1 User vagrant Port 2222 UserKnownHostsFile /dev/null StrictHostKeyChecking no PasswordAuthentication no IdentityFile D:/k8s/.vagrant/machines/master/virtualbox/private_key IdentitiesOnly yes LogLevel FATAL éªŒè¯sshç™»é™†ï¼š 1ssh -i D:/k8s/.vagrant/machines/master/virtualbox/private_key -p 2222 vagrant@localhost å¦‚æžœå¯ä»¥è¿žé€šè™šæ‹Ÿæœºipï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥ï¼š 1ssh -i D:/k8s/.vagrant/machines/master/virtualbox/private_key vagrant@ip å¦‚æžœè‡ªå·±é…ç½®å¯†é’¥ç™»é™†ï¼Œéœ€è¦ä½¿ç”¨ssh-keygenç”Ÿæˆå…¬é’¥å’Œå¯†é’¥ï¼Œå°†å…¬é’¥å†…å®¹å†™å…¥æœåŠ¡ç«¯çš„authorized_keysæ–‡ä»¶ä¸­ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å¯†é’¥æ–‡ä»¶ç™»é™†ã€‚ å®‰è£…Remote - SSHæ’ä»¶ æ·»åŠ Hostå®šä¹‰ï¼Œç¼–è¾‘%USERPROFILE%/.ssh/configæ–‡ä»¶ï¼Œæ·»åŠ  1234Host k8s_master HostName 10.10.10.14 User vagrant IdentityFile D:\k8s\.vagrant\machines\master\virtualbox\private_key æˆ–è€… 12345Host k8s_master HostName 127.0.0.1 User vagrant IdentityFile D:\k8s\.vagrant\machines\master\virtualbox\private_key Port 2222 k8s_masteræ˜¯hostçš„åˆ«åï¼ŒåŽç»­sshå®¢æˆ·ç«¯å¯ä»¥ç›´æŽ¥ç”¨åˆ«åè¿žæŽ¥ï¼Œä¸ç”¨å†æŒ‡å®šUserï¼ŒHostNameå’ŒIdentityFileç­‰å‚æ•°ï¼Œä¾‹å¦‚ï¼š 1ssh k8s_master vscodeè¿žæŽ¥è¿œç¨‹ä¸»æœºï¼Œç‚¹å‡»å·¦ä¸‹è§’ï¼Œå¼¹å‡ºå‘½ä»¤ä¸­é€‰æ‹©Connect to Hostï¼Œé€‰æ‹©ä¸Šè¿°å®šä¹‰çš„Host åŽç»­æ‰“å¼€æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å°±éƒ½æ˜¯è¿œç¨‹ä¸»æœºä¸Šçš„ï¼Œå’Œæ“ä½œæœ¬åœ°æ–‡ä»¶æ˜¯ä¸€æ ·çš„ ç¼–è¯‘æºç  åœ¨è¿œç¨‹ä¸»æœºæ­å»ºå¥½å®Œæ•´çš„golangå¼€å‘çŽ¯å¢ƒï¼Œè™½ç„¶vscodeå¥½åƒè¿è¡Œåœ¨Local Hostï¼Œä½†å®žé™…ä¸Šæ•´ä¸ªå¼€å‘çŽ¯å¢ƒéƒ½æ˜¯ç”¨çš„Remote Hostä¸Šçš„ã€‚ å¯¹äºŽå¤§åž‹çš„golangç¨‹åºï¼Œç¼–è¯‘æ…¢æ˜¯ä¸€ä¸ªå¤´ç–¼çš„é—®é¢˜ï¼Œè¿™é‡Œé’ˆå¯¹ä¼˜åŒ–ç¼–è¯‘é€Ÿåº¦ç»™å‡ºä¸€äº›å»ºè®®ï¼š å¯ç”¨go moduleï¼Œå¹¶è®¾ç½®ä¸€ä¸ªé€Ÿåº¦å¿«çš„GOPROXYï¼Œä¾‹å¦‚https://goproxy.cn å…ˆæ‰§è¡Œgo installï¼Œå°†ç¼–è¯‘ç»“æžœç¼“å­˜åœ¨å…¨å±€ç¼“å­˜ï¼ŒåŽç»­go buildæ—¶æºç æ²¡æœ‰å˜åŒ–å°†ç›´æŽ¥ä½¿ç”¨å…¨å±€ç¼“å­˜ä¸­å†…å®¹ ä½¿ç”¨go build -pæŒ‡å®šç¼–è¯‘å‘½ä»¤å¹¶è¡Œæ•° è¦è°ƒè¯•golangç¨‹åºï¼Œè¿˜éœ€è¦åŠ ä¸Šâ€œ-N -l&quot;ç¼–è¯‘å‚æ•°ï¼Œä¸Šè¿°go install/go buildéƒ½è¦åŠ ä¸Šã€‚ -N disable optimizations -l disable inlining è°ƒè¯• vscodeè¿›è¡Œè°ƒè¯•ä¸»è¦æ˜¯è®¾ç½®launch.jsonæ–‡ä»¶ï¼Œåˆ‡æ¢åˆ°debugè§†å›¾ï¼Œç‚¹å‡»Add Configurationâ€¦ï¼Œå¦‚æžœå½“å‰æ‰“å¼€è¿‡goæ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆlaunch.jsonï¼Œå¦åˆ™éœ€è¦é€‰æ‹©goçŽ¯å¢ƒï¼š launch.jsonçš„configurationså­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªé…ç½®ï¼Œé€šè¿‡requestå’Œmodeçš„ç»„åˆç”¨äºŽä¸åŒçš„è°ƒè¯•åœºæ™¯ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ç»„åˆï¼š request mode program remotePath processId args launch debugã€testï¼ˆä¹Ÿå¯ç”¨autoï¼‰ æºæ–‡ä»¶æˆ–åŒ…ç»å¯¹è·¯å¾„ / / å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨ launch execï¼ˆä¹Ÿå¯ç”¨autoï¼‰ ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç¨‹åºç»å¯¹è·¯å¾„ / / åŒä¸Š launch remoteï¼ˆåºŸé™¤ï¼Œä½¿ç”¨attachï¼‰ / / / / attach local / / è¿›ç¨‹ID / attach remote / è¢«è°ƒè¯•æºç æ–‡ä»¶ç»å¯¹è·¯å¾„ / / ç‰¹åˆ«è¯´æ˜Žä¸€ä¸‹ å½“modeä¸ºautoæ—¶è‡ªåŠ¨æ ¹æ®programåˆ¤æ–­æ˜¯å“ªç§æƒ…å†µ attach+remoteè¿™ç§æƒ…å†µï¼ŒremotePathéžå¸¸é‡è¦ï¼Œä¾‹å¦‚è®¾ç½®åœ¨workspaceFolder/path/to/debuged_fileçš„æ–­ç‚¹ï¼ŒdlvæœåŠ¡ç«¯æ˜¯æ‰“åœ¨remotePath/path/to/debuged_fileä¸Šçš„ï¼Œä¸€æ—¦è®¾ç½®ä¸å¯¹å°±ä¼šå¯¼è‡´æ–­ç‚¹æ–­ä¸åˆ°ï¼Œå¹¶ä¼šå¯¼è‡´dlvæœåŠ¡å‡ºé—®é¢˜ï¼ˆè§æœ€åŽè¯´æ˜Žï¼‰ ä¸æ˜¯æ‰€æœ‰å­—æ®µåœ¨æ¯ç§åœºæ™¯éƒ½éœ€è¦ï¼Œ/è¡¨ç¤ºè¿™ç§æƒ…å†µä¸éœ€è¦ ä¸Šè¿°è¡¨æ ¼åªåˆ—å‡ºäº†ä¸»è¦çš„ä¸€äº›å­—æ®µï¼Œæ¯ç§åœºæ™¯æ”¯æŒå“ªäº›å­—æ®µï¼Œå¯ä»¥é€šè¿‡æ™ºèƒ½æç¤ºï¼ˆé»˜è®¤å¿«æ·é”®Ctrl+Spaceï¼Œå¦‚æžœå¿«æ·é”®å’Œç³»ç»Ÿå†²çªï¼Œéœ€è¦è®¾ç½®å…¶ä»–å¿«æ·é”®ï¼‰è°ƒå‡º vscodeå†…ç½®äº†ä¸€äº›ä»£ç ç‰‡æ®µå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†å¸¸ç”¨åœºæ™¯ï¼Œä¹Ÿæ˜¯é€šè¿‡æ™ºèƒ½æç¤ºè°ƒå‡ºã€‚ Attach to local process 1234567&#123; "name": "Launch file", "type": "go", "request": "launch", "mode": "debug", "program": "$&#123;file&#125;"&#125; Connect to server 123456789&#123; "name": "Connect to server", "type": "go", "request": "attach", "mode": "remote", "remotePath": "$&#123;workspaceFolder&#125;", "port": 2345, "host": "127.0.0.1"&#125; Launch file 1234567&#123; "name": "Launch file", "type": "go", "request": "launch", "mode": "debug", "program": "$&#123;file&#125;"&#125; Launch package 1234567&#123; "name": "Launch Package", "type": "go", "request": "launch", "mode": "debug", "program": "$&#123;workspaceFolder&#125;"&#125; Launch test function 1234567891011&#123; "name": "Launch test function", "type": "go", "request": "launch", "mode": "test", "program": "$&#123;workspaceFolder&#125;", "args": [ "-test.run", "MyTestFunction" ]&#125; Launch test package 1234567&#123; "name": "Launch test package", "type": "go", "request": "launch", "mode": "test", "program": "$&#123;workspaceFolder&#125;"&#125; å¦‚ä¸Šæ‰€ç¤ºï¼Œå…¶ä¸­ç”¨åˆ°å‡ ä¸ªçŽ¯å¢ƒå˜é‡ï¼š fileï¼šå½“å‰æ–‡ä»¶ç»å¯¹è·¯å¾„ workspaceFolderï¼šå·¥ä½œåŒºç›®å½•ç»å¯¹è·¯å¾„ fileDirnameï¼šå½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•ç»å¯¹è·¯å¾„ dlvå­˜åœ¨çš„é—®é¢˜ [vagrant@localhost ~]$ dlv version Delve Debugger Version: 1.3.0 Build: $Id: 2f59bfc686d60989dcef9de40b480d0a34aa2fa5 $ dlvåœ¨ä½¿ç”¨ä¸­å­˜åœ¨ä¸€äº›ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿çš„åœ°æ–¹ï¼š attach+localæ—¶ï¼Œvscodeé€€å‡ºè°ƒè¯•åŽè¢«è°ƒè¯•è¿›ç¨‹ä¹Ÿé€€å‡ºï¼Œæ— æ³•å®žçŽ°deattachçš„æ•ˆæžœ attach+remoteæ—¶ï¼Œvscodeé€€å‡ºè°ƒè¯•åŽdlvæœåŠ¡ç«¯ä¹Ÿé€€å‡º attach+remoteæ—¶ï¼Œå¦‚æžœremotePathè®¾ç½®ä¸å¯¹ï¼ŒdlvæœåŠ¡ç«¯å°±æ— æ³•æ­£å¸¸é€€å‡ºä¹Ÿæ— æ³•å†æ­£å¸¸ä½¿ç”¨ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªBug)ï¼Œåªèƒ½kill -9æ€æŽ‰ï¼Œå¦‚æžœdlvä¸æ€æŽ‰ï¼Œè¢«è°ƒè¯•è¿›ç¨‹ä¹Ÿæ— æ³•é€€å‡ºï¼Œè¿™æ—¶å¦‚æžœå¼ºè¡ŒkillæŽ‰è¢«è°ƒè¯•è¿›ç¨‹ï¼Œå®ƒå°±ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ï¼Œå¦‚æžœæ°å¥½è¢«è°ƒè¯•è¿›ç¨‹æ˜¯systemdå¯åŠ¨çš„æœåŠ¡ï¼Œé‚£ä¹ˆè¦æ¶ˆé™¤åƒµå°¸è¿›ç¨‹å°±åªæœ‰é‡å¯æœºå™¨äº† vscode serveræ˜¯è¿è¡Œåœ¨sshæ‰€ä½¿ç”¨çš„ç”¨æˆ·ä¸‹çš„ï¼Œå¦‚æžœè¢«è°ƒè¯•çš„è¿›ç¨‹å½“å‰ç”¨æˆ·æ²¡æœ‰æƒé™æ˜¯æ— æ³•ä½¿ç”¨attach+localæ¨¡å¼çš„ï¼Œè¿™æ—¶åªæœ‰ç”¨attach+remoteæ¨¡å¼ï¼Œæ‰‹å·¥å¯åŠ¨dlv attachï¼ŒremotePathè®¾ä¸º${workspaceFolder}]]></content>
      <categories>
        <category>golang</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>dlv</tag>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[golangä¸­å¦‚ä½•é€šè¿‡åŒ…çš„importpathå®šä½æºç ç›®å½•]]></title>
    <url>%2F2019%2F10%2F09%2F015-find-code-dir-from-package-importpath%2F</url>
    <content type="text"><![CDATA[golangæ ‡å‡†åº“ä¸­çš„go/buildåŒ…æ˜¯ç”¨æ¥æ”¶é›†åŒ…çš„ä¸€äº›ä¿¡æ¯çš„ï¼Œä¾‹å¦‚èŽ·å–åŒ…çš„æºç ä½ç½®ã€‚ç”¨æ¥å­¦ä¹ golangçš„äº¤äº’å¼æ•™ç¨‹tourå°±æ˜¯ä½¿ç”¨äº†go/buildå®šä½touræºä»£ç ä½ç½®ï¼Œä»Žè€Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨å…¶ä¸­çš„æ–‡ä»¶ã€‚ä½†æ˜¯go/buildæ˜¯æœ‰ä¸€äº›ä½¿ç”¨é™åˆ¶çš„ï¼Œä¸»è¦æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹æ— æ³•å®šä½go moduleçš„æºç ä½ç½®ï¼Œé‚£ä¹ˆè¿˜æœ‰å“ªäº›æ–¹æ³•å¯ä»¥æ ¹æ®åŒ…çš„importpathèŽ·å–åˆ°åŒ…çš„æºä»£ç ä½ç½®å‘¢ï¼Œæœ¬æ–‡è¯¦ç»†è¿›è¡ŒæŽ¢è®¨ã€‚ èµ·å›  golang 1.12.9ï¼Œè®¾ç½®äº†GO111MODULE=onï¼Œä¹Ÿå°±æ˜¯æ˜¾å¼å¼€å¯go moduleã€‚ æŒ‰ç…§tourçš„ä½¿ç”¨æ–¹æ³•ï¼Œé¦–å…ˆï¼š 1go get golang.org/x/tour ç„¶åŽåˆ°GOPATH/binç›®å½•ä¸‹è¿è¡Œtourç¨‹åºï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š Couldnâ€™t find tour files: could not find go-tour content; check $GOROOT and $GOPATH è€Œåœ¨è®¾ç½®GO111MODULE=onä¹‹å‰ä¸€åˆ‡éƒ½æ˜¯æ­£å¸¸çš„ã€‚ é€šè¿‡é˜…è¯»tourçš„æºä»£ç å‘çŽ°å®ƒè¿è¡Œæ—¶éœ€è¦ä½¿ç”¨æºä»£ç ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè¿™æ˜¯é€šè¿‡æ ‡å‡†åº“go/build.Context.Importæ¥å®šä½æºä»£ç çš„è·¯å¾„çš„ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼Œè§local.goæ–‡ä»¶ï¼š 1234567891011121314151617181920const ( basePkg = "golang.org/x/tour" socketPath = "/socket")func findRoot() (string, error) &#123; ctx := build.Default p, err := ctx.Import(basePkg, "", build.FindOnly) if err == nil &amp;&amp; isRoot(p.Dir) &#123; return p.Dir, nil &#125; tourRoot := filepath.Join(runtime.GOROOT(), "misc", "tour") ctx.GOPATH = tourRoot p, err = ctx.Import(basePkg, "", build.FindOnly) if err == nil &amp;&amp; isRoot(tourRoot) &#123; gopath = tourRoot return tourRoot, nil &#125; return "", fmt.Errorf("could not find go-tour content; check $GOROOT and $GOPATH")&#125; p.Dirå³ä¸ºåŒ…å¯¹åº”çš„æºä»£ç è·¯å¾„ï¼Œå…¶ä¸­å…³é”®ä»£ç æ˜¯è°ƒç”¨äº†go/build.Context.Importï¼š 1func (ctxt *Context) Import(path string, srcDir string, mode ImportMode) åˆ†æžgo/build.Context.Importçš„æºä»£ç å‘çŽ°ï¼Œå½“srcDirä¸ºç©ºæ—¶æ€»æ˜¯æ— æ³•èŽ·å–go moduleåŒ…ä¿¡æ¯ã€‚åœ¨è¿›ä¸€æ­¥åˆ†æžåŽŸå› ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹go moduleç›¸å…³çŸ¥è¯†ã€‚ go module go moduleæ˜¯golang 1.11å¼•å…¥çš„åŒ…ç®¡ç†æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡GO111MODULEçŽ¯å¢ƒå˜é‡æŽ§åˆ¶æ˜¯å¦å¯ç”¨ï¼Œæœ‰ä¸‰ä¸ªå€¼ï¼š offï¼šå…³é—­go module onï¼šæ€»æ˜¯ä½¿ç”¨go module autoï¼šé»˜è®¤å€¼ï¼Œå¦‚æžœå½“å‰å·¥ç¨‹åŒ…å«go.modæ–‡ä»¶åˆ™å¯ç”¨ go moduleï¼Œå¦åˆ™ä½¿ç”¨æ—§çš„GOPATHå’Œvendoræœºåˆ¶ å½“å¯ç”¨go moduleæ—¶ï¼Œä¸€ä¸ªå˜åŒ–æ˜¯ä¸‹è½½çš„ä¾èµ–åŒ…ä¸å†æ”¾åœ¨GOPATH/srcç›®å½•ä¸‹ï¼Œè€Œæ˜¯æ”¾åœ¨GOPATH/pkg/modï¼ˆæœªæ¥å¯èƒ½è¿ç§»åˆ°GOCACHE/modï¼‰ä¸‹ï¼Œå¹¶ä¸”ç›®å½•å¸¦æœ‰ç‰ˆæœ¬å·ï¼Œä»¥tourä¸ºä¾‹ï¼Œå¯ç”¨go moduleä¹‹å‰æºç ä½ç½®ä¸ºï¼š 1GOPATH/src/golang.org/x/tour å¯ç”¨ä¹‹åŽå˜ä¸ºï¼š 1GOPATH/pkg/mod/golang.org/x/tour@v0.0.0-20191002171047-6bb846ce41cd moduleå’Œpackage moduleå’Œpackageæ˜¯é›†åˆå’Œå…ƒç´ çš„å…³ç³»ï¼Œä¸€ä¸ªmoduleå¯ä»¥åŒ…å«0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªpackageï¼Œmoduleçš„Pathå’Œå…¶ä¸­packageçš„ImportPathå‰ç¼€ä¸€å®šæ˜¯ç›¸åŒçš„ï¼Œä¾‹å¦‚golang.org/x/toolsæ˜¯ä¸€ä¸ªmoduleï¼Œå…¶ä¸­çš„golang.org/x/tools/go/packagesæ˜¯ä¸€ä¸ªpackageã€‚ importä¸€å®šæ˜¯packageï¼Œè€Œä¸æ˜¯moduleï¼Œå½“å‰moduleä¸­æ‰§è¡Œgo mod tidyå‘½ä»¤å¯ä»¥æ ¹æ®æºç ä¸­çš„importè¡¥é½go.modä¸­ç¼ºå¤±çš„moduleä»¥åŠåˆ é™¤å¤šä½™çš„moduleã€‚ å›žåˆ°é—®é¢˜çš„åŽŸå›  go/buildåœ¨æœ€åˆæ²¡æœ‰å¼•å…¥go moduleä¹‹å‰ï¼Œæ€»æ˜¯ä»ŽGOROOT/srcå’ŒGOPATH/srcä¸‹å¯»æ‰¾åŒ…çš„ï¼Œè¿™æ—¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå½“å¯ç”¨go moduleåŽï¼ŒåŒ…ç¼“å­˜å˜åˆ°äº†GOPATH/pkg/modä¸‹ï¼Œè¿™æ—¶å°±æ‰¾ä¸åˆ°äº†ï¼Œcase 26504æå‡ºäº†è¿™ä¸ªé—®é¢˜å¹¶åšäº†ä¿®æ­£ï¼Œä½†æ˜¯å‡ºäºŽæ•ˆçŽ‡çš„è€ƒè™‘ï¼Œåªæœ‰åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹æ‰ä¼šé’ˆå¯¹go moduleè¿›è¡Œå¤„ç†ï¼Œç„¶åŽé€šè¿‡æ‰§è¡Œgo listå‘½ä»¤å®žçŽ°çš„ã€‚ç‰¹å®šçš„æƒ…å†µæ˜¯ï¼š the AllowBinary and IgnoreVendor flags are not set, Context describes the local file system (all the helper functions are nil), srcDir is outside GOPATH/src (or GO111MODULE=on), thereâ€™s a go.mod in srcDir or above, the release tags are unmodified from Default.Context, and path does not name a standard library package. å½“srcDirä¸ºç©ºçš„æ—¶å€™ï¼Œæ˜¯æ²¡æœ‰åŠžæ³•åˆ¤æ–­ä¸Šè¿°æ¡ä»¶3å’Œ4çš„ï¼Œå°±ä¼šç›´æŽ¥è¿”å›žå¤±è´¥ï¼Œæ‰€ä»¥è¿™æ—¶go/buildä»ç„¶æ— æ³•èŽ·å¾—ç›¸åº”moduleçš„ä¿¡æ¯ï¼Œtouråœ¨è°ƒç”¨go/build.Context.Importæ—¶ä¼ å…¥çš„srcDiræ­£æ˜¯ä¸ºç©ºã€‚ è¯¦è§£go/build.Context.Importè¿‡ç¨‹ 1func (ctxt *Context) Import(path string, srcDir string, mode ImportMode) pathï¼šæ¨¡å—çš„Pathæˆ–åŒ…çš„ImportPath srcDirï¼šå½“å‰å·¥ç¨‹çš„æºç è·¯å¾„ï¼Œä¸‹é¢ä¼šè®²åœ¨å“ªäº›æƒ…å†µä¼šç”¨åˆ° modeï¼šFindOnlyï¼ŒAllowBinaryï¼ŒImportCommentï¼ŒIgnoreVendor Importçš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼š å¦‚æžœä¸ºæœ¬åœ°åŒ…ï¼Œä¹Ÿå°±æ˜¯pathä¸ºç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹çš„æ­£æ˜¯srcDirï¼Œè¿™æ—¶å…ˆæ ¹æ®srcDirå¾—åˆ°ç»å¯¹è·¯å¾„ï¼Œç„¶åŽæ ¹æ®æ­¤ç»å¯¹è·¯å¾„ä¾æ¬¡åœ¨GOROOT/srcå’ŒGOPATH/srcä¸­å¯»æ‰¾ï¼Œç»å¯¹è·¯å¾„å¿…é¡»ä¸ºå…¶å­ç›®å½•ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆå³Importè¿”å›žæ‰¾åˆ°åŒ…ï¼Œè¿™ç§æƒ…å†µä¸‹srcDirä¸èƒ½ä¸ºç©ºï¼Œæœ€åŽp.Dirçš„ç»“æžœæ˜¯Join(srcDir, path) å¦‚æžœéžæœ¬åœ°åŒ…ï¼š é¦–å…ˆé’ˆå¯¹moduleå°è¯•ä½¿ç”¨go listå‘½ä»¤èŽ·å–åŒ…ä¿¡æ¯ï¼Œè¿™æ—¶æœ‰ä¸€ç³»åˆ—é™åˆ¶æ¡ä»¶ï¼Œå…·ä½“è§ä¸Šæ–‡ï¼Œå…¶ä¸­éœ€è¦åˆ¤æ–­srcDirä¸åœ¨GOROOT/srcå’ŒGOPATH/srcä¸‹ä¸”å…¶è·¯å¾„ä¸Šæœ‰go.modæ–‡ä»¶ï¼Œæ‰€ä»¥srcDirä¸ºç©ºåˆ™ç›´æŽ¥å¯»æ‰¾å¤±è´¥ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™æ‰§è¡Œgo listï¼Œå‘½ä»¤çš„å½“å‰è·¯å¾„ä¸ºsrcDirï¼ŒsrcDirå¿…é¡»ä¸ºmoduleçš„è·¯å¾„ï¼Œç±»ä¼¼å¦‚ä¸‹å‘½ä»¤ï¼Œå¦‚æžœæˆåŠŸåˆ™Importè¿”å›žæ‰¾åˆ°åŒ…ï¼Œæœ€åŽp.Dirçš„ç»“æžœæ˜¯go listè¿”å›žçš„Dir 1go list -f &#123;&#123;.Dir&#125;&#125; path ç„¶åŽå°è¯•åœ¨vendorç›®å½•ä¸­å¯»æ‰¾ï¼Œè¿™æ—¶srcDirä¹Ÿä¸èƒ½ä¸ºç©ºï¼Œä½¿ç”¨srcDirä¾æ¬¡åœ¨GOROOT/srcå’ŒGOPATH/srcä¸­å¯»æ‰¾ï¼ŒsrcDirå¿…é¡»ä¸ºå…¶å­ç›®å½•ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆå³Importè¿”å›žæ‰¾åˆ°åŒ…ï¼Œæœ€åŽp.Dirçš„ç»“æžœæ˜¯Join(Abs(srcDir), â€œvendorâ€, path)ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥ ç„¶åŽå°è¯•åœ¨GOROOT/srcä¸­å¯»æ‰¾ï¼ŒæˆåŠŸåˆ™Importè¿”å›žæ‰¾åˆ°åŒ…ï¼Œp.Dirçš„ç»“æžœä¸ºJoin(GOROOT, â€œsrcâ€, path)ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥ ç„¶åŽå°è¯•ä¾æ¬¡åœ¨æ‰€æœ‰GOPATH/srcä¸­å¯»æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆå³Importè¿”å›žæ‰¾åˆ°åŒ…ï¼Œp.Dirçš„ç»“æžœä¸ºJoin(GOPATH, â€œsrcâ€, path) ä»¥ä¸Šè¿‡ç¨‹éƒ½æ²¡æœ‰å®šä½æˆåŠŸåˆ™Importè¿”å›žå¤±è´¥ æ ¹æ®ä¸Šè¿°è¿‡ç¨‹ï¼ŒsrcDiråœ¨ä¸‹è¿°ä¸‰ç§æƒ…å†µä¸‹èµ·åˆ°é‡è¦ä½œç”¨ï¼Œå¦‚æžœä¸ºç©ºåˆ™ä¼šå¯¼è‡´æ‰¾ä¸åˆ°åŒ…ï¼š æœ¬åœ°åŒ…ï¼Œæ­¤æ—¶pathæ˜¯ç›¸å¯¹srcDirçš„ moduleï¼Œæ­¤æ—¶è¿˜éœ€è¦srcDirä¸èƒ½åœ¨GOROOT/srcæˆ–GOPATH/srcä¸­ï¼Œä¸”è·¯å¾„ä¸ŠåŒ…å«go.modæ–‡ä»¶ï¼ŒsrcDiréœ€è¦ä¸ºæ­¤moduleçš„è·¯å¾„ vendorç›®å½•ä¸­çš„åŒ…ï¼Œæ­¤æ—¶pathåœ¨Join(srcDir, â€œvendorâ€)ç›®å½•ä¸‹ å®šä½åŒ…æºç ä½ç½®çš„æ–¹æ³•æ¢³ç† ä¸Šè¿°go/buildåœ¨å®šä½åŒ…æºç ä½ç½®æ—¶å­˜åœ¨ç§ç§é™åˆ¶ï¼Œé‚£ä¹ˆæ˜¯å¦è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå…±æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š å®ƒä»¬ä¹‹é—´æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼Œgo/buildå¯¹æ¨¡å—çš„æ”¯æŒéœ€è¦è°ƒç”¨go listï¼›golang.org/x/tools/go/packagesé»˜è®¤æ˜¯é€šè¿‡go listæ¥èŽ·å–åŒ…æˆ–æ¨¡å—ä¿¡æ¯çš„ï¼Œä¸‹é¢å…·ä½“è¯´æ˜Žå…¶ä½¿ç”¨æ–¹æ³•ã€‚ go list 1go list [-f format] [-json] [-m] [list flags] [build flags] [packages] go listç”¨äºŽåˆ—å‡ºå½“å‰ç›®å½•ä¸»åŒ…æˆ–æ¨¡å—åŠå…¶ä¾èµ–ã€‚å½“GO111MODULE=onä¸”æ²¡æœ‰æŒ‡å®š-mæ—¶ï¼Œå¦‚æžœå½“å‰ç›®å½•æ‰¾ä¸åˆ°ï¼Œè¿˜ä¼šä»ŽGOPROXYæŒ‡å®šåœ°å€ä¸‹è½½ï¼Œæ­¤æ—¶ä¸èƒ½ä½¿ç”¨é€šé…ç¬¦ã€‚ packagesï¼šå½“æŒ‡å®š-mæ—¶ä¸ºæ¨¡å—çš„pathåˆ—è¡¨ï¼Œå¦åˆ™ä¸ºåŒ…çš„importpathåˆ—è¡¨ï¼›ä¸ºç©ºæ—¶åªåˆ—å‡ºä¸»æ¨¡å—æˆ–ä¸»åŒ…ï¼Œä¸ä¸ºç©ºæ—¶åˆ™åˆ—å‡ºåŒ¹é…çš„ï¼Œå¯ä»¥ç”¨â€¦é€šé…ç¬¦ï¼›æœ‰ä¸€äº›ç‰¹æ®Šçš„pathï¼Œå¯¹äºŽæ¨¡å—å¯ä»¥ä½¿ç”¨allï¼Œè¡¨ç¤ºåˆ—å‡ºå½“å‰ä¸»æ¨¡å—åŠæ‰€æœ‰ä¾èµ–æ¨¡å—ï¼Œå¯¹äºŽåŒ…æœ‰all/std/cmdå‡ ä¸ªï¼Œallè¡¨ç¤ºåˆ—å‡ºGOPATHä¸­æ‰€æœ‰åŒ…ï¼Œstdåˆ—å‡ºæ ‡å‡†åº“çš„åŒ…ï¼Œcmdä¼šåˆ—å‡ºgoä»“åº“ä¸­çš„å‘½ä»¤åŠå†…éƒ¨åº“ï¼›å¯¹äºŽæ¨¡å—è¿˜å¯ä»¥ä½¿ç”¨æ¨¡å—æŸ¥è¯¢ï¼Œä¾‹å¦‚å¯ä»¥é€šè¿‡path@versionå¸¦ä¸Šç‰ˆæœ¬ï¼›æ›´å¤šå†…å®¹å¯å‚è€ƒgo help packageså’Œgo help modules -f formatï¼šå¯ä»¥ä½¿ç”¨goæ¨¡æ¿å®šåˆ¶è¾“å‡ºå†…å®¹ æ¨¡å—æœ‰å¦‚ä¸‹å­—æ®µ 1234567891011121314151617type Module struct &#123; Path string // module path Version string // module version Versions []string // available module versions (with -versions) Replace *Module // replaced by this module Time *time.Time // time version was created Update *Module // available update, if any (with -u) Main bool // is this the main module? Indirect bool // is this module only an indirect dependency of main module? Dir string // directory holding files for this module, if any GoMod string // path to go.mod file for this module, if any Error *ModuleError // error loading module&#125;type ModuleError struct &#123; Err string // the error itself&#125; åŒ…æœ‰å¦‚ä¸‹å­—æ®µ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758type Package struct &#123; Dir string // directory containing package sources ImportPath string // import path of package in dir ImportComment string // path in import comment on package statement Name string // package name Doc string // package documentation string Target string // install path Shlib string // the shared library that contains this package (only set when -linkshared) Goroot bool // is this package in the Go root? Standard bool // is this package part of the standard Go library? Stale bool // would 'go install' do anything for this package? StaleReason string // explanation for Stale==true Root string // Go root or Go path dir containing this package ConflictDir string // this directory shadows Dir in $GOPATH BinaryOnly bool // binary-only package: cannot be recompiled from sources ForTest string // package is only for use in named test Export string // file containing export data (when using -export) Module *Module // info about package's containing module, if any (can be nil) Match []string // command-line patterns matching this package DepOnly bool // package is only a dependency, not explicitly listed // Source files GoFiles []string // .go source files (excluding CgoFiles, TestGoFiles, XTestGoFiles) CgoFiles []string // .go source files that import "C" CompiledGoFiles []string // .go files presented to compiler (when using -compiled) IgnoredGoFiles []string // .go source files ignored due to build constraints CFiles []string // .c source files CXXFiles []string // .cc, .cxx and .cpp source files MFiles []string // .m source files HFiles []string // .h, .hh, .hpp and .hxx source files FFiles []string // .f, .F, .for and .f90 Fortran source files SFiles []string // .s source files SwigFiles []string // .swig files SwigCXXFiles []string // .swigcxx files SysoFiles []string // .syso object files to add to archive TestGoFiles []string // _test.go files in package XTestGoFiles []string // _test.go files outside package // Cgo directives CgoCFLAGS []string // cgo: flags for C compiler CgoCPPFLAGS []string // cgo: flags for C preprocessor CgoCXXFLAGS []string // cgo: flags for C++ compiler CgoFFLAGS []string // cgo: flags for Fortran compiler CgoLDFLAGS []string // cgo: flags for linker CgoPkgConfig []string // cgo: pkg-config names // Dependency information Imports []string // import paths used by this package ImportMap map[string]string // map from source import to ImportPath (identity entries omitted) Deps []string // all (recursively) imported dependencies TestImports []string // imports from TestGoFiles XTestImports []string // imports from XTestGoFiles // Error information Incomplete bool // this package or a dependency has an error Error *PackageError // error loading package DepsErrors []*PackageError // errors loading dependencies &#125; ä¸‹é¢é€šè¿‡ä¸€äº›ä¾‹å­æ¥è¯´æ˜Žå…¶ä½¿ç”¨ï¼Œå‡è®¾å½“å‰ç›®å½•ä¸ºtouræºç æ ¹ç›®å½•ï¼š åˆ—å‡ºä¸»æ¨¡å—ç›®å½• 1go lis -m -f &#123;&#123;.Dir&#125;&#125; åˆ—å‡ºä¸»æ¨¡å—å’Œæ‰€æœ‰ä¾èµ–æ¨¡å—ç›®å½• 12go list -m -f &#123;&#123;.Dir&#125;&#125; allgo list -m -f &#123;&#123;.Dir&#125;&#125; ... ä¸Šè¿°ä¸¤ç§æ•ˆæžœæ˜¯ä¸€æ ·çš„ã€‚ åˆ—å‡ºç¬¦åŒ¹é…æ¡ä»¶çš„æ¨¡å—ç›®å½• 1go list -m -f &#123;&#123;.Dir&#125;&#125; golang.org/x/... åˆ—å‡ºä¸»åŒ…ç›®å½• 1go list -f &#123;&#123;.Dir&#125;&#125; åˆ—å‡ºä¸»åŒ…å’Œæ‰€æœ‰ä¾èµ–åŒ…ç›®å½• 1go list -f &#123;&#123;.Dir&#125;&#125; ... åˆ—å‡ºGOPATHæ‰€æœ‰åŒ…ç›®å½• 1go list -f &#123;&#123;.Dir&#125;&#125; all åˆ—å‡ºç¬¦åŒ¹é…æ¡ä»¶çš„åŒ…ç›®å½• 1go list -f &#123;&#123;.Dir&#125;&#125; golang.org/x/... golang.org/x/tools/go/packages å¯¹äºŽæœ¬æ–‡ä¸€å¼€å§‹æåˆ°çš„tourçš„é—®é¢˜ï¼Œå¯ä»¥ä¿®æ”¹findRootæ–¹æ³•ï¼Œç”¨packages.Loadæœ€åŽå†å°è¯•ä¸€æ¬¡å®šä½golang.org/x/tourçš„æºç ä½ç½®ã€‚ 123456789101112131415func findRoot() (string, error) &#123; cfg := &amp;packages.Config&#123;Mode: packages.LoadFiles&#125; pkgs, _ := packages.Load(cfg, basePkg) for _, pkg := range pkgs &#123; for _, goFile := range pkg.GoFiles &#123; root := filepath.Dir(goFile) if isRoot(root) &#123; return root, nil &#125; &#125; &#125; return "", fmt.Errorf("could not find go-tour content; check $GOROOT and $GOPATH")&#125; packages.Loadæœ€åŽé€šè¿‡è°ƒç”¨go listèŽ·å¾—åŒ…ä¿¡æ¯ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 1go list -e -json -compiled -test=false -export=false -deps=false -find=true -- golang.org/x/tour å› ä¸ºpackages.Configä¸­æˆ‘ä»¬æ²¡æœ‰æŒ‡å®šDirï¼ˆè¿™ä¸ªDirä¼šä½œä¸ºä¸Šè¿°å‘½ä»¤æ‰§è¡Œçš„ç›®å½•ï¼‰ï¼Œæ‰€ä»¥ä¸Šè¿°å‘½ä»¤ä½¿ç”¨è¿è¡Œtourçš„å½“å‰ç›®å½•ï¼Œä¹Ÿå°±æ˜¯WORKSPACE/binä½œä¸ºå½“å‰ç›®å½•ï¼Œè¿™æ—¶å½“å‰ç›®å½•æ˜¯æ‰¾ä¸åˆ°åŒ…çš„ï¼Œä½†æ˜¯å› ä¸ºå¼€å¯äº†GO111MODULE=onï¼Œæ‰€ä»¥ä¸Šè¿°å‘½ä»¤ä¼šå°è¯•ä»ŽGOPROXYä¸‹è½½golang.org/x/touræ¨¡å—ï¼Œå¦‚æžœæ­¤æ—¶æ— æ³•è”ç½‘ï¼Œæœ€ç»ˆä¹Ÿæ‰¾ä¸åˆ°åŒ…ã€‚ packages.Loadè¿”å›žçš„åŒ…ä¿¡æ¯å¯ä½¿ç”¨å­—æ®µå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667// A Package describes a loaded Go package.type Package struct &#123; // ID is a unique identifier for a package, // in a syntax provided by the underlying build system. // // Because the syntax varies based on the build system, // clients should treat IDs as opaque and not attempt to // interpret them. ID string // Name is the package name as it appears in the package source code. Name string // PkgPath is the package path as used by the go/types package. PkgPath string // Errors contains any errors encountered querying the metadata // of the package, or while parsing or type-checking its files. Errors []Error // GoFiles lists the absolute file paths of the package's Go source files. GoFiles []string // CompiledGoFiles lists the absolute file paths of the package's source // files that were presented to the compiler. // This may differ from GoFiles if files are processed before compilation. CompiledGoFiles []string // OtherFiles lists the absolute file paths of the package's non-Go source files, // including assembly, C, C++, Fortran, Objective-C, SWIG, and so on. OtherFiles []string // ExportFile is the absolute path to a file containing type // information for the package as provided by the build system. ExportFile string // Imports maps import paths appearing in the package's Go source files // to corresponding loaded Packages. Imports map[string]*Package // Types provides type information for the package. // Modes LoadTypes and above set this field for packages matching the // patterns; type information for dependencies may be missing or incomplete. // Mode LoadAllSyntax sets this field for all packages, including dependencies. Types *types.Package // Fset provides position information for Types, TypesInfo, and Syntax. // It is set only when Types is set. Fset *token.FileSet // IllTyped indicates whether the package or any dependency contains errors. // It is set only when Types is set. IllTyped bool // Syntax is the package's syntax trees, for the files listed in CompiledGoFiles. // // Mode LoadSyntax sets this field for packages matching the patterns. // Mode LoadAllSyntax sets this field for all packages, including dependencies. Syntax []*ast.File // TypesInfo provides type information about the package's syntax trees. // It is set only when Syntax is set. TypesInfo *types.Info // TypesSizes provides the effective size function for types in TypesInfo. TypesSizes types.Sizes&#125; å…¶ä¸­å¹¶æ²¡æœ‰åŒ…çš„Dirï¼Œæ‰€ä»¥åªæœ‰ä»ŽGoFilesä¸­èŽ·å–Dirï¼Œå¦‚æžœGoFilesä¸ºç©ºï¼Œè¿™æ—¶å°±æ— æ³•èŽ·å–åˆ°åŒ…çš„Dirï¼Œè¿™ä¼¼ä¹Žæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå»ºè®®golang.org/x/tools/go/packagesèƒ½å¤Ÿä»Žgo listè¿”å›žè¿™ä¸ªå­—æ®µã€‚ go/build go/buildä¹Ÿæ˜¯touræ‰€é‡‡ç”¨çš„æ–¹æ³•ï¼Œå’Œä¸Šè¿°æ–¹æ³•çš„ä¸åŒä¹‹å¤„åœ¨äºŽï¼Œè¿™ä¸ªåŒ…ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªåŒ…ï¼Œä¼ å…¥çš„pathä¸èƒ½æœ‰é€šé…ç¬¦ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªæ˜Žç¡®çš„pathï¼Œè€Œä¸Šè¿°ä¸¤ç§æ–¹æ³•æ˜¯å¯ä»¥æ‰¹é‡çš„ã€‚ä¹Ÿå› æ­¤go/buildæ¯”è¾ƒæ³¨é‡æ•ˆçŽ‡ï¼Œåœ¨case 26504ä¸­å·²ç»åšäº†é˜è¿°ã€‚è¿™ä¸ªåŒ…çš„ä½¿ç”¨åœ¨ä¼ å…¥srcDirå‚æ•°æ˜¯ä¹Ÿæœ‰ä¸€äº›è®²ç©¶ï¼Œä¸Šæ–‡å·²ç»è¯¦ç»†æŽ¢è®¨ã€‚ æ€»ç»“ ç›®å‰å¹¶æ²¡æœ‰å®Œç¾Žçš„æ–¹æ³•ä»ŽåŒ…çš„importpathå®šä½åˆ°æºç ç›®å½•ï¼Œè™½ç„¶golang.org/x/tools/go/packagesæˆ–go listå¯ä»¥å…¨é¢çš„æ”¯æŒåŒ…æˆ–æ¨¡å—çš„æ£€ç´¢ï¼Œä½†æ˜¯åœ¨ä¸çŸ¥é“æºç ä½ç½®çš„æ—¶å€™ï¼Œå¿…é¡»å¯ç”¨GO111MODULE=onå¹¶è”ç½‘ï¼Œè€Œä¸”è¿™æ—¶èŽ·å–åˆ°çš„ç‰ˆæœ¬å¹¶ä¸ä¸€å®šæ˜¯éœ€è¦çš„ç‰ˆæœ¬ï¼Œè€Œgo/buildåœ¨GO111MODULE=onæ—¶å¯¹æ¨¡å—ä¸­çš„åŒ…æ˜¯æ— æ³•èŽ·å–æºç ä½ç½®çš„ã€‚ ç»¼ä¸Šå¯¹äºŽæ¨¡å—ä¸­çš„åŒ…ç›®å‰æš‚ä¸”å¯ç”¨çš„æ–¹æ¡ˆä¹Ÿåªæœ‰golang.org/x/tools/go/packagesæˆ–go listã€‚å¯¹äºŽéžæ¨¡å—ä¸­çš„åŒ…æœ€å¥½ç”¨go/buildã€‚ æ¨¡å—ä¸­çš„åŒ…ï¼Œå­˜åœ¨ç‰ˆæœ¬å·çš„é—®é¢˜ï¼Œæ— æ³•åƒéžæ¨¡å—åŒ…é‚£æ ·ç›´æŽ¥ä»ŽGOROOTå’ŒGOPATHä¸­å®šä½å³å¯ï¼Œä½ æ— æ³•ç”¨ç›¸åŒçš„æ–¹æ³•åœ¨GOPATH/pkg/modä¸­å®šä½ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„åŒ…ï¼Œè¿™æ˜¯éš¾ä»¥ä»…æ ¹æ®åŒ…çš„importpathå®šä½æºç ä½ç½®çš„é—®é¢˜æ ¹æºã€‚]]></content>
      <categories>
        <category>golang</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>go module</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨vagrantæ­å»ºåˆ†å¸ƒå¼å¼€å‘çŽ¯å¢ƒ]]></title>
    <url>%2F2019%2F09%2F21%2F014-setup-dev-env-with-vagrant%2F</url>
    <content type="text"><![CDATA[åŸºæœ¬éœ€æ±‚ VMèƒ½å¤Ÿä¸Šç½‘ï¼šç”¨äºŽVMå®‰è£…è½¯ä»¶ Hostèƒ½å¤Ÿè®¿é—®VMï¼Œä¸”VMæœ‰å›ºå®šIPï¼šç”¨äºŽHostè¿œç¨‹è°ƒè¯•VM VMä¹‹é—´èƒ½å¤Ÿäº’ç›¸è®¿é—®ï¼šç”¨äºŽæž„æˆåˆ†å¸ƒå¼çŽ¯å¢ƒ VMé—´æ–‡ä»¶å…±äº« VirtualBoxçš„ç½‘ç»œæ¨¡å¼ VirtualBoxæ”¯æŒå››ç§ç½‘ç»œæ¨¡å¼ï¼Œå¸¸ç”¨çš„æ˜¯NATå’ŒHost-onlyä¸¤ç§ï¼Œä¸‹å›¾å¯¹å››ç§ç½‘ç»œæ¨¡å¼è¿›è¡Œäº†å¯¹æ¯”ï¼š NAT Bridged Internal Host-only(é»˜è®¤) Host-only(å…±äº«) Host-only(æ¡¥æŽ¥) VM-&gt;Host y y n y(åˆ°Host-only Adapter) y(è™šæ‹Ÿæœºé…ç½®Host-only Adapterä¸ºç½‘å…³) y(æ— çº¿ç½‘å¡ä¸è¡Œ) Host-&gt;VM n y n y(ä»ŽHost-only Adapter) y(ä»ŽHost-only Adapter) y VM-&gt;Other Host y y n n y y Other Host-&gt;VM n y n n n y VM&lt;-&gt;VM n y åŒç½‘ç»œåä¸‹å¯ä»¥ y y y NAT NATç›¸å…³æœ‰NATå’ŒNAT ç½‘ç»œä¸¤ä¸ªé€‰é¡¹ï¼Œå…¶åŒºåˆ«æ˜¯å‰è€…ä½¿ç”¨å†…ç½®çš„NATç½‘ç»œï¼Œç½‘æ®µä¸º10.0.2.0/24ï¼Œç”¨æˆ·æ— æ³•ä¿®æ”¹ï¼›åŽè€…å¯ä»¥ç”¨æˆ·å®šåˆ¶ï¼Œé€šè¿‡å…¨å±€è®¾å®šä¸­è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹å›¾ã€‚ Host-only Host-onlyæ¯”è¾ƒå¤æ‚ï¼Œé€šè¿‡é…ç½®å¯ä»¥å®žçŽ°å„ç§ä¸åŒæ•ˆæžœï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š é»˜è®¤ å…±äº« è¿™ç§æƒ…å†µåœ¨é»˜è®¤çš„åŸºç¡€ä¸Šï¼Œä¸ºVMå¢žåŠ äº†è¿žé€šå¤–ç½‘æ•ˆæžœã€‚ æ¡¥æŽ¥ è¿™ç§æƒ…å†µå’ŒVirtualBoxçš„æ¡¥æŽ¥ç½‘ç»œæ¨¡å¼å®žçŽ°äº†ä¸€æ ·çš„æ•ˆæžœã€‚è¿™æ—¶HOSTçš„ç½‘å¡ä¸èƒ½ä¸ºæ— çº¿ç½‘å¡ï¼Œåœ¨å¯ç”¨802.1xè®¤è¯çš„ç½‘ç»œä¹Ÿä¸è¡Œã€‚ Vagrantçš„ç½‘ç»œæ¨¡å¼ Vagrantæœ‰ä¸‰ç§ç½‘ç»œæ¨¡å¼ï¼Œå¹¶ä¸ä¼šè¦†ç›–å…·ä½“è™šæ‹Ÿæœºproviderçš„æ‰€æœ‰ç½‘ç»œæ¨¡å¼ã€‚ ç½‘ç»œæ¨¡å¼ ç¤ºä¾‹ å¯¹åº”VirtualBoxç½‘ç»œæ¨¡å¼ Forwarded port config.vm.network â€œforwarded_portâ€, guest: 80, host: 8080, protocol: â€œudpâ€ NAT Private network config.vm.network â€œprivate_networkâ€, ip: â€œ192.168.50.4â€ Host-only Public network config.vm.network â€œpublic_networkâ€, :bridge =&gt; â€˜en1: Wi-Fi (AirPort)â€™ Bridged å¦‚æžœåªé…ç½®ä¸€ä¸ªPrivate networkï¼Œåˆ™vagrantä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªNATå’Œä¸€ä¸ªHost-onlyç½‘ç»œã€‚ å¦‚æžœé…ç½®å¤šä½™ä¸€ä¸ªPrivate networkï¼Œåˆ™vagrantå°±ä¸ä¼šè‡ªåŠ¨åˆ›å»ºNATï¼Œè€Œæ˜¯å¯¹åº”çš„å¤šä¸ªHost-onlyç½‘ç»œã€‚ è™šæ‹Ÿæœºé—´æ–‡ä»¶å…±äº« æœ€ç®€å•çš„æ–¹å¼æ˜¯å°†Hostçš„æŸä¸ªæ–‡ä»¶å¤¹æ˜ å°„åˆ°æ‰€æœ‰è™šæ‹Ÿæœºä¸­ï¼Œé€šè¿‡Vagrantå¾ˆå®¹æ˜“åšåˆ°è¿™ç‚¹ï¼š 12config.vm.synced_folder &quot;./share&quot;, &quot;/share&quot;, create:true, mount_options:[&quot;dmode=775&quot;,&quot;fmode=664&quot;]config.vm.synced_folder &quot;.&quot;,&quot;/vagrant&quot;,disabled:true é»˜è®¤æƒ…å†µä¸‹ï¼Œvagrantæ€»æ˜¯å°†Vagrantfileæ‰€åœ¨ç›®å½•æ–‡ä»¶é€šè¿‡rsyncåŒæ­¥åˆ°è™šæ‹Ÿæœºçš„/vagrantç›®å½•ï¼Œè¿™ä¸ªåŒæ­¥æ˜¯å•å‘çš„ï¼Œä¸Šè¿°é…ç½®ç¦ç”¨äº†è¿™ä¸€ç‚¹ã€‚ç„¶åŽé…ç½®äº†Vagrantfileæ‰€åœ¨ç›®å½•ä¸‹çš„shareç›®å½•æ˜ å°„åˆ°è™šæ‹Ÿæœºçš„/shareç›®å½•ï¼Œè¿™æ˜¯mountè¿›åŽ»çš„ï¼Œå› æ­¤æ˜¯åŒå‘çš„ã€‚ è¦æ˜ å°„æ–‡ä»¶å¤¹ï¼Œè¿˜éœ€è¦åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…VirtualBox Guest Additionsï¼Œä»¥centos7ä¸ºä¾‹ï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š å®‰è£…å†…æ ¸å¼€å‘æ–‡ä»¶ï¼š 1sudo yum install &quot;kernel-devel-uname-r == $(uname -r)&quot; å¦‚æžœæ‰¾ä¸åˆ°å¯¹åº”å†…æ ¸å¼€å‘æ–‡ä»¶ï¼Œåˆ™æ›´æ–°å†…æ ¸ï¼š 12sudo yum update kernel -yinit 6 å®‰è£…ç¼–è¯‘å·¥å…·ï¼š 1sudo yum install kernel-devel gcc make -y ä¸‹è½½VirtualBox Guest Additionsï¼š 1curl -L -O http://download.virtualbox.org/virtualbox/6.0.10/VBoxGuestAdditions_6.0.10.iso å®‰è£…VirtualBox Guest Additionsï¼š 1234sudo mkdir -p /mnt/isosudo mount -o loop VBoxGuestAdditions_6.0.10.iso /mnt/isocd /mnt/isosudo ./VBoxGuestAdditions.run å¼€å‘çŽ¯å¢ƒæ­å»º ä¸ºäº†å®žçŽ°æœ€å¼€å§‹çš„åŸºæœ¬éœ€æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦é€‰æ‹©private_networkå³å¯ï¼Œè¿™æ—¶vagrantä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªNATç½‘ç»œå’Œä¸€ä¸ªHost-onlyç½‘ç»œï¼Œå‰è€…å¯ç”¨äºŽä¸Šç½‘ï¼ŒåŽè€…ç”¨äºŽè™šæ‹Ÿæœºä¹‹é—´ä»¥åŠè™šæ‹Ÿæœºå’ŒHostçš„äº’è¿žï¼Œå…·ä½“Vagrantfileæ–‡ä»¶å¦‚ä¸‹ï¼š 12345678910111213141516171819202122# -*- mode: ruby -*-# vi: set ft=ruby :Vagrant.configure(&quot;2&quot;) do |config| config.vm.synced_folder &quot;./share&quot;, &quot;/share&quot;, create:true, mount_options:[&quot;dmode=775&quot;,&quot;fmode=664&quot;] config.vm.synced_folder &quot;.&quot;,&quot;/vagrant&quot;,disabled:true config.vm.define &quot;master&quot; do |master| master.vm.box = &quot;centos/7&quot; master.vm.network &quot;private_network&quot;, ip: &quot;10.10.10.14&quot;, netmask: &quot;255.255.0.0&quot; end config.vm.define &quot;node1&quot; do |node1| node1.vm.box = &quot;centos/7&quot; node1.vm.network &quot;private_network&quot;, ip: &quot;10.10.10.15&quot;, netmask: &quot;255.255.0.0&quot; end config.vm.define &quot;node2&quot; do |node2| node2.vm.box = &quot;centos/7&quot; node2.vm.network &quot;private_network&quot;, ip: &quot;10.10.10.16&quot;, netmask: &quot;255.255.0.0&quot; end end è™šæ‹Ÿæœºé€‰ç”¨çš„centos7 ä½¿ç”¨äº†multi-machineç‰¹æ€§ï¼Œåœ¨ä¸€ä¸ªVagrantfileä¸­å®šä¹‰å¤šä¸ªè™šæ‹Ÿæœºï¼Œå¦‚ä¸Šå®šä¹‰äº†3ä¸ªè™šæ‹Ÿæœº åœ¨VirtualBoxä¸­åˆ›å»ºHost-only Adapterï¼Œå…¶ç½‘æ®µä¸º10.10.0.0/16ï¼Œè¿™æ ·ä»¥ä¸Šè™šæ‹Ÿæœºä¼šè‡ªåŠ¨é€‰æ‹©è¿™ä¸ªHost-only Adapter å¦‚æžœè™šæ‹Ÿæœºçš„ip+netmaskå’ŒHost-only Adapterä¸æ˜¯ä¸€ä¸ªç½‘æ®µï¼Œåˆ™vagrantä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªHost-only Adapterï¼Œè¦é¿å…è¿™ç§æƒ…å†µï¼Œä»¥ä¾¿æ‰€æœ‰è™šæ‹Ÿæœºä½¿ç”¨çš„ä¸€ä¸ªHost-only Adapter ä½¿ç”¨æ–¹æ³•ï¼š å¯åŠ¨æ‰€æœ‰è™šæ‹Ÿæœº 1vagrant up å…³é—­æ‰€æœ‰è™šæ‹Ÿæœº 1vagrant halt å¯åŠ¨æŸä¸ªè™šæ‹Ÿæœº 1vagrant up master å…³é—­æŸä¸ªè™šæ‹Ÿæœº 1vagrant halt master ç™»é™†æŸä¸ªè™šæ‹Ÿæœº 1vagrant ssh master]]></content>
      <categories>
        <category>devtool</category>
      </categories>
      <tags>
        <tag>vagrant</tag>
        <tag>virtualbox</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[VirtualBoxä½¿ç”¨Host-OnlyæŠ¥"Failed to attach the network LNU"é”™è¯¯]]></title>
    <url>%2F2019%2F09%2F18%2F013-virtualbox-host-only-problem%2F</url>
    <content type="text"><![CDATA[Windows 10ï¼ŒVirtualBox 6.0.10ï¼ŒåŽŸæœ¬ä½¿ç”¨æ­£å¸¸ã€‚ å®‰è£…Wiresharkï¼ˆåŒ…æ‹¬Npcapï¼‰åŽï¼Œä½¿ç”¨Host-Onlyæ—¶æŠ¥&quot;Failed to attach the network LNU&quot;é”™è¯¯ã€‚ åŽŸå›  NDIS6 driveré—®é¢˜å¯¼è‡´ã€‚ å¯èƒ½æ˜¯å®‰è£…äº†NpcapåŽå¯¼è‡´ã€‚ è§£å†³æ–¹æ³• æ–¹æ³•ä¸€ï¼šå®‰è£…virtualboxæ—¶å¢žåŠ å‚æ•°ï¼š-msiparams NETWORKTYPE=NDIS5 æ–¹æ³•äºŒï¼šç¡®ä¿Host-Onlyç½‘å¡å®‰è£…äº†â€VirtualBox NDIS6 Bridged Networking Driver&quot;ï¼Œç„¶åŽå°†ç½‘å¡ç¦ç”¨å†å¯ç”¨ä¸€ä¸‹]]></content>
      <categories>
        <category>devtool</category>
      </categories>
      <tags>
        <tag>vagrant</tag>
        <tag>virtualbox</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windowsä¸‹ä½¿ç”¨OpenSSHæ­å»ºsshæœåŠ¡ç«¯]]></title>
    <url>%2F2019%2F08%2F09%2F012-using-openssh-to-build-ssh-server-upder-windows%2F</url>
    <content type="text"><![CDATA[äº§å“ä¸­éœ€è¦ç”¨åˆ°sftpï¼Œsftpå®žé™…ä¸Šå°±æ˜¯sshçš„ä¸€éƒ¨åˆ†ï¼Œsshåœ¨Linuxç³»ç»Ÿä¸­æ˜¯è‡ªå¸¦çš„ï¼Œè¿è¡Œsshdä¹‹åŽå°±åŒæ—¶ä¹Ÿæ”¯æŒsftpäº†ï¼Œä¹Ÿæ˜¯é€šè¿‡22ç«¯å£è¿žæŽ¥ã€‚ä½†æˆ‘ä»¬çš„äº§å“éœ€è¦æ”¯æŒè·¨å¹³å°ï¼Œéœ€è¦åŒæ—¶æ”¯æŒLinuxå’ŒWindowsï¼Œå› æ­¤éœ€è¦å¯»æ‰¾ä¸€ä¸ªè·¨å¹³å°çš„sshå®žçŽ°ï¼Œé€šè¿‡å¯»æ‰¾å‘çŽ°å®žé™…ä¸Šåœ¨Win10 1809å’ŒWindows Server 2019å¼€å§‹å·²ç»å†…ç½®äº†ï¼Œä½¿ç”¨çš„æ­£æ˜¯OpenSSHã€‚ OpenSSH OpenSSHæ˜¯sshåè®®çš„å¼€æºå®žçŽ°ï¼Œæ˜¯OpenBSDçš„å­é¡¹ç›®ã€‚ OpenSSHå¥—ä»¶åŒ…å«ä»¥ä¸‹å·¥å…·ï¼š è¿œç¨‹æ“ä½œä½¿ç”¨sshã€scpå’Œsftpå®Œæˆã€‚ ä½¿ç”¨ssh-addã€ssh-keysignã€ssh-keyscanå’Œssh-keygenè¿›è¡Œå¯†é’¥ç®¡ç†ã€‚ æœåŠ¡ç«¯ç”±sshdã€sftpæœåŠ¡å™¨å’Œsshä»£ç†ç»„æˆã€‚ æºç ï¼šhttps://github.com/openssh/openssh-portable Windowså®‰è£… Windowså®˜æ–¹å°†OpenSSHç§»æ¤åˆ°Windowsä¸‹ï¼Œæºç ï¼šhttps://github.com/PowerShell/openssh-portableï¼Œå¯ä»¥ä»Žä¸Šè¿°æºç æž„å»ºå®‰è£…ï¼Œå¦‚æžœä½ ä½¿ç”¨çš„Win10 1809æˆ–Windows Server 2019ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Windowså¯é€‰ç¨‹åºå®‰è£…ï¼Œä»¥Window 10 1903ä¸ºä¾‹ï¼š åœ¨â€œåº”ç”¨å’ŒåŠŸèƒ½â€ä¸­ç‚¹å‡»&quot;å¯é€‰åŠŸèƒ½&quot; ç‚¹å‡»&quot;æ·»åŠ åŠŸèƒ½&quot; ç‚¹å‡»â€OpenSSH æœåŠ¡å™¨â€œï¼Œç„¶åŽç‚¹å‡»â€œå®‰è£…â€ï¼Œç¨ç­‰ç‰‡åˆ»åŽå°±å®‰è£…æˆåŠŸäº† å®‰è£…åŽç¨‹åºä½äºŽï¼šC:\Windows\System32\OpenSSH Win10 1903ä½¿ç”¨çš„7.7.2.1ç‰ˆæœ¬ã€‚ å¯åŠ¨æœåŠ¡ï¼Œå‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ 1net start sshd OpenSSHé…ç½® é…ç½®æ–‡ä»¶ %PROGRAMDATA%\ssh\sshd_config é»˜è®¤æ˜¯å¯†ç è®¤è¯å’Œå…¬é’¥è®¤è¯éƒ½å¼€å¯çš„ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ä¸Šè¿°æ–‡ä»¶è¿›è¡ŒæŽ§åˆ¶ï¼š 12PubkeyAuthentication yesPasswordAuthentication no å¯†ç ç™»å½• ä½¿ç”¨Windowsè´¦æˆ·å¯†ç ç™»é™†ã€‚ 1ssh user@host å…¬é’¥ç™»é™† å®¢æˆ·ç«¯ åˆ›å»ºå¯†é’¥å’Œå…¬é’¥ 1ssh-keygen -t rsa -f myssh è¿è¡Œä¸Šè¿°å‘½ä»¤åŽåœ¨%USERPROFILE%\.sshä¸‹ç”Ÿæˆmysshå’Œmyssh.pubæ–‡ä»¶ï¼Œå‰è€…æ˜¯å¯†é’¥ï¼ŒåŽè€…ä¸ºå…¬é’¥ã€‚ å‘sshä»£ç†æ³¨å†Œç§é’¥ 12net start ssh-agentssh-add myssh æœåŠ¡ç«¯ åˆ›å»º%USERPROFILE%\.ssh\authorized_keysæ–‡ä»¶ï¼Œå°†ä¸Šè¿°å®¢æˆ·æœºmyssh.pubçš„å†…å®¹æ‹·è´åˆ°å…¶ä¸­ï¼Œæ£€æŸ¥authorized_keysæ–‡ä»¶æƒä¿®æ”¹ï¼Œç¡®ä¿åªæœ‰System, Administrators and ownerå¯ä»¥è®¿é—® 1icacls %USERPROFILE%\.ssh\authorized_keys å¦‚æžœç™»é™†ç”¨æˆ·å±žäºŽadministratorsç»„ï¼Œè¿˜éœ€è¦åˆ›å»º%PROGRAMDATA%\ssh\administrators_authorized_keysæ–‡ä»¶ï¼ŒåŒæ ·æ‹·è´å®¢æˆ·æœºmyssh.pubçš„å†…å®¹æ‹·è´åˆ°å…¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶åªèƒ½SYSTEMå’ŒAdministratorsç»„è®¿é—®ï¼Œå¯ä»¥æ‰§è¡Œï¼š 123icacls administrators_authorized_keys /inheritance:ricacls administrators_authorized_keys /grant SYSTEM:`(F`)icacls administrators_authorized_keys /grant BUILTIN\Administrators:`(F`) é‡å¯sshdæœåŠ¡ 12net stop sshdnet start sshd å®¢æˆ·ç«¯ç™»é™† 1ssh -i %USERPROFILE%\.ssh\myssh user@host ä½¿ç”¨puttyè®¿é—® puttyæ˜¯å¸¸ç”¨çš„sshå®¢æˆ·ç«¯å·¥å…·ï¼ŒåŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œä½¿ç”¨å¯†é’¥ç™»é™†éœ€è¦ç”Ÿæˆputtyçš„å¯†é’¥æ ¼å¼ã€‚ è¿è¡Œputtygen.exeï¼Œç‚¹å‡»Loadï¼Œè½½å…¥ä¸Šè¿°å®¢æˆ·æœºå¯†é’¥æ–‡ä»¶%USERPROFILE%\.ssh\mysshï¼Œç„¶åŽç‚¹å‡»Save private keyï¼Œå‡è®¾ä¿å­˜ä¸ºC:\myssh.ppkã€‚ ç„¶åŽåœ¨puttyä¸­å°±å¯ä»¥ç”¨ä¸Šè¿°ppkæ–‡ä»¶è¿›è¡Œç™»é™†è®¤è¯ã€‚]]></content>
      <categories>
        <category>devtool</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>OpenSSH</tag>
        <tag>putty</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è§£å†³k8sé›†ç¾¤å¤–æ— æ³•è®¿é—®NodePorté—®é¢˜]]></title>
    <url>%2F2019%2F08%2F06%2F011-nodeport-cannot-be-accessed-outside-the-k8s-cluster%2F</url>
    <content type="text"><![CDATA[centos7.6ä»ŽyumæºäºŒè¿›åˆ¶å®‰è£…äº†k8sé›†ç¾¤ï¼Œå»ºç«‹NodePortç±»åž‹serviceåŽæ— æ³•ä»Žé›†ç¾¤å¤–è®¿é—®serviceï¼Œæœ¬æ–‡è®°å½•äº†é—®é¢˜è§£å†³è¿‡ç¨‹ã€‚ çŽ¯å¢ƒ centos7.6 k8s v1.5.2 dashbaord 1.6.0 masterï¼š10.10.10.14 node1ï¼š10.10.10.15 node2ï¼š10.10.10.16 é›†ç¾¤å¤–æœºå™¨ï¼š10.10.10.1 é—®é¢˜åˆ†æž [vagrant@localhost ~]$ kubectl get pod -n kube-system -o wide NAME READY STATUS RESTARTS AGE IP NODE kubernetes-dashboard-1801235744-v6r9t 1/1 Running 2 3d 172.16.91.2 node2 [vagrant@localhost ~]$ kubectl get svc -n kube-system NAME CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes-dashboard 10.254.106.243 80:30389/TCP 3d æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯é€šè¿‡https://10.10.10.16:30389ä»Žé›†ç¾¤å¤–æœºå™¨(10.10.10.1)æ— æ³•è®¿é—®dashboardï¼Œå…¶ä»–serviceæƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œåœ¨é›†ç¾¤å†…éƒ¨æˆ–è€…é€šè¿‡clusteripæ˜¯å¯ä»¥è®¿é—®çš„ï¼ŒæŽ’é™¤é›†ç¾¤æœ¬ç”Ÿé—®é¢˜ã€‚k8sçš„serviceæ˜¯é€šè¿‡iptableså®žçŽ°çš„ï¼Œåˆæ­¥æ€€ç–‘å’Œiptablesæœ‰å…³ã€‚ é—®é¢˜å®šä½ è¿™é‡Œé€šè¿‡å¢žåŠ traceæ—¥å¿—çš„æ–¹æ³•æ¥è·Ÿè¸ªæ•°æ®åŒ…åœ¨iptablesä¸­å“ªä¸€æ­¥å¤„ç†å‡ºçŽ°é—®é¢˜çš„ã€‚åœ¨node2ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¯¹tcpåè®®å¹¶ä¸”ç›®çš„ç«¯å£ä¸º30389çš„æ•°æ®åŒ…ä»ŽPREROUTINGé“¾å¢žåŠ TRACEæ—¥å¿—ï¼Œæ—¥å¿—ä¼šè¾“å‡ºåˆ°/var/log/messagesã€‚ [vagrant@localhost ~]$ sudo iptables -t raw -A PREROUTING -p tcp --dport 30389 -j TRACE è¯¦ç»†åˆ†æžæ—¥å¿—ä¿¡æ¯ï¼Œå‘çŽ°åˆ°FORWARDé“¾çš„filterè¡¨å°±æ²¡æœ‰åŽç»­åŒ…äº†ã€‚ [vagrant@localhost ~]$sudo cat /var/log/messages Sep 10 07:24:50 localhost kernel: TRACE: raw:PREROUTING:policy:2 IN=eth1 OUT= MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=10.10.10.16 LEN=52 TOS=0x00 PREC=0x00 TTL=128 ID=43914 DF PROTO=TCP SPT=58026 DPT=30389 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) Sep 10 07:24:50 localhost kernel: TRACE: nat:PREROUTING:rule:1 IN=eth1 OUT= MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=10.10.10.16 LEN=52 TOS=0x00 PREC=0x00 TTL=128 ID=43914 DF PROTO=TCP SPT=58026 DPT=30389 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) Sep 10 07:24:50 localhost kernel: TRACE: nat:KUBE-SERVICES:rule:4 IN=eth1 OUT= MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=10.10.10.16 LEN=52 TOS=0x00 PREC=0x00 TTL=128 ID=43914 DF PROTO=TCP SPT=58026 DPT=30389 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) Sep 10 07:24:50 localhost kernel: TRACE: nat:KUBE-NODEPORTS:rule:3 IN=eth1 OUT= MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=10.10.10.16 LEN=52 TOS=0x00 PREC=0x00 TTL=128 ID=43914 DF PROTO=TCP SPT=58026 DPT=30389 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) Sep 10 07:24:50 localhost kernel: TRACE: nat:KUBE-MARK-MASQ:rule:1 IN=eth1 OUT= MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=10.10.10.16 LEN=52 TOS=0x00 PREC=0x00 TTL=128 ID=43914 DF PROTO=TCP SPT=58026 DPT=30389 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) Sep 10 07:24:50 localhost kernel: TRACE: nat:KUBE-MARK-MASQ:return:2 IN=eth1 OUT= MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=10.10.10.16 LEN=52 TOS=0x00 PREC=0x00 TTL=128 ID=43914 DF PROTO=TCP SPT=58026 DPT=30389 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) MARK=0x4000 Sep 10 07:24:50 localhost kernel: TRACE: nat:KUBE-NODEPORTS:rule:4 IN=eth1 OUT= MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=10.10.10.16 LEN=52 TOS=0x00 PREC=0x00 TTL=128 ID=43914 DF PROTO=TCP SPT=58026 DPT=30389 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) MARK=0x4000 Sep 10 07:24:50 localhost kernel: TRACE: nat:KUBE-SVC-XGLOHA7QRQ3V22RZ:rule:1 IN=eth1 OUT= MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=10.10.10.16 LEN=52 TOS=0x00 PREC=0x00 TTL=128 ID=43914 DF PROTO=TCP SPT=58026 DPT=30389 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) MARK=0x4000 Sep 10 07:24:50 localhost kernel: TRACE: nat:KUBE-SEP-7MDAIXCESNWFCQ4R:rule:2 IN=eth1 OUT= MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=10.10.10.16 LEN=52 TOS=0x00 PREC=0x00 TTL=128 ID=43914 DF PROTO=TCP SPT=58026 DPT=30389 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) MARK=0x4000 Sep 10 07:24:50 localhost kernel: TRACE: filter:FORWARD:rule:1 IN=eth1 OUT=docker0 MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=172.16.91.2 LEN=52 TOS=0x00 PREC=0x00 TTL=127 ID=43914 DF PROTO=TCP SPT=58026 DPT=9090 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) MARK=0x4000 Sep 10 07:24:50 localhost kernel: TRACE: filter:DOCKER-ISOLATION:return:1 IN=eth1 OUT=docker0 MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=172.16.91.2 LEN=52 TOS=0x00 PREC=0x00 TTL=127 ID=43914 DF PROTO=TCP SPT=58026 DPT=9090 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) MARK=0x4000 Sep 10 07:24:50 localhost kernel: TRACE: filter:FORWARD:rule:2 IN=eth1 OUT=docker0 MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=172.16.91.2 LEN=52 TOS=0x00 PREC=0x00 TTL=127 ID=43914 DF PROTO=TCP SPT=58026 DPT=9090 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) MARK=0x4000 Sep 10 07:24:50 localhost kernel: TRACE: filter:DOCKER:return:1 IN=eth1 OUT=docker0 MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=172.16.91.2 LEN=52 TOS=0x00 PREC=0x00 TTL=127 ID=43914 DF PROTO=TCP SPT=58026 DPT=9090 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) MARK=0x4000 Sep 10 07:24:50 localhost kernel: TRACE: filter:FORWARD:policy:6 IN=eth1 OUT=docker0 MAC=08:00:27:43:31:95:0a:00:27:00:00:0c:08:00 SRC=10.10.10.1 DST=172.16.91.2 LEN=52 TOS=0x00 PREC=0x00 TTL=127 ID=43914 DF PROTO=TCP SPT=58026 DPT=9090 SEQ=73790228 ACK=0 WINDOW=64240 RES=0x00 SYN URGP=0 OPT (020405B40103030801010402) MARK=0x400 æŸ¥çœ‹FORWARDé“¾å‘çŽ°å…¶policyæ˜¯DROPï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™é‡Œã€‚ [vagrant@localhost ~]$ sudo iptables -nL FORWARD Chain FORWARD (policy DROP) target prot opt source destination DOCKER-ISOLATION all â€“ 0.0.0.0/0 0.0.0.0/0 DOCKER all â€“ 0.0.0.0/0 0.0.0.0/0 ACCEPT all â€“ 0.0.0.0/0 0.0.0.0/0 ctstate RELATED,ESTABLISHED ACCEPT all â€“ 0.0.0.0/0 0.0.0.0/0 ACCEPT all â€“ 0.0.0.0/0 0.0.0.0/0 è§£å†³æ–¹æ³• å°†FORWARDé“¾æ”¹ä¸ºACCEPTçš„ã€‚ [vagrant@localhost ~]$ sudo iptables -P FORWARD ACCEPT]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++æ—¥å¿—æ¡†æž¶åŸºå‡†æµ‹è¯•åŠæºç åˆ†æž]]></title>
    <url>%2F2019%2F07%2F04%2F010-cpp-logging-framework-benchmark%2F</url>
    <content type="text"><![CDATA[C++æ—¥å¿—æ¡†æž¶æœ‰éžå¸¸å¤šï¼Œå¦‚ä½•è¿›è¡Œé€‰æ‹©ï¼Œå…¶ä¸­æ€§èƒ½æ˜¯ä¸€ä¸ªéžå¸¸é‡è¦çš„è€ƒé‡å› ç´ ï¼Œæœ¬æ–‡å¯¹å‡ ç§æœ‰ä»£è¡¨æ€§çš„æ—¥å¿—æ¡†æž¶è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œå¹¶æ·±å…¥åˆ°æºç å’Œå®žçŽ°åŽŸç†è¿›è¡Œåˆ†æžå¯¹æ¯”ï¼Œä¾¿äºŽå¤§å®¶è¿›è¡Œé€‰æ‹©ã€‚ æµ‹è¯•å¯¹è±¡ log4cplus 2.0.2 spdlog 1.3.1 boost.log 1.70 log4cpluså±žäºŽä»¿log4jä¸€ç±»ï¼Œä¹Ÿæ˜¯èµ·æ­¥è¾ƒæ—©çš„æ—¥å¿—æ¡†æž¶ï¼Œæ—©åœ¨2010å¹´ï¼Œå‡ºäºŽlog4jçš„åæ°”ï¼Œæˆ‘åœ¨é¡¹ç›®ä¸­å°±é‡‡ç”¨äº†log4cplusï¼›spdlogå±žäºŽæ¯”è¾ƒçŽ°ä»£åŒ–çš„æ—¥å¿—æ¡†æž¶ï¼Œä¸“æ³¨äºŽæ€§èƒ½ï¼›boost.logæ˜¯1.54è¿›å…¥booståº“çš„ï¼Œå½“å¹´é€‰æ‹©log4cplusæ—¶è¿˜åœ¨è¯„å®¡é˜¶æ®µï¼Œboostå¯ä»¥è¯´æ˜¯å‡†C++æ ‡å‡†åº“ï¼Œèƒ½å¤Ÿè¿›å…¥booståº“è‡ªç„¶è´¨é‡ä¸ä½Žï¼Œä½†æ˜¯å…¶è®¾è®¡ç›¸å¯¹ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œboost.logä½¿ç”¨èµ·æ¥ç€å®žä¸å¤ªæ–¹ä¾¿ï¼Œå®ƒä¸å¤ªåƒç›´æŽ¥é¢å‘ç”¨æˆ·ä½¿ç”¨ï¼Œè€Œæ›´åƒæ˜¯ä½œä¸ºåº•å±‚åº“ä¾›ç”¨æˆ·å°è£…ä¸ºæ›´ä¸Šå±‚åº“ã€‚ æ—¥å¿—æ¡†æž¶å¯¹æ¯” ä¸‰ç§æ—¥å¿—åº“åœ¨ä¸€äº›ç‰¹æ€§å’Œå®žçŽ°æ–¹å¼ä¸Šå­˜åœ¨æ¯”è¾ƒå¤§çš„å·®åˆ«ï¼Œä¸ºæ›´å¥½ç†è§£ä»–ä»¬ï¼Œå…ˆåšä¸€ä¸ªç®€å•å¯¹æ¯”ï¼š log4cplus spdlog boost.log çº¿ç¨‹å®‰å…¨ é»˜è®¤çº¿ç¨‹å®‰å…¨ åˆ†mtå’Œst åˆ†mtå’Œst å¼‚æ­¥æ”¯æŒ ä»Ž1.1.0å¼€å§‹å¢žåŠ asyncappenderï¼Œå¯é…ç½®é˜Ÿåˆ—æ·±åº¦ï¼Œçº¿ç¨‹æ•°ä¸å¯é…ï¼Œæ€»ä¸º1ï¼Œæ·±åº¦æ»¡åŽé˜»å¡žè°ƒç”¨ã€‚æ¯ä¸ªæ—¥å¿—å¯¹è±¡æ‰€æœ‰ã€‚log4cpluså¹¶æ²¡æœ‰æä¾›æ˜¾å¼flushçš„æŽ¥å£ï¼Œåªæœ‰shutdownæ—¥å¿—å¯¹è±¡æˆ–close appenderé—´æŽ¥flushã€‚ï¼ˆlog4cplusçš„åŒæ­¥appenderæž„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªimmediateFlushå‚æ•°ï¼Œè¡¨ç¤ºC++æ ‡å‡†è¾“å‡ºæµæˆ–æ–‡ä»¶æµçš„flushï¼‰ å¯è®¾ç½®é˜Ÿåˆ—æ·±åº¦å’Œçº¿ç¨‹æ•°ï¼Œæ·±åº¦æ»¡åŽæœ‰é˜»å¡žå’Œä¸¢å¼ƒè€çš„ä¸¤ç§ç­–ç•¥ï¼›ä½¿ç”¨å…¨å±€æˆ–æ¯ä¸ªæ—¥å¿—ç‹¬æœ‰éƒ½å¯ä»¥ã€‚ é˜Ÿåˆ—æœ‰é™åˆ¶æ·±åº¦/ä¸é™åˆ¶æ·±åº¦ä»¥åŠfifo/orderingç»„åˆèµ·æ¥å››ç§ï¼Œé™åˆ¶æ·±åº¦çš„é˜Ÿåˆ—æ»¡åŽæœ‰é˜»å¡žå’Œä¸¢å¼ƒæ–°çš„ä¸¤ç§ç­–ç•¥ï¼›çº¿ç¨‹æ•°æ€»ä¸º1ä¸ªï¼›sink frontendæ‰€æœ‰ã€‚ æ—¥å¿—å¯¹è±¡å’Œsinkçš„å…³ç³» sinkåœ¨log4cplusä¸­ç§°ä¸ºappenderï¼Œæ¯ä¸ªæ—¥å¿—å¯¹è±¡æ˜¾å¼æŒ‡å®šappenderã€‚ æ¯ä¸ªæ—¥å¿—å¯¹è±¡æ˜¾å¼æŒ‡å®šsinkã€‚ æ— æ³•æ˜¾å¼æŒ‡å®šæ—¥å¿—å¯¹è±¡(boost.logç§°ä¸ºlog source)å¯¹åº”åˆ°å“ªä¸ªsinkï¼Œæ¢è¨€ä¹‹æ¯ä¸ªæ—¥å¿—å¯¹è±¡å¯¹åº”æ‰€æœ‰sinkï¼Œè¦å®žçŽ°æŸä¸ªæ—¥å¿—å¯¹è±¡åªè¾“å‡ºåˆ°æŸä¸ªsinkï¼Œéœ€è¦é€šè¿‡åœ¨sinkä¸Šè®¾ç½®filteræ¥å®žçŽ°ã€‚å…·ä½“å¯å‚è€ƒï¼šuse-channel-hiearchy-of-boost-log-for-severity-and-sink-filteringï¼Œconnecting a logger to a specific sink æ—¥å¿—ç»§æ‰¿ æ”¯æŒï¼Œç±»ä¼¼log4jï¼Œæ—¥å¿—ç»§æ‰¿æœ‰ä¸€ä¸ªä¸å¥½çš„åœ°æ–¹ï¼Œæ—¥å¿—ä¼šè‡ªåŠ¨å†™åˆ°çˆ¶æ—¥å¿—ï¼Œè€Œrootæ—¥å¿—æ˜¯æ‰€æœ‰æ—¥å¿—çš„ç¥–å…ˆï¼Œå¦‚æžœé…ç½®äº†rootæ—¥å¿—ï¼Œæ€»ä¼šå†™åˆ°å…¶ä¸­ï¼Œè¿™æ ·ä¼šå¯¼è‡´å†™å…¥æ•ˆçŽ‡åŠ£åŒ–ä¸¥é‡ ä¸æ”¯æŒ ä¸æ”¯æŒ é…ç½®æ–‡ä»¶ æ”¯æŒï¼Œç±»ä¼¼log4j ä¸æ”¯æŒ æ”¯æŒ è‡ªå®šä¹‰æ—¥å¿—çº§åˆ« æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ boost.log boost.logç›¸å¯¹å¤æ‚ï¼Œå•ç‹¬åšä¸€ä¸ªç®€å•ä»‹ç»ã€‚boost.logä½¿ç”¨äº†å¾ˆå¤šæ–°çš„æ¦‚å¿µï¼Œè®¾è®¡ä¸Šéžå¸¸æ¨¡å—åŒ–ï¼Œå¯ä»¥çµæ´»ç»„è£…å’Œæ‰©å±•ã€‚å¯¹äºŽåˆæ¬¡ä½¿ç”¨boost.logï¼Œä¸Šæ‰‹ä¸ä¼šç‰¹åˆ«é¡ºç•…ï¼Œéœ€è¦ç†è§£æ¸…æ¥šä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š Log sourceï¼šå°±æ˜¯å…¶ä»–æ¡†æž¶ä¸­çš„æ—¥å¿—å¯¹è±¡ï¼Œä½¿ç”¨è€…ç›´æŽ¥é¢å¯¹çš„ï¼Œå…¶ç‰¹åˆ«ä¹‹å¤„æ˜¯æ—¥å¿—çº§åˆ«ä¹Ÿæ˜¯å®Œå…¨è‡ªå®šä¹‰çš„ï¼› Log sink frontendï¼šå¼‚æ­¥å’ŒåŒæ­¥åœ¨è¿™ä¸€å±‚å®žçŽ°ï¼Œsink backendä½œä¸ºå‚æ•°ä¼ ç»™å®ƒï¼Œåˆ›å»ºä¹‹åŽaddåˆ°coreä¸­ï¼› Log sink backendï¼šä»£è¡¨æ—¥å¿—è¾“å‡ºçš„è½½ä½“ï¼Œå¦‚æŽ§åˆ¶å°ã€æ–‡ä»¶ç­‰ï¼Œè¿™æ˜¯æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„æ¦‚å¿µï¼ŒæŠŠsinkåˆ†ä¸ºfrontendå’Œbackendï¼Œæˆ‘æƒ³æ˜¯ä¸ºäº†å„å±‚éƒ½å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼Œéžå¸¸çµæ´»ï¼› Logging coreï¼šå®ƒæ˜¯å•ä¾‹çš„ï¼Œå»ºç«‹sourceå’Œsinkä¹‹é—´çš„è¿žæŽ¥ï¼Œå°±åƒä¸€ä¸ªhubä¸€æ ·ï¼Œè¿˜å¯ä»¥è®¾ç½®ä¸€äº›å…¨å±€fiterå’Œå±žæ€§ã€‚ ä»¥ä¸‹åˆ—å‡ºç›®å‰boost.logæ”¯æŒçš„æ‰€æœ‰sourceå’Œsinkï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041namespace logging = boost::log;namespace sinks = boost::log::sinks;namespace src = boost::log::sources;namespace expr = boost::log::expressions;namespace attrs = boost::log::attributes;namespace keywords = boost::log::keywords;// Log sourceï¼Œmtè¡¨ç¤ºçº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼Œä¸å¸¦mtè¡¨ç¤ºéžçº¿ç¨‹å®‰å…¨ç‰ˆæœ¬src::loggersrc::logger_mtsrc::severity_loggersrc::severity_logger_mtsrc::channel_loggersrc::channel_logger_mtsrc::severity_channel_loggersrc::severity_channel_logger_mt// Log sink frontendsinks::unlocked_sinksinks::synchronous_sinksinks::asynchronous_sink// å¯¹äºŽå¼‚æ­¥sink frontendæœ‰å¦‚ä¸‹é˜Ÿåˆ—//record queueing strategysinks::unbounded_fifo_queuesinks::unbounded_ordering_queuesinks::bounded_fifo_queuesinks::bounded_ordering_queue//overflow strategies:sinks::drop_on_overflowsinks::block_on_overflow// Log sink backendsinks::basic_text_ostream_backendsinks::text_file_backendsinks::text_multifile_backendsinks::text_ipc_message_queue_backendsinks::syslog_backendsinks::basic_debug_output_backendsinks::basic_simple_event_log_backendsinks::basic_event_log_backend æµ‹è¯•å·¥å…·&amp;ä»£ç  benchmark 1.5.0 å¯¹benchmarkçš„ä½¿ç”¨é‡åˆ°ä¸€ç‚¹å°éšœç¢ï¼Œå› ä¸ºæˆ‘å¸Œæœ›å°†flushçš„æ—¶é—´ä¹Ÿç»Ÿè®¡åœ¨å†…ï¼Œä½†æ˜¯benchmarkçš„é»˜è®¤è®¡æ—¶æ–¹å¼æ˜¯æ— æ³•åœ¨æœ€åŽä¸€ä¸ªè¿­ä»£ï¼ŒåŠ å…¥å¯¹flushçš„è°ƒç”¨ï¼Œå› ä¸ºæœ€åŽä¸€ä¸ªè¿­ä»£ä¼šè‡ªåŠ¨åœæ­¢è®¡æ—¶ã€‚ 12345678910111213141516171819for (auto _ : state) &#123; function_to_be_measured();&#125;// ç­‰ä»·äºŽfor (auto it = state.begin(), e = state.end(); it != e; ++it) &#123; function_to_be_measured();&#125;// æˆ‘å¸Œæœ›è¿™æ ·ï¼Œä½†æ˜¯æ²¡æœ‰æˆåŠŸï¼Œå› ä¸º!=æ“ä½œç¬¦ä¸­ï¼Œå¦‚æžœåˆ°è¾¾è¿­ä»£æœ€åŽï¼Œä¼šè‡ªåŠ¨åœæ­¢è®¡æ—¶for (auto it = state.begin(), e = state.end();;) &#123; if (!(it != e)) &#123; log.flush(); break; &#125; log.info(...); ++it;&#125; å› æ­¤ï¼Œæœ€ç»ˆåªæœ‰é€‰æ‹©UseManualTimeè®¡æ—¶æ–¹å¼ã€‚ æµ‹è¯•ä»£ç ï¼š&lt;https://github.com/zhongpan/cpp-logging-benchmark æ—¶é—´å’Œé€ŸçŽ‡ç»Ÿè®¡åŒ…å«flushæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ä¿è¯æ—¥å¿—å…¨éƒ¨è¾“å‡ºåˆ°æŽ§åˆ¶å°æˆ–æ–‡ä»¶ï¼› å¼‚æ­¥å†™å…¥éƒ½æ˜¯é‡‡ç”¨1ä¸ªçº¿ç¨‹ï¼Œé˜Ÿåˆ—æ·±åº¦éƒ½è®¾ç½®ä¸º8192ï¼Œé˜Ÿåˆ—æ»¡åŽéƒ½é‡‡ç”¨é˜»å¡žç­–ç•¥ï¼› å†™å…¥æ¶ˆæ¯é•¿åº¦æœ€å°é€‰æ‹©32ï¼Œé¿å…stringçš„å°å­—ç¬¦ä¸²æ€§èƒ½ä¼˜åŒ–ï¼Œèƒ½å¤Ÿä»£è¡¨æ›´é€šå¸¸çš„åœºæ™¯ï¼› æµ‹è¯•ç»“æžœ æµ‹è¯•çŽ¯å¢ƒï¼š IntelÂ® Coreâ„¢ i5-7200U CPU @ 2.50GHz Micron 1100 SATA 256G æµ‹è¯•ç»“æžœï¼š a_c_32 a_c_512 s_c_32 s_c_512 log4cplus 298.557/s 47.8782/s 313.306/s 50.7682/s spdlog 14.4967k/s 8.49778k/s 15.5747k/s 6.09162k/s boost.log 6.55519k/s 3.86561k/s 4.98684k/s 3.22393k/s a_f_32 a_f_512 s_f_32 s_f_512 log4cplus 15.8821k/s 5.48616k/s 11.2635k/s 4.91378k/s spdlog 180.147k/s 109.091k/s 229.206k/s 135.489k/s boost.log 29.3718k/s 25.9405k/s 15.7826k/s 14.6118k/s è¯´æ˜Žï¼š 32/512è¡¨ç¤ºæ¶ˆæ¯å­—èŠ‚æ•°ï¼› a/sè¡¨ç¤ºå¼‚æ­¥æˆ–åŒæ­¥ï¼› c/fè¡¨ç¤ºæŽ§åˆ¶å°æˆ–æ–‡ä»¶ï¼› ç»“æžœåˆ†æž æ‰€æœ‰çš„æ—¥å¿—æ¡†æž¶éƒ½è¡¨çŽ°å‡ºæ–‡ä»¶çš„å†™å…¥æ•ˆçŽ‡è¿œé«˜äºŽæŽ§åˆ¶å°ï¼Œå› æ­¤å°½é‡ä½¿ç”¨æ–‡ä»¶æ–¹å¼å†™æ—¥å¿—ï¼› åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼ï¼Œå¦‚æžœæŠŠflushçš„æ—¶é—´ç»Ÿè®¡åœ¨å†…ï¼Œåˆ™æ•ˆçŽ‡åŒºåˆ«ä¸å¤§ï¼Œä½†æ˜¯å¼‚æ­¥æ–¹å¼ä¸ä¼šé˜»å¡žåº”ç”¨ï¼Œå¦‚æžœè€ƒè™‘å¯¹åº”ç”¨çš„æ•ˆçŽ‡å½±å“ï¼Œå¼‚æ­¥æ–¹å¼æ˜¾è‘—ä¼˜äºŽåŒæ­¥ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨ä¸Ÿæ—¥å¿—çš„æƒ…å†µï¼Œåœ¨åº”ç”¨é€€å‡ºæ—¶å¿…é¡»ä¸»åŠ¨flushï¼› å½“æ¶ˆæ¯é•¿åº¦å¢žåŠ æ—¶ï¼Œå†™å…¥æ•ˆçŽ‡éƒ½æœ‰æ‰€ä¸‹é™ï¼Œspdlogå½“æ¶ˆæ¯å¤§äºŽ500å­—èŠ‚æ—¶ä¸‹é™æ˜¾è‘—ï¼ˆè§ä¸‹é¢çš„æºç åˆ†æžï¼‰ï¼Œboost.logä¸‹é™ä¸æ˜Žæ˜¾ï¼› å„ç§æƒ…å†µå†™å…¥æ•ˆçŽ‡éƒ½æ˜¯ï¼šspdlog&gt;boost.log&gt;log4cplusï¼Œå¹¶ä¸”log4cplusçš„æŽ§åˆ¶å°å†™å…¥æ•ˆçŽ‡éžå¸¸éžå¸¸ä½Žï¼Œspdlogçš„æ•ˆçŽ‡æ˜¾è‘—é«˜äºŽå…¶ä»–æ—¥å¿—æ¡†æž¶ï¼Œç‰¹åˆ«æ˜¯æ–‡ä»¶æ–¹å¼å†™å…¥æ•ˆçŽ‡ï¼Œè®©äººéš¾ä»¥ç½®ä¿¡ðŸ‘ï¼Œboost.logåœ¨å¤æ‚çš„è®¾è®¡ä¸‹ä»ç„¶ä¿æŒè‰¯å¥½çš„æ€§èƒ½ï¼Œä¹Ÿéžå¸¸åŽ‰å®³ã€‚ spdlogæ€§èƒ½ä¼˜åŒ–æºç åˆ†æž std::string_viewçš„ä½¿ç”¨é¿å…å­—ç¬¦ä¸²å¤åˆ¶æ—¶å†…å­˜åˆ†é… 123456789101112131415// spdlog/details/logger_impl.hinline void spdlog::logger::log(source_loc source, level::level_enum lvl, const char *msg)&#123; if (!should_log(lvl)) &#123; return; &#125; try &#123; details::log_msg log_msg(source, &amp;name_, lvl, spdlog::string_view_t(msg)); sink_it_(log_msg); &#125; SPDLOG_CATCH_AND_HANDLE&#125; 12345678// spdlog/common.h// string_view type - either std::string_view or fmt::string_view (pre c++17)#if defined(FMT_USE_STD_STRING_VIEW)using string_view_t = std::string_view;#elseusing string_view_t = fmt::string_view;#endif å®žçŽ°fmt::memory_bufferè¿›è¡Œå­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼Œ500é•¿åº¦ä»¥å†…ä½¿ç”¨å†…éƒ¨æ•°ç»„ï¼Œé¿å…å †å†…å­˜åˆ†é…ï¼Œå¹¶ä¸”æ¯”sstreamæ›´å¿« 1234567// spdlog/sinks/basic_file_sink.h void sink_it_(const details::log_msg &amp;msg) override &#123; fmt::memory_buffer formatted; sink::formatter_-&gt;format(msg, formatted); file_helper_.write(formatted); &#125; 1234567891011// spdlog/fmt/bundled/format.h// The number of characters to store in the basic_memory_buffer object itself// to avoid dynamic memory allocation.enum &#123; inline_buffer_size = 500 &#125;;template &lt;typename T, std::size_t SIZE = inline_buffer_size, typename Allocator = std::allocator&lt;T&gt; &gt;class basic_memory_buffer: private Allocator, public internal::basic_buffer&lt;T&gt; &#123; private: T store_[SIZE]; ç¼“å­˜æ—¶é—´å­—ç¬¦ä¸²ï¼Œé¿å…é‡å¤æ ¼å¼åŒ– 1234567891011121314151617181920212223242526272829303132333435363738// spdlog/details/pattern_formatter.h void format(const details::log_msg &amp;msg, const std::tm &amp;tm_time, fmt::memory_buffer &amp;dest) override &#123; using std::chrono::duration_cast; using std::chrono::milliseconds; using std::chrono::seconds;#ifndef SPDLOG_NO_DATETIME // cache the date/time part for the next second. auto duration = msg.time.time_since_epoch(); auto secs = duration_cast&lt;seconds&gt;(duration); if (cache_timestamp_ != secs || cached_datetime_.size() == 0) &#123; cached_datetime_.clear(); cached_datetime_.push_back('['); fmt_helper::append_int(tm_time.tm_year + 1900, cached_datetime_); cached_datetime_.push_back('-'); fmt_helper::pad2(tm_time.tm_mon + 1, cached_datetime_); cached_datetime_.push_back('-'); fmt_helper::pad2(tm_time.tm_mday, cached_datetime_); cached_datetime_.push_back(' '); fmt_helper::pad2(tm_time.tm_hour, cached_datetime_); cached_datetime_.push_back(':'); fmt_helper::pad2(tm_time.tm_min, cached_datetime_); cached_datetime_.push_back(':'); fmt_helper::pad2(tm_time.tm_sec, cached_datetime_); cached_datetime_.push_back('.'); cache_timestamp_ = secs; &#125; fmt_helper::append_buf(cached_datetime_, dest); æŽ§åˆ¶å°è¾“å‡ºä½¿ç”¨CRTæŽ¥å£ï¼Œç›¸å¯¹äºŽostreamæ›´å¿« 1234567891011121314// spdlog/details/console_globals.hstruct console_stdout&#123; static std::FILE *stream() &#123; return stdout; &#125;#ifdef _WIN32 static HANDLE handle() &#123; return ::GetStdHandle(STD_OUTPUT_HANDLE); &#125;#endif&#125;; 123456// corecrt_wstdio.h in windows sdk 10.0.17763.0_ACRTIMP_ALT FILE* __cdecl __acrt_iob_func(unsigned _Ix);#define stdin (__acrt_iob_func(0))#define stdout (__acrt_iob_func(1))#define stderr (__acrt_iob_func(2)) æ–‡ä»¶å†™å…¥ä½¿ç”¨çš„CRTæŽ¥å£ï¼Œç›¸å¯¹äºŽofstreamå¿« 12345678910// sdplog/details/file_helper.h void write(const fmt::memory_buffer &amp;buf) &#123; size_t msg_size = buf.size(); auto data = buf.data(); if (std::fwrite(data, 1, msg_size, fd_) != msg_size) &#123; throw spdlog_ex("Failed writing to file " + os::filename_to_str(_filename), errno); &#125; &#125; æ€»ç»“ ä¸‰ç§æ—¥å¿—æ¡†æž¶å„æœ‰æ‰€é•¿ï¼Œæˆ‘è§‰å¾—æ—¥å¿—æ¡†æž¶æœ€é‡è¦çš„è¿˜æ˜¯æ€§èƒ½å’ŒæŽ¥å£æ˜“ç”¨æ€§ï¼Œä¸ºäº†è°ƒè¯•bugï¼Œå¿…é¡»æ‰“å¿…è¦çš„æ—¥å¿—ï¼Œä½†æ˜¯å¼€äº†æ—¥å¿—ï¼Œåˆå½±å“åˆ°ç¨‹åºæ€§èƒ½ï¼Œç”šè‡³æœ¬æ¥å¿…çŽ°çš„é—®é¢˜ï¼Œå› ä¸ºæ•ˆçŽ‡å˜å·®çš„åŽŸå› éƒ½ä¸å‡ºæ¥äº†ï¼Œè¿™å°±å°´å°¬äº†ã€‚ç»è¿‡ä»¥ä¸Šåˆ†æžå¯¹æ¯”ï¼Œspdlogåœ¨æ€§èƒ½å’ŒæŽ¥å£æ˜“ç”¨æ€§ä¸Šå®Œèƒœå…¶ä»–æ—¥å¿—æ¡†æž¶ï¼Œæ˜¯æ—¥å¿—æ¡†æž¶çš„é¦–é€‰ï¼Œå…¶æ¬¡boost.logä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™é€‰æ‹©ï¼Œä½†æ˜¯å…¶æŽ¥å£ç”¨èµ·æ¥ä¸æ˜¯ç‰¹åˆ«é¡ºç•…ï¼Œå¯¹äºŽlog4cplusè¿˜æ˜¯ä¸æŽ¨èå¤§å®¶ä½¿ç”¨äº†ï¼Œå·²ç»ç”¨äº†çš„å°½å¿«åˆ‡æ¢å§ï¼Œå½“ç„¶spdlogä½¿ç”¨äº†å¤§é‡C++æ–°ç‰¹æ€§ï¼Œä½ å¿…é¡»ä½¿ç”¨C++11ä»¥ä¸Šçš„æ–°æ ‡å‡†ï¼Œä½†è¿™ä¼¼ä¹Žä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚]]></content>
      <categories>
        <category>loging</category>
      </categories>
      <tags>
        <tag>c++</tag>
        <tag>logging</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€‰æ‹©æœ€ä½³çš„Windowsè¿œç¨‹æ¡Œé¢æ›¿ä»£å·¥å…·]]></title>
    <url>%2F2019%2F07%2F01%2F009-windows-remote-control-tool%2F</url>
    <content type="text"><![CDATA[å¼€å‘è°ƒè¯•è¿‡ç¨‹ä¸­å°‘ä¸äº†ä½¿ç”¨è¿œç¨‹æ¡Œé¢è®¿é—®å…¶ä»–æœºå™¨ï¼Œæœ€è¿‘Windowsçš„è¿œç¨‹æ¡Œé¢æ— æ³•ä½¿ç”¨ï¼Œåªå¾—å¯»æ‰¾å…¶ä»–æ›¿ä»£æ–¹æ¡ˆï¼Œç»è¿‡ä¸€ç•ªæœç´¢è¯•ç”¨ä¹‹åŽï¼Œæœ‰å‡ æ¬¾è½¯ä»¶åŸºæœ¬èƒ½å¤Ÿè¾¾åˆ°å’ŒWindowsè¿œç¨‹æ¡Œé¢ç±»ä¼¼æ•ˆæžœï¼Œé€‰æ‹©ä¸»è¦è€ƒé‡å¦‚ä¸‹å› ç´ ï¼š å…è´¹è§£å†³æ–¹æ¡ˆï¼Œå•†ä¸šçš„é¦–å…ˆæŽ’é™¤ï¼Œå¦‚Teamviewerï¼ŒAnyDeskï¼ŒRadminç­‰ï¼› æ¸…æ™°åº¦å’Œé€Ÿåº¦åŸºæœ¬æŽ¥è¿‘Windowsçš„RDPï¼Œè¿™é‡Œä¸å¾—ä¸è¯´Windowsä¸‹çš„RDPç¡®å®žæ˜¯æœ€å¥½çš„ï¼Œæ²¡æœ‰ä¹‹ä¸€ï¼› UltraVNC è¯´åˆ°è¿œç¨‹è®¿é—®ï¼Œé¦–å…ˆä¸€å®šä¼šæƒ³åˆ°VNCï¼ŒVNCåœ¨Windowsè®¿é—®Linuxä¸­ç”¨çš„æ¯”è¾ƒå¤šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥Windowsè®¿é—®Windowsï¼ŒVNCçš„å®žçŽ°æœ‰å‡ ä¸ªä¸»è¦çš„è½¯ä»¶ï¼ŒåŒ…æ‹¬ï¼šRealVNCã€TightVNCï¼ˆè¿˜æœ‰ä¸€ä¸ªæºäºŽå®ƒçš„TigerVNCï¼‰ã€UltraVNCï¼Œå®ƒä»¬éƒ½åŸºäºŽæœ€åˆçš„AT&amp;Tå¼€æºçš„VNCï¼Œåè®®ä¸Šå½¼æ­¤å…¼å®¹ï¼Œå„æœ‰æ‰€é•¿ï¼Œä¹Ÿæœ‰ç›¸äº’å¸æ”¶ï¼Œå…¶ä¸­åŠŸèƒ½æ€§ä¸ŠUltraVNCæœ€ä¸ºå¼ºå¤§ï¼Œæ”¯æŒæ–‡ä»¶ä¼ è¾“ç­‰åŠŸèƒ½ã€‚ é¦–å…ˆè¯•ç”¨äº†UltraVNCï¼Œä½†æ˜¯ç»“æžœè®©äººå¤§è·Œçœ¼é•œï¼Œé€Ÿåº¦æ…¢çš„ä¸€å¡Œç³Šæ¶‚ã€‚è½¬è€Œæ‰¾åˆ°äº†TigerVNCï¼Œå·ç§°é«˜æ€§èƒ½ï¼Œä½†æ˜¯é€Ÿåº¦å’ŒUltraVNCå·®ä¸å¤šã€‚ç»è¿‡ä¸€ç•ªæœç´¢ä¹‹åŽï¼ŒåŽŸæ¥UltraVNCéœ€è¦é…åˆVideo Mirror Driverä¸€èµ·ä½¿ç”¨æ‰èƒ½æœ‰æ›´å¥½çš„é€Ÿåº¦ï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š ä¸‹è½½Mirror Driver SDKï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿä¸åŒé€‰æ‹©ä¸åŒçš„é©±åŠ¨ï¼Œä¾‹å¦‚Windows 7 64ä½å¯é€‰æ‹©driver\vista64ç›®å½•ä¸‹çš„ æ‰§è¡Œsetupdrv.exe installæˆ–ç›¸åº”æ‰¹å¤„ç†è„šæœ¬è¿›è¡Œå®‰è£…ï¼Œå®‰è£…æˆåŠŸåŽä¼šå¤šå‡ºæ˜¾ç¤ºè®¾å¤‡ UltraVNCæœåŠ¡ç«¯è®¾ç½®ï¼Œå‹¾é€‰Mirror Driverã€‚æ³¨æ„UltraVNCå¿…é¡»å’ŒMirror Driverçš„ä½æ•°ä¸€è‡´ï¼Œå¦‚æžœæ˜¯64ä½æ“ä½œç³»ç»Ÿï¼Œå°±å¿…é¡»éƒ½æ˜¯64ä½ã€‚ ç‚¹å‡»check the Mirror Driverï¼Œä¼šæ˜¾ç¤ºï¼š å¦‚æžœæœ‰å®¢æˆ·ç«¯è¿žæŽ¥ä¸Šï¼Œå†ç‚¹å‡»check the Mirror Driverï¼Œä¼šæ˜¾ç¤ºï¼š å¯ç”¨Mirror DriveråŽï¼Œç¡®å®žé€Ÿåº¦æµç•…äº†è®¸å¤šï¼ŒåŸºæœ¬æ»¡è¶³ä½¿ç”¨ï¼Œä½†æ˜¯ç›¸æ¯”RDPï¼Œåœ¨æµç•…åº¦ä¸Šè¿˜æ˜¯å·®ä¸€äº›ã€‚ TrueRemote æ— æ„ä¸­å‘çŽ°äº†è¿™æ¬¾è½¯ä»¶ï¼Œéžå¸¸è½»é‡ï¼Œè½¯ä»¶åŽ‹ç¼©åŒ…åªæœ‰151Kï¼Œä½†æ˜¯æµç•…åº¦ä¸Šè®©äººæ˜ åƒéžå¸¸æ·±åˆ»ï¼Œå¹¶ä¸”æ”¯æŒæ–‡ä»¶ä¼ è¾“ï¼Œå®Œå…¨æ»¡è¶³åŸºæœ¬çš„ä½¿ç”¨éœ€æ±‚ã€‚ä½†æ˜¯è¿™æ¬¾è½¯ä»¶æœ€åŽæ›´æ–°æ˜¯2012å¹´ï¼Œä½œè€…åŽç»­å·²ç»æ²¡æœ‰ç»´æŠ¤äº†ã€‚è¿™æ¬¾è½¯ä»¶æ˜¯åªæ”¯æŒWindowsçš„ï¼Œå®˜æ–¹ä¸»é¡µï¼šhttp://blog.x-row.net/?p=47ï¼Œä½¿ç”¨æ–¹æ³•éžå¸¸ç®€å•ï¼š æœåŠ¡ç«¯ Controlé€‰æ‹©Offå°±æ˜¯åªè¯»æŽ§åˆ¶ï¼ŒServiceé€‰æ‹©EntryåŽä¼šå®‰è£…æˆWindowsæœåŠ¡ã€‚ å®¢æˆ·ç«¯ æ³¨æ„Passwordä¸ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œå¯ä»¥ä¿®æ”¹tureremote.iniæ–‡ä»¶ä¿å­˜ã€‚Scrollç±»ä¼¼UltraVNCçš„Scale to windowï¼Œé€‰Offè¡¨ç¤ºä¸ç¼©æ”¾ï¼Œå°±ä¼šå‡ºçŽ°æ»šåŠ¨æ¡ï¼Œä½†æ˜¯è¿™æ—¶æ˜¯æœ€æ¸…æ™°çš„ï¼Œå¦åˆ™å°±ä¼šç¼©æ”¾åˆ°åˆé€‚å¤§å°ï¼Œä½†æ˜¯ä¼šå‡ºçŽ°ç¨è®¸æ¨¡ç³Šã€‚Codecè²Œä¼¼åªæœ‰TrueRemoteå’ŒToshiba YUV411ä¸¤ä¸ªå¯ç”¨ï¼Œæ•ˆæžœå·®ä¸å¤šã€‚ è¿žæŽ¥ä¸Šä¹‹åŽæ•ˆæžœå¦‚ä¸Šï¼Œæ ‡é¢˜æ èœå•ä¸­åŠ å…¥äº†ä¸€äº›æŽ§åˆ¶èœå•ï¼Œå‘é€æ–‡ä»¶å¯ä»¥ä»Žè¿™é‡Œæ“ä½œã€‚ NoMachine NoMachineåˆ†for everybodyå’Œenterpriseä¸¤ä¸ªç‰ˆæœ¬ï¼Œfor everybodyç‰ˆæœ¬æ˜¯å…è´¹çš„ã€‚NoMachineå®žçŽ°äº†è‡ªæœ‰çš„nxåè®®ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œæµç•…ç¨‹åº¦æŽ¥è¿‘RDPã€‚ å®‰è£…åŽéœ€è¦é‡å¯ï¼ŒæœåŠ¡ç«¯å·²ç»è‡ªåŠ¨å®‰è£…ä¸ºWindowsæœåŠ¡ï¼Œé»˜è®¤ä½¿ç”¨4000ç«¯å£ã€‚æœåŠ¡ç«¯å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼š æ‰“å¼€å®¢æˆ·ç«¯å¦‚ä¸‹ï¼š å»ºç«‹è¿žæŽ¥ï¼š åè®®æ”¯æŒNXå’ŒSSHä¸¤ç§ï¼Œè®¤è¯æ–¹å¼æ”¯æŒå¦‚ä¸‹ä¸‰ç§ï¼š ç™»é™†ä¹‹åŽæ•ˆæžœå¦‚ä¸‹ï¼Œæˆ‘å‘ä¸€ä¸ªç»†èŠ‚ï¼Œå±å¹•ä¼šéšç€é¼ æ ‡ç§»åŠ¨è‡ªåŠ¨æ»šåŠ¨ï¼Œéžå¸¸äººæ€§åŒ–ï¼Œç»™ä¸€ä¸ªå¤§å¤§çš„èµžðŸ‘: é€šè¿‡ç‚¹å‡»å³ä¸Šè§’æˆ–è€…å¿«æ·é”®Ctrl+Alt+0å¯ä»¥è°ƒå‡ºè®¾ç½®ç•Œé¢ï¼ŒåŠŸèƒ½éžå¸¸ä¸°å¯Œå®Œå–„ï¼š ä¾‹å¦‚å…³äºŽæ˜¾ç¤ºè®¾ç½®å¦‚ä¸‹ï¼š å…³äºŽè®¾å¤‡è®¾ç½®å¦‚ä¸‹ï¼š æ€»ç»“ æµç•…åº¦ åŠŸèƒ½ è½»é‡ è·¨å¹³å° UltraVNC â­ï¸â­ï¸â­ï¸éœ€è¦å¯ç”¨mirror driver â­ï¸â­ï¸â­ï¸â­ï¸ â­ï¸â­ï¸â­ï¸ âŒä»…æ”¯æŒWindows TrueRemote â­ï¸â­ï¸â­ï¸ â­ï¸â­ï¸â­ï¸ä¸æ”¯æŒå…¨å±ï¼Œæ— æ³•å‘é€Ctrl+Alt+Delete â­ï¸â­ï¸â­ï¸â­ï¸ âŒä»…æ”¯æŒWindows NoMachine â­ï¸â­ï¸â­ï¸ â­ï¸â­ï¸â­ï¸â­ï¸ â­ï¸â­ï¸â­ï¸ âœ”ï¸è¿˜æ”¯æŒmobile é€šè¿‡ä»¥ä¸Šå¯¹æ¯”ï¼Œé¦–é€‰æŽ¨èNoMachineï¼Œå„æ–¹é¢éƒ½æ¯”è¾ƒå‡ºè‰²ï¼Œç‰¹åˆ«æ˜¯å¤šå¹³å°æ”¯æŒã€‚å…¶æ¬¡æ˜¯TrueRemoteï¼ŒåŸºæœ¬æ»¡è¶³ä½¿ç”¨ï¼Œå…¶ä»–ç‰¹ç‚¹æ˜¯å°å·§è½»é‡ã€‚UltraVNCä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºçŽ°è¿‡å®¢æˆ·ç«¯æŒ‚æ­»æƒ…å†µï¼Œä¸æ˜¯ç‰¹åˆ«ç¨³å®šï¼Œå…¶ç”¨æˆ·ç•Œé¢ä¹Ÿä¸å¤ªç®€æ´å’Œå‹å¥½ã€‚]]></content>
      <categories>
        <category>devtool</category>
      </categories>
      <tags>
        <tag>remote control</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CMakeä½¿ç”¨NinjaåŠ é€ŸC++ä»£ç æž„å»ºè¿‡ç¨‹]]></title>
    <url>%2F2019%2F06%2F26%2F008-cmake-with-ninja%2F</url>
    <content type="text"><![CDATA[Ninjaçš„å°å·§ã€å¿«é€Ÿã€ç¨³å®šç¡®å®žæƒŠè‰³åˆ°æˆ‘ï¼Œåœ¨ä½¿ç”¨Ninjaä¹‹å‰ï¼Œæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨Incredi BuildåŠ é€Ÿæˆ‘ä»¬çš„äº§å“æž„å»ºï¼ŒIBç¡®å®žæ˜¯ä¸€æ¬¾éžå¸¸ä¼˜ç§€çš„å•†ä¸šè½¯ä»¶ï¼Œç›´åˆ°æœ€è¿‘åœ¨ä½¿ç”¨IBç¼–è¯‘æ—¶ï¼Œç»å¸¸æ€§å¯¼è‡´æœåŠ¡å™¨æ­»æœºï¼Œæˆ‘ä¸å¾—ä¸å¯»æ±‚å…¶ä»–åŠ é€Ÿæž„å»ºè¿‡ç¨‹çš„å·¥å…·ï¼Œè¿™æ—¶æˆ‘æ‰¾åˆ°äº†Ninjaï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯é‡‡ç”¨CMakeæž„å»ºçš„ï¼Œè€ŒCMakeåˆšå¥½æ”¯æŒninjaçš„generatorï¼Œæ‰€ä»¥å¼•å…¥Ninjaæ²¡æœ‰èŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œè®©äººæ•¬ä½©çš„æ˜¯ï¼Œæ­¤åŽå°±å†ä¹Ÿæ²¡æœ‰æ­»æœºè¿‡äº†ï¼ŒçœŸçš„æ˜¯å†æœ‰æ²¡æœ‰ðŸ‘ã€‚ CMakeå¦‚ä½•ä½¿ç”¨Ninja å¦‚ä¸‹ä»¥Windowsä¸ºä¾‹ï¼š ä¸‹è½½ninja.exeï¼Œæ”¾åˆ°æŸä¸ªç›®å½•ï¼Œå‡è®¾D:\toolï¼Œå¹¶å°†D:\toolåŠ å…¥PATHçŽ¯å¢ƒå˜é‡ï¼› å‡è®¾æºä»£ç ç›®å½•ä¸ºD:\codeï¼Œå…¶ä¸­åŒ…å«CMakeLists.txtæ–‡ä»¶ï¼Œé‚£ä¹ˆæž„å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š 12345cd /d D:\codemkdir buildcd buildcmake .. -G "Ninja" -DCMAKE_MAKE_PROGRAM=D:\tool\ninja.exeninja Ninjaå’ŒMSVCçš„å…³ç³» åœ¨Windowsä¸Šä¸€èˆ¬ä½¿ç”¨çš„ç¼–è¯‘å™¨æ˜¯MSVCï¼ŒNinjaå’ŒMSVCçš„å…³ç³»å°±åƒmakeå’Œgccçš„å…³ç³»ï¼Œå½“ç„¶Ninjiaä¹Ÿå¯ä»¥ç”¨åœ¨Linuxä¸‹å’Œgccé…åˆã€‚æ‰€ä»¥Ninjaåªæ˜¯è´Ÿè´£è°ƒç”¨ç¼–è¯‘å™¨å¹²æ´»ï¼Œæœ¬ç”Ÿå¹¶ä¸è´Ÿè´£ç¼–è¯‘ï¼Œéœ€è¦å¼„æ¸…æ¥šã€‚ å¦‚ä½•ä½¿ç”¨é¢„ç¼–è¯‘å¤´æ–‡ä»¶ CMakeå¹¶æ²¡æœ‰å†…ç½®é¢„ç¼–è¯‘å¤´æ–‡ä»¶çš„æ”¯æŒï¼Œéœ€è¦é€šè¿‡target_compile_optionsã€set_source_files_propertiesè¿™äº›å·²æœ‰çš„å‘½ä»¤è®¾ç½®é¢„ç¼–è¯‘å‚æ•°ï¼Œä»Žgithubä¸Šå¯ä»¥æ‰¾åˆ°ä¸€äº›å°è£…ï¼Œå¯ä»¥å¼€ç®±å³ç”¨ï¼Œä¾‹å¦‚ï¼šcmake-precompiled-headerã€CMakePCHCompilerï¼Œå…¶ä¸­CMakePCHCompilerçš„ç›®æ ‡å°±æ˜¯æˆä¸ºCMakeçš„æ ‡å‡†æ¨¡å—ã€‚ ä½†æ˜¯è¿™äº›å°è£…ä¸­éƒ½æ²¡æœ‰è€ƒè™‘åˆ°ä½¿ç”¨ninjiaåœ¨é¢„ç¼–è¯‘æ—¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé¢„ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯é¦–å…ˆéœ€è¦æ ¹æ®é¢„ç¼–è¯‘å¤´æ–‡ä»¶ç”Ÿæˆpchæ–‡ä»¶(ç±»ä¼¼objæ–‡ä»¶)ï¼Œç„¶åŽå†ç¼–è¯‘å…¶ä»–cppæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å…¶ä»–cppæ–‡ä»¶éœ€è¦ä¾èµ–è¿™ä¸ªpchæ–‡ä»¶ï¼Œä»–ä»¬æœ‰ç¼–è¯‘çš„å…ˆåŽé¡ºåºï¼Œå¦‚æžœä½¿ç”¨MSVSç¼–è¯‘ï¼Œå®ƒä¼šä¿è¯è¿™ä¸ªé¡ºåºï¼Œä½†æ˜¯æ¢æˆninjaåŽï¼Œè¿™ä¸ªä¾èµ–å…³ç³»å¹¶ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆåˆ°build.ninjaç­‰æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ç¼–è¯‘çš„è¿‡ç¨‹å°±ä¼šå‡ºçŽ°pchè¿˜æ²¡ç”Ÿæˆå°±å¼€å§‹ç¼–è¯‘å…¶ä»–cppæ–‡ä»¶ï¼Œè‡ªç„¶å°±ç¼–è¯‘ä¸è¿‡ã€‚ è¿™ä¸ªé—®é¢˜æˆ‘ç ”ç©¶äº†å¾ˆé•¿æ—¶é—´ï¼Œæ‰å‘çŽ°åœ¨CMakeLists.txtä¸­å¢žåŠ ä¸€äº›ç¼–è¯‘å‚æ•°è®¾ç½®æ‰è¡Œï¼š åœ¨é¢„ç¼–è¯‘å¤´æ–‡ä»¶å¯¹åº”çš„cppæ–‡ä»¶ä¸Šï¼Œä¸»è¦å…³æ³¨OBJECT_OUTPUTSå±žæ€§1set_source_files_properties($&#123;header_src&#125; PROPERTIES COMPILE_FLAGS "/Yc$&#123;header_path&#125; /FI$&#123;header_path&#125; /Fp$&#123;win_pch&#125;" OBJECT_OUTPUTS $&#123;win_pch&#125;) åœ¨å…¶ä»–æ¯ä¸ªcppæ–‡ä»¶ä¸Šï¼Œä¸»è¦å…³æ³¨OBJECT_DEPENDSå±žæ€§1set_source_files_properties($&#123;src&#125; PROPERTIES OBJECT_DEPENDS $&#123;win_pch&#125;) è¿™æ ·ç”Ÿæˆçš„ninjiaæž„å»ºæ–‡ä»¶æ‰ä¼šç”Ÿæˆæ­£ç¡®çš„ä¾èµ–å…³ç³»ã€‚ Ninjaå’ŒMSVCå…±äº«ä¸­é—´æ–‡ä»¶ NinjaåŠ é€Ÿç¼–è¯‘è¿‡ç¨‹æ˜¯éžå¸¸å¥½çš„é€‰æ‹©ï¼Œä½†æ˜¯å¼€å‘è°ƒè¯•è¿˜æ˜¯éœ€è¦åœ¨IDEä¸‹ï¼ŒWindowsä¸‹å°±æ˜¯MSVSï¼Œæ‰€ä»¥è¿˜æ˜¯å¸Œæœ›CMakeä¹Ÿç”ŸæˆMSVSå·¥ç¨‹ï¼Œç„¶åŽæ‰“å¼€MSVSå¼€å‘è°ƒè¯•ã€‚ä½†æ˜¯Ninjaå’ŒMSVSä¸¤ä¸ªgeneratoråªèƒ½äºŒé€‰ä¸€ï¼Œæœ‰æ²¡æœ‰åŠžæ³•èƒ½å¤Ÿä¸¤è€…åŒæ—¶ä½¿ç”¨å‘¢ï¼Œæˆ‘åšäº†ä¸€äº›å°è¯•ï¼Œè§£å†³äº†ä¸­é—´ä¸€äº›é—®é¢˜ï¼Œè¿˜æœ‰å¾…ç»§ç»­ï¼š é¦–å…ˆè¦è§£å†³çš„æ˜¯ç”Ÿæˆ2ä¸ªgeneratorï¼ŒCMakeæ˜¯æ²¡æœ‰åŠžæ³•åœ¨åŒä¸€ä¸ªbuildç›®å½•ç”Ÿæˆä¸¤æ¬¡ä¸åŒçš„generatorçš„ï¼Œæ‰€ä»¥éœ€è¦ç”¨ä¸åŒçš„ç›®å½•ï¼Œè¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼š 12345cd /d D:\codemkdir buildcd buildcmake .. -G &quot;Ninja&quot; -Bninja -DCMAKE_MAKE_PROGRAM=D:\tool\ninja.execmake .. -G &quot;Visual Studio 15 2017 Win64&quot; è¿™æ ·ninjaçš„å·¥ç¨‹ç”Ÿæˆåœ¨build\ninjaç›®å½•ä¸‹ï¼ŒMSVSå·¥ç¨‹ç”Ÿæˆåœ¨buildç›®å½•ä¸‹ã€‚ å…¶æ¬¡è¦è§£å†³ninjaå’ŒMSVCç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶çš„ä½ç½®ä¸ä¸€æ ·é—®é¢˜ï¼Œå¦‚objæ–‡ä»¶ã€‚ninjaæ˜¯ä¸€ä¸ªå•é…é…ç½®æž„å»ºç³»ç»Ÿï¼Œè€ŒMSVSæ˜¯ä¸€ä¸ªå¤šé…ç½®æž„å»ºç³»ç»Ÿï¼Œä»–ä»¬çš„ä¸­é—´æ–‡ä»¶è·¯å¾„æ˜¯ä¸ä¸€æ ·çš„ã€‚ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¯¹CMakeæºä»£ç è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œå°†ninjiaè¾“å‡ºçš„ä¸­é—´æ–‡ä»¶è·¯å¾„æ”¹ä¸ºå’ŒMSVSä¸€æ ·ï¼Œå‚è§æˆ‘çš„githubä»“åº“ï¼šhttps://github.com/zhongpan/CMake æœ€åŽè¦è§£å†³MSVCå’Œninjiaè¦èƒ½å¤Ÿè®¤å½¼æ­¤ç”Ÿæˆçš„ç¼–è¯‘ä¸­é—´æ–‡ä»¶ï¼Œåˆ‡æ¢åŽä¸ä¼šè§¦å‘é‡ç¼–ï¼Œå¯èƒ½ä¸­é—´æœ‰ä¸€äº›å½¼æ­¤ç‰¹æœ‰çš„æ–‡ä»¶éœ€è¦ç”Ÿæˆï¼Œè¿™ä¸€æ­¥è¿˜æœ‰å¾…ç»§ç»­ðŸ’ªã€‚]]></content>
      <categories>
        <category>devtool</category>
      </categories>
      <tags>
        <tag>c++</tag>
        <tag>ninja</tag>
        <tag>cmake</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çŽ°ä»£åŒ–OJç³»ç»Ÿdmojæ­å»ºé—®é¢˜æ€»ç»“åŠä½¿ç”¨æ–¹æ³•]]></title>
    <url>%2F2019%2F06%2F17%2F007-dmoj-set-up%2F</url>
    <content type="text"><![CDATA[dmojä»‹ç» dmojæ˜¯ä¸€ä¸ªå¼€æºçš„Online Judge(ç®€ç§°OJ)ç³»ç»Ÿï¼Œæ­£å¦‚å…¶ç®€ä»‹ä¸­æè¿°çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªçŽ°ä»£çš„OJç³»ç»Ÿï¼Œç›¸æ¯”å…¶ä»–è€ç‰Œçš„OJç³»ç»Ÿï¼Œå…¶ä¸»è¦ç‰¹ç‚¹æ˜¯ï¼š æ”¯æŒçš„è¯­è¨€éžå¸¸ä¸°å¯Œï¼Œå…¶ä»–OJç³»ç»Ÿä¸»è¦æ˜¯Javaã€C++ã€Pythonï¼Œè€Œdmojå‡ ä¹Žè¦†ç›–äº†æ‰€æœ‰ä¸»æµçš„è¯­è¨€ï¼Œå…¶ä¸­æ¯”è¾ƒå¸å¼•æˆ‘çš„è¿˜æ”¯æŒJavaScriptï¼› å…¶judgeç³»ç»Ÿçš„æ˜¯é«˜åº¦å¯æ‰©å±•çš„ï¼Œé¦–å…ˆæ˜¯å¯æ–¹ä¾¿çš„å¼•å…¥æ–°è¯­è¨€çš„æ”¯æŒï¼Œå…¶æ¬¡æ˜¯é¢˜ç›®çš„è¯„åˆ¤è¿‡ç¨‹å¯é«˜åº¦å®šåˆ¶ï¼› å…¶åŠŸèƒ½æ€§ä¸Šéžå¸¸å®Œå¤‡ï¼Œè¦†ç›–OJç³»ç»Ÿå¿…å¤‡çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæ¯”å¦‚æœ‰äº›OJä¸æ”¯æŒç»„ç»‡ï¼Œåªæœ‰ç”¨æˆ·çš„æ¦‚å¿µï¼Œè€Œdmojéƒ½æ˜¯æ”¯æŒçš„ï¼› å›½é™…åŒ–ã€æœ¬åœ°åŒ–æ”¯æŒéžå¸¸å‡ºè‰²ï¼Œå¾—ç›ŠäºŽdjangoæ¡†æž¶ï¼Œdmojå¯¹å›½é™…åŒ–ã€æ—¶åŒºã€æœ¬åœ°åŒ–å¤„ç†çš„éžå¸¸å¥½ï¼Œè¿˜æœ‰å…¶å¤´åƒé‡‡ç”¨gravataræœåŠ¡ï¼Œä¹Ÿæ˜¯åŠ åˆ†é¡¹ï¼› å…¶WEBç«™ç‚¹ä¹Ÿæ˜¯å¯å®šåˆ¶çš„ï¼Œé€šè¿‡ç®¡ç†åŽå°å¯åŠ¨æ€æ·»åŠ å¯¼èˆªå’Œç®€å•é¡µé¢ï¼Œæ”¯æŒmarkdowné¡µé¢ã€‚ å®‰è£…é—®é¢˜æ€»ç»“ æ ¹æ®å®˜æ–¹çš„å®‰è£…æ‰‹å†Œï¼Œä»ç„¶ä¼šé‡åˆ°ä¸å°‘é—®é¢˜ï¼Œç‰¹å°†å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜è®°å½•ä¸‹æ¥ï¼Œä¾›å…¶ä»–äººå‚è€ƒã€‚æˆ‘æ˜¯åœ¨debian9è™šæ‹Ÿæœºä¸­å®‰è£…çš„ï¼Œå®‰è£…åˆ†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ç«™ç‚¹ï¼Œä¸€éƒ¨åˆ†æ˜¯judgeï¼Œjudgeå¯ä»¥å®‰è£…å¤šä¸ªã€‚ webç«™ç‚¹å®‰è£… pythonç‰ˆæœ¬ å¿…é¡»é‡‡ç”¨python3ï¼Œä»£ç ä¸­ä½¿ç”¨äº†ä»…python3æ‰æœ‰çš„åº“ã€‚ pip install mysqlclientæ—¶æŠ¥é”™ 1apt install libmysqlclient-dev ä¿®æ”¹ä¸ºï¼š 1apt install libmariadbclient-dev å†…ç½‘å±è”½äº†gitåè®®ï¼Œpip install -r requirements.txtæŠ¥é”™ å…ˆå°†https://github.com/DMOJ/dmoj-wpadminå–åˆ°æœ¬åœ°ï¼Œç„¶åŽä¿®æ”¹requirements.txtä¸­-e git://github.com/DMOJ/dmoj-wpadmin.git#egg=dmoj-wpadminä¸ºæœ¬åœ°è·¯å¾„ã€‚ USE_TZ = Trueæ—¶åœ¨WEBç«™ç‚¹ä¸Šæ¶‰åŠæ—¶é—´å­—æ®µçš„æ“ä½œåŽæŠ¥é”™:Database returned an invalid datetime value. Are time zone definitions for your database installed? æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -D mysql -u root -p å‘é€é‚®ä»¶æ—¶å¼‚å¸¸ï¼šMail from must equal authorized user local_settingsä¸­åŠ å…¥DEFAULT_FROM_EMAILï¼Œèµ‹å€¼ä¸ºä½¿ç”¨çš„é‚®ä»¶å‘é€åœ°å€ã€‚ judgeå®‰è£… pythonç‰ˆæœ¬ python2æˆ–python3å‡å¯ ç¼–è¯‘æ—¶æ‰¾ä¸åˆ°seccompç›¸å…³å¤´æ–‡ä»¶ æ‰§è¡Œï¼š 1sudo apt install libseccomp-dev libseccomp2 seccomp å…¶ä»–ç›¸å…³çŸ¥è¯† vagrantå®‰è£…å¢žå¼ºåŠŸèƒ½ 12345apt-get install build-essential linux-headers-$(uname -r)vagrant upload &quot;C:\Program Files\Oracle\VirtualBox\VBoxGuestAdditions.iso&quot; /home/vagrant/VBoxGuestAdditions.isosudo mkdir /media/VBoxGuestAdditionssudo mount -o loop,ro VBoxGuestAdditions.iso /media/VBoxGuestAdditionssudo sh /media/VBoxGuestAdditions/VBoxLinuxAdditions.run source: not found ls -l 'which sh' æç¤º/bin/sh -&gt; dashè¿™è¯´æ˜Žæ˜¯ç”¨dashæ¥è¿›è¡Œè§£æžçš„ã€‚æ‰§è¡Œï¼šsudo dpkg-reconfigure dashï¼Œåœ¨ç•Œé¢ä¸­é€‰æ‹©noï¼Œå†ls -l 'which sh' æç¤º/bin/sh -&gt; bashï¼Œä¿®æ”¹æˆåŠŸï¼Œsourceå¯ä»¥ç”¨äº†ã€‚ å®‰è£…JDK 1sudo apt-get install openjdk-8-jre openjdk-8-jdk mariadbä¿®æ”¹è®¤è¯æ–¹å¼å’Œrootå¯†ç  https://www.cnblogs.com/zhuxiaoxi/p/10843659.html ä½¿ç”¨è¯´æ˜Ž å…³äºŽé¢˜ç›® å®‰è£…åŽæ˜¯ä¸åŒ…å«é¢˜ç›®çš„ï¼Œè¦è®©OJçœŸæ­£è¿è½¬èµ·æ¥ï¼Œå¿…é¡»åŒ…å«é¢˜ç›®ï¼Œé€šè¿‡çˆ¬è™«ç¨‹åºå¯ä»¥ä»Ždmojå®˜ç½‘æå–é¢˜ç›®ï¼Œå¯å‚è€ƒæˆ‘å†™çš„çˆ¬è™«ç¨‹åºï¼šhttps://github.com/zhongpan/dmoj_problemsã€‚ å¢žåŠ è¯­è¨€ ä»¥å¢žåŠ V8JSä¸ºä¾‹ï¼š å®‰è£…v8dmoj å‚è€ƒhttps://github.com/DMOJ/v8dmojä¸­çš„å®‰è£…æ­¥éª¤å®‰è£…ï¼Œä¼šå®‰è£…v8dmojç¨‹åºåˆ°/user/binä¸‹ ä¿®æ”¹judgeçš„runtime è¿è¡Œdmoj-autoconfï¼Œä¼šè‡ªåŠ¨æ£€æµ‹æœ¬æœºä¸Šå¯ç”¨çš„ç¼–ç¨‹è¯­è¨€çŽ¯å¢ƒï¼Œæ ¹æ®è¾“å‡ºä¿®æ”¹judegçš„é…ç½®æ–‡ä»¶ä¸­çš„runtimeï¼Œå®‰è£…v8dmojåŽä¼šå¢žåŠ å¦‚ä¸‹è¡Œï¼š 1v8dmoj: /user/bin/v8dmoj é‡å¯judgeï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†V8JSï¼š ç«™ç‚¹ç®¡ç†åŽå°å¢žåŠ è¯­è¨€ï¼Œæ³¨æ„æ ‡è¯†ç¬¦åŒä¸Šé¢è£åˆ¤æœåŠ¡å™¨çš„æ‰§è¡Œå™¨æ ‡è¯†ç¬¦ä¸€è‡´]]></content>
      <categories>
        <category>online judge</category>
      </categories>
      <tags>
        <tag>online judge</tag>
        <tag>dmoj</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°ä¸€æ¬¡å¤±è´¥çš„Windowsä¸‹ä½¿ç”¨Docker UCPæ­å»ºå®¹å™¨é›†ç¾¤]]></title>
    <url>%2F2019%2F06%2F03%2F006-docker-ucp-failure-set-up%2F</url>
    <content type="text"><![CDATA[æ‰‹å¤´åˆšå¥½æœ‰Windowså®¹å™¨çš„Docker UCPçš„Licenseï¼Œæ‰€ä»¥æƒ³è¯•ç€ç”¨Dockers UCPæ­å»ºä¸€ä¸ªWindowså®¹å™¨é›†ç¾¤ä½“éªŒä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°è¿™æ˜¯ä¸€ä¸ªéžå¸¸ç—›è‹¦çš„ç»åŽ†ï¼Œè¿™ä¹Ÿè¯æ˜Žäº†çŽ©å®¹å™¨ä¸»æµè¿˜æ˜¯Linuxï¼ŒæŠ˜è…¾äº†å¾ˆä¹…ç»ˆäºŽæˆåŠŸäº†ä¸€æ¬¡ï¼Œä½†æ˜¯å½“æˆ‘åœ¨åŒæ ·çš„çŽ¯å¢ƒæƒ³å†é‡æ–°æ¥ä¸€æ¬¡çš„æ—¶å€™ï¼Œå±…ç„¶ä¸€ç›´å†ä¹Ÿæ²¡æœ‰æˆåŠŸè¿‡ðŸ’”ï¼Œç‰¹å°†è¿™æ¬¡è¿‡ç¨‹è®°å½•ä¸€ä¸‹ï¼Œå“ªä½åŒå­¦çŸ¥é“é—®é¢˜æ‰€åœ¨è¿˜æœ›èµæ•™ðŸ™ã€‚ ç»„ç½‘ æˆ‘åªæœ‰ä¸€å°ç¬”è®°æœ¬ï¼Œåªæœ‰å……åˆ†åˆ©ç”¨çŽ°åœ¨æœ‰èµ„æºäº†ï¼ŒWindowså®¹å™¨é›†ç¾¤çš„ç®¡ç†èŠ‚ç‚¹è¿˜æ˜¯å¿…é¡»ç”¨Linuxï¼Œå› æ­¤é‡‡ç”¨è™šæ‹Ÿæœºè¿è¡ŒLinuxç®¡ç†èŠ‚ç‚¹ï¼Œç¬”è®°æœ¬ä½œä¸ºWindowså·¥ä½œèŠ‚ç‚¹ï¼Œå…·ä½“ç»„ç½‘å¦‚ä¸‹ï¼š è½¯ä»¶ç‰ˆæœ¬ Windows 10 Pro 1803 ç®¡ç†èŠ‚ç‚¹ä½¿ç”¨Docker ce 18.09.06ï¼Œå·¥ä½œèŠ‚ç‚¹Docker ee 18.09.06 Docker UCP 2.2.18 Vagrant 2.2.4 å®‰è£… å®‰è£…å‡†å¤‡ å¼€å¯Hyper-Vå’Œå®¹å™¨æ”¯æŒï¼Œåœ¨â€œæŽ§åˆ¶é¢æ¿â€â†’â€œç¨‹åºâ€â†’â€œå¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½â€ä¸­é€‰ä¸­Hyper-Vå’ŒContainersï¼Œç‚¹ç¡®å®šã€‚å¦‚æžœå·²ç»å¼€å¯åˆ™è·³è¿‡æ­¤æ­¥ã€‚ å‡†å¤‡ç®¡ç†èŠ‚ç‚¹ å®‰è£…vagrantï¼Œä¸‹è½½åœ°å€https://releases.hashicorp.com/vagrant/2.2.4/vagrant_2.2.4_x86_64.msi ä½¿ç”¨å®˜æ–¹çš„centos/7è™šæ‹Ÿæœºæ¨¡æ¿å»ºç«‹è™šæ‹Ÿæœºï¼Œæ³¨æ„è¿™é‡Œé€‰æ‹©Hyper-Vé©±åŠ¨ï¼Œå› ä¸ºWindowså®¹å™¨å¿…é¡»ä½¿ç”¨hyper-vè™šæ‹ŸåŒ–ï¼Œè€ŒVirtualBoxçš„è™šæ‹ŸåŒ–æŠ€æœ¯ä¾èµ–vt-xï¼ŒHyper-Vå’Œvt-xæ˜¯å†²çªçš„ï¼Œå¼€å¯Hyper-VåŽä¼šè‡ªåŠ¨å…³é—­vt-xï¼Œå› æ­¤æ— æ³•ä½¿ç”¨VirtualBoxè™šæ‹Ÿæœºã€‚ 12vagrant init centos/7vagrant up --provider=hyperv è¿è¡Œvagrant upä¼šå…ˆä»Žå®˜æ–¹ä¸‹è½½è™šæ‹Ÿæœºæ¨¡æ¿ï¼Œæ­¤è¿‡ç¨‹éœ€è¦ä¸€å®šæ—¶é—´ã€‚ä½¿ç”¨Hyper-VåŽï¼Œvagrantä¹Ÿä¼šæœ‰ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚æ— æ³•é€šè¿‡Vagrantfileè¿›è¡ŒæŸäº›é…ç½®ï¼ŒåŒ…æ‹¬ç½‘ç»œï¼Œå®‰è£…è¿‡ç¨‹éœ€è¦é€‰æ‹©ä½¿ç”¨å“ªä¸ªè™šæ‹Ÿäº¤æ¢æœºï¼Œé€‰æ‹©natï¼ŒåŽç»­åœ¨Hyper-Vç®¡ç†å…¶ä¸­è¿˜å¯ä»¥ä¿®æ”¹ï¼š default: to create a new virtual switch. default: default: 1) Default Switch default: 2) nat default: default: What switch would you like to use? è™šæ‹Ÿæœºé…ç½®æˆé™æ€ip åŸºç¡€è™šæ‹Ÿæœºæ²¡æœ‰å®‰è£…ifconfigï¼Œå®‰è£…ä¸€ä¸‹ifconfigï¼š 1sudo yum install net-tools.x86_64 å‰é¢è™šæ‹Ÿæœºé€‰æ‹©äº†é»˜è®¤çš„å†…éƒ¨äº¤æ¢æœºnatï¼Œå…¶ä¸­å†…ç½®çš„DHCHåˆ†é…çš„ipæ˜¯172.16.0.0/16ï¼Œä¸ºé¿å…ipåœ°å€å˜åŒ–ï¼Œæœ€å¥½é…ç½®æˆé™æ€ipï¼ŒåŽç»­å®‰è£…Docker UCPéœ€è¦è¿™ä¸ªipï¼š é¦–å…ˆå°†è™šæ‹Ÿäº¤æ¢æœºnatçš„ipæ”¹æˆé™æ€192.168.10.1 ç„¶åŽä¿®æ”¹è™šæ‹Ÿæœºçš„ipä¸º192.168.10.10ï¼Œç½‘å…³ä¸º192.168.10.1 å®‰è£…docker ce 1234567$ sudo yum install -y yum-utils \ device-mapper-persistent-data \ lvm2$ sudo yum-config-manager \ --add-repo \ https://download.docker.com/linux/centos/docker-ce.repo$ sudo yum install docker-ce docker-ce-cli containerd.io å¯åŠ¨docker 12$ sudo systemctl start docker$ sudo docker run hello-world å‡†å¤‡å·¥ä½œèŠ‚ç‚¹ ä¸‹è½½dockerï¼Œåœ°å€https://download.docker.com/components/engine/windows-server/18.09/docker-18.09.6.zip è§£åŽ‹åˆ°D:\dockerï¼Œå®‰è£…æˆWindowsæœåŠ¡123dockerd --register-serviceStart-Service dockerdocker container run hello-world:nanoserver å®‰è£…Dockers UCP å®‰è£…ç®¡ç†èŠ‚ç‚¹ 123456vagrant sshdocker container run --rm -it --name ucp \ -v /var/run/docker.sock:/var/run/docker.sock \ docker/ucp:2.2.18 install \ --host-address 192.168.10.10 \ --interactive ä¸Šè¿°è¿‡ç¨‹ä¼šå…ˆæ‹‰å–docker/ucp:2.2.18é•œåƒï¼Œéœ€è¦ä¸€å®šæ—¶é—´ï¼Œç„¶åŽæ ¹æ®äº¤äº’æç¤ºä¸€æ­¥æ­¥è¿›è¡Œå®‰è£…ã€‚ å®‰è£…å·¥ä½œèŠ‚ç‚¹ è®¾ç½®é˜²ç«å¢™ç­–ç•¥ç­‰ 123$script = [ScriptBlock]::Create((docker run --rm docker/ucp-agent-win:2.2.18 windows-script | Out-String))Invoke-Command $script ä¸Šè¿°è¿‡ç¨‹ä¼šå…ˆæ‹‰å–docker/ucp-agent-win:2.2.18é•œåƒï¼Œéœ€è¦ä¸€å®šæ—¶é—´ã€‚ ä¿®æ”¹daemon.json å¢žåŠ &quot;labels&quot;: [â€œos=windowsâ€] éªŒè¯Docker UCPå‰ç«¯ç•Œé¢ï¼šhttps://192.168.10.10 å·¥ä½œèŠ‚ç‚¹æŽ¥å…¥é›†ç¾¤ é€šè¿‡Dockers UCPç•Œé¢ä¸Šå¯ä»¥å¾—åˆ°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ç™»å½•åˆ°ç®¡ç†èŠ‚ç‚¹ä¸Šé€šè¿‡å‘½ä»¤è¡Œå¾—åˆ°ã€‚åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œä¸Šè¿°å‘½ä»¤ï¼Œå°±åŠ å…¥åˆ°é›†ç¾¤ã€‚å†å›žåˆ°Dockers UCPç•Œé¢ä¸Šå°±å¯ä»¥çœ‹åˆ°å·¥ä½œèŠ‚ç‚¹åŠ å…¥è¿›æ¥ã€‚ é—®é¢˜ ä¸Šè¿°æ­å»ºè¿‡ç¨‹è¿˜ç®—é¡ºåˆ©ï¼Œé—®é¢˜å‡ºåœ¨æœ€åŽä¸€æ­¥ï¼Œå·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤åŽï¼Œåœ¨èŠ‚ç‚¹åˆ—è¡¨ä¸­Windowså·¥ä½œèŠ‚ç‚¹çŠ¶æ€æ€»ä¸æ­£å¸¸ï¼ŒåªæˆåŠŸè¿‡ä¸€æ¬¡ï¼Œå·¥ä½œèŠ‚ç‚¹CPUåˆ©ç”¨çŽ‡ç­‰ä¿¡æ¯éƒ½æ˜¾ç¤ºå‡ºæ¥äº†ï¼ŒåŽæ¥å†è¯•å°±ä¸€ç›´å¡åœ¨å¦‚ä¸‹é”™è¯¯ï¼š å¯èƒ½çš„é—®é¢˜åŽŸå› æ˜¯å·¥ä½œèŠ‚ç‚¹å®¹å™¨ç½‘ç»œä¸­æ²¡æœ‰overlayç½‘ç»œï¼Œåœ¨æˆåŠŸçš„é‚£ä¸€æ¬¡ä¸­ï¼Œåœ¨å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤åŽé€šè¿‡docker network lså¯ä»¥çœ‹åˆ°overlayç½‘ç»œï¼Œä½†æ˜¯åŽæ¥å†è¯•å°±æ²¡æœ‰åŒæ­¥åˆ°overlayç½‘ç»œã€‚å¯èƒ½çš„åŽŸå› æ˜¯Default Switchå¯¼è‡´ï¼Œåœ¨æˆåŠŸçš„é‚£ä¸€æ¬¡æˆ‘åˆ é™¤äº†Default Switchï¼Œä½†æ˜¯åŽæ¥å†è¿™æ ·åšï¼Œoverlayç½‘ç»œä»ç„¶ä¸å­˜åœ¨ã€‚ å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤è¿˜é‡åˆ°å¦‚ä¸‹ä¸€äº›é—®é¢˜ï¼š å·¥ä½œèŠ‚ç‚¹è™šæ‹Ÿå†…å­˜è®¾ç½®å¤ªå° {â€œlevelâ€:â€œerrorâ€,â€œmsgâ€:â€œFailed to start proxy. Run â€œdocker logs ucp-proxyâ€ for more detailsâ€,â€œtimeâ€:â€œ2019-05-12T17:18:49+08:00â€} {â€œlevelâ€:â€œfatalâ€,â€œmsgâ€:&quot;unable to reconcile state of Docker Proxy component: Error response from daemon: CreateComputeSystem 1bbffaab2a7609e6b21cdeea0b3b0b11204d86e7629c2 077646119141fcd8682: The paging file is too small for this operation to completen(extra info: {â€œSystemTypeâ€:â€œContainerâ€,â€œNameâ€:&quot;1bbffaab2a7609e6b21cdeea0b3b0b112 è™šæ‹Ÿç½‘å¡è®¾ç½®ä¸ºé™æ€IPåŽè™šæ‹Ÿï¼Œéœ€è¦ä¿ç•™hyper-vç½‘ç»œå†…éƒ¨ipï¼Œå¦åˆ™åœ¨èŠ‚ç‚¹åˆ—è¡¨ä¸­æ˜¾ç¤ºå¦‚ä¸‹é”™è¯¯ä¿¡æ¯: This Windows node cannot connect to its local Docker daemon. Make sure the Docker daemon is set up correctly on that node. See https://www.docker.com/ddc-34 for more information. åº”è¯¥å¦‚ä¸‹è®¾ç½®ï¼š MTUé—®é¢˜ï¼Œåœ¨å¦‚ä¸‹caseä¸­æåˆ°MTUé—®é¢˜ï¼Œä¸ç¡®å®šæ˜¯å¦åœ¨æˆ‘é‡åˆ°çš„é—®é¢˜ä¸­èµ·åˆ°ä½œç”¨ å‚è€ƒ:https://success.docker.com/article/newly-added-windows-node-reports-awaiting-healthy-status-in-classic-node-inventory ç»è¿‡å¤šæ¬¡æŠ˜è…¾ä¹‹åŽï¼Œwindowså¯åŠ¨dockerdæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š Error starting daemon: Error initializing network controller: Error creating default network: hnsCall failed in Win32: A network with this name already exists. (0x803b0010) è§£å†³æ–¹æ³•æ˜¯æ‰§è¡Œäº†ï¼Œå·²ç»æ²¡æœ‰å¿ƒæ€ç»†ç©¶æ ¹æºäº†ï¼š 1netcfg -d]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docer</tag>
        <tag>docker ucp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨github pageså’Œhexoæ­å»ºä¸ªäººåšå®¢]]></title>
    <url>%2F2019%2F06%2F01%2F005-build-blog-with-hexo%2F</url>
    <content type="text"><![CDATA[è¿™åˆæ˜¯ä¸€ç¯‡å¦‚ä½•ä½¿ç”¨github pageså’Œhexoæ­å»ºä¸ªäººåšå®¢çš„æ–‡ç« ï¼Œæ˜¯çš„ï¼Œç½‘ç»œä¸Šå·²ç»æœ‰æ— æ•°è¿™ç±»æ–‡ç« ï¼Œæ‰€ä»¥æˆ‘ä¸å‡†å¤‡è¯¦ç»†è®°å½•æ¯ä¸€ä¸ªæ­¥éª¤ï¼Œå¯¹äºŽç½‘ç»œä¸Šå·²ç»æœ‰çš„ï¼Œæˆ‘åªåˆ—å‡ºå‚è€ƒçš„æ–‡ç« ã€‚æœ¬æ–‡ç€é‡é€‰æ‹©å»ºç«‹ä¸€ä¸ªä¸ªäººåšå®¢æœ€å®žç”¨ï¼Œæœ€éœ€è¦çš„é…ç½®ä¿®æ”¹ï¼Œhexoçš„æ‰©å±•æ€§æ˜¯éžå¸¸å‡ºè‰²çš„ï¼Œå®Œå…¨å¯ä»¥å®šåˆ¶å‡ºéžå¸¸é…·ç‚«çš„å„ç§æ•ˆæžœï¼Œè¿™ç±»ä¿®æ”¹æœ¬æ–‡å¹¶ä¸æ¶‰åŠã€‚å¦å¤–ç½‘ç»œä¸Šçš„ä¸€äº›æ–‡ç« å·²ç»æ¯”è¾ƒé™ˆæ—§ï¼Œå®Œå…¨å‚ç…§å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæœ¬æ–‡è¿›è¡Œäº†ä¸€äº›è¡¥å……ã€‚å¦‚æžœä½ æ­£åœ¨å‡†å¤‡æ­å»ºä¸€ä¸ªä¸ªäººåšå®¢ï¼Œæœ¬æ–‡åº”è¯¥å¯ä»¥å¸®åŠ©ä½ ï¼Œä¸éœ€è¦åœ¨ç½‘ç»œä¸Šå„ç§æ–‡ç« ä¸­è‹¦è‹¦å¯»æ‰¾éªŒè¯ã€‚å½“ç„¶ï¼Œä¸»è¦è¿˜æ˜¯è¦æ„Ÿè°¢ç½‘ç»œä¸Šä¹äºŽåˆ†äº«çš„äººä»¬ï¼Œæ­£æ˜¯åœ¨ä»–ä»¬çš„æˆæžœä¹‹ä¸Šï¼Œæ‰èƒ½æœ‰æœ¬åšå®¢ï¼Œä¹Ÿæ¬¢è¿Žå¤§å®¶å¸¸æ¥é€›é€›ï¼šhttp://zhongpan.techã€‚ ä½¿ç”¨github pageså»ºç«‹ä¸ªäººåšå®¢ githubä¸ºå¼€å‘è€…æä¾›äº†åŸºäºŽgitç‰ˆæœ¬ç®¡ç†çš„ä»£ç å’Œå†…å®¹çš„æ‰˜ç®¡æœåŠ¡ï¼Œä»–åŒæ—¶æä¾›äº†github pagesåŠŸèƒ½ï¼Œå…è®¸å¼€å‘è€…å»ºç«‹ä¸ªäººç½‘é¡µï¼Œå¹¶æä¾›äº†ä¸€ç³»åˆ—å»ºç«™æ¨¡æ¿ï¼Œä»¥åŠå½¢å¦‚xxx.github.ioçš„äºŒçº§åŸŸåï¼Œå…¶ä¸­xxxä¸ºgithubè´¦å·åï¼Œå»ºç«‹github pagesçš„è¿‡ç¨‹å’Œå»ºç«‹ä»“åº“çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯ä»“åº“åæ€»æ˜¯xxx.github.ioï¼Œè¿™æ ·å°±å¯ç”¨github pagesäº†ã€‚å…·ä½“å¯å‚è€ƒ[1]ï¼Œå…³äºŽgit ssh keyé…ç½®å¯å‚è€ƒ[2]ï¼Œå…³äºŽå¦‚ä½•ç»‘å®šè‡ªå·±çš„åŸŸåå‚è€ƒ[3]ï¼Œå…¶ä¸­æåˆ°ä¸»æœºè®°å½•@çš„è®°å½•å€¼åŽè¦åŠ ä¸€ä¸ª.ï¼Œç»è¿‡éªŒè¯å…¶å®žæ˜¯ä¸éœ€è¦çš„ï¼Œæˆ‘æ˜¯ä½¿ç”¨çš„é˜¿é‡Œäº‘åŸŸåæœåŠ¡ã€‚ github pagesä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ï¼Œåªèƒ½æ‰˜ç®¡é™æ€é¡µé¢ï¼Œæ— æ³•è¿è¡ŒåŽç«¯æœåŠ¡ï¼Œä¹Ÿå°±ä¸èƒ½è¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“å’Œè·¯ç”±ã€‚å¯¹äºŽå»ºç«‹å¤æ‚çš„ä¸ªäººç½‘ç«™è¿˜æ˜¯æœ€å¥½ä½¿ç”¨äº‘ä¸»æœºï¼Œå¯¹äºŽå»ºç«‹ç›¸å¯¹ç®€å•çš„ä¸ªäººåšå®¢ï¼Œä½¿ç”¨github pagesè¿˜æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œå¯¹é¡µé¢çš„ç®¡ç†å’Œç®¡ç†gitä»£ç ç±»ä¼¼ï¼Œå¼€å‘è€…ä¼šéžå¸¸äº²åˆ‡ã€‚ ä½¿ç”¨hexoç®¡ç†åšå®¢ å‰é¢å·²ç»æåˆ°github pagesåªèƒ½æ‰˜ç®¡é™æ€é¡µé¢ï¼Œä¸€èˆ¬çš„ä¸ªäººåšå®¢éœ€è¦æä¾›æ ‡ç­¾ã€åˆ†ç±»ç­‰åŠŸèƒ½ï¼Œé€šè¿‡æ‰‹å·¥åŽ»ç¼–è¾‘é™æ€é¡µé¢æ˜¯éžå¸¸ä¸æ–¹ä¾¿çš„ã€‚å› æ­¤å°±äº§ç”Ÿäº†hexoè¿™æ ·çš„é¡¹ç›®ï¼Œhexoæ˜¯ä½¿ç”¨node.jsç¼–å†™çš„ï¼Œç”¨äºŽå°†ç”¨æˆ·ç¼–å†™çš„é¡µé¢è½¬æ¢æˆç½‘ç«™é™æ€é¡µé¢ï¼Œä¸ä»…å¦‚æ­¤ï¼Œå®ƒè¿˜æä¾›äº†ä¸°å¯Œçš„æ’ä»¶å’Œä¸»é¢˜ï¼Œå®žçŽ°å„ç§å®¢æœç«¯ç½‘é¡µåŠŸèƒ½ï¼Œæ¯”å¦‚è¯„è®ºã€åˆ†äº«ç­‰ç­‰ã€‚æœ¬åšå®¢ä½¿ç”¨äº†Hexo v3.9.0è¿›è¡Œç®¡ç†ï¼Œå…·ä½“å®‰è£…æ­¥éª¤å‚è€ƒ[1]ã€‚hexoåˆæ¬¡ä½¿ç”¨å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é—®é¢˜ï¼š é€šè¿‡gitä¸Šä¼ ï¼Œé™¤äº†ä¿®æ”¹ç«™ç‚¹çš„_config.ymlçš„deployå±žæ€§ï¼Œæ³¨æ„è¿˜éœ€è¦å®‰è£…hexo-deployer-gitæ’ä»¶ï¼š 1npm i hexo-deployer-git --save æ¯æ¬¡é‡æ–°ä¸Šä¼ åŽä¼šåˆ æŽ‰github pagesä¸Šçš„CNAMEã€README.mdæ–‡ä»¶ï¼šå¯å‚è€ƒ[4]è§£å†³ã€‚ å¦‚ä½•ä½¿ç”¨å›¾ç‰‡ï¼šå¯å‚è€ƒ[5]ã€‚ æ³¨æ„å›¾ç‰‡åä¸­ä¸èƒ½åŒ…å«ç©ºæ ¼ï¼Œå¦åˆ™å›¾ç‰‡æ— æ³•æ˜¾ç¤º æ³¨æ„å¦‚æžœä½¿ç”¨äº†hexo-image-assertæ’ä»¶ï¼Œå°±ä¸è¦ç”¨asset_imgæ ‡ç­¾ï¼Œæ€»æ˜¯ç”¨markdownè¯­æ³•ï¼Œå¦åˆ™å›¾ç‰‡æ˜¾ç¤ºä¸äº†ï¼Œè½¬æ¢ç”Ÿæˆçš„htmlä¸­çš„imageè·¯å¾„ä¼¼ä¹Žè¿›è¡Œäº†ä¸¤æ¬¡è½¬æ¢ï¼Œå¯¼è‡´è·¯å¾„ä¸å¯¹ å¦‚ä½•æ·»åŠ é˜…è¯»å…¨æ–‡ï¼šå¯å‚è€ƒ[6]ã€‚ ç®€å•æ€»ç»“ä¸€ä¸‹hexoçš„åŠŸèƒ½ï¼š é¡µé¢åˆ†postã€pageå’Œdraftä¸‰ç§ï¼Œhexoä¸­ç§°ä¸ºlayoutï¼Œpostå°±æ˜¯åšå®¢æ–‡ç« ï¼Œä½äºŽsource/_postsç›®å½•ä¸‹ï¼Œpageæ˜¯ç‹¬ç«‹çš„é¡µé¢ï¼Œä½äºŽsourceç›®å½•ä¸‹åŒåç›®å½•ï¼Œdraftæ˜¯åšå®¢è‰ç¨¿ï¼Œä½äºŽsource/_draftsç›®å½•ä¸‹ï¼Œè‰ç¨¿å®ŒæˆåŽé€šè¿‡hexo publishå‘½ä»¤è‡ªåŠ¨å‘å¸ƒåˆ°postä¸­ã€‚hexoå†…ç½®æ”¯æŒä¸€äº›ç‰¹æ®Šç”¨é€”é¡µé¢ï¼Œå¦‚æ ‡ç­¾ã€åˆ†ç±»ã€å­˜æ¡£ï¼Œå¯¹postè¿›è¡Œå½’ç±»ï¼Œå¦‚æ ‡ç­¾é¡µé¢ï¼Œåœ¨Front-matterä¸­å®šä¹‰typeå±žæ€§ä¸ºtagsï¼š 123456---title: tagsdate: 2019-06-21 10:15:51type: "tags"comments: false--- ç„¶åŽåœ¨postä¸­ä½¿ç”¨ä¸Šè¿°typeï¼Œä¾‹å¦‚: 123456---title: ä½¿ç”¨github pageå’Œhexoæ­å»ºä¸ªäººåšå®¢é—®é¢˜æ€»ç»“date: 2019-06-01 11:03:06tags: - hexo--- é¡µé¢éƒ½æ˜¯ä½¿ç”¨markdownç¼–å†™ï¼Œæ‰§è¡Œhexo gåŽä¼šè½¬æ¢æˆhtmlï¼Œæ”¾åˆ°publicç›®å½•ä¸‹ï¼Œæœ€åŽä¸Šä¼ åˆ°githubçš„å°±æ˜¯publicç›®å½•ä¸‹çš„å†…å®¹ã€‚ å¯¹äºŽä¸Šè¿°æ ‡ç­¾ã€åˆ†ç±»ç­‰é¡µé¢ï¼Œhexoä¼šè‡ªåŠ¨ç”Ÿæˆé™æ€é¡µé¢ï¼Œå…¶ä¸­åŒ…å«ç›¸åº”çš„åšå®¢æ–‡ç« é“¾æŽ¥ï¼Œè§‚å¯Ÿä¸€ä¸‹publicä¸‹çš„ç›®å½•ç»“æž„å°±ä¼šå‘çŽ°è¿™ä¸€ç‚¹ã€‚è¿™æ˜¯é€šè¿‡hexo-generator-tagã€hexo-generator-categoryç­‰æ’ä»¶å®žçŽ°çš„ã€‚ ç½‘ç«™çš„æœ€ç»ˆå‘ˆçŽ°æ•ˆæžœéƒ½æ˜¯é€šè¿‡ä¸»é¢˜å®žçŽ°çš„ï¼Œhexoé»˜è®¤çš„ä¸»é¢˜æ˜¯landscapeï¼Œè¿˜æœ‰ä¼—å¤šçš„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œä¸»é¢˜ä¸»è¦ä½¿ç”¨æ¨¡æ¿æŠ€æœ¯ç”Ÿæˆæœ€ç»ˆçš„é™æ€é¡µé¢ï¼Œå¦‚swigã€ejsã€jadeç­‰ï¼Œç›¸åº”çš„éœ€è¦å®‰è£…å¯¹åº”çš„æ’ä»¶ï¼Œå¦‚hexo-renderer-jadeï¼Œejsæ˜¯é»˜è®¤çš„ã€‚ é…ç½®Hexo-NexTä¸»é¢˜ hexoé»˜è®¤çš„ä¸»é¢˜landscapeéš¾ä»¥å®Œå…¨æ»¡è¶³ä¸ªäººåšå®¢éœ€æ±‚ï¼Œè¯•ç”¨äº†å‡ æ¬¾ä¸»é¢˜ä¹‹åŽï¼Œæœ€ç»ˆæˆ‘é€‰æ‹©äº†NexT.Mist v7.1.2ï¼Œå®ƒçš„åŠŸèƒ½éžå¸¸ä¸°å¯Œï¼Œå®‰è£…é…ç½®å¯å‚è€ƒ[7]ï¼Œå‚è€ƒä¸Šè¿°æ–‡ç« ï¼Œæœ¬åšå®¢ä¸»è¦åšäº†å¦‚ä¸‹ä¿®æ”¹ï¼Œä¿®æ”¹è¿‡ç¨‹ä¸­å‘çŽ°ä¸Šè¿°æ–‡ç« æœ‰äº›å†…å®¹å·²ç»è¿‡æ—¶ï¼š ä¿®æ”¹åº•éƒ¨æ ‡ç­¾æ ·å¼ï¼šä¸éœ€è¦ä¿®æ”¹Blog\themes\next\layout\_macro\post.swigäº†ï¼Œä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶_config.ymlå³å¯ï¼› 1tag_icon: true å¯ç”¨canvas_neståŠ¨ç”»ï¼šæ³¨æ„é¦–å…ˆéœ€è¦å‚ç…§https://github.com/theme-next/theme-next-canvas-nestä¸­è¯´æ˜Žå®‰è£…canvas-neståº“ï¼› å¢žåŠ åˆ†ç±»å’Œæ ‡ç­¾é¡µé¢ ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæžœ å¢žåŠ å­—æ•°å’Œé˜…è¯»æ—¶é•¿ç»Ÿè®¡ï¼šæ³¨æ„å…ˆå‚ç…§https://github.com/theme-next/hexo-symbols-count-timeä¸­è¯´æ˜Žå®‰è£…symbols-count-timeåº“ï¼Œç„¶åŽä¿®æ”¹ç«™ç‚¹çš„_config.yml(æ³¨æ„ä¸æ˜¯ä¸»é¢˜çš„)ï¼Œå¢žåŠ ï¼š 123456symbols_count_time: symbols: true time: true total_symbols: true total_time: true exclude_codeblock: false å¢žåŠ è®¿å®¢æ•°å’Œè®¿é—®é‡ç»Ÿè®¡ï¼šnextä¸»é¢˜å·²ç»æ”¯æŒbusuanziï¼Œç›´æŽ¥å¼€å¯å³å¯ï¼› å¢žåŠ è¯„è®ºåŠŸèƒ½ å¢žåŠ åˆ†äº«åŠŸèƒ½ï¼šnextå·²ç»ä¸æ”¯æŒjiathisï¼Œæœ¬åšå®¢é€‰æ‹©äº†needmoreshare2ï¼Œç›´æŽ¥å¼€å¯å³å¯ï¼› å¢žåŠ ç«™å†…æœç´¢åŠŸèƒ½ åœ¨æ–‡ç« æœ«å°¾æ·»åŠ â€œæ–‡ç« ç»“æŸâ€æ ‡è®°ï¼šå›¾æ ‡æ¢äº†ä¸€ä¸‹ ä¾§è¾¹æ ç¤¾äº¤å°å›¾æ ‡è®¾ç½® åº•éƒ¨éšè—ç”±Hexoå¼ºåŠ›é©±åŠ¨ã€ä¸»é¢˜â€“NexT.Mist åº•éƒ¨ç”¨æˆ·å›¾æ ‡æ¢æˆæ¡ƒå¿ƒ è®¾ç½®å¤´åƒï¼šæ²¡æœ‰è®¾ç½®åŠ¨ç”»æ•ˆæžœ æ·»åŠ ç‰ˆæƒä¿¡æ¯ï¼šnextå·²ç»æ”¯æŒï¼Œåœ¨creative_commonsè¿™ä¸ªéƒ¨åˆ†ï¼Œé€‰æ‹©åˆé€‚çš„licenseå³å¯ã€‚ æ·»åŠ ç½‘é¡µé¡¶éƒ¨è¿›åº¦åŠ è½½æ¡ å¦å¤–è¿˜å¢žåŠ äº†ï¼š å¼€å¯é˜…è¯»è¿›åº¦ï¼šå‚ç…§https://github.com/theme-next/theme-next-reading-progresså®‰è£…theme-next-reading-progressï¼›ä¿®æ”¹ä¸»é¢˜çš„_config.ymlï¼Œå°†reading_progressçš„enableç½®ä¸ºtrueï¼› 1234reading_progress: enable: true color: "#37c6c0" height: 2px å…¶æ•ˆæžœæ˜¯åœ¨æ–‡ç« é¡¶éƒ¨å¢žåŠ ä¸€ä¸ªè¿›åº¦æ¡æ˜¾ç¤ºé˜…è¯»è¿›åº¦ã€‚ å¼€å¯ä¹¦ç­¾ï¼šå‚ç…§https://github.com/theme-next/theme-next-bookmarkå®‰è£…theme-next-bookmarkï¼›ä¿®æ”¹ä¸»é¢˜çš„_config.ymlï¼Œå°†bookmarkçš„enableç½®ä¸ºtrueï¼› 12345bookmark: enable: true # If auto, save the reading position when closing the page or clicking the bookmark-icon. # If manual, only save it by clicking the bookmark-icon. save: auto åœ¨ä½¿ç”¨hextä¸»é¢˜æ—¶é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š postä¸­æ ‡é¢˜çº§åˆ«å¿…é¡»è¿žç»­ï¼Œå¦åˆ™postçš„tocå‡ºçŽ°å¥‡æ€ªçš„é”™ä¹±é—®é¢˜ï¼š ä¾‹å¦‚postä¸­ç¬¬ä¸€å±‚ç”¨h1ï¼Œç¬¬äºŒå±‚ç”¨h3ï¼Œtocå°±ä¼šè¿™æ ·ï¼š æ”¹ä¸ºç¬¬ä¸€å±‚ç”¨h1ï¼Œç¬¬äºŒå±‚ç”¨h2ï¼Œä¿æŒè¿žç»­ï¼Œtocå°±æ­£å¸¸äº†ï¼š markdownç¼–è¾‘å·¥å…· æœ€åŽå»ºè®®æ‰¾ä¸€æ¬¾åˆé€‚çš„markdownç¼–è¾‘å·¥å…·ï¼Œæˆ‘æ˜¯ä½¿ç”¨çš„Typoraï¼Œè‡³æ­¤å»ºç«‹åšå®¢çš„å„é¡¹å‡†å¤‡å®Œå…¨å°±ç»ªäº†ï¼ŒæŽ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«çš„ä¹¦å†™äº†ï¼ŒTyporaå’Œhexoé…åˆä½¿ç”¨ä¼šé‡åˆ°å¦‚ä¸‹é—®é¢˜ï¼š å›¾ç‰‡åœ¨typoraä¸­æ˜¾ç¤ºé—®é¢˜ å‰é¢ä»‹ç»è¿‡åœ¨hexoæ’å…¥å›¾ç‰‡æŽ¨èä½¿ç”¨hexo-asset-imageæ’ä»¶çš„æ–¹æ³•ï¼Œè¿™æ—¶å›¾ç‰‡æ˜¯æ”¾åœ¨poståŒåçš„ç›®å½•ä¸­ï¼Œè€Œhexoçš„markdownä¸­å¼•ç”¨å›¾ç‰‡å¹¶æ²¡æœ‰åŠ ä¸Šç›®å½•åï¼Œè¿™æ ·åœ¨typoraä¸­å°±æ˜¾ç¤ºä¸äº†å›¾ç‰‡ã€‚è§£å†³æ–¹æ³•å‚è€ƒ[8]ï¼Œç»è¿‡æˆ‘çš„éªŒè¯ï¼Œå¯è¡Œæ–¹æ³•å¦‚ä¸‹ï¼Œå…¶ä¸­xxxxxxä¸ºpoståï¼š åœ¨Front-matterä¸­åŠ å…¥typora-copy-images-toæˆ–è€…åœ¨typoraå…¨å±€åå¥½è®¾ç½®ä¸­è®¾ç½®ï¼Œå…¶ä¸­xxxxxxä¸ºpostå 1typora-copy-images-to: xxxxxx æˆ–è€…å¦‚ä¸‹å›¾åœ¨typoraè®¾ç½®ï¼š åœ¨Front-matterä¸­åŠ å…¥typora-root-urlï¼Œå¦åˆ™markdownä¸­ä¼šå¸¦æœ‰ç›®å½•åxxxxxxï¼Œè¿™æ—¶åœ¨typoraä¸­å¯ä»¥æ˜¾ç¤ºå›¾ç‰‡ï¼Œä½†æ˜¯hexoä¸­ä¸èƒ½ 1typora-root-url: xxxxxx è¿›è¡Œä¸Šè¿°ä¿®æ”¹åŽï¼Œåœ¨typoraä¸­å¤åˆ¶ç²˜è´´æˆ–æ’å…¥æœ¬åœ°å›¾ç‰‡åŽï¼Œtyporaä¼šè‡ªåŠ¨æ”¾åˆ°xxxxxxç›®å½•ä¸‹ï¼Œå¹¶ç”Ÿæˆmarkdownå¦‚ä¸‹ï¼š 1![name](/name.png) è¿™é‡Œè¿˜æ˜¯æœ‰ä¸€ç‚¹é—®é¢˜ï¼Œå°±æ˜¯è·¯å¾„å‰é¢æœ‰ä¸€ä¸ª/ï¼Œåœ¨typoraä¸­æ˜¾ç¤ºæ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯åœ¨hexoä¸­æ— æ³•æ˜¾ç¤ºå›¾ç‰‡ï¼Œéœ€è¦åˆ é™¤/ã€‚ hexoè½¬æ¢åŽçš„æ˜¾ç¤ºæ•ˆæžœå¹¶éžå’Œtyporaä¸€æ ·ï¼Œç›®å‰ç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯å¯¹Reference-style linksè½¬æ¢åŽï¼Œå¼•ç”¨çš„é“¾æŽ¥åˆ—è¡¨å¹¶æ²¡æœ‰æ˜¾ç¤ºï¼Œè€Œåœ¨typoraä¸­æ˜¯æ˜¾ç¤ºçš„ã€‚æ‰€ä»¥åŽæ¥åªæœ‰æ¢æˆäº†Footnotesã€‚typoraä¸­å¯¹å¼•ç”¨çš„é“¾æŽ¥åˆ—è¡¨æ˜¾ç¤ºæ•ˆæžœå¦‚ä¸‹ï¼› æ”¯æŒemojiè¡¨æƒ… hexoé»˜è®¤çš„markdownæ¸²æŸ“å™¨æ˜¯ä¸æ”¯æŒemojiçš„ï¼Œå¯ä»¥ä½¿ç”¨emojiç›¸å…³æ’ä»¶æˆ–è€…æ›´æ¢markdownè½¬æ¢å™¨ï¼Œæˆ‘æ˜¯é€‰æ‹©çš„æ›´æ¢markdownè½¬æ¢å™¨ï¼Œå…·ä½“å¯å‚è€ƒ[9]ã€‚é™¤äº†emojiï¼Œæˆ‘è¿˜ç”¨åˆ°äº†å®ƒçš„FootnoteåŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘è¿˜å®‰è£…äº† footnoteæ’ä»¶ï¼Œå¦‚éœ€å…¶ä»–æ’ä»¶ï¼ŒåŒæ ·éœ€è¦å…ˆå®‰è£…ï¼š 1234npm un hexo-renderer-marked --savenpm i hexo-renderer-markdown-it --savenpm install markdown-it-emoji --savenpm install markdown-it-footnote --save å¦å¤–å…¶é…ç½®æ–‡ä»¶ï¼Œæˆ‘å°†permalinkç½®ä¸ºfalseäº†ï¼š 1234567891011121314151617181920markdown: render: html: true xhtmlOut: false breaks: true linkify: true typographer: true quotes: 'â€œâ€â€˜â€™' plugins: - markdown-it-footnote #- markdown-it-sup #- markdown-it-sub #- markdown-it-abbr - markdown-it-emoji anchors: level: 2 collisionSuffix: 'v' permalink: false permalinkClass: header-anchor permalinkSymbol: Â¶ å‚è€ƒæ–‡ç«  ç»é…ï¼šhexo+nextä¸»é¢˜åŠæˆ‘èµ°è¿‡çš„å‘ â†© â†© git ssh keyé…ç½® â†© ç»‘å®šåŸŸååˆ° GitHub Pages â†© é¿å…read.meï¼ŒCNAMEæ–‡ä»¶çš„è¦†ç›–ï¼Œæ‰‹åŠ¨æ”¹github pageçš„åŸŸå â†© Hexoä¸­æ·»åŠ æœ¬åœ°å›¾ç‰‡ â†© Hexo-è®¾ç½®é˜…è¯»å…¨æ–‡ â†© Hexo-NexTé…ç½®è¶…ç‚«ç½‘é¡µæ•ˆæžœ â†© hexoä¸Žtyporaç»“åˆ â†© Hexo NexT å¼€å¯ emoji â†©]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>github pages</tag>
        <tag>hexo</tag>
        <tag>typora</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£å…­è¾¹å½¢æž¶æž„]]></title>
    <url>%2F2017%2F09%2F28%2F004-understanding-of-hexagonal-architecture%2F</url>
    <content type="text"><![CDATA[å…­è¾¹å½¢æž¶æž„æˆ–å…­è§’æž¶æž„æ˜¯Alistair Cockburnåœ¨2005å¹´æå‡ºï¼Œè§£å†³äº†ä¼ ç»Ÿçš„åˆ†å±‚æž¶æž„æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œå®žé™…ä¸Šå®ƒä¹Ÿæ˜¯ä¸€ç§åˆ†å±‚æž¶æž„ï¼Œåªä¸è¿‡ä¸æ˜¯ä¸Šä¸‹æˆ–å·¦å³ï¼Œè€Œæ˜¯å˜æˆäº†å†…éƒ¨å’Œå¤–éƒ¨ã€‚åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰å’Œå¾®æœåŠ¡æž¶æž„ä¸­éƒ½å‡ºçŽ°äº†å…­è¾¹å½¢æž¶æž„çš„èº«å½±ï¼Œåœ¨ã€Šå®žçŽ°é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹ä¸€ä¹¦ä¸­ï¼Œä½œè€…å°†å…­è¾¹å½¢æž¶æž„åº”ç”¨åˆ°é¢†åŸŸé©±åŠ¨è®¾è®¡çš„å®žçŽ°ï¼Œå…­è¾¹å½¢çš„å†…éƒ¨ä»£è¡¨äº†applicationå’Œdomainå±‚ï¼Œè€Œåœ¨Chris Richardsonå¯¹å¾®æœåŠ¡æž¶æž„æ¨¡å¼çš„å®šä¹‰ä¸­ï¼Œæ¯ä¸ªå¾®æœåŠ¡ä½¿ç”¨å…­è¾¹å½¢æž¶æž„è®¾è®¡ï¼Œè¶³è§å…­è¾¹å½¢æž¶æž„çš„é‡è¦æ€§ã€‚é‚£ä¹ˆè®©æˆ‘ä»¬ä¸€æŽ¢ç©¶ç«Ÿï¼Œå®ƒä¸ºä½•å¦‚æ­¤å—é’çã€‚ é—®é¢˜ ä¼ ç»Ÿçš„åˆ†å±‚æž¶æž„å…·æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œä¾‹å¦‚ç»å…¸çš„ä¸‰å±‚æž¶æž„ï¼ŒæŠŠç³»ç»Ÿåˆ†ä¸ºè¡¨ç¤ºå±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®è®¿é—®å±‚ã€‚åœ¨Martin Fowlerçš„ã€Šä¼ä¸šåº”ç”¨æž¶æž„æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­åšè¿‡æ·±å…¥é˜è¿°ï¼Œæœ¬ä¹¦04å¹´å‡ºç‰ˆï¼Œæ—¶è‡³ä»Šæ—¥åˆ†å±‚æž¶æž„ä»ç„¶æ˜¯å¸¸ç”¨çš„è®¾è®¡æ–¹æ³•ï¼Œåˆ†å±‚æž¶æž„å¯ä»¥é™ä½Žè€¦åˆã€æé«˜å¤ç”¨ã€åˆ†è€Œæ²»ä¹‹ï¼Œä½†åŒæ—¶ä¹Ÿè¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š åº”ç”¨é€»è¾‘åœ¨ä¸åŒå±‚æ³„éœ²ï¼Œå¯¼è‡´æ›¿æ¢æŸä¸€å±‚å˜å¾—å›°éš¾ã€éš¾ä»¥å¯¹æ ¸å¿ƒé€»è¾‘å®Œæ•´æµ‹è¯•ï¼šä½ æ˜¯å¦æœ‰è¿‡å›°æƒ‘ï¼Œä»£ç åˆ°åº•åº”è¯¥æ”¾åœ¨å“ªä¸ªå±‚ï¼Œè™½ç„¶å®šä¹‰äº†å„å±‚çš„èŒè´£ï¼Œä½†æ˜¯æ€»æœ‰äººä¸ä¸¥æ ¼éµå¾ªå±‚æ¬¡çš„åˆ†ç•Œï¼Œå¯¹äºŽä¸‰å±‚æž¶æž„ï¼Œå¸¸å¸¸ä¼šå‡ºçŽ°ä¸šåŠ¡é€»è¾‘å†™åœ¨äº†è¡¨ç¤ºå±‚ï¼Œæˆ–è€…ä¸šåŠ¡é€»è¾‘ç›´æŽ¥å’Œæ•°æ®è®¿é—®ç»‘å®šã€‚ ä¼ ç»Ÿçš„åˆ†å±‚æž¶æž„æ˜¯ä¸€ç»´çš„ç»“æž„ï¼Œæœ‰æ—¶åº”ç”¨ä¸å…‰æ˜¯ä¸Šä¸‹çš„ä¾èµ–ï¼Œå¯èƒ½æ˜¯å¤šç»´çš„ä¾èµ–ï¼Œè¿™æ—¶ä¸€ç»´çš„ç»“æž„å°±æ— æ³•é€‚åº”äº†ã€‚ æž¶æž„è¯´æ˜Ž å…­è¾¹å½¢æž¶æž„åˆç§°ä¸ºç«¯å£-é€‚é…å™¨ï¼Œè¿™ä¸ªåå­—æ›´å®¹å™¨ç†è§£ã€‚å…­è¾¹å½¢æž¶æž„å°†ç³»ç»Ÿåˆ†ä¸ºå†…éƒ¨ï¼ˆå†…éƒ¨å…­è¾¹å½¢ï¼‰å’Œå¤–éƒ¨ï¼Œå†…éƒ¨ä»£è¡¨äº†åº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤–éƒ¨ä»£è¡¨åº”ç”¨çš„é©±åŠ¨é€»è¾‘ã€åŸºç¡€è®¾æ–½æˆ–å…¶ä»–åº”ç”¨ã€‚å†…éƒ¨é€šè¿‡ç«¯å£å’Œå¤–éƒ¨ç³»ç»Ÿé€šä¿¡ï¼Œç«¯å£ä»£è¡¨äº†ä¸€å®šåè®®ï¼Œä»¥APIå‘ˆçŽ°ã€‚ä¸€ä¸ªç«¯å£å¯èƒ½å¯¹åº”å¤šä¸ªå¤–éƒ¨ç³»ç»Ÿï¼Œä¸åŒçš„å¤–éƒ¨ç³»ç»Ÿéœ€è¦ä½¿ç”¨ä¸åŒçš„é€‚é…å™¨ï¼Œé€‚é…å™¨è´Ÿè´£å¯¹åè®®è¿›è¡Œè½¬æ¢ã€‚è¿™æ ·å°±ä½¿å¾—åº”ç”¨ç¨‹åºèƒ½å¤Ÿä»¥ä¸€è‡´çš„æ–¹å¼è¢«ç”¨æˆ·ã€ç¨‹åºã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ‰¹å¤„ç†è„šæœ¬æ‰€é©±åŠ¨ï¼Œå¹¶ä¸”ï¼Œå¯ä»¥åœ¨ä¸Žå®žé™…è¿è¡Œçš„è®¾å¤‡å’Œæ•°æ®åº“ç›¸éš”ç¦»çš„æƒ…å†µä¸‹å¼€å‘å’Œæµ‹è¯•ã€‚ å†…æ¶µ å…­è¾¹å½¢æž¶æž„çš„é‡ç‚¹ä½“çŽ°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š å…³æ³¨ç‚¹ å¯¹äºŽåˆ†å±‚æž¶æž„ä¸­å±‚æ¬¡çš„ç•Œå®šï¼ŒMartin Fowlerç»™å‡ºäº†ä¸€ä¸ªåˆ¤å®šçš„æ–¹æ³•ï¼Œå°±æ˜¯å¦‚æžœæŠŠè¡¨ç¤ºå±‚æ¢æˆå…¶ä»–å®žçŽ°ï¼Œå¦‚æžœå’ŒåŽŸæ¥çš„è¡¨ç¤ºå±‚æœ‰é‡å¤å®žçŽ°çš„å†…å®¹ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†å†…å®¹å°±åº”è¯¥æ”¾åˆ°ä¸šåŠ¡é€»è¾‘å±‚ã€‚é‚£ä¹ˆå¦‚ä½•è®©å¼€å‘äººå‘˜åœ¨ç³»ç»Ÿè®¾è®¡è¿‡ç¨‹ä¸­å§‹ç»ˆä¿æŒè¿™ç§è§†è§’ï¼Œä¼ ç»Ÿçš„åˆ†å±‚æž¶æž„æ˜¯éš¾ä»¥åšåˆ°çš„ã€‚å…­è¾¹å½¢æž¶æž„æœ‰ä¸€ä¸ªæ˜Žç¡®çš„å…³æ³¨ç‚¹ï¼Œä»Žä¸€å¼€å§‹å°±å¼ºè°ƒæŠŠé‡å¿ƒæ”¾åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šï¼Œå¤–éƒ¨çš„é©±åŠ¨é€»è¾‘æˆ–è¢«é©±åŠ¨é€»è¾‘å­˜åœ¨å¯å˜æ€§ã€å¯æ›¿æ¢æ€§ï¼Œä¾èµ–å…·ä½“æŠ€æœ¯ç»†èŠ‚ã€‚è€Œä¸šåŠ¡é€»è¾‘ç›¸å¯¹æ›´åŠ ç¨³å®šï¼Œä½“çŽ°åº”ç”¨çš„æ ¸å¿ƒä»·å€¼ï¼Œéœ€è¦è¢«è¯¦å°½çš„æµ‹è¯•ã€‚ å¤–éƒ¨å¯æ›¿æ¢ ä¸€ä¸ªç«¯å£å¯¹åº”å¤šä¸ªé€‚é…å™¨ï¼Œæ˜¯å¯¹ä¸€ç±»å¤–éƒ¨ç³»ç»Ÿçš„å½’çº³ï¼Œå®ƒä½“çŽ°äº†å¯¹å¤–éƒ¨çš„æŠ½è±¡ã€‚åº”ç”¨é€šè¿‡ç«¯å£ä¸ºå¤–ç•Œæä¾›æœåŠ¡ï¼Œè¿™äº›ç«¯å£éœ€è¦è¢«è‰¯å¥½çš„è®¾è®¡å’Œæµ‹è¯•ã€‚å†…éƒ¨ä¸å…³å¿ƒå¤–éƒ¨å¦‚ä½•ä½¿ç”¨ç«¯å£ï¼Œä»Žä¸€å¼€å§‹å°±è¦å‡å®šå¤–éƒ¨ä½¿ç”¨è€…æ˜¯å¯æ›¿æ¢çš„ã€‚å…­è¾¹å½¢çš„å…­å¹¶æ²¡æœ‰å®žè´¨æ„ä¹‰ï¼Œåªæ˜¯ä¸ºäº†ç•™è¶³å¤Ÿçš„ç©ºé—´æ”¾ç½®ç«¯å£å’Œé€‚é…å™¨ï¼Œä¸€èˆ¬ç«¯å£æ•°ä¸ä¼šè¶…è¿‡4ä¸ªã€‚é€‚é…å™¨å¯ä»¥åˆ†ä¸º2ç±»ï¼Œâ€œä¸»â€ã€â€œä»Žâ€é€‚é…å™¨ï¼Œä¹Ÿå¯ç§°ä¸ºâ€œé©±åŠ¨è€…â€å’Œâ€œè¢«é©±åŠ¨è€…â€ã€‚ è‡ªåŠ¨æµ‹è¯• åœ¨å…­è¾¹å½¢æž¶æž„ä¸­ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å’Œç”¨æˆ·å…·æœ‰åŒç­‰çš„åœ°ä½ï¼Œåœ¨å®žçŽ°ç”¨æˆ·ç•Œé¢çš„åŒæ—¶å°±éœ€è¦è€ƒè™‘è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚å®ƒä»¬å¯¹åº”ç›¸åŒçš„ç«¯å£ã€‚å…­è¾¹å½¢æž¶æž„ä¸ä»…è®©è‡ªåŠ¨åŒ–æµ‹è¯•è¿™ä»¶äº‹æƒ…æˆä¸ºè®¾è®¡ç¬¬ä¸€è¦ç´ ï¼ŒåŒæ—¶è‡ªåŠ¨åŒ–æµ‹è¯•ä¹Ÿä¿è¯åº”ç”¨é€»è¾‘ä¸ä¼šæ³„éœ²åˆ°ç”¨æˆ·ç•Œé¢ï¼Œåœ¨æŠ€æœ¯ä¸Šä¿è¯äº†å±‚æ¬¡çš„åˆ†ç•Œã€‚ ä¾èµ–å€’ç½® å…­è¾¹å½¢æž¶æž„å¿…é¡»éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼šå†…éƒ¨ç›¸å…³çš„ä»£ç ä¸èƒ½æ³„éœ²åˆ°å¤–éƒ¨ã€‚æ‰€è°“çš„æ³„éœ²æ˜¯æŒ‡ä¸èƒ½å‡ºçŽ°å†…éƒ¨ä¾èµ–å¤–éƒ¨çš„æƒ…å†µï¼Œåªèƒ½å¤–éƒ¨ä¾èµ–å†…éƒ¨ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å¤–éƒ¨æ˜¯å¯ä»¥æ›¿æ¢çš„ã€‚å¯¹äºŽé©±åŠ¨è€…é€‚é…å™¨ï¼Œå°±æ˜¯å¤–éƒ¨ä¾èµ–å†…éƒ¨çš„ã€‚ä½†æ˜¯å¯¹äºŽè¢«é©±åŠ¨è€…é€‚é…å™¨ï¼Œå®žé™…æ˜¯å†…éƒ¨ä¾èµ–å¤–éƒ¨ï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ä¾èµ–å€’ç½®ï¼Œç”±é©±åŠ¨è€…é€‚é…å™¨å°†è¢«é©±åŠ¨è€…é€‚é…å™¨æ³¨å…¥åˆ°åº”ç”¨å†…éƒ¨ï¼Œè¿™æ—¶ç«¯å£çš„å®šä¹‰åœ¨åº”ç”¨å†…éƒ¨ï¼Œä½†æ˜¯å®žçŽ°æ˜¯ç”±é€‚é…å™¨å®žçŽ°ã€‚ ä»£ç ç¤ºä¾‹ https://github.com/zhongpan/hexagonal-architecture-sample appå±‚ app.h 1234567891011121314151617181920#pragma oncenamespace app &#123; class RateRepository &#123; public: virtual double getRate(double amount) = 0; &#125;; class Discounter &#123; public: Discounter(RateRepository* rateRepository) : _rateRepository(rateRepository) &#123;&#125; double discount(double amount); private: RateRepository* _rateRepository; &#125;; &#125; app.cpp 12345678910#include &quot;app.h&quot;namespace app &#123; double Discounter::discount(double amount) &#123; if (amount &lt;= 0) return 0; double rate = _rateRepository-&gt;getRate(amount); return amount * rate; &#125;&#125; å‘½ä»¤è¡Œadapter cmd.cpp 123456789101112131415#include &quot;app.h&quot;#include &quot;repo.h&quot;#include &lt;iostream&gt;using namespace app;using namespace repo;int main(int argc, char* argv[]) &#123; double amount = 0.0; std::cout &lt;&lt; &quot;please enter amount:&quot;; std::cin &gt;&gt; amount; MockRateRepository repo; Discounter app(&amp;repo); std::cout &lt;&lt; &quot;discount is:&quot; &lt;&lt; app.discount(amount) &lt;&lt; std::endl;&#125; å•å…ƒæµ‹è¯•adapter test.cpp 1234567891011121314151617181920212223242526272829#define BOOST_TEST_MAIN#include &quot;app.h&quot;#include &lt;boost/test/unit_test.hpp&gt;#include &lt;boost/smart_ptr.hpp&gt;using namespace boost;class MockConstRateRepository : public app::RateRepository &#123;public: MockConstRateRepository(double rate) : _rate(rate) &#123;&#125; double getRate(double amount) &#123; return _rate; &#125;private: double _rate;&#125;;BOOST_AUTO_TEST_SUITE(s_discount)BOOST_AUTO_TEST_CASE(t_discount)&#123; double RATE_0point01 = 0.01; MockConstRateRepository repo(RATE_0point01); app::Discounter app(&amp;repo); BOOST_CHECK_EQUAL(app.discount(100), 100*RATE_0point01); BOOST_CHECK_EQUAL(app.discount(0), 0); BOOST_CHECK_EQUAL(app.discount(-100), 0);&#125;BOOST_AUTO_TEST_SUITE_END() æŒä¹…åŒ–adapter repo.h 123456789#pragma once#include &quot;app.h&quot;namespace repo &#123; class MockRateRepository : public app::RateRepository &#123; public: double getRate(double amount); &#125;;&#125; repo.cpp 123456789#include &quot;repo.h&quot;namespace repo &#123; double MockRateRepository::getRate(double amount) &#123; if (amount &lt;= 100) return 0.01; if (amount &lt;= 1000) return 0.02; return 0.05; &#125;&#125; å¤‡æ³¨ï¼š æœ¬æ–‡ä»Žhttps://www.cnblogs.com/zhongpan/p/7606430.htmlè¿ç§»è€Œæ¥ã€‚]]></content>
      <categories>
        <category>æž¶æž„</category>
      </categories>
      <tags>
        <tag>æž¶æž„</tag>
        <tag>å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[boost::lockfreeä½¿ç”¨ä»‹ç»]]></title>
    <url>%2F2017%2F09%2F15%2F003-how-to-use-boost-lockfree%2F</url>
    <content type="text"><![CDATA[boost::lockfreeæ˜¯boost1.53å¼•å…¥çš„æ— é”æ•°æ®ç»“æž„ï¼ŒåŒ…æ‹¬boost::lockfree::stackã€boost::lockfree::queueå’Œboost::lockfree::spsc_queueä¸‰ç§ï¼Œå‰ä¸¤ç§ç”¨äºŽå¤šç”Ÿäº§è€…/å¤šæ¶ˆè´¹è€…åœºæ™¯ï¼Œç¬¬ä¸‰ä¸ªç”¨äºŽå•ç”Ÿäº§è€…/å•æ¶ˆè´¹è€…åœºæ™¯ï¼Œä¸‹é¢å¯¹å®ƒä»¬çš„ä½¿ç”¨è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼Œä»¥boost::lockfree::stackä¸ºä¾‹ï¼Œå…¶ä»–ç±»ä¼¼ã€‚ æž„é€  boost::lockfree::stackæºä»£ç å¦‚ä¸‹ï¼ˆboost 1.65ï¼‰ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#ifdef BOOST_NO_CXX11_VARIADIC_TEMPLATEStemplate &lt;typename T, class A0, class A1, class A2&gt;#elsetemplate &lt;typename T, typename ...Options&gt;#endifclass stack&#123;private:#ifndef BOOST_DOXYGEN_INVOKED BOOST_STATIC_ASSERT(boost::is_copy_constructible&lt;T&gt;::value);#ifdef BOOST_NO_CXX11_VARIADIC_TEMPLATES typedef typename detail::stack_signature::bind&lt;A0, A1, A2&gt;::type bound_args;#else typedef typename detail::stack_signature::bind&lt;Options...&gt;::type bound_args;#endif static const bool has_capacity = detail::extract_capacity&lt;bound_args&gt;::has_capacity; static const size_t capacity = detail::extract_capacity&lt;bound_args&gt;::capacity; static const bool fixed_sized = detail::extract_fixed_sized&lt;bound_args&gt;::value; static const bool node_based = !(has_capacity || fixed_sized); static const bool compile_time_sized = has_capacity;/* çœç•¥ */public: typedef T value_type; typedef typename implementation_defined::allocator allocator; typedef typename implementation_defined::size_type size_type; //! Construct stack // @&#123; stack(void): pool(node_allocator(), capacity) &#123; BOOST_ASSERT(has_capacity); initialize(); &#125; template &lt;typename U&gt; explicit stack(typename node_allocator::template rebind&lt;U&gt;::other const &amp; alloc): pool(alloc, capacity) &#123; BOOST_STATIC_ASSERT(has_capacity); initialize(); &#125; explicit stack(allocator const &amp; alloc): pool(alloc, capacity) &#123; BOOST_ASSERT(has_capacity); initialize(); &#125; // @&#125; //! Construct stack, allocate n nodes for the freelist. // @&#123; explicit stack(size_type n): pool(node_allocator(), n) &#123; BOOST_ASSERT(!has_capacity); initialize(); &#125; template &lt;typename U&gt; stack(size_type n, typename node_allocator::template rebind&lt;U&gt;::other const &amp; alloc): pool(alloc, n) &#123; BOOST_STATIC_ASSERT(!has_capacity); initialize(); &#125; boost::lockfree::stackçš„ç¬¬ä¸€ä¸ªæ¨¡æ¿å‚æ•°æ˜¯å…ƒç´ ç±»åž‹ï¼ŒåŽé¢3ä¸ªå‚æ•°æ˜¯ç”¨æ¥é…ç½®stackçš„ï¼Œæ²¡æœ‰é¡ºåºè¦æ±‚ï¼š boost::lockfree::fixed_sizedï¼šæ˜¯å¦å›ºå®šå¤§å°ï¼Œé»˜è®¤ä¸ºboost::lockfree::fixed_sized&lt;false&gt;ï¼Œå¦‚æžœä¸ºtrueï¼Œåˆ™å†…éƒ¨ä½¿ç”¨æ•°ç»„ä¿å­˜å…ƒç´ ï¼Œå¤§å°ä¸èƒ½åŠ¨æ€å¢žé•¿ï¼› boost::lockfree::capacityï¼šç¼–è¯‘æ—¶è®¾ç½®å†…éƒ¨æ•°ç»„å¤§å°ï¼Œè®¾ç½®äº†capacityæ„å‘³ç€ä¸€å®šæ˜¯boost::lockfree::fixed_sized&lt;true&gt;ï¼Œå’Œè¿è¡Œæ—¶æŒ‡å®šå¤§å°æ˜¯äº’æ–¥çš„ï¼Œè§ä¸‹é¢çš„ä¾‹å­ï¼› boost::lockfree::allocatorï¼šè®¾ç½®åˆ†é…å™¨ï¼Œé»˜è®¤boost::lockfree::allocator&lt;std::allocator&lt;void&gt;&gt;ã€‚ ä¾‹å¦‚ï¼š 1234567891011//è¡¨ç¤ºåŠ¨æ€å¤§å°ï¼Œåˆå§‹å¤§å°ä¸º4ï¼Œç”¨å®Œäº†å†åŠ¨æ€å¢žé•¿ï¼›æ­¤æ—¶å¿…é¡»åœ¨æž„é€ å‡½æ•°æŒ‡å®šåˆå§‹å¤§å°ï¼Œå¦åˆ™æ–­è¨€å¤±è´¥ï¼›boost::lockfree::stack&lt;int&gt; s(4);//è¡¨ç¤ºå¤§å°å›ºå®šï¼Œè¿è¡Œæ—¶æŒ‡å®šåˆå§‹å¤§å°ä¸º4ï¼Œç”¨å®ŒåŽå†pushå°±ä¼šå¤±è´¥ï¼›æ­¤æ—¶å¿…é¡»åœ¨æž„é€ å‡½æ•°æŒ‡å®šåˆå§‹å¤§å°ï¼Œå¦åˆ™æ–­è¨€å¤±è´¥ï¼›boost::lockfree::stack&lt;int, boost::lockfree::fixed_sized&lt;true&gt;&gt; s1(4);//è¡¨ç¤ºå¤§å°å›ºå®šï¼Œç¼–è¯‘æ—¶æŒ‡å®šåˆå§‹å¤§å°ä¸º4ï¼Œç”¨å®ŒåŽå†pushå°±ä¼šå¤±è´¥ï¼›æ­¤æ—¶ä¸èƒ½åœ¨æž„é€ å‡½æ•°æŒ‡å®šåˆå§‹å¤§å°ï¼Œå¦åˆ™æ–­è¨€å¤±è´¥ï¼›boost::lockfree::stack&lt;int, boost::lockfree::capacity&lt;4&gt;&gt; s2;//å’Œä¸Šé¢ä¸€æ ·ï¼Œè®¾ç½®äº†capacityï¼Œfixed_sizeå°±æ€»æ˜¯trueboost::lockfree::stack&lt;int, boost::lockfree::fixed_size&lt;false&gt;, boost::lockfree::capacity&lt;4&gt;&gt; s3; æˆå‘˜æ–¹æ³• pushï¼šåŽ‹å…¥ä¸€ä¸ªå…ƒç´ åˆ°å®¹å™¨ï¼Œé™¤äº†unsynchronized_ï¼Œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ‰€æœ‰éƒ½æ˜¯éžé˜»å¡žçš„ã€‚ 123456789101112bool push(T const &amp; v)bool bounded_push(T const &amp; v)template &lt;typename ConstIterator&gt;ConstIterator push(ConstIterator begin, ConstIterator end)template &lt;typename ConstIterator&gt;ConstIterator bounded_push(ConstIterator begin, ConstIterator end)bool unsynchronized_push(T const &amp; v)ConstIterator unsynchronized_push(ConstIterator begin, ConstIterator end) bounded_è¡¨ç¤ºä¸åŠ¨æ€å¢žé•¿ï¼Œå½“åˆå§‹å¤§å°ç”¨å®ŒåŽå†pushå°±ä¼šå¤±è´¥ï¼› unsynchronized_è¡¨ç¤ºéžçº¿ç¨‹å®‰å…¨ï¼› popï¼šä»Žå®¹å™¨ä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œé™¤äº†unsynchronized_ï¼Œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ‰€æœ‰éƒ½æ˜¯éžé˜»å¡žçš„ã€‚ 123456789bool pop(T &amp; ret)template &lt;typename U&gt;bool pop(U &amp; ret)bool unsynchronized_pop(T &amp; ret)template &lt;typename U&gt;bool unsynchronized_pop(U &amp; ret) unsynchronized_è¡¨ç¤ºéžçº¿ç¨‹å®‰å…¨ï¼› consume_ï¼šä»Žå®¹å™¨å¼¹å‡º1ä¸ªæˆ–å…¨éƒ¨å…ƒç´ ï¼Œå¹¶åº”ç”¨æŸä¸ªå‡½æ•°å¯¹è±¡ã€‚çº¿ç¨‹å®‰å…¨æˆ–é˜»å¡žä¸Žå¦å–å†³äºŽå‡½æ•°å¯¹è±¡ã€‚ 1234567891011121314151617181920212223template &lt;typename Functor&gt;bool consume_one(Functor &amp; f)template &lt;typename Functor&gt;bool consume_one(Functor const &amp; f)template &lt;typename Functor&gt;size_t consume_all(Functor &amp; f)template &lt;typename Functor&gt;size_t consume_all(Functor const &amp; f)template &lt;typename Functor&gt;size_t consume_all_atomic(Functor &amp; f)template &lt;typename Functor&gt;size_t consume_all_atomic(Functor const &amp; f)template &lt;typename Functor&gt;size_t consume_all_atomic_reversed(Functor &amp; f)template &lt;typename Functor&gt;size_t consume_all_atomic_reversed(Functor const &amp; f) _oneè¡¨ç¤ºåªæ¶ˆè´¹1ä¸ªå…ƒç´ ï¼› _allè¡¨ç¤ºæ¶ˆè´¹æ‰€æœ‰å…ƒç´ ï¼› _atomicè¡¨ç¤ºæ¶ˆè´¹è¿‡ç¨‹æ˜¯åŽŸå­çš„ï¼Œå…¶é—´å…¶ä»–æ“ä½œå¯¹å…¶æ˜¯ä¸å¯è§çš„ã€‚ _reversedè¡¨ç¤ºå€’åºæ¶ˆè´¹ã€‚ å…¶ä»– 123456//é¢„åˆ†é…ç©ºé—²èŠ‚ç‚¹æ•°ï¼Œå’Œç¼–è¯‘æ—¶è®¾ç½®capacityäº’æ–¥ï¼›çº¿ç¨‹å®‰å…¨ï¼Œå¯èƒ½é˜»å¡žvoid reserve(size_type n)//éžçº¿ç¨‹å®‰å…¨void reserve_unsafe(size_type n)//åˆ¤æ–­æ˜¯å¦ä¸ºç©ºbool empty(void) const ç®€å•ç¤ºä¾‹ 12345678910111213141516#include &lt;boost/lockfree/stack.hpp&gt;int main(int argc, char *argv[])&#123; boost::lockfree::stack&lt;int&gt; s(64); //producer for (int i = 0; i &lt; 1000; i++) &#123; s.push(i); &#125; //consumer s.consume_all([](int i) &#123; std::cout &lt;&lt; i &lt;&lt; std::endl; &#125;); return 0;&#125;]]></content>
      <categories>
        <category>c++</category>
      </categories>
      <tags>
        <tag>c++</tag>
        <tag>boost</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼ç›‘æŽ§ç³»ç»Ÿzipkinä»‹ç»]]></title>
    <url>%2F2017%2F09%2F11%2F002-introduction-to-zipkin%2F</url>
    <content type="text"><![CDATA[zipkinæ˜¯TwitteråŸºäºŽgoogleçš„åˆ†å¸ƒå¼ç›‘æŽ§ç³»ç»ŸDapperï¼ˆè®ºæ–‡ï¼‰çš„å¼€å‘æºå®žçŽ°ï¼Œzipkinç”¨äºŽè·Ÿè¸ªåˆ†å¸ƒå¼æœåŠ¡ä¹‹é—´çš„åº”ç”¨æ•°æ®é“¾è·¯ï¼Œåˆ†æžå¤„ç†å»¶æ—¶ï¼Œå¸®åŠ©æˆ‘ä»¬æ”¹è¿›ç³»ç»Ÿçš„æ€§èƒ½å’Œå®šä½æ•…éšœã€‚ zipkinæž¶æž„ Instrumented clientå’ŒInstrumented serveræ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡ï¼Œé€šè¿‡è£…å¤‡åº“é‡‡é›†è·Ÿè¸ªä¿¡æ¯ï¼Œè£…å¤‡åº“å†è°ƒç”¨Transportï¼ŒæŠŠè·Ÿè¸ªä¿¡æ¯å‘é€ç»™zipkinã€‚ è£…å¤‡åº“ é’ˆå¯¹ä¸åŒè¯­è¨€ï¼Œä¸åŒRPCæ¡†æž¶ï¼Œæœ‰ä¸åŒçš„è£…å¤‡åº“å®žçŽ°ï¼Œç›®å‰å·²æœ‰å®žçŽ°åˆ—è¡¨è§æ­¤ï¼Œå…¶ä¸­Braveæ˜¯zipkinå®˜æ–¹æä¾›çš„Javaçš„è£…å¤‡åº“ã€‚ ä¸€ä¸ªè£…å¤‡åº“çš„å®žçŽ°éœ€è¦è€ƒè™‘å¦‚ä¸‹æƒ…å†µï¼š å®žçŽ°è¯­è¨€ï¼Œå’Œéœ€è¦è£…å¤‡çš„æœåŠ¡çš„è¯­è¨€ä¸€è‡´ zipkinéœ€è¦çš„æ ¸å¿ƒæ•°æ®ç»“æž„ä¿¡æ¯è®°å½•ï¼ŒåŒ…æ‹¬tracerid,spanidçš„ç”Ÿæˆï¼Œå»¶è¿Ÿæ—¶é—´çš„è®¡ç®—ï¼Œäº‹ä»¶è®°å½•ï¼Œtagè®°å½•ç­‰ æœåŠ¡ä¹‹é—´è·Ÿè¸ªä¿¡æ¯çš„ä¼ é€’ï¼Œç§°ä¸ºæ¤å…¥ï¼Œä¸åŒRPCæŽ¥å£æ¤å…¥çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œä¾‹å¦‚HTTPæŽ¥å£é‡‡ç”¨B3åè®®æ¤å…¥ æ¤å…¥çš„ä¿¡æ¯åŒ…æ‹¬ï¼šTrace Idã€Span Idã€Parent Idã€Sampledã€Flags é‡‡æ ·ï¼Œå‡å°‘è·Ÿè¸ªå¯¼è‡´çš„ç³»ç»Ÿè´Ÿè· æŠ¥å‘Šç»™zipkinï¼Œè°ƒç”¨Transportå°†è·Ÿè¸ªä¿¡æ¯ä¼ ç»™zipkin Transport Transportæ˜¯zipkinå¯¹å¤–æä¾›çš„æŽ¥å£ï¼Œç›®å‰æœ‰HTTPã€Kafkaã€Scribeä¸‰ç§ã€‚ HTTPï¼šé‡‡ç”¨jsonæ ¼å¼ï¼ŒæŽ¥å£å®šä¹‰è§https://github.com/openzipkin/zipkin-api Kafkaï¼šåˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ Scribeï¼šFacebookçš„æ—¥å¿—æ”¶é›†ç³»ç»Ÿhttps://github.com/facebook/scribe æ ¸å¿ƒæ•°æ®ç»“æž„ v2ç‰ˆæœ¬ï¼š traceIdï¼š64ä½æˆ–128ä½ï¼Œå…¨å±€å”¯ä¸€ï¼Œ parentIdï¼šçˆ¶spanidï¼Œ64ä½ï¼Œæ ¹spançš„parentIdä¸ºç©º idï¼šspanidï¼Œ64ä½ï¼ŒtranceIdå†…å”¯ä¸€ nameï¼šæ–¹æ³•å serviceNameï¼šæœåŠ¡å timestampï¼šè‡ª1970-1-1 00:00:00 UTCçš„å¾®ç§’ durationï¼šå¼€å§‹spanåˆ°ç»“æŸspançš„æ—¶é—´ï¼Œå•ä½å¾®ç§’ annotationsï¼šè®°å½•äº‹ä»¶ï¼Œvalueæœ‰ä¸€äº›é¢„å®šä¹‰çš„å€¼ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯å‘é€(cs)ï¼Œå®¢æˆ·ç«¯æŽ¥æ”¶(cr)ï¼ŒæœåŠ¡ç«¯æŽ¥æ”¶(sr)ï¼ŒæœåŠ¡ç«¯å‘é€(ss)ç­‰ tagsï¼šè®°å½•é™„åŠ æ•°æ® ä¸€ä¸ªSpanå°±æ˜¯è®°å½•[remoteEndpoint.serviceName]æœåŠ¡çš„[Span.name]æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå…¶ä¸­çš„annotationè®°å½•äº†ä¸­é—´çš„ä¸€äº›äº‹ä»¶å‘ç”Ÿæ—¶é—´ï¼Œé€šè¿‡è¿™äº›æ—¶é—´å¯ä»¥å¾—åˆ°[Span.name]æ–¹æ³•çš„ç½‘ç»œä¼ è¾“æ—¶é—´ï¼ŒæœåŠ¡ç«¯æ‰§è¡Œæ—¶é—´ï¼Œå®¢æˆ·ç«¯å“åº”æ—¶é—´ç­‰ä¿¡æ¯ï¼Œä»Žè€Œå¯¹å…¶è¿›è¡Œè¯Šæ–­ä¼˜åŒ–ã€‚å¤šä¸ªSpané€šè¿‡parentIdæž„æˆä¸€ä¸ªæ ‘å½¢ç»“æž„ï¼Œæ ¹Spançš„parentIdä¸ºç©ºï¼Œæè¿°äº†ä¸€æ¬¡traceï¼ˆtranceIdæ ‡è¯†ï¼‰ä¸­å¤šä¸ªæœåŠ¡ä¹‹é—´çš„è°ƒç”¨è¿‡ç¨‹ã€‚ ç¤ºä¾‹è¯´æ˜Ž https://github.com/zhongpan/zipkin-ice å‡è®¾service1.fun1ä¸­è°ƒç”¨service2.fun2å’Œservice3.fun3ï¼Œservice2.fun2ä¸­è°ƒç”¨service4.fun4ã€‚æœ¬æ¬¡è·Ÿè¸ªå„ä¸ªæœåŠ¡ä¸­ä¼šåˆ›å»ºå¦‚ä¸Šçš„span1~span7ï¼Œspan1ä¸ºæ ¹spanã€‚span2å’Œspan4ä¸ºä¸€æ¬¡RPCçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¡Œä¸ºï¼Œå¯ä»¥å…±äº«spanidï¼Œspan4ä¸ç”¨æ–°ç”Ÿæˆspanidï¼Œspan2å’Œspan4åœ¨zipkinä¸­ä¼šåˆå¹¶ä¸º1ä¸ªspanï¼Œspan3/span5ä»¥åŠspan6/span7ç±»ä¼¼ã€‚æœ€ç»ˆï¼Œåœ¨zipkinç•Œé¢å±•ç¤ºçš„æ ‘å½¢ç»“æž„ä¸ºï¼š]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼è·Ÿè¸ª</category>
      </categories>
      <tags>
        <tag>zipkin</tag>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£std::chronoçš„æ—¶é’ŸClock]]></title>
    <url>%2F2017%2F09%2F07%2F001-understand-chrono%2F</url>
    <content type="text"><![CDATA[std::chronoæ˜¯C++11å¼•å…¥çš„æ—¥æœŸæ—¶é—´å¤„ç†åº“ï¼Œå…¶ä¸­åŒ…å«3ç§æ—¶é’Ÿï¼šsystem_clockï¼Œsteady_clockï¼Œhigh_resolution_clockã€‚è¿‘æ¥éœ€è¦ä½¿ç”¨é«˜ç²¾åº¦æ—¶é—´ï¼Œå¾ˆè‡ªç„¶æƒ³åˆ°ä½¿ç”¨high_resolution_clockï¼Œç„¶è€Œä½¿ç”¨åŽå‘çŽ°å¹¶éžé¢„æœŸçš„å¾—åˆ°è‡ª1970/1/1é›¶ç‚¹ä¹‹åŽçš„è®¡æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªå°å¾—å¤šçš„æ•°å­—ã€‚é‚£ä¹ˆè¿™ä¸‰ç§æ—¶é’Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œç”¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¥ä¸€æŽ¢ç©¶ç«Ÿã€‚ é—®é¢˜ 12auto tp = std::chrono::high_resolution_clock::now();std::cout &lt;&lt; tp.time_since_epoch().count() &lt;&lt; std::endl; ä¸Šè¿°ä»£ç è¾“å‡ºä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°å­—ï¼Œhigh_resolution_clockçš„ç²¾åº¦æ˜¯çº³ç§’ï¼Œä¸å¯èƒ½æ˜¯è¿™ä¹ˆå°çš„æ•°å­—ã€‚ ä¸‰ç§æ—¶é’Ÿçš„åŒºåˆ« æ‰€è°“æ—¶é’Ÿï¼Œæ˜¯æŒ‡ä»Žä¸€ä¸ªæ—¶ç‚¹å¼€å§‹ï¼ŒæŒ‰ç…§æŸä¸ªåˆ»åº¦çš„ä¸€ä¸ªè®¡æ•°ã€‚å¦‚ä¸‹ä»£ç æ‘˜è‡ªVC2017ã€‚ system_clock 1234567struct system_clock&#123; // wraps GetSystemTimePreciseAsFileTime/GetSystemTimeAsFileTimetypedef long long rep;typedef ratio_multiply&lt;ratio&lt;_XTIME_NSECS_PER_TICK, 1&gt;, nano&gt; period;typedef chrono::duration&lt;rep, period&gt; duration;typedef chrono::time_point&lt;system_clock&gt; time_point;static constexpr bool is_steady = false; å¯¹äºŽsystem_clockï¼Œå…¶èµ·ç‚¹æ˜¯epochï¼Œå³1970-01-01 00:00:00 UTCï¼Œå…¶åˆ»åº¦æ˜¯1ä¸ªtickï¼Œä¹Ÿå°±æ˜¯_XTIME_NSECS_PER_TICKçº³ç§’ã€‚ high_resolution_clock 1typedef steady_clock high_resolution_clock; high_resolution_clockå®žé™…ä¸Šå’Œsteady_clockä¸€æ ·ã€‚ steady_clock 1234567struct steady_clock&#123; // wraps QueryPerformanceCountertypedef long long rep;typedef nano period;typedef nanoseconds duration;typedef chrono::time_point&lt;steady_clock&gt; time_point;static constexpr bool is_steady = true; steady_clockçš„åˆ»åº¦æ˜¯1çº³ç§’ï¼Œèµ·ç‚¹å¹¶éž1970-01-01 00:00:00 UTCï¼Œä¸€èˆ¬æ˜¯ç³»ç»Ÿå¯åŠ¨æ—¶é—´ï¼Œè¿™å°±æ˜¯é—®é¢˜çš„å…³é”®ã€‚steady_clockçš„ä½œç”¨æ˜¯ä¸ºäº†å¾—åˆ°ä¸éšç³»ç»Ÿæ—¶é—´ä¿®æ”¹è€Œå˜åŒ–çš„æ—¶é—´é—´éš”ï¼Œæ‰€ä»¥å‡¡æ˜¯æƒ³å¾—åˆ°ç»å¯¹æ—¶ç‚¹çš„ç”¨æ³•éƒ½æ˜¯é”™è¯¯çš„ã€‚steady_clockæ˜¯æ²¡æœ‰to_time_t()çš„å®žçŽ°çš„ï¼Œè€Œsystem_clockæ˜¯æœ‰çš„ã€‚ ä¸‰ç§æ—¶é’Ÿç”¨åœ¨ä»€ä¹ˆæ—¶å€™ system_clockï¼šç”¨åœ¨éœ€è¦å¾—åˆ°ç»å¯¹æ—¶ç‚¹çš„åœºæ™¯ 123auto tp = std::chrono::system_clock::now();std::time_t tt = std::chrono::system_clock::to_time_t(tp);std::cout &lt;&lt; tt &lt;&lt; &quot;seconds from 1970-01-01 00:00:00 UTC&quot; &lt;&lt; std::endl; steady_clockï¼šç”¨åœ¨éœ€è¦å¾—åˆ°æ—¶é—´é—´éš”ï¼Œå¹¶ä¸”è¿™ä¸ªæ—¶é—´é—´éš”ä¸ä¼šå› ä¸ºä¿®æ”¹ç³»ç»Ÿæ—¶é—´è€Œå—å½±å“çš„åœºæ™¯ 1234auto tp1 = std::chrono::steady_clock::now();//do somethingauto tp2 = std::chrono::steady_clock::now();std::cout &lt;&lt; std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(tp2 - tp1).count() &lt;&lt; &quot;microseconds&quot; &lt;&lt; std::endl; high_resolution_clockï¼šhigh_resolution_clockæ˜¯system_clockæˆ–steady_clockä¹‹ä¸€ï¼Œæ ¹æ®æƒ…å†µä½¿ç”¨ å¸¸è§çš„é”™è¯¯ç”¨æ³• std::this_thread::sleep_untilä¼ å…¥çš„æ˜¯steady_clock::time_point æ ¹æ®steady_clock::time_pointå¾—åˆ°time_t]]></content>
      <categories>
        <category>c++</category>
      </categories>
      <tags>
        <tag>c++</tag>
        <tag>c++11</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iceboxæœåŠ¡å¯åŠ¨å¤±è´¥é—®é¢˜å®šä½è®°å½•]]></title>
    <url>%2F2016%2F01%2F11%2F024-icebox-service-started-failed%2F</url>
    <content type="text"><![CDATA[é€šè¿‡IceGridGUIå¯åŠ¨æŸä¸ªiceboxæœåŠ¡æ—¶ï¼Œå¼¹å‡ºå¦‚ä¸‹å›¾çš„é”™è¯¯å¯¹è¯æ¡†ï¼Œå¯åŠ¨æœåŠ¡å¤±è´¥ã€‚æç¤ºæ‰¾ä¸åˆ°icebox.exeç¨‹åºï¼Œä½†æ˜¯icebox.exeæ˜¯å­˜åœ¨çš„ï¼Œå¹¶ä¸”åœ¨pathä¸­ï¼Œé—®é¢˜éžå¸¸è¯¡å¼‚ã€‚ä¸‹é¢è¯¦ç»†è®°å½•é—®é¢˜å®šä½çš„è¿‡ç¨‹ã€‚ èƒŒæ™¯çŸ¥è¯† IceGridçš„æž¶æž„ä¸­åŒ…å«icegridregistry.exeå’Œicegridnode.exeä¸¤ä¸ªè¿›ç¨‹ï¼Œicegridnode.exeè´Ÿè´£å¯åŠ¨å…·ä½“çš„æœåŠ¡ï¼Œå½“ä»ŽIceGridGUIä¸­startæŸä¸ªæœåŠ¡æ—¶ï¼Œ å®žé™…ä¸Šæ˜¯è°ƒç”¨icegridnode.exeæŽ¥å£ï¼Œç”±icegridnode.exeè´Ÿè´£å¯åŠ¨æœåŠ¡ï¼Œå¦‚æžœæœåŠ¡æ˜¯iceboxæœåŠ¡ï¼Œå°±ä¼šæ ¹æ®application.xmlä¸­é…ç½®çš„iceboxè·¯å¾„è¿è¡Œ iceboxï¼Œç”±iceboxåŠ è½½å…·ä½“æœåŠ¡dllã€‚ application.xmlä¸­é…ç½®çš„iceboxè·¯å¾„ï¼Œä¸€èˆ¬é…ç½®çš„iceboxç¨‹åºåï¼Œä¸åŒ…å«å®Œæ•´è·¯å¾„ï¼Œiceboxç¨‹åºåæ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œè¿è¡ŒçŽ¯å¢ƒï¼Œç¨‹åºåæœ‰æ‰€ä¸åŒã€‚ åˆæ­¥åˆ¤æ–­ é—®é¢˜çš„çŽ°è±¡æ˜¯æ‰¾ä¸åˆ°iceboxï¼Œå› ä¸ºapplication.xmlä¸­åªé…ç½®iceboxç¨‹åºåï¼Œæ²¡æœ‰å®Œæ•´è·¯å¾„ï¼Œ æ‰€ä»¥æŽ¨æµ‹icegridnode.exeåº”è¯¥æ˜¯é€šè¿‡ç³»ç»Ÿpathå¯»æ‰¾iceboxçš„ï¼Œé‚£ä¹ˆé¦–å…ˆè‡ªç„¶ä¼šæƒ³åˆ°å¯èƒ½æ˜¯ç³»ç»Ÿpathè·¯å¾„ä¸­ä¸åŒ…å«iceboxçš„è·¯å¾„ã€‚ ç¬¬ä¸€æ¬¡å°è¯• é¦–å…ˆæŸ¥çœ‹ç³»ç»ŸçŽ¯å¢ƒå˜é‡æ˜¯å¦åŒ…å«iceboxçš„è·¯å¾„ï¼Œ ç»è¿‡æŸ¥çœ‹æ­¤è·¯å¾„æ˜¯å­˜åœ¨çš„ï¼› ç„¶åŽæŸ¥çœ‹è¿›ç¨‹çš„æŽ§åˆ¶å—æ˜¯å¦åŒ…å«ç³»ç»ŸPathï¼Œè¿›ç¨‹å¯åŠ¨æ—¶ä¼šå¤åˆ¶ä¸€ä»½ç³»ç»ŸçŽ¯å¢ƒå˜é‡åˆ°è¿›ç¨‹æŽ§åˆ¶å—ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä»½ç³»ç»ŸçŽ¯å¢ƒå˜é‡ï¼Œ å› æ­¤ä¿®æ”¹ç³»ç»ŸPathå¯¹å·²ç»å¯åŠ¨çš„è¿›ç¨‹æ˜¯æ— æ•ˆçš„ã€‚é‚£ä¹ˆæ€Žä¹ˆæŸ¥çœ‹è¿›ç¨‹çš„çŽ¯å¢ƒå˜é‡å‘¢ï¼Œå¯ä»¥é€šè¿‡procexp.exeå·¥å…·ï¼Œç»è¿‡æŸ¥çœ‹icegridnode.exeè¿›ç¨‹ä¸­ç³»ç»ŸPathæ˜¯æ­£ç¡®çš„ã€‚è‡³æ­¤ç¬¬ä¸€æ¬¡å°è¯•ä»¥å¤±è´¥å‘Šç»ˆã€‚ ç»§ç»­åˆ†æž ç»è¿‡åˆæ­¥è¯Šæ–­æŽ’é™¤äº†å¤–éƒ¨çŽ¯å¢ƒçš„é—®é¢˜ï¼ŒæŽ¥ä¸‹æ¥åªèƒ½ä»Žç¨‹åºå†…éƒ¨æ¥æ‰¾åŽŸå› ï¼Œéœ€è¦æ‰¾åˆ°å‡ºé—®é¢˜çš„ä»£ç ä½ç½®ï¼Œæ ¹æ®æœåŠ¡å¯åŠ¨çš„åŽŸç†ï¼Œé—®é¢˜åº”è¯¥å‡ºåœ¨icegridnode.exeä¸­ï¼Œ å…³é”®å°±æ˜¯æ€Žä¹ˆåœ¨Iceæºä»£ç ä¸­å¿«é€Ÿæ‰¾åˆ°ï¼Œè€Œç›®å‰å”¯ä¸€çš„çº¿ç´¢å°±æ˜¯å¼¹å‡ºçš„é”™è¯¯å¯¹è¯æ¡†ï¼Œè¿™åº”è¯¥æ˜¯çªç ´å£ï¼› æ ¹æ®å¯¹è¯æ¡†ä¸­çš„é”™è¯¯æ¶ˆæ¯ï¼Œç”¨å…³é”®å­—&quot;Couldnâ€™t find&quot;åœ¨Iceæºä»£ç ä¸­æœç´¢ï¼Œè¿™é‡ŒæŽ¨èFindStrï¼ˆWindowsä¸‹ä¹Ÿæœ‰findstrå‘½ä»¤ï¼‰è¿™ä¸ªå·¥å…·ï¼Œç»è¿‡æœç´¢æžœç„¶æ‰¾åˆ°äº† å‡ºé—®é¢˜çš„ä»£ç ä½ç½®ï¼Œå¦‚ä¸‹ï¼š æºä»£ç çš„ä½ç½®æ‰¾åˆ°äº†ï¼Œå°±è¦å¼€å§‹ä¸Šç»ˆæžç¥žå™¨äº†ï¼Œé‚£å°±æ˜¯windbgï¼ŒæŽ¥ä¸‹æ¥å…ˆåšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œçœ‹ä¸€ä¸‹å‡ºé—®é¢˜çš„ä»£ç ã€‚ icegridnode.exeå¯åŠ¨iceboxçš„æºä»£ç  æŸ¥çœ‹ä»£ç å…³é”®çš„åœ°æ–¹æ˜¯SearchPathWçš„è°ƒç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªWindows APIã€‚ 123456789101112131415161718192021#ifdef _WIN32 if(!IceUtilInternal::isAbsolutePath(path)) &#123; if(path.find('/') == string::npos) &#123; // // Get the absolute pathname of the executable. // wchar_t absbuf[_MAX_PATH]; wchar_t* fPart; wstring ext = path.size() &lt;= 4 || path[path.size() - 4] != '.' ? L".exe" : L""; if(SearchPathW(NULL, IceUtil::stringToWstring(path).c_str(), ext.c_str(), _MAX_PATH, absbuf, &amp;fPart) == 0) &#123; if(_traceLevels-&gt;activator &gt; 0) &#123; Trace out(_traceLevels-&gt;logger, _traceLevels-&gt;activatorCat); out &lt;&lt; "couldn't find `" &lt;&lt; path &lt;&lt; "' executable."; &#125; throw string("Couldn't find `" + path + "' executable."); &#125; path = IceUtil::wstringToString(absbuf); SearchPathå‡½æ•°è¯´æ˜Ž SearchPathå®šä¹‰ï¼š 12345678DWORD WINAPI SearchPath( _In_opt_ LPCTSTR lpPath, _In_ LPCTSTR lpFileName, _In_opt_ LPCTSTR lpExtension, _In_ DWORD nBufferLength, _Out_ LPTSTR lpBuffer, _Out_opt_ LPTSTR *lpFilePart); Parameters lpPath [in, optional] The path to be searched for the file. If this parameter is NULL, the function searches for a matching file using a registry-dependent system search path. For more information, see the Remarks section. Return value If the function succeeds, the value returned is the length, in TCHARs, of the string that is copied to the buffer, not including the terminating null character. If the return value is greater than nBufferLength, the value returned is the size of the buffer that is required to hold the path, including the terminating null character. If the function fails, the return value is zero. To get extended error information, call GetLastError. å¼€å§‹ç¬¬äºŒæ¬¡å°è¯•ï¼Œä¸Šwindbg å…ˆå¯¹icegridnode.exeåšäº†ä¸€ä¸ªuserdumpä¿ç•™å¥½çŽ¯å¢ƒä»¥é˜²ä¸‡ä¸€ï¼Œ ç„¶åŽè®¾ç½®å¥½windbgçš„ç¬¦å·å’Œæºä»£ç è·¯å¾„ï¼› ç”¨windbg attachåˆ°icegridnode.exeè¿›ç¨‹å¼€å§‹è°ƒè¯•ï¼Œæ‰“å¼€Activator.cppæ–‡ä»¶ï¼Œåœ¨370è¡Œè®¾ç½®å¥½æ–­ç‚¹ï¼ŒF5(Go)ï¼› åœ¨IceGridGUIå·¥å…·ä¸­startæŸä¸ªæœåŠ¡ï¼Œwindbgä¸­å¯ä»¥çœ‹åˆ°æ–­ç‚¹å‘½ä¸­ã€‚å¾ˆæ˜¾ç„¶å‡ºçŽ°æœ¬é—®é¢˜ä¸€å®šæ˜¯SearchPathWè¿”å›žçš„0ï¼Œ é‚£ä¹ˆä¸ºä»€ä¹ˆSearchPathWè¿”å›žçš„0ï¼ŒçŽ°åœ¨å°±å¯ä»¥ä¸€æŽ¢ç©¶ç«Ÿäº†ï¼ŒæŸ¥çœ‹SearchPathè¾“å…¥çš„å‚æ•°ï¼Œå‘çŽ°è¾“å…¥çš„å‚æ•°éƒ½æ˜¯æ­£ç¡®çš„ï¼Œ Step Intoåˆ°IceUtil::stringToWstringï¼Œå…¶è½¬æ¢ç»“æžœä¹Ÿæ˜¯æ­£ç¡®çš„ï¼ŒStep Outç»§ç»­å¾€ä¸‹è°ƒç¡®è®¤SearchPathW ç¡®å®žè¿”å›žçš„0ï¼› æ ¹æ®SearchPathå‡½æ•°çš„è¯´æ˜Žï¼Œè¿”å›ž0è¡¨ç¤ºå¤±è´¥ï¼Œé€šè¿‡GetLastErrorå¯ä»¥æŸ¥è¯¢é”™è¯¯ç ï¼Œåœ¨windbgä¸­é€šè¿‡!gleå‘½ä»¤æŸ¥è¯¢é”™è¯¯ç ä¸º0ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é”™è¯¯ï¼Œ è¿™å°±å¥‡æ€ªäº†ï¼Œè¾“å…¥å‚æ•°éƒ½æ˜¯æ­£ç¡®çš„ï¼Œé”™è¯¯ç ä¹Ÿæ˜¾ç¤ºæ²¡æœ‰é”™è¯¯ï¼Œä¸ºä»€ä¹ˆæ‰¾ä¸åˆ°iceboxå‘¢ï¼Ÿ é€šè¿‡windbgçš„!pebå‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿›ç¨‹æŽ§åˆ¶å—ï¼Œç¡®è®¤äº†è¿›ç¨‹çš„çŽ¯å¢ƒå˜é‡ç³»ç»ŸPathç¡®å®žåŒ…å«æ­£ç¡®è·¯å¾„ï¼Œè‡ªæ­¤é™·å…¥åƒµå±€ï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ˜¯æ­£å¸¸çš„ï¼Œ ä½†æ˜¯SearchPathçš„è¿”å›žç»“æžœå°±æ˜¯ä¸å¯¹ã€‚ windbg å°çŸ¥è¯† !stlå‘½ä»¤æ‰“å°stlå­—ç¬¦ä¸² !gleèŽ·å–GetLastErroré”™è¯¯ç  !pebå‘½ä»¤æŸ¥çœ‹è¿›ç¨‹æŽ§åˆ¶å— åƒµå±€æ‰“ç ´ çœŸæ˜¯å±±ç©·æ°´å¤ç–‘æ— è·¯ï¼ŒæŸ³æš—èŠ±æ˜Žåˆä¸€æ‘ï¼Œæ­£å½“ä¸€ç­¹èŽ«å±•ä¹‹æ—¶ï¼Œä¸€ä¸ªè¯¯æ“ä½œåè€Œæ‰“ç ´åƒµå±€ï¼Œè®©æ–°çš„çº¿ç´¢æµ®å‡ºæ°´é¢ï¼Œ æœ¬æ¥æ˜¯æƒ³detachçš„ï¼Œç”±äºŽwindbgå¡ä½æ²¡ååº”ï¼Œå°±æŽ¥ç€ç‚¹äº†å…³é—­windbgï¼Œå¼¹å‡ºå¯¹è¯æ¡†æç¤ºç­‰å¾…è¿˜æ˜¯å–æ¶ˆï¼Œå°±ç‚¹äº†å–æ¶ˆï¼Œ ç»“æžœwindbgæ˜¯é€€å‡ºäº†ï¼Œä½†æ˜¯icegridnode.exeä¹Ÿé€€å‡ºäº†ï¼Œå¹¸å¥½ä¹‹å‰userdumpäº†ï¼Œä¸è¿‡æ¯•ç«Ÿä¸¢å¤±äº†ç¬¬ä¸€æ‰‹çŽ¯å¢ƒï¼Œè¿˜æ˜¯ æœ‰äº›å¯æƒœï¼Œéš¾é“è¿™ä¸ªé—®é¢˜å°±æ­¤åˆæˆäº†æ— å¤´å†¤æ¡ˆï¼Œä¸èƒ½å•Šã€‚ ç»§ç»­ï¼Œè¿™ä¹ˆå¥‡æ€ªçš„é—®é¢˜ä¸æ‰¾å‡ºçœŸç›¸è®©äººä¸çˆ½ï¼Œæ—¢ç„¶icegridnode.exeå·²ç»é€€å‡ºï¼Œé‚£é‡å¯ä¸€ä¸‹ï¼Œçœ‹èƒ½å¦é‡çŽ°é—®é¢˜å§ï¼Œ è¿›å…¥services.mscï¼Œå¯åŠ¨icegridnodeæœåŠ¡ï¼Œå±…ç„¶æŠ¥é”™äº†ï¼ŒæœåŠ¡æ— æ³•å¯åŠ¨ï¼Œé¡¿æ—¶çœ¼å‰ä¸€äº®ï¼Œé©¬ä¸Šæƒ³åˆ°è‚¯å®šè·Ÿç”¨æˆ·æƒé™æœ‰å…³ç³»ï¼Œ æŸ¥çœ‹äº†icegridnodeæœåŠ¡çš„ç”¨æˆ·ï¼Œä½¿ç”¨çš„Local Serviceç”¨æˆ·ï¼Œé‚£ä¹ˆä¼šä¸ä¼šæ˜¯Local Serviceç”¨æˆ·æƒé™é—®é¢˜å¯¼è‡´çš„å‘¢ï¼Ÿ ä»€ä¹ˆæ˜¯Local Serviceç”¨æˆ· å‚è€ƒ1ï¼Œå‚è€ƒ2 LocalSystem è´¦æˆ· LocalSystemæ˜¯é¢„è®¾çš„æ‹¥æœ‰æœ¬æœºæ‰€æœ‰æƒé™çš„æœ¬åœ°è´¦æˆ·ï¼Œè¿™ä¸ªè´¦æˆ·è·Ÿé€šå¸¸çš„ç”¨æˆ·è´¦æˆ·æ²¡æœ‰ä»»ä½•å…³è”ï¼Œä¹Ÿæ²¡æœ‰ç”¨æˆ·åå’Œå¯†ç ä¹‹ç±»çš„å‡­è¯ã€‚è¿™ä¸ªæœåŠ¡è´¦æˆ·å¯ä»¥æ‰“å¼€æ³¨å†Œè¡¨çš„HKEY_LOCAL_MACHINE\Securityé”®ï¼Œå½“LocalSystemè®¿é—®ç½‘ç»œèµ„æºæ—¶ï¼Œå®ƒæ˜¯ä½œä¸ºè®¡ç®—æœºçš„åŸŸè´¦æˆ·ä½¿ç”¨çš„ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œä»¥LocalSystemè´¦æˆ·è¿è¡Œçš„æœåŠ¡ä¸»è¦æœ‰ï¼šWindowsUpdate Clientã€ Clipbookã€Com+ã€DHCP Clientã€Messenger Serviceã€Task Schedulerã€Server Serviceã€Workstation Serviceï¼Œè¿˜æœ‰Windows Installerã€‚ Network Service è´¦æˆ· Network Serviceè´¦æˆ·æ˜¯é¢„è®¾çš„æ‹¥æœ‰æœ¬æœºéƒ¨åˆ†æƒé™çš„æœ¬åœ°è´¦æˆ·ï¼Œå®ƒèƒ½å¤Ÿä»¥è®¡ç®—æœºçš„åä¹‰è®¿é—®ç½‘ç»œèµ„æºã€‚ä½†æ˜¯ä»–æ²¡æœ‰Local System é‚£ä¹ˆå¤šçš„æƒé™ï¼Œä»¥è¿™ä¸ªè´¦æˆ·è¿è¡Œçš„æœåŠ¡ä¼šæ ¹æ®å®žé™…çŽ¯å¢ƒæŠŠè®¿é—®å‡­æ®æäº¤ç»™è¿œç¨‹çš„è®¡ç®—æœºã€‚Network Serviceè´¦æˆ·é€šå¸¸å¯ä»¥è®¿é—®Network Serviceã€Everyoneç»„ï¼Œè¿˜æœ‰è®¤è¯ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„èµ„æºã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œä»¥Network Serviceè´¦æˆ·è¿è¡Œçš„æœåŠ¡ä¸»è¦æœ‰ï¼šDistributed Transaction Coordinatorã€DNS Clientã€Performance Logs and Alertsï¼Œè¿˜æœ‰RPC Locatorã€‚ Local Service è´¦æˆ· Local Serviceè´¦æˆ·æ˜¯é¢„è®¾çš„æ‹¥æœ‰æœ€å°æƒé™çš„æœ¬åœ°è´¦æˆ·ï¼Œå¹¶åœ¨ç½‘ç»œå‡­è¯ä¸­å…·æœ‰åŒ¿åçš„èº«ä»½ã€‚Local Serviceè´¦æˆ·é€šå¸¸å¯ä»¥è®¿é—®Local Serviceã€Everyoneç»„è¿˜æœ‰è®¤è¯ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„èµ„æºã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œä»¥Local Serviceè´¦æˆ·è¿è¡Œçš„æœåŠ¡ä¸»è¦æœ‰ï¼šAlerterã€Remote Registryã€Smart Cardã€SSDPï¼Œè¿˜æœ‰WebClientã€‚ ç¬¬ä¸‰æ¬¡å°è¯•ï¼ŒéªŒè¯çŒœæƒ³ æ„Ÿè§‰çœŸç›¸åº”è¯¥å¿«å‡ºæ¥äº†ï¼ŒæŽ¥ä¸‹æ¥éªŒè¯ä¸€ä¸‹è‡ªå·±çš„çŒœæƒ³ï¼Œå¾ˆç®€å•åªè¦ç”¨Local Serviceç”¨æˆ·è¿è¡Œcmdï¼Œåœ¨cmdä¸­è¿è¡Œwhereå‘½ä»¤å°±å¯ä»¥éªŒè¯äº†ï¼› é¦–å…ˆæƒ³åˆ°runaså‘½ä»¤ï¼Œå°è¯•äº†ä¸€ä¸‹ï¼Œå¯¹å†…ç½®ç”¨æˆ·æ— æ³•ä½¿ç”¨ï¼› å¼€å§‹googleå¦‚ä½•ä½¿ç”¨Local Serviceç”¨æˆ·è¿è¡ŒæŸä¸ªç¨‹åºï¼Œè¿˜çœŸæ‰¾åˆ°äº†æ–¹æ³•ï¼Œé€šè¿‡psexecå·¥å…·ï¼Œ è¿™æ˜¯ä¸€ä¸ªéžå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œç‚¹å‡»æ­¤å¤„ä¸‹è½½ï¼Œå…¶å®žé‡Œé¢è¿˜æœ‰ä¸€ç³»åˆ—å…¶ä»–å·¥å…·ï¼› æ‰§è¡Œpsexec.exe -i -u â€œnt authority\localserviceâ€ cmdå‘½ä»¤ï¼Œå¼¹å‡ºæ–°çš„cmdçª—å£ï¼Œæ‰§è¡Œwhoamiå‘½ä»¤ï¼Œç¡®è®¤ç¡®å®žä½¿ç”¨localserviceç”¨æˆ·è¿è¡Œçš„ï¼Œ æ³¨æ„è¿™é‡Œlocalserviceç”¨æˆ·çš„å…¨åæ˜¯nt authority\localserviceï¼Œç„¶åŽè¿è¡Œwhere iceboxå‘½ä»¤ï¼Œç¡®å®žæ‰¾ä¸åˆ°ï¼ŒåŒæ—¶ä»¥administratorè¿è¡Œcmdï¼Œ ç¡®è®¤å¯ä»¥æ‰¾åˆ°ï¼Œè‡³æ­¤å¯ä»¥å®Œå…¨ç¡®å®šé—®é¢˜æ˜¯ç”±localserviceç”¨æˆ·æƒé™å¯¼è‡´ã€‚ è¿›ä¸€æ­¥æ‰¾åˆ°æ ¹æº è¦ä¿®å¤é—®é¢˜è¿˜éœ€è¦æ‰¾åˆ°åˆ°åº•æ˜¯ä»€ä¹ˆå½±å“äº†localserviceç”¨æˆ·çš„æƒé™ï¼Œå¯ä»¥é€šè¿‡å¯¹æ¯”æ­£å¸¸çš„æœºå™¨çš„è®¾ç½®æ‰¾åˆ°å·®å¼‚ï¼Œ é¦–å…ˆæƒ³åˆ°çš„æ˜¯ç»„ç­–ç•¥ä¸­æ˜¯å¦æœ‰å¯¹localserviceç”¨æˆ·æƒé™çš„è®¾ç½®ï¼Œè¿è¡Œgpedit.mscæ‰“å¼€ç»„ç­–ç•¥ï¼Œå¯¹æ¯”æ­£å¸¸æœºå™¨å’Œé—®é¢˜æœºå™¨ï¼Œ ç¡®å®žå‘çŽ°æœ‰ä¸€é¡¹ä¸¤è¾¹æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¿®æ”¹ä¹‹åŽå¹¶æ²¡æœ‰æ•ˆæžœï¼Œä¸‹å›¾ä¸ºæ­£å¸¸æœºå™¨çš„æˆªå›¾ï¼› ç„¶åŽæƒ³åˆ°çš„å¯èƒ½æ˜¯ç›®å½•çš„æƒé™è®¾ç½®é—®é¢˜ï¼Œå¯¹æ¯”æ­£å¸¸æœºå™¨å’Œé—®é¢˜æœºå™¨ï¼Œå‘çŽ°é—®é¢˜æœºå™¨å°‘äº†Usersç”¨æˆ·ç»„çš„æƒé™ï¼Œä¸‹å›¾ä¸ºæ­£å¸¸æœºå™¨æˆªå›¾ï¼š ç„¶åŽåœ¨é—®é¢˜æœºå™¨ä¸Šå‚ç…§æ­£å¸¸æœºå™¨æ·»åŠ Usersç”¨æˆ·ç»„çš„â€œRead &amp; execute,List folder contents,Read,Special permissions (Create files/write data,Create folders/append data)â€æƒé™ï¼Œæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»å‡ºçŽ°äº†ï¼Œwhereå‘½ä»¤å¯ä»¥æ­£ç¡®æ‰¾åˆ°iceboxäº†ï¼Œ icegridnodeæœåŠ¡ä¹Ÿå¯ä»¥æ­£å¸¸å¯åŠ¨äº†ï¼ŒéªŒè¯äº†ä¸€ä¸‹åœ¨IceGridGUIä¸­startæœåŠ¡ä¹Ÿæ˜¯OKçš„ï¼Œç„¶åŽåˆ é™¤ä»¥ä¸Šæƒé™ï¼Œå†éªŒè¯æ˜¯å¦é—®é¢˜èƒ½å¤çŽ°ï¼Œæžœç„¶é—®é¢˜å¤çŽ°äº†ï¼Œ é—®é¢˜çš„æ ¹æºç»ˆäºŽæ‰¾åˆ°ï¼Œé—®é¢˜ä¹Ÿå¾—ä»¥åœ†æ»¡è§£å†³ï¼ŒHappyï¼ï¼ï¼ä»Žæ­£å¸¸æœºå™¨æ¥çœ‹ï¼Œiceboxæ‰€åœ¨ç›®å½•çš„æƒé™å…¶å®žæ˜¯ä»ŽD:\ç»§æ‰¿çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿çˆ¶çš„æƒé™æ¥ä¿®æ”¹ã€‚ ä»€ä¹ˆæ˜¯Usersç”¨æˆ·ç»„ å‚è€ƒ æ™®é€šç”¨æˆ·ç»„ï¼Œè¿™ä¸ªç»„çš„ç”¨æˆ·æ— æ³•è¿›è¡Œæœ‰æ„æˆ–æ— æ„çš„æ”¹åŠ¨ã€‚å› æ­¤ï¼Œç”¨æˆ·å¯ä»¥è¿è¡Œç»è¿‡éªŒè¯çš„åº”ç”¨ç¨‹åºï¼Œä½†ä¸å¯ä»¥è¿è¡Œå¤§å¤šæ•°æ—§ç‰ˆåº”ç”¨ç¨‹åºã€‚Users ç»„æ˜¯æœ€å®‰å…¨çš„ç»„ï¼Œå› ä¸ºåˆ†é…ç»™è¯¥ç»„çš„é»˜è®¤æƒé™ä¸å…è®¸æˆå‘˜ä¿®æ”¹æ“ä½œç³»ç»Ÿçš„è®¾ç½®æˆ–ç”¨æˆ·èµ„æ–™ã€‚Users ç»„æä¾›äº†ä¸€ä¸ªæœ€å®‰å…¨çš„ç¨‹åºè¿è¡ŒçŽ¯å¢ƒã€‚åœ¨ç»è¿‡ NTFS æ ¼å¼åŒ–çš„å·ä¸Šï¼Œé»˜è®¤å®‰å…¨è®¾ç½®æ—¨åœ¨ç¦æ­¢è¯¥ç»„çš„æˆå‘˜å±åŠæ“ä½œç³»ç»Ÿå’Œå·²å®‰è£…ç¨‹åºçš„å®Œæ•´æ€§ã€‚ç”¨æˆ·ä¸èƒ½ä¿®æ”¹ç³»ç»Ÿæ³¨å†Œè¡¨è®¾ç½®ã€æ“ä½œç³»ç»Ÿæ–‡ä»¶æˆ–ç¨‹åºæ–‡ä»¶ã€‚Users å¯ä»¥å…³é—­å·¥ä½œç«™ï¼Œä½†ä¸èƒ½å…³é—­æœåŠ¡å™¨ã€‚Users å¯ä»¥åˆ›å»ºæœ¬åœ°ç»„ï¼Œä½†åªèƒ½ä¿®æ”¹è‡ªå·±åˆ›å»ºçš„æœ¬åœ°ç»„ã€‚ å®ƒå—administratorã€admin ç­‰ç®¡ç†å‘˜çš„ç®¡åˆ¶å’Œå®‰æŽ’ã€‚æ¯”å¦‚ï¼šä½ å®¶æˆ–ä½ å¯å®¤é‡Œåªæœ‰ä½ è‡ªå·±1å°ç”µè„‘ï¼Œä½ å¯ä»¥è®¾ç½®ä¸¤ä¸ªç”¨æˆ·ï¼Œä¸€ä¸ªç®¡ç†å‘˜ï¼Œå¦ä¸€ä¸ªä¸ºæ™®é€šç”¨æˆ·ã€‚è¿™æ ·ï¼Œåœ¨ç®¡ç†å‘˜èº«ä»½ä¸‹ï¼Œè®¾ç½®æ–‡ä»¶çš„â€œåªè¯»â€å±žæ€§ï¼Œç¦æ­¢â€œæ·»åŠ æˆ–åˆ é™¤ç¨‹åºâ€â€¦â€¦ä½ å¯ä»¥æ”¾å¿ƒä»–äººä¸ä¼šä¿®æ”¹æˆ–åˆ é™¤ä½ çš„èµ„æ–™ï¼Œå¦å¤–ï¼Œä¹Ÿå¯ä»¥é˜²æ­¢ä»–äººç”¨ä½ çš„æœºå™¨æ¥ä¸‹è½½ä¸œè¥¿ã€‚ æ€»ç»“ è°ƒè¯•çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªæŠ½ä¸æ‹¨èŒ§çš„è¿‡ç¨‹ï¼Œå±‚å±‚æ·±å…¥ï¼Œéœ€è¦è¶³å¤Ÿçš„è€å¿ƒå’Œç»†å¿ƒï¼Œæ¯èµ°ä¸€æ­¥å‰å…ˆä»”ç»†åˆ†æžä¸€ä¸‹ï¼Œç„¶åŽéªŒè¯è‡ªå·±çš„çŒœæƒ³ï¼Œä»»ä½•é—®é¢˜ä¸€å®šæœ‰å…¶æ ¹æœ¬åŽŸå› ï¼Œ åªè¦ä¸è½»æ˜“æ”¾å¼ƒï¼Œé€šè¿‡ä¸€å®šæŠ€å·§åŠåŠªåŠ›ï¼Œä¸€å®šæ˜¯å¯ä»¥æ‰¾åˆ°é—®é¢˜åŽŸå› çš„ï¼› è°ƒè¯•çš„è¿‡ç¨‹å¯ä»¥å­¦åˆ°å¾ˆå¤šæ–°çš„çŸ¥è¯†ï¼Œè¿™ä¸ªé—®é¢˜ä¸­æœ‰å¾ˆå¤šçŸ¥è¯†å…¶å®žæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œæ¯”å¦‚Windowsçš„ç”¨æˆ·æƒé™çŸ¥è¯†ï¼Œä½†æ˜¯é€šè¿‡é—®é¢˜çº¿ç´¢ï¼Œé¡ºè—¤æ‘¸ç“œï¼Œåœ¨Googleçš„å¸®åŠ© ä¸‹ï¼Œæ—¢å­¦åˆ°äº†æ–°çš„çŸ¥è¯†ï¼Œé—®é¢˜ä¹Ÿå¾—ä»¥è§£å†³ï¼Œä¸ªäººèƒ½åŠ›å°±æ˜¯è¿™æ ·æå‡ä¸Šæ¥çš„ï¼Œä½†æ˜¯å¦‚æžœè§£å†³é—®é¢˜åŠé€”è€ŒåºŸï¼Œé‚£ä¹ˆéšè—å…¶ä¸­çš„å¾ˆå¤šåŽŸç†å’Œç›¸å…³çŸ¥è¯†ï¼Œä½ å°±æ— ç¼˜çŸ¥æ™“ï¼› Windowså¹³å°ä¸‹çš„windbgç»å¯¹æ˜¯ç¥žå™¨ï¼Œå¤§éƒ¨åˆ†é—®é¢˜ï¼Œå¦‚æžœwindbgè°ƒä¸å‡ºé—®é¢˜ï¼Œé‚£åŸºæœ¬ä¸Šå¯ä»¥æ–­å®šåº”è¯¥ä¸æ˜¯ç¨‹åºæœ¬èº«çš„é—®é¢˜ï¼Œè¿™ä¹ˆå¥½çš„ä¸œè¥¿ï¼Œè¿˜ä¸èµ¶å¿«å­¦ï¼› è°ƒè¯•ä¹‹å‰ä¸€å®šæ³¨æ„å…ˆæ”¶é›†å„ç§çº¿ç´¢ä»¥åŠä¿æŠ¤å¥½çŽ¯å¢ƒï¼Œé€€å‡ºè°ƒè¯•æ—¶ä¸€å®šè¦detachï¼Œä»¥å…çŽ¯å¢ƒè¢«ç ´åï¼Œè¿™æ ·é—®é¢˜å¯èƒ½å°±æ°¸è¿œæ— æ³•å¾—è§å¤©æ—¥ï¼› æµè§ˆäº†ä¸€ä¸‹iceçš„æ‰‹å†Œï¼Œåœ¨Widnows Servicesä¸€ç« ï¼Œæåˆ°å®‰è£…icegridnodeä¸ºWindowsæœåŠ¡æ—¶å»ºè®®ä½¿ç”¨LocalServiceç”¨æˆ·ï¼Œå¹¶ä¸”å‘çŽ°äº†icaclså‘½ä»¤ï¼Œ å¯ä»¥ç”¨äºŽæŸ¥çœ‹å’Œä¿®æ”¹æ–‡ä»¶çš„æƒé™ï¼ŒåŸºäºŽè¿™äº›å†…å®¹å¯¹æœ¬é—®é¢˜å…¶å®žä¹Ÿå¯ä»¥åšä¸€äº›æŽ¨æ–­ï¼› æœ€åŽå…¶å®žè¿˜æœ‰ä¸€ä¸ªç–‘é—®ï¼Œæ—¢ç„¶æ²¡æœ‰æƒé™ï¼Œä¸ºä»€ä¹ˆSearchPathçš„GetLastErroré”™è¯¯ç æ˜¯0ï¼Œå¦‚æžœè¿™ä¸ªæ—¶å€™ä»Žé”™è¯¯ç å°±èƒ½åˆ¤æ–­é”™è¯¯ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ›´å®¹æ˜“è§£å†³äº†ã€‚å½“ç„¶ ä¹Ÿè®¸SearchPathå†…éƒ¨è¿˜è°ƒç”¨äº†å…¶ä»–APIå‡½æ•°ï¼Œå¯¼è‡´GetLastErrorä¸º0ï¼Œä¸ç®¡æ€Žä¹ˆæ ·å¦‚æžœSearchPathçš„æŽ¥å£è®¾è®¡çš„å¥½ä¸€ç‚¹ï¼ŒæŸ¥é—®é¢˜å°±æ›´å®¹æ˜“äº†ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼è®¡ç®—</category>
      </categories>
      <tags>
        <tag>ice</tag>
        <tag>icegrid</tag>
        <tag>windbg</tag>
      </tags>
  </entry>
</search>
